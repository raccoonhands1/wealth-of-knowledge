/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var T0=Object.create;var vi=Object.defineProperty;var A0=Object.getOwnPropertyDescriptor;var F0=Object.getOwnPropertyNames;var E0=Object.getPrototypeOf,P0=Object.prototype.hasOwnProperty;var D0=(o,e,t)=>e in o?vi(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var vu=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),bu=(o,e)=>{for(var t in e)vi(o,t,{get:e[t],enumerable:!0})},Th=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of F0(e))!P0.call(o,n)&&n!==t&&vi(o,n,{get:()=>e[n],enumerable:!(r=A0(e,n))||r.enumerable});return o};var Uo=(o,e,t)=>(t=o!=null?T0(E0(o)):{},Th(e||!o||!o.__esModule?vi(t,"default",{value:o,enumerable:!0}):t,o)),R0=o=>Th(vi({},"__esModule",{value:!0}),o);var vt=(o,e,t)=>D0(o,typeof e!="symbol"?e+"":e,t);var Dn=vu((C3,Fh)=>{"use strict";function co(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function Ah(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function U0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var us={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),co(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=Ah(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(co(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Ah(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return co(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];co(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":us.normalize(e)},relative:function(e,t){if(co(e),co(t),e===t||(e=us.resolve(e),t=us.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,u=-1,f=0;f<=c;++f){if(f===c){if(l>c){if(t.charCodeAt(i+f)===47)return t.slice(i+f+1);if(f===0)return t.slice(i+f)}else s>c&&(e.charCodeAt(r+f)===47?u=f:f===0&&(u=0));break}var d=e.charCodeAt(r+f),m=t.charCodeAt(i+f);if(d!==m)break;d===47&&(u=f)}var p="";for(f=r+u+1;f<=n;++f)(f===n||e.charCodeAt(f)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(i+u):(i+=u,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(co(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');co(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){co(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return U0("/",e)},parse:function(e){co(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,u=e.length-1,f=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?i===-1?i=u:f!==1&&(f=1):i!==-1&&(f=-1)}return i===-1||l===-1||f===0||f===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};us.posix=us;Fh.exports=us});var lv=vu((sU,av)=>{var ov=require("url").parse,dC=require("events"),pC=require("https"),mC=require("http"),hC=require("util"),gC=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],iv=[239,187,191],yC=58,vC=32,nv=10,bC=13,sv=1024*256,_C=/^(cookie|authorization)$/i;function wC(o){return iv.every(function(e,t){return o[t]===e})}function _t(o,e){var t=_t.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==_t.CLOSED&&(t=_t.CONNECTING,p("error",new Qi("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==_t.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,m())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",f="",d=null;function m(){var g=ov(o),I=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var L=n?SC(r):r;for(var k in L){var C=L[k];C&&(g.headers[k]=C)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var T=e&&e.proxy;if(T){var A=ov(e.proxy);I=A.protocol==="https:",g.protocol=I?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=A.hostname,g.host=A.host,g.port=A.port}if(e&&e.https){for(var E in e.https)if(gC.indexOf(E)!==-1){var P=e.https[E];P!==void 0&&(g[E]=P)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(I?pC:mC).request(g,function(M){if(s.connectionInProgress=!1,M.statusCode===500||M.statusCode===502||M.statusCode===503||M.statusCode===504){p("error",new Qi("error",{status:M.statusCode,message:M.statusMessage})),i();return}if(M.statusCode===301||M.statusCode===302||M.statusCode===307){var $=M.headers.location;if(!$){p("error",new Qi("error",{status:M.statusCode,message:M.statusMessage}));return}var W=new URL(o).origin,O=new URL($).origin;n=W!==O,M.statusCode===307&&(d=o),o=$,process.nextTick(m);return}if(M.statusCode!==200)return p("error",new Qi("error",{status:M.statusCode,message:M.statusMessage})),s.close();t=_t.OPEN,M.on("close",function(){M.removeAllListeners("close"),M.removeAllListeners("end"),i()}),M.on("end",function(){M.removeAllListeners("close"),M.removeAllListeners("end"),i()}),p("open",new Qi("open"));var N,te,Z=0,Q=-1,ye=0,z=0;M.on("data",function(q){N?(q.length>N.length-z&&(ye=N.length*2+q.length,ye>sv&&(ye=N.length+q.length+sv),te=Buffer.alloc(ye),N.copy(te,0,0,z),N=te),q.copy(N,z),z+=q.length):(N=q,wC(N)&&(N=N.slice(iv.length)),z=N.length);for(var X=0,fe=z;X<fe;){c&&(N[X]===nv&&++X,c=!1);for(var j=-1,ee=Q,re,de=Z;j<0&&de<fe;++de)re=N[de],re===yC?ee<0&&(ee=de-X):re===bC?(c=!0,j=de-X):re===nv&&(j=de-X);if(j<0){Z=fe-X,Q=ee;break}else Z=0,Q=-1;v(N,X,ee,j),X+=j+1}X===fe?(N=void 0,z=0):X>0&&(N=N.slice(X,z),z=N.length)})}),a.on("error",function(M){s.connectionInProgress=!1,i(M.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}m();function p(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==_t.CLOSED&&(t=_t.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function v(g,I,L,k){if(k===0){if(u.length>0){var C=f||"message";p(C,new xC(C,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}f=void 0}else if(L>0){var T=L<0,A=0,E=g.slice(I,I+(T?k:L)).toString();T?A=k:g[I+L+1]!==vC?A=L+1:A=L+2,I+=A;var P=k-A,M=g.slice(I,I+P).toString();if(E==="data")u+=M+`
`;else if(E==="event")f=M;else if(E==="id")l=M;else if(E==="retry"){var $=parseInt(M,10);Number.isNaN($)||(s.reconnectInterval=$)}}}}av.exports=_t;hC.inherits(_t,dC.EventEmitter);_t.prototype.constructor=_t;["open","error","message"].forEach(function(o){Object.defineProperty(_t.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(_t,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(_t,"OPEN",{enumerable:!0,value:1});Object.defineProperty(_t,"CLOSED",{enumerable:!0,value:2});_t.prototype.CONNECTING=0;_t.prototype.OPEN=1;_t.prototype.CLOSED=2;_t.prototype.close=function(){this._close()};_t.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};_t.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};_t.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Qi(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function xC(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function SC(o){var e={};for(var t in o)_C.test(t)||(e[t]=o[t]);return e}});var Gl=vu((rV,Js)=>{var ge=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},ut=-1,dt=1,We=0;ge.Diff=function(o,e){return[o,e]};ge.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ge.Diff(We,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new ge.Diff(We,a)),l&&c.push(new ge.Diff(We,l)),this.diff_cleanupMerge(c),c};ge.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new ge.Diff(dt,e)];if(!e)return[new ge.Diff(ut,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new ge.Diff(dt,s.substring(0,a)),new ge.Diff(We,i),new ge.Diff(dt,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=ut),n;if(i.length==1)return[new ge.Diff(ut,o),new ge.Diff(dt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],f=l[2],d=l[3],m=l[4],p=this.diff_main(c,f,t,r),v=this.diff_main(u,d,t,r);return p.concat([new ge.Diff(We,m)],v)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ge.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new ge.Diff(We,""));for(var i=0,a=0,l=0,c="",u="";i<s.length;){switch(s[i][0]){case dt:l++,u+=s[i][1];break;case ut:a++,c+=s[i][1];break;case We:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var f=this.diff_main(c,u,!1,t),d=f.length-1;d>=0;d--)s.splice(i,0,f[d]);i=i+f.length}l=0,a=0,c="",u="";break}i++}return s.pop(),s};ge.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),u=0;u<a;u++)l[u]=-1,c[u]=-1;l[i+1]=0,c[i+1]=0;for(var f=r-n,d=f%2!=0,m=0,p=0,v=0,g=0,I=0;I<s&&!(new Date().getTime()>t);I++){for(var L=-I+m;L<=I-p;L+=2){var k=i+L,C;L==-I||L!=I&&l[k-1]<l[k+1]?C=l[k+1]:C=l[k-1]+1;for(var T=C-L;C<r&&T<n&&o.charAt(C)==e.charAt(T);)C++,T++;if(l[k]=C,C>r)p+=2;else if(T>n)m+=2;else if(d){var A=i+f-L;if(A>=0&&A<a&&c[A]!=-1){var E=r-c[A];if(C>=E)return this.diff_bisectSplit_(o,e,C,T,t)}}}for(var P=-I+v;P<=I-g;P+=2){var A=i+P,E;P==-I||P!=I&&c[A-1]<c[A+1]?E=c[A+1]:E=c[A-1]+1;for(var M=E-P;E<r&&M<n&&o.charAt(r-E-1)==e.charAt(n-M-1);)E++,M++;if(c[A]=E,E>r)g+=2;else if(M>n)v+=2;else if(!d){var k=i+f-P;if(k>=0&&k<a&&l[k]!=-1){var C=l[k],T=i+C-k;if(E=r-E,C>=E)return this.diff_bisectSplit_(o,e,C,T,t)}}}}return[new ge.Diff(ut,o),new ge.Diff(dt,e)]};ge.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),u=this.diff_main(a,l,!1,n);return c.concat(u)};ge.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",u=0,f=-1,d=t.length;f<l.length-1;){f=l.indexOf(`
`,u),f==-1&&(f=l.length-1);var m=l.substring(u,f+1);(r.hasOwnProperty?r.hasOwnProperty(m):r[m]!==void 0)?c+=String.fromCharCode(r[m]):(d==s&&(m=l.substring(u),f=l.length),c+=String.fromCharCode(d),r[m]=d,t[d++]=m),u=f+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};ge.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};ge.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ge.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ge.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};ge.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(p,v,g){for(var I=p.substring(g,g+Math.floor(p.length/4)),L=-1,k="",C,T,A,E;(L=v.indexOf(I,L+1))!=-1;){var P=n.diff_commonPrefix(p.substring(g),v.substring(L)),M=n.diff_commonSuffix(p.substring(0,g),v.substring(0,L));k.length<M+P&&(k=v.substring(L-M,L)+v.substring(L,L+P),C=p.substring(0,g-M),T=p.substring(g+P),A=v.substring(0,L-M),E=v.substring(L+P))}return k.length*2>=p.length?[C,T,A,E,k]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,u,f,d;o.length>e.length?(c=l[0],u=l[1],f=l[2],d=l[3]):(f=l[0],d=l[1],c=l[2],u=l[3]);var m=l[4];return[c,u,f,d,m]};ge.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==We?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==dt?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new ge.Diff(ut,n)),o[t[r-1]+1][0]=dt,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==ut&&o[s][0]==dt){var u=o[s-1][1],f=o[s][1],d=this.diff_commonOverlap_(u,f),m=this.diff_commonOverlap_(f,u);d>=m?(d>=u.length/2||d>=f.length/2)&&(o.splice(s,0,new ge.Diff(We,f.substring(0,d))),o[s-1][1]=u.substring(0,u.length-d),o[s+1][1]=f.substring(d),s++):(m>=u.length/2||m>=f.length/2)&&(o.splice(s,0,new ge.Diff(We,u.substring(0,m))),o[s-1][0]=dt,o[s-1][1]=f.substring(0,f.length-m),o[s+1][0]=ut,o[s+1][1]=u.substring(m),s++),s++}s++}};ge.prototype.diff_cleanupSemanticLossless=function(o){function e(m,p){if(!m||!p)return 6;var v=m.charAt(m.length-1),g=p.charAt(0),I=v.match(ge.nonAlphaNumericRegex_),L=g.match(ge.nonAlphaNumericRegex_),k=I&&v.match(ge.whitespaceRegex_),C=L&&g.match(ge.whitespaceRegex_),T=k&&v.match(ge.linebreakRegex_),A=C&&g.match(ge.linebreakRegex_),E=T&&m.match(ge.blanklineEndRegex_),P=A&&p.match(ge.blanklineStartRegex_);return E||P?5:T||A?4:I&&!k&&C?3:k||C?2:I||L?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==We&&o[t+1][0]==We){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,u=s,f=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=f&&(f=d,l=r,c=n,u=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ge.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ge.whitespaceRegex_=/\s/;ge.linebreakRegex_=/[\r\n]/;ge.blanklineEndRegex_=/\n\r?\n$/;ge.blanklineStartRegex_=/^\r?\n\r?\n/;ge.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==We?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==ut?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new ge.Diff(ut,n)),o[t[r-1]+1][0]=dt,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};ge.prototype.diff_cleanupMerge=function(o){o.push(new ge.Diff(We,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case dt:r++,s+=o[e][1],e++;break;case ut:t++,n+=o[e][1],e++;break;case We:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==We?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new ge.Diff(We,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new ge.Diff(ut,n)),e++),s.length&&(o.splice(e,0,new ge.Diff(dt,s)),e++),e++):e!==0&&o[e-1][0]==We?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==We&&o[e+1][0]==We&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};ge.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==dt&&(t+=o[i][1].length),o[i][0]!==ut&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===ut?s:s+(e-n)};ge.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case dt:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case ut:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case We:e[i]="<span>"+c+"</span>";break}}return e.join("")};ge.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==dt&&(e[t]=o[t][1]);return e.join("")};ge.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==ut&&(e[t]=o[t][1]);return e.join("")};ge.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case dt:t+=i.length;break;case ut:r+=i.length;break;case We:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ge.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case dt:e[t]="+"+encodeURI(o[t][1]);break;case ut:e[t]="-"+o[t][1].length;break;case We:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ge.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new ge.Diff(dt,decodeURI(a))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new ge.Diff(We,c):t[r++]=new ge.Diff(ut,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};ge.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ge.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(C,T){var A=C/e.length,E=Math.abs(t-T);return n.Match_Distance?A+E/n.Match_Distance:E?1:A}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,u,f=e.length+o.length,d,m=0;m<e.length;m++){for(c=0,u=f;c<u;)s(m,t+u)<=i?c=u:f=u,u=Math.floor((f-c)/2+c);f=u;var p=Math.max(1,t-u+1),v=Math.min(t+u,o.length)+e.length,g=Array(v+2);g[v+1]=(1<<m)-1;for(var I=v;I>=p;I--){var L=r[o.charAt(I-1)];if(m===0?g[I]=(g[I+1]<<1|1)&L:g[I]=(g[I+1]<<1|1)&L|((d[I+1]|d[I])<<1|1)|d[I+1],g[I]&l){var k=s(m,I-1);if(k<=i)if(i=k,a=I-1,a>t)p=Math.max(1,2*t-a);else break}}if(s(m+1,t)>i)break;d=g}return a};ge.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ge.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new ge.Diff(We,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new ge.Diff(We,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};ge.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new ge.patch_obj,a=0,l=0,c=0,u=r,f=r,d=0;d<n.length;d++){var m=n[d][0],p=n[d][1];switch(!a&&m!==We&&(i.start1=l,i.start2=c),m){case dt:i.diffs[a++]=n[d],i.length2+=p.length,f=f.substring(0,c)+p+f.substring(c);break;case ut:i.length1+=p.length,i.diffs[a++]=n[d],f=f.substring(0,c)+f.substring(c+p.length);break;case We:p.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=p.length,i.length2+=p.length):p.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,u),s.push(i),i=new ge.patch_obj,a=0,u=f,l=c);break}m!==dt&&(l+=p.length),m!==ut&&(c+=p.length)}return a&&(this.patch_addContext_(i,u),s.push(i)),s};ge.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new ge.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new ge.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};ge.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var u;if(c==-1?u=e.substring(l,l+a.length):u=e.substring(l,c+this.Match_MaxBits),a==u)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var f=this.diff_main(a,u,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(f)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(f);for(var d=0,m,p=0;p<o[s].diffs.length;p++){var v=o[s].diffs[p];v[0]!==We&&(m=this.diff_xIndex(f,d)),v[0]===dt?e=e.substring(0,l+m)+v[1]+e.substring(l+m):v[0]===ut&&(e=e.substring(0,l+m)+e.substring(l+this.diff_xIndex(f,d+v[1].length))),v[0]!==ut&&(d+=v[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};ge.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=We)s.unshift(new ge.Diff(We,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=We)s.push(new ge.Diff(We,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};ge.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new ge.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new ge.Diff(We,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===dt?(a.length2+=u.length,s+=u.length,a.diffs.push(r.diffs.shift()),l=!1):c===ut&&a.diffs.length==1&&a.diffs[0][0]==We&&u.length>2*e?(a.length1+=u.length,n+=u.length,l=!1,a.diffs.push(new ge.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-a.length1-this.Patch_Margin),a.length1+=u.length,n+=u.length,c===We?(a.length2+=u.length,s+=u.length):l=!1,a.diffs.push(new ge.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var f=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);f!==""&&(a.length1+=f.length,a.length2+=f.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===We?a.diffs[a.diffs.length-1][1]+=f:a.diffs.push(new ge.Diff(We,f))),l||o.splice(++t,0,a)}}};ge.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ge.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new ge.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new ge.Diff(ut,l));else if(a=="+")i.diffs.push(new ge.Diff(dt,l));else if(a==" ")i.diffs.push(new ge.Diff(We,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};ge.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ge.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case dt:r="+";break;case ut:r="-";break;case We:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};Js.exports=ge;Js.exports.diff_match_patch=ge;Js.exports.DIFF_DELETE=ut;Js.exports.DIFF_INSERT=dt;Js.exports.DIFF_EQUAL=We});var k3={};bu(k3,{default:()=>yu});module.exports=R0(k3);var ot=require("obsidian"),p0=require("obsidian"),m0=Uo(Dn());var rt=require("obsidian");var Rt=()=>new Map,Ea=o=>{let e=Rt();return o.forEach((t,r)=>{e.set(r,t)}),e},jr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Eh=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},Ph=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var uo=()=>new Set;var Pa=o=>o[o.length-1];var Dh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},zr=Array.from;var wu=Array.isArray;var Da=class{constructor(){this._observers=Rt()}on(e,t){return jr(this._observers,e,uo).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zr((this._observers.get(e)||Rt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Rt()}},fs=class{constructor(){this._observers=Rt()}on(e,t){jr(this._observers,e,uo).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zr((this._observers.get(e)||Rt()).values()).forEach(r=>r(...t))}destroy(){this._observers=Rt()}};var sr=Math.floor;var ds=Math.abs;var ps=(o,e)=>o<e?o:e,Wr=(o,e)=>o>e?o:e,M3=Number.isNaN;var Ra=o=>o!==0?o<0:1/o<0;var Su=Number.MAX_SAFE_INTEGER,T3=Number.MIN_SAFE_INTEGER,A3=1<<31;var Rh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&sr(o)===o),F3=Number.isNaN,E3=Number.parseInt;var O0=String.fromCharCode,P3=String.fromCodePoint,D3=O0(65535),N0=o=>o.toLowerCase(),$0=/^\s*/g,B0=o=>o.replace($0,""),V0=/([A-Z])/g,ku=(o,e)=>B0(o.replace(V0,t=>`${e}${N0(t)}`));var H0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},gs=typeof TextEncoder!="undefined"?new TextEncoder:null,q0=o=>gs.encode(o),Oh=gs?q0:H0;var hs=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});hs&&hs.decode(new Uint8Array).length===1&&(hs=null);var Rn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},On=()=>new Rn;var j0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var _r=o=>{let e=new Uint8Array(j0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},z0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Wr(t,e)*2),o.cpos=0)},Ut=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Oa=Ut;var qe=(o,e)=>{for(;e>127;)Ut(o,128|127&e),e=sr(e/128);Ut(o,127&e)},Na=(o,e)=>{let t=Ra(e);for(t&&(e=-e),Ut(o,(e>63?128:0)|(t?64:0)|63&e),e=sr(e/64);e>0;)Ut(o,(e>127?128:0)|127&e),e=sr(e/128)},Cu=new Uint8Array(3e4),W0=Cu.length/3,K0=(o,e)=>{if(e.length<W0){let t=gs.encodeInto(e,Cu).written||0;qe(o,t);for(let r=0;r<t;r++)Ut(o,Cu[r])}else Ot(o,Oh(e))},G0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;qe(o,r);for(let n=0;n<r;n++)Ut(o,t.codePointAt(n))},Oo=gs&&gs.encodeInto?K0:G0;var wi=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=ps(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Wr(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Ot=(o,e)=>{qe(o,e.byteLength),wi(o,e)},Lu=(o,e)=>{z0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},J0=(o,e)=>Lu(o,4).setFloat32(0,e,!1),Y0=(o,e)=>Lu(o,8).setFloat64(0,e,!1),Q0=(o,e)=>Lu(o,8).setBigInt64(0,e,!1);var $h=new DataView(new ArrayBuffer(4)),Z0=o=>($h.setFloat32(0,o),$h.getFloat32(0)===o),vs=(o,e)=>{switch(typeof e){case"string":Ut(o,119),Oo(o,e);break;case"number":Rh(e)&&ds(e)<=2147483647?(Ut(o,125),Na(o,e)):Z0(e)?(Ut(o,124),J0(o,e)):(Ut(o,123),Y0(o,e));break;case"bigint":Ut(o,122),Q0(o,e);break;case"object":if(e===null)Ut(o,126);else if(wu(e)){Ut(o,117),qe(o,e.length);for(let t=0;t<e.length;t++)vs(o,e[t])}else if(e instanceof Uint8Array)Ut(o,116),Ot(o,e);else{Ut(o,118);let t=Object.keys(e);qe(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Oo(o,n),vs(o,e[n])}}break;case"boolean":Ut(o,e?120:121);break;default:Ut(o,127)}},_i=class extends Rn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&qe(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Bh=o=>{o.count>0&&(Na(o.encoder,o.count===1?o.s:-o.s),o.count>1&&qe(o.encoder,o.count-2))},Un=class{constructor(){this.encoder=new Rn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Bh(this),this.count=1,this.s=e)}toUint8Array(){return Bh(this),_r(this.encoder)}};var Vh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Na(o.encoder,e),o.count>1&&qe(o.encoder,o.count-2)}},bs=class{constructor(){this.encoder=new Rn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Vh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Vh(this),_r(this.encoder)}},Ua=class{constructor(){this.sarr=[],this.s="",this.lensE=new Un}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Rn;return this.sarr.push(this.s),this.s="",Oo(e,this.sarr.join("")),wi(e,this.lensE.toUint8Array()),_r(e)}};var Fr=o=>new Error(o),Kr=()=>{throw Fr("Method unimplemented")},Er=()=>{throw Fr("Unexpected case")};var Hh=Fr("Unexpected end of array"),qh=Fr("Integer out of Range"),_s=class{constructor(e){this.arr=e,this.pos=0}},Jr=o=>new _s(o),jh=o=>o.pos!==o.arr.length;var X0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},jt=o=>X0(o,Be(o));var Nn=o=>o.arr[o.pos++];var Be=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Su)throw qh}throw Hh},Ba=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if((e&128)===0)return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Su)throw qh}throw Hh};var eS=o=>{let e=Be(o);if(e===0)return"";{let t=String.fromCodePoint(Nn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Nn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},tS=o=>hs.decode(jt(o)),Gr=hs?tS:eS;var Au=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},rS=o=>Au(o,4).getFloat32(0,!1),oS=o=>Au(o,8).getFloat64(0,!1),nS=o=>Au(o,8).getBigInt64(0,!1);var sS=[o=>{},o=>null,Ba,rS,oS,nS,o=>!1,o=>!0,Gr,o=>{let e=Be(o),t={};for(let r=0;r<e;r++){let n=Gr(o);t[n]=ws(o)}return t},o=>{let e=Be(o),t=[];for(let r=0;r<e;r++)t.push(ws(o));return t},jt],ws=o=>sS[127-Nn(o)](o),xi=class extends _s{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),jh(this)?this.count=Be(this)+1:this.count=-1),this.count--,this.s}};var $n=class extends _s{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ba(this);let e=Ra(this.s);this.count=1,e&&(this.s=-this.s,this.count=Be(this)+2)}return this.count--,this.s}};var xs=class extends _s{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Ba(this),t=e&1;this.diff=sr(e/2),this.count=1,t&&(this.count=Be(this)+2)}return this.s+=this.diff,this.count--,this.s}},$a=class{constructor(e){this.decoder=new $n(e),this.str=Gr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var O3=crypto.subtle,zh=crypto.getRandomValues.bind(crypto);var Si=()=>zh(new Uint32Array(1))[0];var iS="10000000-1000-4000-8000"+-1e11,Ss=()=>iS.replace(/[018]/g,o=>(o^Si()&15>>o/4).toString(16));var Bn=Date.now;var No=o=>new Promise(o);var aS=Promise.all.bind(Promise);var Eu=o=>o===void 0?null:o;var Pu=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Gh=new Pu,cS=!0;try{typeof localStorage!="undefined"&&localStorage&&(Gh=localStorage,cS=!1)}catch(o){}var Jh=Gh;var Yh=Object.assign,fS=Object.keys,Qh=(o,e)=>{for(let t in o)e(o[t],t)};var ki=o=>fS(o).length;var Zh=o=>{for(let e in o)return!1;return!0},dS=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Du=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),Ru=(o,e)=>o===e||ki(o)===ki(e)&&dS(o,(t,r)=>(t!==void 0||Du(e,r))&&e[r]===t);var Ii=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ii(o,e,t+1)}};var eg=o=>o,pS=(o,e)=>o===e;var ks=(o,e)=>{if(o==null||e==null)return pS(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!ks(o.get(t),e.get(t)))return!1;break}case Object:if(ki(o)!==ki(e))return!1;for(let t in o)if(!Du(o,t)||!ks(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!ks(o[t],e[t]))return!1;break;default:return!1}return!0},tg=(o,e)=>e.includes(o);var Ci=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var B3=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,fo,mS=[],hS=()=>{if(fo===void 0)if(Ci){fo=Rt();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&fo.set(e,""),e=r):e!==null?(fo.set(e,r),e=null):mS.push(r)}e!==null&&fo.set(e,"")}else typeof location=="object"?(fo=Rt(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");fo.set(`--${ku(e,"-")}`,t),fo.set(`-${ku(e,"-")}`,t)}})):fo=Rt();return fo},Ou=o=>hS().has(o);var Nu=o=>Ci?Eu(process.env[o.toUpperCase().replaceAll("-","_")]):Eu(Jh.getItem(o));var gS=o=>Ou("--"+o)||Nu(o)!==null,V3=gS("production"),rg=Ci&&tg(process.env.FORCE_COLOR,["true","1","2"]),og=!Ou("no-colors")&&(!Ci||process.stdout.isTTY||rg)&&(!Ci||Ou("color")||rg||Nu("COLORTERM")!==null||(Nu("TERM")||"").includes("color"));var vS=o=>new Uint8Array(o);var ng=o=>{let e=vS(o.byteLength);return e.set(o),e};var $u=class{constructor(e,t){this.left=e,this.right=t}},Qt=(o,e)=>new $u(o,e);var sg=(o,e)=>o.forEach(t=>e(t.left,t.right));var po=typeof document!="undefined"?document:{},_S=o=>po.createElement(o),wS=()=>po.createDocumentFragment(),xS=o=>po.createTextNode(o),H3=typeof DOMParser!="undefined"?new DOMParser:null;var SS=(o,e)=>(sg(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var kS=o=>{let e=wS();for(let t=0;t<o.length;t++)lg(e,o[t]);return e},ig=(o,e)=>(lg(o,kS(e)),o);var Li=(o,e=[],t=[])=>ig(SS(_S(o),e),t);var Is=xS;var ag=o=>Eh(o,(e,t)=>`${t}:${e};`).join("");var lg=(o,e)=>o.appendChild(e),q3=po.ELEMENT_NODE,j3=po.TEXT_NODE,z3=po.CDATA_SECTION_NODE,W3=po.COMMENT_NODE,K3=po.DOCUMENT_NODE,G3=po.DOCUMENT_TYPE_NODE,J3=po.DOCUMENT_FRAGMENT_NODE;var mo=Symbol;var Mi=mo(),Ti=mo(),Vu=mo(),Hu=mo(),qu=mo(),Ai=mo(),ju=mo(),Fi=mo(),zu=mo(),ug=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var Y3=Bn();var LS={[Mi]:Qt("font-weight","bold"),[Ti]:Qt("font-weight","normal"),[Vu]:Qt("color","blue"),[qu]:Qt("color","green"),[Hu]:Qt("color","grey"),[Ai]:Qt("color","red"),[ju]:Qt("color","purple"),[Fi]:Qt("color","orange"),[zu]:Qt("color","black")},MS=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Rt(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=LS[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=ag(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},TS=og?MS:ug,fg=(...o)=>{console.log(...TS(o)),AS.forEach(e=>e.print(o))};var AS=uo();var dg=o=>({[Symbol.iterator](){return this},next:o}),pg=(o,e)=>dg(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Ha=(o,e)=>dg(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Pi=class{constructor(e,t){this.clock=e,this.len=t}},Vn=class{constructor(){this.clients=new Map}},Mg=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];Og(o,s,a.clock,a.len,t)}}),RS=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=sr((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},ff=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&RS(t,e.clock)!==null},df=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=Wr(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Ku=o=>{let e=new Vn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)Dh(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return df(e),e},Ja=(o,e,t,r)=>{jr(o.clients,e,()=>[]).push(new Pi(t,r))},pf=()=>new Vn,US=o=>{let e=pf();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new Pi(a,l))}}n.length>0&&e.clients.set(r,n)}),e},pn=(o,e)=>{qe(o.restEncoder,e.clients.size),zr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),qe(o.restEncoder,t);let n=r.length;qe(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},Di=o=>{let e=new Vn,t=Be(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Be(o.restDecoder),s=Be(o.restDecoder);if(s>0){let i=jr(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new Pi(o.readDsClock(),o.readDsLen()))}}return e},gg=(o,e,t)=>{let r=new Vn,n=Be(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Be(o.restDecoder),a=Be(o.restDecoder),l=t.clients.get(i)||[],c=Ct(t,i);for(let u=0;u<a;u++){let f=o.readDsClock(),d=f+o.readDsLen();if(f<c){c<d&&Ja(r,i,c,d-c);let m=go(l,f),p=l[m];for(!p.deleted&&p.id.clock<f&&(l.splice(m+1,0,sl(e,p,f-p.id.clock)),m++);m<l.length&&(p=l[m++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&l.splice(m,0,sl(e,p,d-p.id.clock)),p.delete(e))}else Ja(r,i,f,d-f)}}if(r.clients.size>0){let s=new $o;return qe(s.restEncoder,0),pn(s,r),s.toUint8Array()}return null};var Tg=Si,ho=class o extends Da{constructor({guid:e=Ss(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Tg(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new el,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=No(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>No(c=>{let u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&st(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(zr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return st(this,e,t)}get(e,t=Et){let r=jr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==Et&&n!==t)if(n===Et){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Fs)}getText(e=""){return this.get(e,Bi)}getMap(e=""){return this.get(e,Es)}getXmlElement(e=""){return this.get(e,Vi)}getXmlFragment(e=""){return this.get(e,Ps)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){zr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new o({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,st(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Ms=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Be(this.restDecoder)}readDsLen(){return Be(this.restDecoder)}},Ya=class extends Ms{readLeftID(){return Ke(Be(this.restDecoder),Be(this.restDecoder))}readRightID(){return Ke(Be(this.restDecoder),Be(this.restDecoder))}readClient(){return Be(this.restDecoder)}readInfo(){return Nn(this.restDecoder)}readString(){return Gr(this.restDecoder)}readParentInfo(){return Be(this.restDecoder)===1}readTypeRef(){return Be(this.restDecoder)}readLen(){return Be(this.restDecoder)}readAny(){return ws(this.restDecoder)}readBuf(){return ng(jt(this.restDecoder))}readJSON(){return JSON.parse(Gr(this.restDecoder))}readKey(){return Gr(this.restDecoder)}},Gu=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Be(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Be(this.restDecoder)+1;return this.dsCurrVal+=e,e}},mn=class extends Gu{constructor(e){super(e),this.keys=[],Be(e),this.keyClockDecoder=new xs(jt(e)),this.clientDecoder=new $n(jt(e)),this.leftClockDecoder=new xs(jt(e)),this.rightClockDecoder=new xs(jt(e)),this.infoDecoder=new xi(jt(e),Nn),this.stringDecoder=new $a(jt(e)),this.parentInfoDecoder=new xi(jt(e),Nn),this.typeRefDecoder=new $n(jt(e)),this.lenDecoder=new $n(jt(e))}readLeftID(){return new dn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new dn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ws(this.restDecoder)}readBuf(){return jt(this.restDecoder)}readJSON(){return ws(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Ts=class{constructor(){this.restEncoder=On()}toUint8Array(){return _r(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){qe(this.restEncoder,e)}writeDsLen(e){qe(this.restEncoder,e)}},Hn=class extends Ts{writeLeftID(e){qe(this.restEncoder,e.client),qe(this.restEncoder,e.clock)}writeRightID(e){qe(this.restEncoder,e.client),qe(this.restEncoder,e.clock)}writeClient(e){qe(this.restEncoder,e)}writeInfo(e){Oa(this.restEncoder,e)}writeString(e){Oo(this.restEncoder,e)}writeParentInfo(e){qe(this.restEncoder,e?1:0)}writeTypeRef(e){qe(this.restEncoder,e)}writeLen(e){qe(this.restEncoder,e)}writeAny(e){vs(this.restEncoder,e)}writeBuf(e){Ot(this.restEncoder,e)}writeJSON(e){Oo(this.restEncoder,JSON.stringify(e))}writeKey(e){Oo(this.restEncoder,e)}},Qa=class{constructor(){this.restEncoder=On(),this.dsCurrVal=0}toUint8Array(){return _r(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,qe(this.restEncoder,t)}writeDsLen(e){e===0&&Er(),qe(this.restEncoder,e-1),this.dsCurrVal+=e}},$o=class extends Qa{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new bs,this.clientEncoder=new Un,this.leftClockEncoder=new bs,this.rightClockEncoder=new bs,this.infoEncoder=new _i(Oa),this.stringEncoder=new Ua,this.parentInfoEncoder=new _i(Oa),this.typeRefEncoder=new Un,this.lenEncoder=new Un}toUint8Array(){let e=On();return qe(e,0),Ot(e,this.keyClockEncoder.toUint8Array()),Ot(e,this.clientEncoder.toUint8Array()),Ot(e,this.leftClockEncoder.toUint8Array()),Ot(e,this.rightClockEncoder.toUint8Array()),Ot(e,_r(this.infoEncoder)),Ot(e,this.stringEncoder.toUint8Array()),Ot(e,_r(this.parentInfoEncoder)),Ot(e,this.typeRefEncoder.toUint8Array()),Ot(e,this.lenEncoder.toUint8Array()),wi(e,_r(this.restEncoder)),_r(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){vs(this.restEncoder,e)}writeBuf(e){Ot(this.restEncoder,e)}writeJSON(e){vs(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},OS=(o,e,t,r)=>{r=Wr(r,e[0].id.clock);let n=go(e,r);qe(o.restEncoder,e.length-n),o.writeClient(t),qe(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},mf=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{Ct(e,s)>n&&r.set(s,n)}),il(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),qe(o.restEncoder,r.size),zr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{OS(o,e.clients.get(n),n,s)})},NS=(o,e)=>{let t=Rt(),r=Be(o.restDecoder);for(let n=0;n<r;n++){let s=Be(o.restDecoder),i=new Array(s),a=o.readClient(),l=Be(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let u=o.readInfo();switch(31&u){case 0:{let f=o.readLen();i[c]=new ir(Ke(a,l),f),l+=f;break}case 10:{let f=Be(o.restDecoder);i[c]=new ar(Ke(a,l),f),l+=f;break}default:{let f=(u&192)===0,d=new xt(Ke(a,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,f?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,f&&(u&32)===32?o.readString():null,ry(o,u));i[c]=d,l+=d.length}}}}return t},$S=(o,e,t)=>{let r=[],n=zr(t.keys()).sort((m,p)=>m-p);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let m=t.get(n[n.length-1]);for(;m.refs.length===m.i;)if(n.pop(),n.length>0)m=t.get(n[n.length-1]);else return null;return m},i=s();if(i===null)return null;let a=new el,l=new Map,c=(m,p)=>{let v=l.get(m);(v==null||v>p)&&l.set(m,p)},u=i.refs[i.i++],f=new Map,d=()=>{for(let m of r){let p=m.id.client,v=t.get(p);v?(v.i--,a.clients.set(p,v.refs.slice(v.i)),t.delete(p),v.i=0,v.refs=[]):a.clients.set(p,[m]),n=n.filter(g=>g!==p)}r.length=0};for(;;){if(u.constructor!==ar){let p=jr(f,u.id.client,()=>Ct(e,u.id.client))-u.id.clock;if(p<0)r.push(u),c(u.id.client,u.id.clock-1),d();else{let v=u.getMissing(o,e);if(v!==null){r.push(u);let g=t.get(v)||{refs:[],i:0};if(g.refs.length===g.i)c(v,Ct(e,v)),d();else{u=g.refs[g.i++];continue}}else(p===0||p<u.length)&&(u.integrate(o,p),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(i!==null&&i.i<i.refs.length)u=i.refs[i.i++];else{if(i=s(),i===null)break;u=i.refs[i.i++]}}if(a.clients.size>0){let m=new $o;return mf(m,a,new Map),qe(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},BS=(o,e)=>mf(o,e.doc.store,e.beforeState),VS=(o,e,t,r=new mn(o))=>st(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=NS(r,i),c=$S(n,a,l),u=a.pendingStructs;if(u){for(let[d,m]of u.missing)if(m<Ct(a,d)){s=!0;break}if(c){for(let[d,m]of c.missing){let p=u.missing.get(d);(p==null||p>m)&&u.missing.set(d,m)}u.update=tl([u.update,c.update])}}else a.pendingStructs=c;let f=gg(r,n,a);if(a.pendingDs){let d=new mn(Jr(a.pendingDs));Be(d.restDecoder);let m=gg(d,n,a);f&&m?a.pendingDs=tl([f,m]):a.pendingDs=f||m}else a.pendingDs=f;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,Ag(n.doc,d)}},t,!1);var Ag=(o,e,t,r=mn)=>{let n=Jr(e);VS(n,o,t,new r(n))},vo=(o,e,t)=>Ag(o,e,t,Ya),HS=(o,e,t=new Map)=>{mf(o,e.store,t),pn(o,US(e.store))},qS=(o,e=new Uint8Array([0]),t=new $o)=>{let r=Fg(e);HS(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(rk(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===Hn)return ek(n.map((s,i)=>i===0?s:nk(s)));if(t.constructor===$o)return tl(n)}return n[0]},zi=(o,e)=>qS(o,e,new Hn),jS=o=>{let e=new Map,t=Be(o.restDecoder);for(let r=0;r<t;r++){let n=Be(o.restDecoder),s=Be(o.restDecoder);e.set(n,s)}return e},Fg=o=>jS(new Ms(Jr(o))),Eg=(o,e)=>(qe(o.restEncoder,e.size),zr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{qe(o.restEncoder,t),qe(o.restEncoder,r)}),o),zS=(o,e)=>Eg(o,il(e.store)),WS=(o,e=new Qa)=>(o instanceof Map?Eg(e,o):zS(e,o),e.toUint8Array()),Pg=o=>WS(o,new Ts),Ju=class{constructor(){this.l=[]}},yg=()=>new Ju,vg=(o,e)=>o.l.push(e),bg=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Dg=(o,e,t)=>Ii(o.l,[e,t]),dn=class{constructor(e,t){this.client=e,this.clock=t}},Ls=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ke=(o,e)=>new dn(o,e);var Rg=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Er()};var Za=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=u=>this.clients.set(u,i);a.observe(u=>{u.changes.added.forEach(f=>{f.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,Ku([this.dss.get(i)||pf(),Di(new Ms(Jr(d)))]))})})}),this.dss.set(i,Ku(a.map(u=>Di(new Ms(Jr(u)))))),l.observe(u=>u.changes.added.forEach(f=>f.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new Es,i.set("ids",new Fs),i.set("ds",new Fs),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((f,d)=>{r===f&&i.get("ids").push([d])});let c=new Ts,u=this.dss.get(r);u&&(pn(c,u),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let u=new Ts;pn(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(ff(r,e))return t;return null}},Xa=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var hf=o=>new Xa(o.type==null?null:Ke(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ke(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Yu=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},KS=(o,e,t=0)=>new Yu(o,e,t),qa=(o,e,t)=>{let r=null,n=null;return o._item===null?n=Rg(o):r=Ke(o._item.id.client,o._item.id.clock),new Xa(r,n,e,t)},gf=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return qa(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return qa(o,Ke(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return qa(o,r.lastId,t);r=r.right}return qa(o,null,t)};var yf=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(Ct(t,r.client)<=r.clock)return null;let c=Lg(t,r),u=c.item;if(!(u instanceof xt))return null;if(a=u.parent,a._item===null||!a._item.deleted){l=u.deleted||!u.countable?0:c.diff+(i>=0?0:1);let f=u.left;for(;f!==null;)!f.deleted&&f.countable&&(l+=f.length),f=f.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(Ct(t,n.client)<=n.clock)return null;let{item:c}=Lg(t,n);if(c instanceof xt&&c.content instanceof yo)a=c.content.type;else return null}else throw Er();i>=0?l=a._length:l=0}return KS(a,l,o.assoc)},vf=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Ls(o.item,e.item)&&Ls(o.type,e.type)&&o.assoc===e.assoc,Qu=class{constructor(e,t){this.ds=e,this.sv=t}};var GS=(o,e)=>new Qu(o,e),i4=GS(pf(),new Map);var Cs=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!ff(e.ds,o.id),Zu=(o,e)=>{let t=jr(o.meta,Zu,uo),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<Ct(r,s)&&hn(o,Ke(s,n))}),Mg(o,e.ds,n=>{}),t.add(e))};var el=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},il=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},Ct=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},Ug=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Er()}t.push(e)},go=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=sr(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=sr((t+r)/2)}throw Er()},JS=(o,e)=>{let t=o.clients.get(e.client);return t[go(t,e.clock)]},Wa=JS,Xu=(o,e,t)=>{let r=go(e,t),n=e[r];return n.id.clock<t&&n instanceof xt?(e.splice(r+1,0,sl(o,n,t-n.id.clock)),r+1):r},hn=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Xu(o,t,e.clock)]},_g=(o,e,t)=>{let r=e.clients.get(t.client),n=go(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==ir&&r.splice(n+1,0,sl(o,s,t.clock-s.id.clock+1)),s},YS=(o,e,t)=>{let r=o.clients.get(e.id.client);r[go(r,e.id.clock)]=t},Og=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=Xu(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&Xu(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},ef=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Vn,this.beforeState=il(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},wg=(o,e)=>e.deleteSet.clients.size===0&&!Ph(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(df(e.deleteSet),BS(o,e),pn(o,e.deleteSet),!0),xg=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&jr(o.changed,e,uo).add(t)},Ka=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof xt&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},QS=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=go(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){let f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof xt&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},ZS=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=ps(n.length-1,1+go(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+Ka(n,l)}})};var Ng=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{df(s),t.afterState=il(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),Dg(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Ii(a,[]),t._needFormattingCleanup&&hk(t)}finally{r.gc&&QS(s,n,r.gcFilter),ZS(s,n),t.afterState.forEach((u,f)=>{let d=t.beforeState.get(f)||0;if(d!==u){let m=n.clients.get(f),p=Wr(go(m,d),1);for(let v=m.length-1;v>=p;)v-=1+Ka(m,v)}});for(let u=i.length-1;u>=0;u--){let{client:f,clock:d}=i[u].id,m=n.clients.get(f),p=go(m,d);p+1<m.length&&Ka(m,p+1)>1||p>0&&Ka(m,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(fg(Fi,Mi,"[yjs] ",Ti,Ai,"Changed the client-id because another client seems to be using it."),r.clientID=Tg()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Hn;wg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new $o;wg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):Ng(o,e+1)}}},st=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new ef(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&Ng(n,0)}}return i};function*XS(o){let e=Be(o.restDecoder);for(let t=0;t<e;t++){let r=Be(o.restDecoder),n=o.readClient(),s=Be(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Be(o.restDecoder);yield new ar(Ke(n,s),l),s+=l}else if((31&a)!==0){let l=(a&192)===0,c=new xt(Ke(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,ry(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new ir(Ke(n,s),l),s+=l}}}}var Ri=class{constructor(e,t){this.gen=XS(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ar);return this.curr}};var Ui=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},ek=o=>tl(o,Ya,Hn);var tk=(o,e)=>{if(o.constructor===ir){let{client:t,clock:r}=o.id;return new ir(Ke(t,r+e),o.length-e)}else if(o.constructor===ar){let{client:t,clock:r}=o.id;return new ar(Ke(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new xt(Ke(r,n+e),null,Ke(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},tl=(o,e=mn,t=$o)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Jr(u))),n=r.map(u=>new Ri(u,!0)),s=null,i=new t,a=new Ui(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,m)=>{if(d.curr.id.client===m.curr.id.client){let p=d.curr.id.clock-m.curr.id.clock;return p===0?d.curr.constructor===m.curr.constructor?0:d.curr.constructor===ar?1:-1:p}else return m.curr.id.client-d.curr.id.client}),n.length!==0;){let u=n[0],f=u.curr.id.client;if(s!==null){let d=u.curr,m=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),m=!0;if(d===null||d.id.client!==f||m&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)un(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===ar)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{un(a,s.struct,s.offset);let p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ar(Ke(f,s.struct.id.clock+s.struct.length),p),offset:0}}else{let p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===ar?s.struct.length-=p:d=tk(d,p)),s.struct.mergeWith(d)||(un(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==ar;d=u.next())un(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(un(a,s.struct,s.offset),s=null),bf(a);let l=r.map(u=>Di(u)),c=Ku(l);return pn(i,c),i.toUint8Array()},rk=(o,e,t=mn,r=$o)=>{let n=Fg(e),s=new r,i=new Ui(s),a=new t(Jr(o)),l=new Ri(a,!1);for(;l.curr;){let u=l.curr,f=u.id.client,d=n.get(f)||0;if(l.curr.constructor===ar){l.next();continue}if(u.id.clock+u.length>d)for(un(i,u,Wr(d-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===f;)un(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===f&&l.curr.id.clock+l.curr.length<=d;)l.next()}bf(i);let c=Di(a);return pn(s,c),s.toUint8Array()};var $g=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:_r(o.encoder.restEncoder)}),o.encoder.restEncoder=On(),o.written=0)},un=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&$g(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),qe(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},bf=o=>{$g(o);let e=o.encoder.restEncoder;qe(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];qe(e,r.written),wi(e,r.restEncoder)}},ok=(o,e,t,r)=>{let n=new t(Jr(o)),s=new Ri(n,!1),i=new r,a=new Ui(i);for(let c=s.curr;c!==null;c=s.next())un(a,e(c),0);bf(a);let l=Di(n);return pn(i,l),i.toUint8Array()};var nk=o=>ok(o,eg,mn,Hn),Sg="You must not compute changes after the event-handler fired.",As=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=sk(this.currentTarget,this.target))}deletes(e){return ff(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fr(Sg);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=Pa(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=Pa(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=Pa(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Fr(Sg);let t=this.target,r=uo(),n=uo(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},sk=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Bg=80,_f=0,tf=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=_f++}},ik=o=>{o.timestamp=_f++},Vg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=_f++},ak=(o,e,t)=>{if(o.length>=Bg){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Vg(r,e,t),r}else{let r=new tf(e,t);return o.push(r),r}},al=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>ds(e-s.index)<ds(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,ik(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&ds(t.index-n)<r.parent.length/Bg?(Vg(t,r,n),t):ak(o._searchMarker,r,n)},Oi=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=Wr(e,n.index+t))}};var ll=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;jr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Dg(r._eH,t,e)},Et=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=yg(),this._dEH=yg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Kr()}clone(){throw Kr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){vg(this._eH,e)}observeDeep(e){vg(this._dEH,e)}unobserve(e){bg(this._eH,e)}unobserveDeep(e){bg(this._dEH,e)}toJSON(){}},Hg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},qg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Ni=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},jg=(o,e)=>{let t=[];return Ni(o,(r,n)=>{t.push(e(r,n,o))}),t},lk=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},zg=(o,e)=>{let t=al(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},rl=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(n=new xt(Ke(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Ds(c)),n.integrate(o,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:n=new xt(Ke(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new qi(new Uint8Array(f))),n.integrate(o,0);break;case ho:n=new xt(Ke(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new ji(f)),n.integrate(o,0);break;default:if(f instanceof Et)n=new xt(Ke(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new yo(f)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Wg=()=>Fr("Length exceeded!"),Kg=(o,e,t,r)=>{if(t>e._length)throw Wg();if(t===0)return e._searchMarker&&Oi(e._searchMarker,t,r.length),rl(o,e,null,r);let n=t,s=al(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&hn(o,Ke(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&Oi(e._searchMarker,n,r.length),rl(o,e,i,r)},ck=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return rl(o,e,n,t)},Gg=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=al(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&hn(o,Ke(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&hn(o,Ke(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Wg();e._searchMarker&&Oi(e._searchMarker,n,-s+r)},ol=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},wf=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new Ds([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ds([r]);break;case Uint8Array:a=new qi(r);break;case ho:a=new ji(r);break;default:if(r instanceof Et)a=new yo(r);else throw new Error("Unexpected content type")}new xt(Ke(i,Ct(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},xf=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Jg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Yg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var uk=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Cs(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},ja=o=>pg(o.entries(),e=>!e[1].deleted),rf=class extends As{constructor(e,t){super(e,t),this._transaction=t}},Fs=class o extends Et{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new o;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return e.insert(0,this.toArray().map(t=>t instanceof Et?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),ll(this,e,new rf(this,e))}insert(e,t){this.doc!==null?st(this.doc,r=>{Kg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?st(this.doc,t=>{ck(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?st(this.doc,r=>{Gg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return zg(this,e)}toArray(){return qg(this)}slice(e=0,t=this.length){return Hg(this,e,t)}toJSON(){return this.map(e=>e instanceof Et?e.toJSON():e)}map(e){return jg(this,e)}forEach(e){Ni(this,e)}[Symbol.iterator](){return lk(this)}_write(e){e.writeTypeRef(Fk)}},fk=o=>new Fs,of=class extends As{constructor(e,t,r){super(e,t),this.keysChanged=r}},Es=class o extends Et{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return this.forEach((t,r)=>{e.set(r,t instanceof Et?t.clone():t)}),e}_callObserver(e,t){ll(this,e,new of(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof Et?n.toJSON():n}}),e}get size(){return[...ja(this._map)].length}keys(){return Ha(ja(this._map),e=>e[0])}values(){return Ha(ja(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Ha(ja(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?st(this.doc,t=>{ol(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?st(this.doc,r=>{wf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return xf(this,e)}has(e){return Yg(this,e)}clear(){this.doc!==null?st(this.doc,e=>{this.forEach(function(t,r,n){ol(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Ek)}},dk=o=>new Es,fn=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&Ru(o,e),$i=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Er(),this.right.content.constructor){case Pt:this.right.deleted||Rs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},kg=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Pt:e.right.deleted||Rs(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&hn(o,Ke(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},za=(o,e,t,r)=>{let n=new Map,s=r?al(e,t):null;if(s){let i=new $i(s.p.left,s.p,s.index,n);return kg(o,i,t-s.index)}else{let i=new $i(null,e._start,0,n);return kg(o,i,t)}},Qg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Pt&&fn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,u=new xt(Ke(s,Ct(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Pt(a,i));u.integrate(o,0),t.right=u,t.forward()})},Rs=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Zg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===Pt&&fn((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Xg=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],u=(a=t.currentAttributes.get(l))!=null?a:null;if(!fn(u,c)){i.set(l,u);let{left:f,right:d}=t;t.right=new xt(Ke(s,Ct(n.store,s)),f,f&&f.lastId,d,d&&d.id,e,null,new Pt(l,c)),t.right.integrate(o,0),t.forward()}}return i},Wu=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,m)=>{n[m]===void 0&&(n[m]=null)});let s=o.doc,i=s.clientID;Zg(t,n);let a=Xg(o,e,t,n),l=r.constructor===String?new Bo(r):r instanceof Et?new yo(r):new qn(r),{left:c,right:u,index:f}=t;e._searchMarker&&Oi(e._searchMarker,t.index,l.getLength()),u=new xt(Ke(i,Ct(s.store,i)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=f,t.forward(),Qg(o,e,t,a)},Ig=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;Zg(t,n);let a=Xg(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Pt));){if(!t.right.deleted)switch(t.right.content.constructor){case Pt:{let{key:l,value:c}=t.right.content,u=n[l];if(u!==void 0){if(fn(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&hn(o,Ke(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new xt(Ke(i,Ct(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Bo(l)),t.right.integrate(o,0),t.forward()}Qg(o,e,t,a)},ey=(o,e,t,r,n)=>{var c,u;let s=e,i=Rt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Pt){let f=s.content;i.set(f.key,f)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let f=e.content;switch(f.constructor){case Pt:{let{key:d,value:m}=f,p=(c=r.get(d))!=null?c:null;(i.get(d)!==f||p===m)&&(e.delete(o),a++,!l&&((u=n.get(d))!=null?u:null)===m&&p!==m&&(p===null?n.delete(d):n.set(d,p))),!l&&!e.deleted&&Rs(n,f);break}}}e=e.right}return a},pk=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Pt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},mk=o=>{let e=0;return st(o.doc,t=>{let r=o._start,n=o._start,s=Rt(),i=Ea(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case Pt:Rs(i,n.content);break;default:e+=ey(t,r,n,s,i),s=Ea(i),r=n;break}n=n.right}}),e},hk=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&Og(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===Pt&&i.constructor!==ir&&e.add(i.parent)})}st(t,r=>{Mg(o,o.deleteSet,n=>{if(n instanceof ir||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===Pt?e.add(s):pk(r,n)});for(let n of e)mk(n)})},Cg=(o,e,t)=>{let r=t,n=Ea(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case yo:case qn:case Bo:t<e.right.length&&hn(o,Ke(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&ey(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&Oi(i._searchMarker,e.index,-r+t),e},nf=class extends As{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];st(e,r=>{var m,p,v;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",u=0,f=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":f>0&&(g={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((I,L)=>{I!==null&&(g.attributes[L]=I)}))),c="";break;case"retain":u>0&&(g={retain:u},Zh(l)||(g.attributes=Yh({},l))),u=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case yo:case qn:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Bo:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=i.length);break;case Pt:{let{key:g,value:I}=i.content;if(this.adds(i)){if(!this.deletes(i)){let L=(m=n.get(g))!=null?m:null;fn(L,I)?I!==null&&i.delete(r):(a==="retain"&&d(),fn(I,(p=s.get(g))!=null?p:null)?delete l[g]:l[g]=I)}}else if(this.deletes(i)){s.set(g,I);let L=(v=n.get(g))!=null?v:null;fn(L,I)||(a==="retain"&&d(),l[g]=L)}else if(!i.deleted){s.set(g,I);let L=l[g];L!==void 0&&(fn(L,I)?L!==null&&i.delete(r):(a==="retain"&&d(),I===null?delete l[g]:l[g]=I))}i.deleted||(a==="insert"&&d(),Rs(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},Bi=class o extends Et{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new o}clone(){let e=new o;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new nf(this,e,t);ll(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Bo&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?st(this.doc,r=>{let n=new $i(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&Wu(r,this,n,a,i.attributes||{})}else i.retain!==void 0?Ig(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&Cg(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let f={},d=!1;s.forEach((p,v)=>{d=!0,f[v]=p});let m={insert:a};d&&(m.attributes=f),n.push(m),a=""}}let u=()=>{for(;l!==null;){if(Cs(l,e)||t!==void 0&&Cs(l,t))switch(l.content.constructor){case Bo:{let f=s.get("ychange");e!==void 0&&!Cs(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Cs(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case yo:case qn:{c();let f={insert:l.content.getContent()[0]};if(s.size>0){let d={};f.attributes=d,s.forEach((m,p)=>{d[p]=m})}n.push(f);break}case Pt:Cs(l,e)&&(c(),Rs(s,l.content));break}l=l.right}c()};return e||t?st(i,f=>{e&&Zu(f,e),t&&Zu(f,t),u()},"cleanup"):u(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?st(n,s=>{let i=za(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),Wu(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?st(n,s=>{let i=za(s,this,e,!r);Wu(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?st(r,n=>{Cg(n,za(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?st(n,s=>{let i=za(s,this,e,!1);i.right!==null&&Ig(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?st(this.doc,t=>{ol(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?st(this.doc,r=>{wf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return xf(this,e)}getAttributes(){return Jg(this)}_write(e){e.writeTypeRef(Pk)}},gk=o=>new Bi,Ei=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Vi||t.constructor===Ps)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Ps=class o extends Et{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new o}clone(){let e=new o;return e.insert(0,this.toArray().map(t=>t instanceof Et?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ei(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ei(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),zr(new Ei(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){ll(this,e,new sf(this,t,e))}toString(){return jg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Ni(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?st(this.doc,r=>{Kg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)st(this.doc,r=>{let n=e&&e instanceof Et?e._item:e;rl(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Fr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?st(this.doc,r=>{Gg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return qg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return zg(this,e)}slice(e=0,t=this.length){return Hg(this,e,t)}forEach(e){Ni(this,e)}_write(e){e.writeTypeRef(Rk)}},yk=o=>new Ps,Vi=class o extends Ps{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new o(this.nodeName)}clone(){let e=new o(this.nodeName),t=this.getAttributes();return Qh(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof Et?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?st(this.doc,t=>{ol(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?st(this.doc,r=>{wf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return xf(this,e)}hasAttribute(e){return Yg(this,e)}getAttributes(e){return e?uk(this,e):Jg(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return Ni(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(Dk),e.writeKey(this.nodeName)}},vk=o=>new Vi(o.readKey()),sf=class extends As{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},af=class o extends Es{constructor(e){super(),this.hookName=e}_copy(){return new o(this.hookName)}clone(){let e=new o(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Uk),e.writeKey(this.hookName)}},bk=o=>new af(o.readKey()),lf=class o extends Bi{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new o}clone(){let e=new o;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Ok)}},_k=o=>new lf,Hi=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Kr()}mergeWith(e){return!1}write(e,t,r){throw Kr()}integrate(e,t){throw Kr()}},wk=0,ir=class extends Hi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Ug(e.doc.store,this)}write(e,t){e.writeInfo(wk),e.writeLen(this.length-t)}getMissing(e,t){return null}},qi=class o{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new o(this.content)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},xk=o=>new qi(o.readBuf()),nl=class o{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new o(this.len)}splice(e){let t=new o(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Ja(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},Sk=o=>new nl(o.readLen()),ty=(o,e)=>new ho({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),ji=class o{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new o(ty(this.doc.guid,this.opts))}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},kk=o=>new ji(ty(o.readString(),o.readAny())),qn=class o{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new o(this.embed)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Ik=o=>new qn(o.readJSON()),Pt=class o{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new o(this.key,this.value)}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},Ck=o=>new Pt(o.readKey(),o.readJSON()),cf=class o{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new o(this.arr)}splice(e){let t=new o(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Lk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new cf(t)},Ds=class o{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new o(this.arr)}splice(e){let t=new o(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},Mk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Ds(t)},Bo=class o{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new o(this.str)}splice(e){let t=new o(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Tk=o=>new Bo(o.readString()),Ak=[fk,dk,gk,vk,yk,bk,_k],Fk=0,Ek=1,Pk=2,Dk=3,Rk=4,Uk=5,Ok=6,yo=class o{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new o(this.type._copy())}splice(e){throw Kr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},Nk=o=>new yo(Ak[o.readTypeRef()](o)),Lg=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ke(t.client,t.clock+r)),n=Wa(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof xt);return{item:n,diff:r}};var sl=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new xt(Ke(r,n+t),e,Ke(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ke(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var xt=class o extends Hi{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ct(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ct(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===dn&&this.id.client!==this.parent.client&&this.parent.clock>=Ct(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=_g(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=hn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ir||this.right&&this.right.constructor===ir)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===o&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===o&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===dn){let r=Wa(t,this.parent);r.constructor===ir?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=_g(e,e.doc.store,Ke(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),Ls(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(Ls(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(Wa(e.doc.store,n.origin)))s.has(Wa(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ug(e.doc.store,this),this.content.integrate(e,this),xg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ir(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ke(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Ls(e.origin,this.lastId)&&this.right===e&&Ls(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Ja(e.deleteSet,this.id.client,this.id.clock,this.length),xg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Er();this.content.gc(e),t?YS(e,this,new ir(this.id,this.length)):this.content=new nl(this.length)}write(e,t){let r=t>0?Ke(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=Rg(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===dn?(e.writeParentInfo(!1),e.writeLeftID(a)):Er();s!==null&&e.writeString(s)}this.content.write(e,t)}},ry=(o,e)=>$k[e&31](o),$k=[()=>{Er()},Sk,Lk,xk,Tk,Ik,Ck,Nk,Mk,kk,()=>{Er()}],Bk=10,ar=class extends Hi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Er()}write(e,t){e.writeInfo(Bk),qe(e.restEncoder,this.length-t)}getMissing(e,t){return null}},oy=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},ny="__ $YJS$ __";oy[ny]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");oy[ny]=!0;var zn=o=>No((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),sy=(o,e)=>No((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Fr(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),iy=o=>zn(indexedDB.deleteDatabase(o)),ay=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Pr=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>jk(r,n))},Vo=(o,e)=>zn(o.count(e)),ly=(o,e)=>zn(o.get(e)),Sf=(o,e)=>zn(o.delete(e)),cy=(o,e,t)=>zn(o.put(e,t));var cl=(o,e)=>zn(o.add(e)),uy=(o,e,t)=>zn(o.getAll(e,t));var Vk=(o,e,t)=>{let r=null;return qk(o,e,n=>(r=n,!1),t).then(()=>r)},fy=(o,e=null)=>Vk(o,e,"prev");var Hk=(o,e)=>No((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var qk=(o,e,t,r="next")=>Hk(o.openKeyCursor(e,r),n=>t(n.key)),jk=(o,e)=>o.objectStore(e);var dy=(o,e)=>IDBKeyRange.upperBound(o,e),py=(o,e)=>IDBKeyRange.lowerBound(o,e);var kf="custom",my="updates",hy=500,gy=(o,e=()=>{},t=()=>{})=>{let[r]=Pr(o.db,[my]);return uy(r,py(o._dbref,!1)).then(n=>{o._destroyed||(e(r),st(o.doc,()=>{n.forEach(s=>vo(o.doc,s))},o,!1),t(r))}).then(()=>fy(r).then(n=>{o._dbref=n+1})).then(()=>Vo(r).then(n=>{o._dbsize=n})).then(()=>r)},zk=(o,e=!0)=>gy(o).then(t=>{(e||o._dbsize>=hy)&&cl(t,zi(o.doc)).then(()=>Sf(t,dy(o._dbref,!0))).then(()=>Vo(t).then(r=>{o._dbsize=r}))});var gn=class extends fs{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=sy(e,r=>ay(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=No(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,gy(this,i=>cl(i,zi(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=Pr(this.db,[my]);cl(s,r),++this._dbsize>=hy&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{zk(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{iy(this.name)})}get(e){return this._db.then(t=>{let[r]=Pr(t,[kf],"readonly");return ly(r,e)})}set(e,t){return this._db.then(r=>{let[n]=Pr(r,[kf]);return cy(n,t,e)})}del(e){return this._db.then(t=>{let[r]=Pr(t,[kf]);return Sf(r,e)})}};var Sr=Uo(Dn());var yy=0,fl=1,vy=2,dl=(o,e)=>{qe(o,yy);let t=Pg(e);Ot(o,t)},If=(o,e,t)=>{qe(o,fl),Ot(o,zi(e,t))},Wk=(o,e,t)=>If(e,t,jt(o)),by=(o,e,t)=>{try{vo(e,jt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},_y=(o,e)=>{qe(o,vy),Ot(o,e)},Kk=by,wy=(o,e,t,r)=>{let n=Be(o);switch(n){case yy:Wk(o,e,t);break;case fl:by(o,t,r);break;case vy:Kk(o,t,r);break;default:throw new Error("Unknown message type")}return n};var Jk=0;var xy=(o,e,t)=>{switch(Be(o)){case Jk:t(e,Gr(o))}};var Cf=3e4,pl=class extends fs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Bn();this.getLocalState()!==null&&Cf/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&Cf<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&ml(this,r,"timeout")},sr(Cf/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:Bn()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),ks(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},ml=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:Bn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Us=(o,e,t=o.states)=>{let r=e.length,n=On();qe(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;qe(n,i),qe(n,l),Oo(n,JSON.stringify(a))}return _r(n)};var Sy=(o,e,t)=>{let r=Jr(e),n=Bn(),s=[],i=[],a=[],l=[],c=Be(r);for(let u=0;u<c;u++){let f=Be(r),d=Be(r),m=JSON.parse(Gr(r)),p=o.meta.get(f),v=o.states.get(f),g=p===void 0?0:p.clock;(g<d||g===d&&m===null&&o.states.has(f))&&(m===null?f===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(f):o.states.set(f,m),o.meta.set(f,{clock:d,lastUpdated:n}),p===void 0&&m!==null?s.push(f):p!==void 0&&m===null?l.push(f):m!==null&&(ks(m,v)||a.push(f),i.push(f)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var Ns=()=>new Map,My=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Ty=()=>new Set,Zk=Array.from;var Ay=String.fromCharCode,u4=String.fromCodePoint,f4=Ay(65535),Xk=o=>o.toLowerCase(),eI=/^\s*/g,tI=o=>o.replace(eI,""),rI=/([A-Z])/g,ky=(o,e)=>tI(o.replace(rI,t=>`${e}${Xk(t)}`)),oI=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Wi=typeof TextEncoder!="undefined"?new TextEncoder:null,nI=o=>Wi.encode(o),sI=Wi?nI:oI,Lf=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Lf&&Lf.decode(new Uint8Array).length===1&&(Lf=null);var Iy=o=>o===void 0?null:o,iI=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Fy=new iI,Pf=!0;try{typeof localStorage!="undefined"&&(Fy=localStorage,Pf=!1)}catch(o){}var Ey=Fy,aI=o=>Pf||addEventListener("storage",o),lI=o=>Pf||removeEventListener("storage",o),cI=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},uI=(o,e)=>e.includes(o),Vs=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Py=typeof window!="undefined"&&typeof document!="undefined"&&!Vs,d4=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,bo,fI=[],dI=()=>{if(bo===void 0)if(Vs){bo=Ns();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&bo.set(e,""),e=r):e!==null?(bo.set(e,r),e=null):fI.push(r)}e!==null&&bo.set(e,"")}else typeof location=="object"?(bo=Ns(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");bo.set(`--${ky(e,"-")}`,t),bo.set(`-${ky(e,"-")}`,t)}})):bo=Ns();return bo},Tf=o=>dI().has(o),Af=o=>Iy(Vs?process.env[o.toUpperCase()]:Ey.getItem(o)),pI=o=>Tf("--"+o)||Af(o)!==null,p4=pI("production"),Cy=Vs&&uI(process.env.FORCE_COLOR,["true","1","2"]),m4=!Tf("no-colors")&&(!Vs||process.stdout.isTTY||Cy)&&(!Vs||Tf("color")||Cy||Af("COLORTERM")!==null||(Af("TERM")||"").includes("color")),Dy=Math.floor,Ry=(o,e)=>o<e?o:e,mI=(o,e)=>o>e?o:e,h4=Number.isNaN,hI=Math.pow,Uy=128,gI=1<<17,yI=1<<18,vI=1<<19,bI=1<<20,_I=1<<21,wI=1<<22,xI=1<<23,SI=1<<24,kI=1<<25,II=1<<26,CI=1<<27,LI=1<<28,MI=1<<29,TI=1<<30,g4=1<<31,hl=127,y4=gI-1,v4=yI-1,b4=vI-1,_4=bI-1,w4=_I-1,x4=wI-1,S4=xI-1,k4=SI-1,I4=kI-1,C4=II-1,L4=CI-1,M4=LI-1,T4=MI-1,A4=TI-1,AI=Number.MAX_SAFE_INTEGER,F4=Number.MIN_SAFE_INTEGER,E4=1<<31,P4=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Dy(o)===o),D4=Number.isNaN,R4=Number.parseInt,FI=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Yr=()=>new FI,Df=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Dr=o=>{let e=new Uint8Array(Df(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set($y(o.cbuf.buffer,0,o.cpos),t),e},gl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Zt=(o,e)=>{for(;e>hl;)gl(o,Uy|hl&e),e=Dy(e/128);gl(o,hl&e)},Ff=new Uint8Array(3e4),EI=Ff.length/3,PI=(o,e)=>{if(e.length<EI){let t=Wi.encodeInto(e,Ff).written||0;Zt(o,t);for(let r=0;r<t;r++)gl(o,Ff[r])}else $s(o,sI(e))},DI=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Zt(o,r);for(let n=0;n<r;n++)gl(o,t.codePointAt(n))},U4=Wi&&Wi.encodeInto?PI:DI,RI=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Ry(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(mI(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},$s=(o,e)=>{Zt(o,e.byteLength),RI(o,e)},O4=new DataView(new ArrayBuffer(4)),Oy=o=>new Error(o),UI=Oy("Unexpected end of array"),OI=Oy("Integer out of Range"),NI=class{constructor(o){this.arr=o,this.pos=0}},$I=o=>new NI(o),BI=(o,e)=>{let t=$y(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},VI=o=>BI(o,Ny(o)),Ny=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&hl)*t,t*=128,n<Uy)return e;if(e>AI)throw OI}throw UI},HI=o=>new Uint8Array(o),$y=(o,e,t)=>new Uint8Array(o,e,t),qI=o=>new Uint8Array(o),jI=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=Ay(o[t]);return btoa(e)},zI=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),WI=o=>{let e=atob(o),t=HI(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},KI=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},GI=Py?jI:zI,JI=Py?WI:KI,By=new Map,YI=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:JI(e.newValue||"")}),aI(this._onChange)}postMessage(o){Ey.setItem(this.room,GI(qI(o)))}close(){lI(this._onChange)}},QI=typeof BroadcastChannel=="undefined"?YI:BroadcastChannel,Rf=o=>My(By,o,()=>{let e=Ty(),t=new QI(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),ZI=(o,e)=>(Rf(o).subs.add(e),e),XI=(o,e)=>{let t=Rf(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),By.delete(o)),r},Os=(o,e,t=null)=>{let r=Rf(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},Ef=Date.now,eC=class{constructor(){this._observers=Ns()}on(o,e){My(this._observers,o,Ty).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return Zk((this._observers.get(o)||Ns()).values()).forEach(t=>t(...e))}destroy(){this._observers=Ns()}},tC=o=>cI(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Wn=0,Vy=3,Bs=1,rC=2,Ki=[];Ki[Wn]=(o,e,t,r,n)=>{Zt(o,Wn);let s=wy(e,o,t.doc,t);r&&s===fl&&!t.synced&&(t.synced=!0)};Ki[Vy]=(o,e,t,r,n)=>{Zt(o,Bs),$s(o,Us(t.awareness,Array.from(t.awareness.getStates().keys())))};Ki[Bs]=(o,e,t,r,n)=>{Sy(t.awareness,VI(e),t)};Ki[rC]=(o,e,t,r,n)=>{xy(e,t.doc,(s,i)=>oC(t,i))};var Ly=3e4,oC=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Hy=(o,e,t)=>{let r=$I(e),n=Yr(),s=Ny(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},qy=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Ef();let r=Hy(o,new Uint8Array(t.data),!0);Df(r)>1&&e.send(Dr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,ml(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(qy,Ry(hI(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Ef(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Yr();if(Zt(t,Wn),dl(t,o.doc),e.send(Dr(t)),o.awareness.getLocalState()!==null){let r=Yr();Zt(r,Bs),$s(r,Us(o.awareness,[o.doc.clientID])),e.send(Dr(r))}},o.emit("status",[{status:"connecting"}])}},Mf=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Os(o.bcChannel,e,o)},jy=class extends eC{constructor(o,e,t,{connect:r=!0,awareness:n=new pl(t),params:s={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=tC(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=i,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Ki.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let f=Yr();Zt(f,Wn),dl(f,t),this.ws.send(Dr(f))}},a)),this._bcSubscriber=(f,d)=>{if(d!==this){let m=Hy(this,new Uint8Array(f),!1);Df(m)>1&&Os(this.bcChannel,Dr(m),this)}},this._updateHandler=(f,d)=>{if(d!==this){let m=Yr();Zt(m,Wn),_y(m,f),Mf(this,Dr(m))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:f,updated:d,removed:m},p)=>{let v=f.concat(d).concat(m),g=Yr();Zt(g,Bs),$s(g,Us(n,v)),Mf(this,Dr(g))},this._unloadHandler=()=>{ml(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var f;this.wsconnected&&Ly<Ef()-this.wsLastMessageReceived&&((f=this.ws)==null||f.close())},Ly/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(ZI(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Yr();Zt(o,Wn),dl(o,this.doc),Os(this.bcChannel,Dr(o),this);let e=Yr();Zt(e,Wn),If(e,this.doc),Os(this.bcChannel,Dr(e),this);let t=Yr();Zt(t,Vy),Os(this.bcChannel,Dr(t),this);let r=Yr();Zt(r,Bs),$s(r,Us(this.awareness,[this.doc.clientID])),Os(this.bcChannel,Dr(r),this)}disconnectBc(){let o=Yr();Zt(o,Bs),$s(o,Us(this.awareness,[this.doc.clientID],new Map)),Mf(this,Dr(o)),this.bcconnected&&(XI(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(qy(this),this.connectBc())}};var zy=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],yl=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=zy[Si()%zy.length]}};var Nt=new WeakMap,Wy=!1;function bl(o){Wy=o}var Rr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},Xt,er,vl=[];function Ky(o,e,t,r){er=o,Xt=t,r&&(Rr={...Rr,...r}),e.setInterval(Of,Rr.batchInterval)}async function Of(){if(vl.length===0)return;let o=[...vl];vl.length=0;for(let e=0;e<Rr.maxRetries;e++)try{await nC();let t=o.map(Uf).join(`
`)+`
`;await er.append(Xt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Rr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function nC(){let o=await er.stat(Xt);if(o&&o.size>Rr.maxFileSize){for(let e=Rr.maxBackups;e>0;e--){let t=`${Xt}.${e}`,r=`${Xt}.${e+1}`;await er.exists(t)&&(e===Rr.maxBackups?await er.remove(t):await er.rename(t,r))}await er.exists(Xt)&&await er.rename(Xt,`${Xt}.1`),await er.write(Xt,"")}}function Uf(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var sC=["token","authorization","email","key"];function iC(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&sC.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Fe(o,e="log"){return(...t)=>{if(Wy){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(iC).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!Rr.disableConsole)if(Rr.allowStackTraces||e==="debug"||e==="log")console[e](Uf(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${Uf(a)}`,l[e])}vl.push(a)}}}async function _l(){let o=[];await er.exists(Xt)&&o.push(Xt);for(let e=1;e<=Rr.maxBackups;e++){let t=`${Xt}.${e}`;await er.exists(t)&&o.push(t)}return o}async function Gy(){let o=[];if(await er.exists(Xt)){let e=await er.read(Xt);o.push(e)}for(let e=1;e<=Rr.maxBackups;e++){let t=`${Xt}.${e}`;if(await er.exists(t)){let r=await er.read(t);o.push(r)}}return o.reverse().join(`
`)}var Xe=class{constructor(e){let t=e||this.constructor.name;this.debug=Fe(`[${t}]`,"debug"),this.log=Fe(`[${t}]`,"log"),this.warn=Fe(`[${t}]`,"warn"),this.error=Fe(`[${t}]`,"error")}setLoggers(e){this.debug=Fe(`[${e}]`,"debug"),this.log=Fe(`[${e}]`,"log"),this.warn=Fe(`[${e}]`,"warn"),this.error=Fe(`[${e}]`,"error")}};var Hl=require("obsidian");var Ur=class o extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,o.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof o||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},wl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function aC(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||lC,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function Jy(o,e,t){let r=Object.assign({},t||{}),n=r.encode||cC;if(!wl.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!wl.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!wl.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!wl.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!(function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date})(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function lC(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function cC(o){return encodeURIComponent(o)}var Zy;function xl(o){if(o)try{let e=decodeURIComponent(Zy(o.split(".")[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Xy(o,e=0){let t=xl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Zy=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Yy="pb_auth",Gi=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Xy(this.token)}get isAdmin(){return xl(this.token).type==="admin"}get isAuthRecord(){return xl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Yy){let r=aC(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=Yy){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=xl(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=Jy(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let f in this.model)u.includes(f)&&(s.model[f]=this.model[f]);i=Jy(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},$f=class extends Gi{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",(e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)}))}},Ho=class{constructor(e){this.client=e}},Bf=class extends Ho{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then((()=>!0))}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then((()=>!0))}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},Ji=class extends Ho{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then((n=>{var s;return n.items=((s=n.items)==null?void 0:s.map((i=>this.decode(i))))||[],n}))}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then((r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new Ur({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]}))}async getOne(e,t){if(!e)throw new Ur({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((r=>this.decode(r)))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then((r=>this.decode(r)))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then((n=>this.decode(n)))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then((()=>!0))}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then((i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r}));return n(1)}};function wr(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Nf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Vf=class extends Ji{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then((n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n}))}async delete(e,t){return super.delete(e,t).then((r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r}))}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=wr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||Nf(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&(function(c,u,f,d){Nf(c);let m=c.beforeSend,p=c.authStore.model,v=c.authStore.onChange(((g,I)=>{(!g||(I==null?void 0:I.id)!=(p==null?void 0:p.id)||(I!=null&&I.collectionId||p!=null&&p.collectionId)&&(I==null?void 0:I.collectionId)!=(p==null?void 0:p.collectionId))&&Nf(c)}));c._resetAutoRefresh=function(){v(),c.beforeSend=m,delete c._resetAutoRefresh},c.beforeSend=async(g,I)=>{var T;let L=c.authStore.token;if((T=I.query)!=null&&T.autoRefresh)return m?m(g,I):{url:g,sendOptions:I};let k=c.authStore.isValid;if(k&&Xy(c.authStore.token,u))try{await f()}catch(A){k=!1}k||await d();let C=I.headers||{};for(let A in C)if(A.toLowerCase()=="authorization"&&L==C[A]&&c.authStore.token){C[A]=c.authStore.token;break}return I.headers=C,m?m(g,I):{url:g,sendOptions:I}}})(this.client,i,(()=>this.authRefresh({autoRefresh:!0})),(()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s)))),a}async authRefresh(e,t){let r={method:"POST"};return r=wr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=wr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then((()=>!0))}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=wr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then((()=>!0))}},uC=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function ev(o){if(o){o.query=o.query||{};for(let e in o)uC.includes(e)||(o.query[e]=o[e],delete o[e])}}var Sl=class extends Ho{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){ev(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch((e=>{if(!(e!=null&&e.isAbort))throw e}))}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise(((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()}))}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout((()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))}),this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",(e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then((async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()})).then((()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)})).catch((r=>{this.clientId="",this.connectErrorHandler(r)}))}))}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new Ur(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout((()=>{this.initConnect()}),t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Hf=class extends Ji{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then((n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n}))}async delete(e,t){return super.delete(e,t).then((r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r}))}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then((t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]})))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=wr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then((i=>this.authResponse(i)))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=wr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then((c=>this.authResponse(c)))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find((l=>l.name===t.provider));if(!r)throw new Ur(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new Sl(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=Qy(void 0)),new Promise((async(l,c)=>{var u;try{await s.subscribe("@oauth2",(async p=>{let v=s.clientId;try{if(!p.state||v!==p.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let I=await this.authWithOAuth2Code(r.name,p.code,r.codeVerifier,n,t.createData,g);l(I)}catch(g){c(new Ur(g))}a()}));let f={state:s.clientId};(u=t.scopes)!=null&&u.length&&(f.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,f);await(t.urlCallback||function(p){i?i.location.href=p:i=Qy(p)})(d)}catch(f){a(),c(new Ur(f))}}))}async authRefresh(e,t){let r={method:"POST"};return r=wr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then((n=>this.authResponse(n)))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=wr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then((()=>!0))}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=wr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then((()=>!0))}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=wr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then((()=>!0))}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=wr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then((()=>!0))}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=wr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then((()=>!0))}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=wr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then((()=>!0))}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then((()=>!0))}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function Qy(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new Ur(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var qf=class extends Ji{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then((()=>!0))}},jf=class extends Ho{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new Ur({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},zf=class extends Ho{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Wf=class extends Ho{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then((t=>(t==null?void 0:t.token)||""))}},Kf=class extends Ho{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then((()=>!0))}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then((()=>!0))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then((()=>!0))}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then((()=>!0))}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},Kn=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new $f,this.admins=new Vf(this),this.collections=new qf(this),this.files=new Wf(this),this.logs=new jf(this),this.settings=new Bf(this),this.realtime=new Sl(this),this.health=new zf(this),this.backups=new Kf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Hf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then((async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new Ur({url:n.url,status:n.status,data:s});return s})).catch((n=>{throw new Ur(n)}))}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),ev(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter((t=>typeof t!="string")).length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var Hs=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var $t=class $t{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return $t.instance||($t.instance=new $t(new Hs),Nt.set(this.instance,"postie")),$t.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Fe("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Fe("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){Fe("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){$t.instance&&($t.instance.mailboxes=null,$t.instance.allMailLog=[],$t.instance.deliveredMailLog=[],$t.instance.timeProvider.destroy(),$t.instance.timeProvider=null,$t.instance.isDelivering=!1,$t.instance.isInTransaction=!1,$t.instance.currentTransactionId=0,$t._destroyed=!0,$t.instance=void 0)}};$t._destroyed=!1;var Qr=$t;var Gf=new Map;function tv(){for(let[,o]of Gf)o();Gf.clear()}var at=class extends Xe{constructor(t){super();this.observableName=t;this.destroyed=!1;Gf.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Qr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Qr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};var cv=require("obsidian"),uv=require("obsidian");var Yi={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!0,enableDiscordLogin:!1,enableSelfManageHosts:!0,enableToasts:!0,enablePresenceAvatars:!0,enableLiveEmbeds:!0,enablePreviewViewHooks:!0,enableMetadataViewHooks:!0,enableKanbanView:!0};function kl(o){return o in Yi}function fC(){return new Proxy({},{get:(o,e)=>e})}var qo=fC();function He(){return{...lr.getInstance().flags}}function yn(o,e,t=()=>{}){lr.getInstance().flags[o]?e():t()}function rv(o,e,t=()=>{}){o.forEach(r=>{if(lr.getInstance().flags[r]){e();return}}),t()}var lr=class o extends at{constructor(){super("FeatureFlagManager"),this.flags=Yi}async applyServerFlags(e){if(!this.settings)return;let r=e.filter(n=>n.override).reduce((n,s)=>(n[s.name]=s.value,n),{});this.log("applying server flags",r),await this.settings.update(n=>({...n,...r}),!0)}static getInstance(){return o.instance||(o.instance=new o),o.instance}setSettings(e){this.settings=e,this.unsubscribes.push(this.settings.subscribe(t=>{this.flags={...this.flags,...t},this.notifyListeners()}))}getFlag(e){return this.flags[e]}setFlag(e,t){this.settings&&this.settings.update(r=>({...r,[e]:t}))}static destroy(){o.instance&&o.instance.destroy(),o.instance=null}};if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(uv.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=lv()));var lt=async(o,e)=>{var c;let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.7.1"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;try{i=await(0,cv.requestUrl)(s)}catch(u){if((c=u==null?void 0:u.message)!=null&&c.includes("net::ERR_FAILED"))return new Response(JSON.stringify({error:"Network request failed"}),{status:503,statusText:"Service Unavailable",headers:new Headers({"content-type":"application/json"})});throw u}if(!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),He().enableNetworkLogging){let u=i.status>=500?"error":i.status>=400?"warn":"debug",f=i.text,d;if((i.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(f)}catch(p){}Fe("[CustomFetch]",u)(i.status.toString(),r,t,d||f)}if(i.status>=500)throw new Error(i.text);return a};var Il=class extends Gi{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var Lt=crypto,Or=o=>o instanceof CryptoKey;var cr=new TextEncoder,Gt=new TextDecoder,hU=2**32;function vn(...o){let e=o.reduce((n,{length:s})=>n+s,0),t=new Uint8Array(e),r=0;for(let n of o)t.set(n,r),r+=n.length;return t}var fv=o=>{let e=o;typeof e=="string"&&(e=cr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},Zr=o=>fv(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),dv=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},_o=o=>{let e=o;e instanceof Uint8Array&&(e=Gt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return dv(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Jf={};bu(Jf,{JOSEAlgNotAllowed:()=>js,JOSEError:()=>Bt,JOSENotSupported:()=>ht,JWEDecryptionFailed:()=>Zi,JWEInvalid:()=>xr,JWKInvalid:()=>Cl,JWKSInvalid:()=>Ll,JWKSMultipleMatchingKeys:()=>Ml,JWKSNoMatchingKey:()=>Xi,JWKSTimeout:()=>Tl,JWSInvalid:()=>ft,JWSSignatureVerificationFailed:()=>zs,JWTClaimValidationFailed:()=>tr,JWTExpired:()=>qs,JWTInvalid:()=>zt});var Bt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},tr=class extends Bt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},qs=class extends Bt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},js=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},ht=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},Zi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},xr=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},ft=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},zt=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Cl=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Ll=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},Xi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Ml=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Tl=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},zs=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Al=Lt.getRandomValues.bind(Lt);function jo(o,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${o}`)}function Fl(o,e){return o.name===e}function Yf(o){return parseInt(o.name.slice(4),10)}function IC(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function CC(o,e){if(e.length&&!e.some(t=>o.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function mv(o,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Fl(o.algorithm,"HMAC"))throw jo("HMAC");let r=parseInt(e.slice(2),10);if(Yf(o.algorithm.hash)!==r)throw jo(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Fl(o.algorithm,"RSASSA-PKCS1-v1_5"))throw jo("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(Yf(o.algorithm.hash)!==r)throw jo(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Fl(o.algorithm,"RSA-PSS"))throw jo("RSA-PSS");let r=parseInt(e.slice(2),10);if(Yf(o.algorithm.hash)!==r)throw jo(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(o.algorithm.name!=="Ed25519"&&o.algorithm.name!=="Ed448")throw jo("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Fl(o.algorithm,"ECDSA"))throw jo("ECDSA");let r=IC(e);if(o.algorithm.namedCurve!==r)throw jo(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}CC(o,t)}function hv(o,e,...t){var r;if(t.length>2){let n=t.pop();o+=`one of type ${t.join(", ")}, or ${n}.`}else t.length===2?o+=`one of type ${t[0]} or ${t[1]}.`:o+=`of type ${t[0]}.`;return e==null?o+=` Received ${e}`:typeof e=="function"&&e.name?o+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(o+=` Received an instance of ${e.constructor.name}`),o}var Xr=(o,...e)=>hv("Key must be ",o,...e);function Qf(o,e,...t){return hv(`Key for the ${o} algorithm must be `,e,...t)}var Zf=o=>Or(o),Mt=["CryptoKey"];var AC=(...o)=>{let e=o.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(let r of e){let n=Object.keys(r);if(!t||t.size===0){t=new Set(n);continue}for(let s of n){if(t.has(s))return!1;t.add(s)}}return!0},Ws=AC;function FC(o){return typeof o=="object"&&o!==null}function Vt(o){if(!FC(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var El=(o,e)=>{if(o.startsWith("RS")||o.startsWith("PS")){let{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${o} requires key modulusLength to be 2048 bits or larger`)}};var bn=(o,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let r=o.indexOf(e[0],t);if(r===-1)return!1;let n=o.subarray(r,r+e.length);return n.length!==e.length?!1:n.every((s,i)=>s===e[i])||bn(o,e,r+1)},yv=o=>{switch(!0){case bn(o,[42,134,72,206,61,3,1,7]):return"P-256";case bn(o,[43,129,4,0,34]):return"P-384";case bn(o,[43,129,4,0,35]):return"P-521";case bn(o,[43,101,110]):return"X25519";case bn(o,[43,101,111]):return"X448";case bn(o,[43,101,112]):return"Ed25519";case bn(o,[43,101,113]):return"Ed448";default:throw new ht("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},RC=async(o,e,t,r,n)=>{var c;let s,i,a=new Uint8Array(atob(t.replace(o,"")).split("").map(u=>u.charCodeAt(0))),l=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},i=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},i=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},i=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let u=yv(a);s=u.startsWith("P-")?{name:"ECDH",namedCurve:u}:{name:u},i=l?[]:["deriveBits"];break}case"EdDSA":s={name:yv(a)},i=l?["verify"]:["sign"];break;default:throw new ht('Invalid or unsupported "alg" (Algorithm) value')}return Lt.subtle.importKey(e,a,s,(c=n==null?void 0:n.extractable)!=null?c:!1,i)};var vv=(o,e,t)=>RC(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",o,e,t);async function Xf(o,e,t){if(typeof o!="string"||o.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return vv(o,e,t)}var UC=(o,e)=>{if(!(e instanceof Uint8Array)){if(!Zf(e))throw new TypeError(Qf(o,e,...Mt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Mt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},OC=(o,e,t)=>{if(!Zf(e))throw new TypeError(Qf(o,e,...Mt));if(e.type==="secret")throw new TypeError(`${Mt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Mt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Mt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Mt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Mt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},NC=(o,e,t)=>{o.startsWith("HS")||o==="dir"||o.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(o)?UC(o,e):OC(o,e,t)},ta=NC;function jC(o,e,t,r,n){if(n.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new o('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(i=>typeof i!="string"||i.length===0))throw new o('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(let i of r.crit){if(!s.has(i))throw new ht(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new o(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&r[i]===void 0)throw new o(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(r.crit)}var Ks=jC;var zC=(o,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${o}" option must be an array of strings`);if(e)return new Set(e)},td=zC;var GC=Symbol();function Pl(o,e){let t=`SHA-${o.slice(-3)}`;switch(o){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:o.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new ht(`alg ${o} is not supported either by JOSE or your javascript runtime`)}}function Dl(o,e,t){if(Or(e))return mv(e,o,t),e;if(e instanceof Uint8Array){if(!o.startsWith("HS"))throw new TypeError(Xr(e,...Mt));return Lt.subtle.importKey("raw",e,{hash:`SHA-${o.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(Xr(e,...Mt,"Uint8Array"))}var JC=async(o,e,t,r)=>{let n=await Dl(o,e,"verify");El(o,n);let s=Pl(o,n.algorithm);try{return await Lt.subtle.verify(s,n,t,r)}catch(i){return!1}},xv=JC;async function Rl(o,e,t){var v;if(!Vt(o))throw new ft("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new ft('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new ft("JWS Protected Header incorrect type");if(o.payload===void 0)throw new ft("JWS Payload missing");if(typeof o.signature!="string")throw new ft("JWS Signature missing or incorrect type");if(o.header!==void 0&&!Vt(o.header))throw new ft("JWS Unprotected Header incorrect type");let r={};if(o.protected)try{let g=_o(o.protected);r=JSON.parse(Gt.decode(g))}catch(g){throw new ft("JWS Protected Header is invalid")}if(!Ws(r,o.header))throw new ft("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...r,...o.header},s=Ks(ft,new Map([["b64",!0]]),t==null?void 0:t.crit,r,n),i=!0;if(s.has("b64")&&(i=r.b64,typeof i!="boolean"))throw new ft('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new ft('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&td("algorithms",t.algorithms);if(l&&!l.has(a))throw new js('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof o.payload!="string")throw new ft("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new ft("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=await e(r,o),c=!0),ta(a,e,"verify");let u=vn(cr.encode((v=o.protected)!=null?v:""),cr.encode("."),typeof o.payload=="string"?cr.encode(o.payload):o.payload),f;try{f=_o(o.signature)}catch(g){throw new ft("Failed to base64url decode the signature")}if(!await xv(a,e,f,u))throw new zs;let m;if(i)try{m=_o(o.payload)}catch(g){throw new ft("Failed to base64url decode the payload")}else typeof o.payload=="string"?m=cr.encode(o.payload):m=o.payload;let p={payload:m};return o.protected!==void 0&&(p.protectedHeader=r),o.header!==void 0&&(p.unprotectedHeader=o.header),c?{...p,key:e}:p}async function rd(o,e,t){if(o instanceof Uint8Array&&(o=Gt.decode(o)),typeof o!="string")throw new ft("Compact JWS must be a string or Uint8Array");let{0:r,1:n,2:s,length:i}=o.split(".");if(i!==3)throw new ft("Invalid Compact JWS");let a=await Rl({payload:n,protected:r,signature:s},e,t),l={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?{...l,key:a.key}:l}var od=o=>Math.floor(o.getTime()/1e3);var YC=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Ul=o=>{let e=YC.exec(o);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r=e[3].toLowerCase(),n;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return e[1]==="-"||e[4]==="ago"?-n:n};var Sv=o=>o.toLowerCase().replace(/^application\//,""),QC=(o,e)=>typeof o=="string"?e.includes(o):Array.isArray(o)?e.some(Set.prototype.has.bind(new Set(o))):!1,Ol=(o,e,t={})=>{let{typ:r}=t;if(r&&(typeof o.typ!="string"||Sv(o.typ)!==Sv(r)))throw new tr('unexpected "typ" JWT header value',"typ","check_failed");let n;try{n=JSON.parse(Gt.decode(e))}catch(p){}if(!Vt(n))throw new zt("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:i,subject:a,audience:l,maxTokenAge:c}=t,u=[...s];c!==void 0&&u.push("iat"),l!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),i!==void 0&&u.push("iss");for(let p of new Set(u.reverse()))if(!(p in n))throw new tr(`missing required "${p}" claim`,p,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new tr('unexpected "iss" claim value',"iss","check_failed");if(a&&n.sub!==a)throw new tr('unexpected "sub" claim value',"sub","check_failed");if(l&&!QC(n.aud,typeof l=="string"?[l]:l))throw new tr('unexpected "aud" claim value',"aud","check_failed");let f;switch(typeof t.clockTolerance){case"string":f=Ul(t.clockTolerance);break;case"number":f=t.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:d}=t,m=od(d||new Date);if((n.iat!==void 0||c)&&typeof n.iat!="number")throw new tr('"iat" claim must be a number',"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new tr('"nbf" claim must be a number',"nbf","invalid");if(n.nbf>m+f)throw new tr('"nbf" claim timestamp check failed',"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new tr('"exp" claim must be a number',"exp","invalid");if(n.exp<=m-f)throw new qs('"exp" claim timestamp check failed',"exp","check_failed")}if(c){let p=m-n.iat,v=typeof c=="number"?c:Ul(c);if(p-f>v)throw new qs('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(p<0-f)throw new tr('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return n};async function nd(o,e,t){var i;let r=await rd(o,e,t);if((i=r.protectedHeader.crit)!=null&&i.includes("b64")&&r.protectedHeader.b64===!1)throw new zt("JWTs MUST NOT use unencoded payload");let s={payload:Ol(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...s,key:r.key}:s}var r2,Nl,Cv;(typeof navigator=="undefined"||!((Cv=(Nl=navigator.userAgent)==null?void 0:Nl.startsWith)!=null&&Cv.call(Nl,"Mozilla/5.0 ")))&&(r2="jose/v5.3.0");var sd={};bu(sd,{decode:()=>$l,encode:()=>o2});var o2=Zr,$l=_o;function ra(o){if(typeof o!="string")throw new zt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new zt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new zt("Invalid JWT");if(!e)throw new zt("JWTs must contain a payload");let r;try{r=$l(e)}catch(s){throw new zt("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Gt.decode(r))}catch(s){throw new zt("Failed to parse the decoded payload as JSON")}if(!Vt(n))throw new zt("Invalid JWT Claims Set");return n}var n2=`
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyDIav6xzBzyi6eQu8aJA
O8DufA/MyTMDsD9d6PmjhuPTSlVPharZSjxRkHi6sK50ZmRedQbyiBuNp0g6so30
+zunoqT9XUpvZD0+USlGvi0J48Cop+DQbbpTlAlsmX6BxhHJLUrmgU0AhHjvJLNL
rRuzzQxrn/Oi0byUHu/moitUypX1hSYrKH5meRy8zoyGb8b0qIOEKpcpVKGyD/ne
+u0Bhh6tI8t2vQDQK0RL87dc+EqlQXxtijXBSClqvJi7o3JYTtWtuaWcZ2pQdg5y
+gDMii2hZYLNdgDM+/NcJlp3fkPztVeVRpiV20gZDhqANSjWjx9iN1Jt9A97rCSH
XQIDAQAB
-----END PUBLIC KEY-----
`.trim();var Ht=class extends Error{constructor(t,r,n){super(t);this.type=r;this.details=n;this.name="ValidationError"}};function id(o){return typeof o=="object"&&o!==null&&"license"in o&&typeof o.license=="string"}function Bl(o){return Array.isArray(o)&&o.every(id)}var Vl=class{constructor(e){this.settings=e;this.log=Fe("[EndpointManager]")}isStaging(){return!1}sanitizeUrlForLog(e){try{let t=new URL(e);return t.search="",t.toString()}catch(t){return e}}validateUrl(e){if(!e||typeof e!="string")throw new Ht("URL must be a non-empty string","URL_INVALID");let t;try{t=new URL(e)}catch(s){throw new Ht("Invalid URL format","URL_INVALID")}let r=this.isStaging();if(r){if(t.protocol!=="https:"&&t.protocol!=="http:")throw new Ht("Only HTTP and HTTPS URLs are allowed in development","URL_INVALID")}else if(t.protocol!=="https:")throw new Ht("Only HTTPS URLs are allowed in production","URL_INVALID");let n=t.hostname.toLowerCase();if((n==="localhost"||n==="127.0.0.1"||n==="::1")&&this.log(`Warning: Using localhost endpoint (development build: ${r})`),!n||n.length<3)throw new Ht("Invalid hostname","URL_INVALID")}async getPublicKey(){if(this._publicKeyCache)return this._publicKeyCache;try{return this._publicKeyCache=await Xf(n2,"RS256"),this._publicKeyCache}catch(e){throw new Ht("Failed to import public key","JWT_VERIFICATION_FAILED",e)}}getApiUrl(){return this._validatedApiUrl||"https://api.system3.md"}getAuthUrl(){return this._validatedAuthUrl||"https://auth.system3.md"}getDefaultUrls(){return{apiUrl:"https://api.system3.md",authUrl:"https://auth.system3.md",environment:"production"}}async validateAndSetEndpoints(e=1e4){let t=this.settings.get(),r=this.getActiveTenant(t);if(!r)return this.log("No active enterprise tenant configured, using defaults"),this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,{success:!0};try{let n=this.performTenantValidation(r.tenantUrl),s=new Promise((a,l)=>setTimeout(()=>l(new Error(`Validation timed out after ${e}ms`)),e));return await Promise.race([n,s])}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("Failed to validate tenant:",s),{success:!1,error:s}}}async performTenantValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return!n.apiUrl||!n.authUrl?{success:!1,error:"License missing required apiUrl or authUrl"}:n.authUrl!==e?{success:!1,error:`Tenant URL mismatch: expected ${e}, license has ${n.authUrl}`}:(this._validatedApiUrl=n.apiUrl,this._validatedAuthUrl=n.authUrl,this.log("Successfully validated enterprise tenant",{tenant:e,apiUrl:this._validatedApiUrl,authUrl:this._validatedAuthUrl,customer:n.customer}),{success:!0,licenseInfo:r.licenseInfo})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchTenantLicense(e){try{let t=new URL(e),r=`${t.protocol}//${t.host}/.well-known/relay.md/license`;this.log("Fetching tenant license from:",r);let n=await lt(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`License fetch failed: ${n.status} ${n.statusText}`);let s=await n.json(),i=[];if(Bl(s))i=s;else if(s&&typeof s=="object"&&"licenses"in s&&Bl(s.licenses))i=s.licenses;else if(id(s))i=[s];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(i.length===0)throw new Error("Empty license list");return{success:!0,license:i[0].license}}catch(t){let r=t instanceof Error?t.message:"Unknown error";return r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("ERR_")||r.includes("ECONNREFUSED")?r=`Unable to connect to ${e}. Please check the URL and ensure the server is running.`:r.includes("404")?r=`No tenant license found at ${e}. This may not be a valid Enterprise Relay tenant.`:r.includes("License fetch failed"),this.log("Tenant license fetch error:",r),{success:!1,error:r}}}findMatchingEndpointLicense(e,t,r){this.log(`Searching for ${r} license for ${this.sanitizeUrlForLog(t)}`);for(let n of e)try{let s=ra(n.license);if(s.endpointType===r&&s.url===t)return this.log(`Found matching license for ${r}: ${this.sanitizeUrlForLog(t)}`),n}catch(s){continue}return null}async validateTenantLicense(e,t){this.log(`Tenant license validation starting: ${this.sanitizeUrlForLog(t)}`);try{let r=await this.verifyJWT(e);if(r.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${r.iss}`,"LICENSE_INVALID");if(r.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${r.sub}`,"LICENSE_INVALID");let n={issuer:r.iss||"Unknown",subject:r.sub||"Unknown",validFrom:r.iat?new Date(r.iat*1e3).toISOString():"Unknown",validTo:r.exp?new Date(r.exp*1e3).toISOString():"Unknown",isValid:!0};return this.log(`Tenant license validation successful: ${this.sanitizeUrlForLog(t)}`),{success:!0,licenseInfo:n}}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log(`Tenant license validation failed: ${this.sanitizeUrlForLog(t)} - ${n}`),{success:!1,error:n}}}validateLicenseClaims(e,t,r){if(e.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${e.iss}`,"LICENSE_INVALID");if(e.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${e.sub}`,"LICENSE_INVALID");if(e.endpointType!==t)throw new Ht(`License endpoint type mismatch: expected ${t}, got ${e.endpointType}`,"LICENSE_INVALID");if(e.url!==r)throw new Ht(`License URL mismatch: expected ${r}, got ${e.url}`,"LICENSE_INVALID")}async verifyJWT(e){try{let t=await this.getPublicKey(),{payload:r}=await nd(e,t,{algorithms:["RS256"]});return r}catch(t){throw this.log("JWT verification failed:",t),new Ht(`JWT verification failed: ${t instanceof Error?t.message:"Unknown error"}`,"JWT_VERIFICATION_FAILED",t)}}clearValidatedEndpoints(){this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,this.log("Cleared validated endpoints, reverted to defaults")}hasValidatedEndpoints(){return!!(this._validatedApiUrl&&this._validatedAuthUrl)}getActiveTenant(e){if(!(!e.activeTenantId||!e.tenants))return e.tenants.find(t=>t.id===e.activeTenantId)}generateTenantId(e){try{let t=new URL(e);return`${t.hostname}:${t.port||(t.protocol==="https:"?"443":"80")}`}catch(t){return e.replace(/[^a-zA-Z0-9]/g,"_")}}async addTenant(e,t=!0){var r;try{this.validateUrl(e);let n=this.generateTenantId(e);if((r=this.settings.get().tenants)!=null&&r.some(l=>l.id===n))return{success:!1,error:"This tenant is already configured"};let i={id:n,name:e,tenantUrl:e,isValidated:!1},a;if(t){let l=await this.fetchTenantLicense(e);if(!l.success)return{success:!1,error:l.error||"Failed to fetch tenant license"};let c=await this.validateTenantLicense(l.license,e);if(!c.success)return{success:!1,error:c.error||"Tenant license validation failed"};a=c;let u=await this.verifyJWT(l.license);i={...i,name:u.customer||e,apiUrl:u.apiUrl,authUrl:u.authUrl,customer:u.customer,logo:u.logo,environment:u.environment,isValidated:!0,lastValidated:Date.now()}}return await this.settings.update(l=>({...l,tenants:[...l.tenants||[],i]})),{success:!0,tenantId:n,licenseInfo:a==null?void 0:a.licenseInfo}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async removeTenant(e){let t=this.settings.get(),r=t.tenants||[];if(!r.some(s=>s.id===e))return!1;let n={tenants:r.filter(s=>s.id!==e)};return t.activeTenantId===e&&(n.activeTenantId=void 0,this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),await this.settings.update(s=>({...s,...n})),!0}async switchToTenant(e){var n;let r=(n=this.settings.get().tenants)==null?void 0:n.find(s=>s.id===e);return r?(await this.settings.update(s=>({...s,activeTenantId:e})),r.isValidated&&r.apiUrl&&r.authUrl?(this._validatedApiUrl=r.apiUrl,this._validatedAuthUrl=r.authUrl):(this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),{success:!0}):{success:!1,error:"Tenant not found"}}async getCustomerInfo(){if(!this.hasValidatedEndpoints())return null;let e=this.settings.get(),t=this.getActiveTenant(e);if(!t)return null;try{if(t.isValidated&&t.customer)return{customer:t.customer,logo:t.logo};let r=await this.fetchTenantLicense(t.tenantUrl);if(r.success&&r.license){let n=await this.verifyJWT(r.license);return{customer:n.customer,logo:n.logo}}}catch(r){this.log("Failed to get customer info:",r)}return null}async getDefaultTenantInfo(){try{let e=await this.fetchTenantLicense("https://auth.system3.md");if(e.success&&e.license){let t=await this.verifyJWT(e.license);return{customer:t.customer,logo:t.logo,environment:"production"}}}catch(e){this.log("Failed to get default tenant info:",e)}return null}async testValidateTenant(e,t=1e4){try{let r=this.performTestValidation(e),n=new Promise((i,a)=>setTimeout(()=>a(new Error(`Validation timed out after ${t}ms`)),t));return await Promise.race([r,n])}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log("Failed to test validate endpoints:",n),{success:!1,error:n}}}async performTestValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return this.log("Test validation successful for tenant",{tenantUrl:e,apiUrl:n.apiUrl,authUrl:n.authUrl}),{success:!0,licenseInfo:r.licenseInfo}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchEndpointLicenseForUrl(e,t,r){try{let n=new URL(e),s=`${n.protocol}//${n.host}/.well-known/relay.md/license`;this.log(`Fetching ${t.toUpperCase()} licenses for test validation from:`,s);let i=await lt(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`License fetch failed: ${i.status} ${i.statusText}`);let a=await i.json();this.log("License response received from:",s);let l=[];if(Bl(a))l=a;else if(a&&typeof a=="object"&&"licenses"in a&&Bl(a.licenses))l=a.licenses;else if(id(a))l=[a];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(this.log(`Parsed ${l.length} licenses`),l.length===0)throw new Error("Empty license list");let c=this.findMatchingEndpointLicense(l,r,t);if(!c)throw new Ht(`No valid ${t.toUpperCase()} license found for: ${r}`,"LICENSE_NOT_FOUND");return{success:!0,license:c.license}}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("License fetch error:",s),{success:!1,error:`License fetch failed: ${s}`}}}};function s2(o){if("email"in o&&"name"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("email"in o&&"login"in o&&"avatar_url"in o){let e=o,t=(e.name||e.login).split(" ");return{name:e.name||e.login,given_name:t[0]||e.login,family_name:t.slice(1).join(" ")||"",email:e.email,picture:e.avatar_url}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}if("email"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name||`${e.given_name} ${e.family_name}`,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}return null}function i2(o,e,t,r){let n=r?s2(r):null;return new yl(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var ad=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},ql=class extends at{constructor(t,r,n,s,i,a){var c;super();this.beforeLogin=s;this.loginSettings=i;let l=Fe("[Pocketbase]","debug");this.authStore=new Il(`pocketbase_auth_${t}`),this.endpointManager=a,this.pb=new Kn(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(u,f)=>(l(u,f),f.fetch=lt,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.7.1"}),{url:u,options:f}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(c=this.pb.authStore.model)!=null&&c.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(u=>{u.status===404&&this.logout()}),Nt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.7.1"};return(0,Hl.requestUrl)({url:`${this.endpointManager.getApiUrl()}/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.7.1"};(0,Hl.requestUrl)({url:`${this.endpointManager.getApiUrl()}/flags`,method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;lr.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Hl.requestUrl)({url:`${this.endpointManager.getApiUrl()}/whoami`,method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}getEndpointManager(){return this.endpointManager}async validateAndApplyEndpoints(t){let r=await this.endpointManager.validateAndSetEndpoints(t);if(r.success&&this.endpointManager.hasValidatedEndpoints()){let n=Fe("[Pocketbase]","debug");this.pb=new Kn(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(s,i)=>(n(s,i),i.fetch=lt,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.7.1"}),{url:s,options:i}),this.log("Updated PocketBase instance with validated endpoints")}return r}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return i2((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(t){var a;let r=this.pb.buildUrl("/api/oauth2-redirect"),n=l=>{let c=l.replace(/\//g,"\\/");return new RegExp(`^${c}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},s=l=>{let c=new URL(l),f=`${c.protocol}//${c.host}${c.pathname}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${f}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},i=[n("https://accounts.google.com/o/oauth2/auth"),n("https://github.com/login/oauth/authorize"),n("https://discord.com/api/oauth2/authorize"),n("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")];if(t){let l=t.oidc;(a=l==null?void 0:l.info)!=null&&a.authUrl&&(console.log("[OIDC Provider] Creating dynamic intercept for authUrl:",l.info.authUrl),i.push(s(l.info.authUrl)))}else i.push(new RegExp(`.*?/auth.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i"));return i}updateWebviewIntercepts(t){let r=this.getWebviewIntercepts(t);return console.log("[OIDC Provider] Updated webview intercepts:",r.map(n=>n.source)),r}async initiateManualOAuth2CodeFlow(t,r){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(u=>u.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async u=>this.pb.collection("users").authWithOAuth2Code(l.name,u,l.codeVerifier,s,{fetch:t}).then(f=>(this.setup(f,l.name),f));i[a]=new ad(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};function Lv(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function a2(o){let e=ra(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var jl=class{constructor(e,t=5){this.expiryMargin=300*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=a2,this.maxConnections=t,this.refreshInterval=null,Nt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,u="";c>0?u=`expires in ${Lv(c-this.expiryMargin)}`:u="expired",t.push(`${s} (${i}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Lv(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};var zo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var ld=class{constructor(){this.platform="s3rn";this.product="relay"}},cd=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Wo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},wo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},eo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},xo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},ud=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},Nr=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Ko=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Gn=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},Gs=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},bt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,u,f,d,m,p,v]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new wo(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new eo(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&u==="hash"&&d==="contentType"&&p==="contentLength")return new ud(s,a,c,f,m,v);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new xo(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new Wo(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new Ko(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new Gn(s,a);if(r==="relay"&&n==="folder")return new Nr(s);if(r==="relay"&&n==="relay")return new cd(s);if(n===void 0)return new ld;throw new Error("Invalid s3rn format for the given product type")}};function l2(o){return o.expiryTime||0}function c2(o,e){return(...t)=>e(o,...t)}async function u2(o,e,t,r){var c;let n=Fe("[TokenStore][Refresh]","debug"),s=Fe("[TokenStore][Refresh]","error");n(`${e}`);let i=bt.decode(e),a;if(i instanceof wo)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof eo)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof Wo)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof xo)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.7.1","Content-Type":"application/json"};try{let u=o.getEndpointManager().getApiUrl(),f=await lt(`${u}/token`,{method:"POST",headers:l,body:a});if(!f.ok){n(f.status,await f.text()),r(Error(`Received status code ${f.status} from an API.`));return}let d=await f.json();t(d)}catch(u){s(u,a),r(u)}}var zl=class extends jl{constructor(t,r,n,s=5){super({log:Fe("[LiveTokenStore]","debug"),refresh:c2(t,u2),getJwtExpiry:l2,getStorage:function(){return new zo("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let u=this.getJwtExpiry(c),f=this.tokenMap.get(i);return this.tokenMap.set(r,{...f,token:c,expiryTime:u}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var m;let i=Fe("[TokenStore][Fetch]","debug");i(`${t}`);let a=bt.decode(t),l;if(a instanceof xo)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.7.1","Content-Type":"application/json"},u=this.loginManager.getEndpointManager().getApiUrl(),f=await lt(`${u}/file-token`,{method:"POST",headers:c,body:l});if(!f.ok){i(f.status,await f.text());let p=await f.json();throw new Error(p.error)}return await f.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};function f2(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Mv(o){let e=JSON.stringify(o),t=f2(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var d2={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Tv(o,e,t){let r={token:o.token},n=new jy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var Go=class extends Xe{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new ho,He().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new Za(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(bt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Tv(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let f=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),f&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Mv(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(bt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var i;this.clientToken=t;let r=new ho,n=Tv(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let a=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${a}`),(i=this._provider.ws)==null||i.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:d2[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.ws&&(this._provider.ws.onopen=null,this._provider.ws.onmessage=null,this._provider.ws.onerror=null,this._provider.ws.onclose=null,(this._provider.ws.readyState===WebSocket.OPEN||this._provider.ws.readyState===WebSocket.CONNECTING)&&this._provider.ws.close(1e3,"Destroyed"),this._provider.ws=null),this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var Ev=require("obsidian");var JB=require("obsidian"),Jo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Wl=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var to=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Kl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Av(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Fe("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var p2={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function _n(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return p2[e]||"application/octet-stream"}var Fv=Uo(Gl());function ro(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new Fv.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=He().enableDeltaLogging?Fe("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,u]of i){switch(c){case 1:l(`Inserting "${u}" at position ${a}`),r.insert(a,u),a+=u.length;break;case 0:l(`Keeping "${u}" (length: ${u.length})`),a+=u.length;break;case-1:l(`Deleting "${u}" at position ${a}`),r.delete(a,u.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function oo(o){return o instanceof wt}var wt=class extends Go{constructor(t,r,n,s){let i=s.relayId?new wo(s.relayId,s.guid,r):new Ko(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this.requestSave=(0,Ev.debounce)(this.save,2e3);this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new gn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),yn(qo.enableDeltaLogging,()=>{let a=l=>{var u,f;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(f=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:f.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&He().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this.getTFile()),this._tfile}getTFile(){var t;return(t=this._parent)==null?void 0:t.getTFile(this)}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(/\r\n/g,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new Jo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);vo(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let u of this.pendingOps)if(l=u(l),c.push(u),l==r){if(this.clearDiskBuffer(),a==this.text)ro(this.ydoc,l,this);else return He().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Ko&&(this.sharedFolder.relayId?this.s3rn=new wo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ko(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new to(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new to(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return _n(this.path)}save(){this.tfile&&(this.vault.modify(this.tfile,this.text),this.warn("file saved",this.path))}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Pr(this._persistence.db,["updates"],"readonly"),r=await Vo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,this._parent=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var wn=class extends at{constructor(){super(),this._set=new Set}add(e){let t=this._set.size;return this._set.add(e),this._set.size>t&&this.notifyListeners(),this}delete(e){let t=this._set.delete(e);return t&&this.notifyListeners(),t}clear(){this._set.clear(),this.notifyListeners()}has(e){return this._set.has(e)}items(){return[...this._set]}get size(){return this._set.size}map(e){return this.items().map(e)}forEach(e){this.items().forEach(e)}find(e){return this.items().find(e)}some(e){for(let t of this._set)if(e(t))return!0;return!1}filter(e){let t=[];for(let r of this._set)e(r)&&t.push(r);return t}};var Jl,m2=new Uint8Array(16);function fd(){if(!Jl&&(Jl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Jl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jl(m2)}var Wt=[];for(let o=0;o<256;++o)Wt.push((o+256).toString(16).slice(1));function Pv(o,e=0){return Wt[o[e+0]]+Wt[o[e+1]]+Wt[o[e+2]]+Wt[o[e+3]]+"-"+Wt[o[e+4]]+Wt[o[e+5]]+"-"+Wt[o[e+6]]+Wt[o[e+7]]+"-"+Wt[o[e+8]]+Wt[o[e+9]]+"-"+Wt[o[e+10]]+Wt[o[e+11]]+Wt[o[e+12]]+Wt[o[e+13]]+Wt[o[e+14]]+Wt[o[e+15]]}var h2=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),dd={randomUUID:h2};function g2(o,e,t){if(dd.randomUUID&&!e&&!o)return dd.randomUUID();o=o||{};let r=o.random||(o.rng||fd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Pv(r)}var Ys=g2;function pd(o){return Array.isArray(o.permissionParents)}var Jt=class extends at{constructor(t){super();this.observableName=t;this.derivedMapRefCounts=new WeakMap;this.activeDerivedMaps=new Set;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}subscribe(t){let r=null;for(let s of this.activeDerivedMaps)if(s&&s.parentCallback===t){r=s;break}if(r){let s=this.derivedMapRefCounts.get(r)||0;this.derivedMapRefCounts.set(r,s+1)}let n=super.subscribe(t);return()=>{if(r){let i=(this.derivedMapRefCounts.get(r)||0)-1;i<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,i)}n()}}unsubscribe(t){for(let r of this.activeDerivedMaps)if(r&&r.parentCallback===t){let s=(this.derivedMapRefCounts.get(r)||0)-1;s<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,s);break}super.unsubscribe(t)}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new md(this,t);return this._derivedMaps.set(t,n),this.derivedMapRefCounts.set(n,0),this.activeDerivedMaps.add(n),n}},md=class extends Jt{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.parentCallback=()=>{let n=new Map;this.parentMap.forEach((s,i)=>{this.predicate(s,i)&&n.set(i,s)}),this._map=n,this.notifyListeners()},this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(this.parentCallback))}subscribe(t){return this.sub(),super.subscribe(t)}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsub&&(this.unsub(),this.unsub=void 0),(t=this._listeners)==null||t.clear(),this.parentCallback=null)}};var Qs=class extends at{constructor(t,r){super();this.evaluate=t;this.unsubscribes=[];this.subscriberCount=0;this.observableName="ObservablePermission";this.currentValue=this.evaluate(),r.forEach(n=>{let s=n.on(()=>{let i=this.evaluate();i!==this.currentValue&&(this.currentValue=i,this.notifyListeners())});this.unsubscribes.push(s)})}subscribe(t){if(this.destroyed)throw new Error("Cannot subscribe to destroyed ObservablePermission");this.subscriberCount++,t(this.currentValue);let r=this.on(()=>{t(this.currentValue)});return()=>{r(),this.subscriberCount--,this.subscriberCount===0&&this.destroy()}}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,(t=this._listeners)==null||t.clear())}},Yl=class{constructor(e){this.relayManager=e;this.policies=new Map;this.registerBuiltinPolicies()}isAllowed(e){let t=this.getResourceType(e.resource),r=`${t}:${e.action}`,n=this.policies.get(r);if(!n)return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}};try{return{allowed:n.evaluate(e,this.relayManager),policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}catch(s){return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}}can(e,t,r,n){let s=this.getResourceType(r),i=t[1];if(t[0]!==r[0])throw new Error(`unexpected permission/resource mismatch ${t[0]} ${r[0]}`);let a=`${s}:${i}`,l=this.policies.get(a),c={principal:e,action:i,resource:r,context:n},u=l?this.getFilteredCollections(l.dependencies,c):[];return new Qs(()=>this.isAllowed(c).allowed,u)}getPolicies(){return Array.from(this.policies.keys()).sort()}registerPolicy(e){let[t,r]=e.permission,n=`${t}:${r}`;this.policies.set(n,e)}getResourceType(e){return e[0]}getResourceId(e){return e[1]}getFilteredCollections(e,t){let r=[];for(let n of Object.keys(e)){let s=this.relayManager.getCollectionMapByName(n);s&&r.push(s)}return r}registerBuiltinPolicies(){this.registerPolicy({permission:["folder","delete"],description:"Delete a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDelete.bind(this)}),this.registerPolicy({permission:["folder","rename"],description:"Rename a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRename.bind(this)}),this.registerPolicy({permission:["folder","read_content"],description:"Read folder contents and add to vault",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRead.bind(this)}),this.registerPolicy({permission:["folder","edit_content"],description:"Edit notes in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderWrite.bind(this)}),this.registerPolicy({permission:["folder","upload"],description:"Upload attachments to folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource),relays:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.id===r.relayId)},storage_quotas:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource)),n=r&&this.relayManager.relays.get(r.relayId);return!!(n&&e.id===n.storageQuotaId)}},evaluate:this.evaluateFolderUpload.bind(this)}),this.registerPolicy({permission:["folder","download"],description:"Download attachments from folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDownload.bind(this)}),this.registerPolicy({permission:["folder","manage_files"],description:"Add/remove/rename files in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageFiles.bind(this)}),this.registerPolicy({permission:["relay","delete"],description:"Delete a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayDelete.bind(this)}),this.registerPolicy({permission:["relay","rename"],description:"Rename a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayRename.bind(this)}),this.registerPolicy({permission:["relay","manage_users"],description:"Manage users in relay server (add/remove/change roles)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageUsers.bind(this)}),this.registerPolicy({permission:["relay","manage_sharing"],description:"Manage relay share keys (enable/disable sharing, rotate keys)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageSharing.bind(this)}),this.registerPolicy({permission:["subscription","manage"],description:"Manage relay subscriptions and plans",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateSubscriptionManage.bind(this)}),this.registerPolicy({permission:["folder","manage_users"],description:"Manage users in folder (add/remove/change roles)",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageUsers.bind(this)})}isFolderCreator(e,t){let r=this.relayManager.remoteFolders.get(t);return(r==null?void 0:r.creatorId)===e}isRelayOwnerForFolder(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwner(e,r.relayId):!1}isRelayOwner(e,t){return!!this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e&&n.role==="Owner")}hasRelayRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.relayRoles.find(i=>i.relayId===t&&i.userId===e&&n.includes(i.role))}hasFolderRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.folderRoles.find(i=>i.sharedFolderId===t&&i.userId===e&&n.includes(i.role))}hasFolderAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.getUserFolderRole(e,t)?!0:r.private?!1:!!this.getUserRelayRole(e,r.relayId):!1}hasFolderWriteAccess(e,t){let r=this.relayManager.remoteFolders.get(t);if(!r)return!1;let n=this.getUserFolderRole(e,t);if(n&&this.roleHasWritePermission(n))return!0;if(!r.private){let s=this.getUserRelayRole(e,r.relayId);if(s&&this.roleHasWritePermission(s))return!0}return!1}hasFolderManagementAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwnerForFolder(e,t)?!0:r.private?this.hasFolderRole(e,t,["Owner"]):this.isFolderCreator(e,t):!1}getUserFolderRole(e,t){let r=this.relayManager.folderRoles.find(n=>n.sharedFolderId===t&&n.userId===e);return(r==null?void 0:r.role)||null}getUserRelayRole(e,t){let r=this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e);return(r==null?void 0:r.role)||null}roleHasWritePermission(e){return["Owner","Member"].includes(e)}hasStorageQuota(e,t){let r=this.relayManager.remoteFolders.get(e);if(!r)return!1;let n=this.relayManager.relays.get(r.relayId);if(!n)return!1;let s=n.storageQuota;return s?s.usage+t<=s.quota:!0}evaluateFolderDelete(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRename(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRead(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderWrite(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderDownload(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderManageFiles(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderUpload(e){var n;let t=this.getResourceId(e.resource),r=((n=e.context)==null?void 0:n.fileSize)||0;return this.hasFolderWriteAccess(e.principal,t)&&this.hasStorageQuota(t,r)}evaluateRelayDelete(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayRename(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageUsers(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageSharing(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateSubscriptionManage(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateFolderManageUsers(e){let t=this.getResourceId(e.resource);return this.relayManager.remoteFolders.get(t)?this.isRelayOwnerForFolder(e.principal,t)?!0:this.hasFolderRole(e.principal,t,["Owner"]):!1}};function hd(o){return typeof o.id=="string"}function y2(o){return typeof o.name=="string"}var yd=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Dv(o){return typeof o.aggregate_root=="object"}function gd(o){return o&&Array.isArray(o.permissionParents)}var oa=class{get aggregate_root(){}get permissionParents(){return[]}},vd=class extends at{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get metered(){return this.storageQuota.metered}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},bd=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new vd(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},Ql=class extends oa{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},_d=class extends at{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}get publicKey(){return this.provider.public_key}get keyType(){return this.provider.key_type}get keyId(){return this.provider.key_id}update(t){return this.provider=t,this}},wd=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new _d(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},xd=class extends at{constructor(t,r,n,s,i,a){super();this.remoteFolder=t;this.relays=r;this.relayRoles=n;this.folderRoles=s;this.users=i;this.user=a}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}set name(t){this.remoteFolder.name=t}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get creatorId(){return this.remoteFolder.creator}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get relayId(){return this.remoteFolder.relay}get role(){var s,i;let t=this.remoteFolder.creator===this.user.id,r=(s=this.relayRoles.find(a=>a.relayId===this.relay.id&&a.userId===this.user.id))==null?void 0:s.role,n=(i=this.folderRoles.find(a=>a.sharedFolderId===this.remoteFolder.id&&a.userId===this.user.id))==null?void 0:i.role;if(this.remoteFolder.private){if(n)return n}else return r||this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":r||"Member";return this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member"}get owner(){return this.role==="Owner"}get aggregate_root(){return["relays",this.remoteFolder.relay]}get permissionParents(){var r,n;let t=[];if(this.remoteFolder.private){let s=(r=this.folderRoles.find(i=>i.sharedFolderId===this.id&&i.userId===this.user.id))==null?void 0:r.id;s&&t.push(["shared_folder_roles",s])}else{let s=(n=this.relayRoles.find(i=>i.relayId===this.relayId&&i.userId===this.user.id))==null?void 0:n.id;s&&t.push(["relay_roles",s])}return t}},Sd=class{constructor(e,t,r,n,s,i){this.remoteFolders=e;this.relays=t;this.folderRoles=r;this.relayRoles=n;this.users=s;this.user=i;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new xd(e,this.relays,this.relayRoles,this.folderRoles,this.users,this.user);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},kd=class{constructor(e,t,r,n,s,i,a,l){this.relays=e;this.relayRoles=t;this.relayInvitations=r;this.remoteFolders=n;this.subscriptions=s;this.storageQuotas=i;this.providers=a;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Rd(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Id=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Fd(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Cd=class{constructor(e,t,r,n){this.folderRoles=e;this.remoteFolders=t;this.users=r;this.roles=n;this.collectionName="shared_folder_roles"}items(){return this.folderRoles.values()}clear(){this.folderRoles.clear()}get(e){return this.folderRoles.get(e)}ingest(e){let t=this.folderRoles.get(e.id);if(t)return t.update(e),this.folderRoles.notifyListeners(),t;let r=new Ed(e,this.remoteFolders,this.users,this.roles);return this.folderRoles.set(r.id,r),r}delete(e){this.folderRoles.delete(e)}},Ld=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Pd(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Md=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Ql(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Td=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Dd(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Ad=class extends Xe{constructor(e){super(),this.collections=new Map,this.relationships=new Map;for(let t of e)this.collections.set(t.collectionName,t);Nt.set(this,"Store")}getCollection(e){let t=this.collections.get(e);if(!t)throw this.error("No collection found for",e),new Error("No collection found for "+e);return t}clear(){let e=Qr.getInstance();e.beginTransaction(),this.collections.forEach(t=>{t.clear()}),this.collections.clear(),this.relationships.clear(),e.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(e){return this.ingestBatch(e==null?void 0:e.items)}ingestBatch(e){if(e)return e.map(t=>this.ingest(t))}ingest(e){let t=Qr.getInstance();t.beginTransaction();let r=this._ingest(e);return t.commitTransaction(),r}_ingest(e){if(!e)return;let t,r=this.collections.get(e.collectionName);if(r?t=r.ingest(e):this.error("No collection found for record",e),Dv(t)){let n=t.aggregate_root;if(n){let s=e.id,i=this.relationships.get(n.join(":"))||new Set;i.add([e.collectionName,s].join(":")),this.relationships.set(n.join(":"),i)}}if(gd(t)){let n=t.permissionParents;for(let s of n){let i=e.id,a=this.relationships.get(s.join(":"))||new Set;a.add([e.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(e.expand)for(let[,n]of Object.entries(e.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return t}delete(e){this.cascade(e.collectionName,e.id)}graphviz(){let e=`digraph G {
`;for(let[t,r]of this.collections)for(let n of r.items()){if(!hd(n)){this.warn("record has no id",n);continue}let s=t+"_"+n.id;if(y2(n)&&(s=t+"_"+n.name),e+=`  ${t}_${n.id} [label="${s}"];
`,hd(n)&&Dv(n)&&n.aggregate_root){let[i,a]=n.aggregate_root;e+=`  ${t}_${n.id} -> ${i}_${a};
`}if(hd(n)&&gd(n))for(let i of n.permissionParents){let[a,l]=i;e+=`  ${t}_${n.id} -> ${a}_${l} [style=dotted];
`}}return e+="}",e}cascade(e,t){let r=this.collections.get(e),n=this.relationships.get([e,t].join(":")),s=Qr.getInstance();s.beginTransaction(),r&&(this.warn("cascade delete parent",e,t),r.delete(t)),this.relationships.delete([e,t].join(":"));for(let i of n||[]){let[a,l]=i.split(":");try{let u=this.getCollection(a).get(l);if(gd(u)){let f=u.permissionParents.filter(d=>{let[m,p]=d;try{return!!this.getCollection(m).get(p)}catch(v){return this.warn("Parent collection not found during validation",m,v),!1}});f.length===0?(this.warn("cascade delete child (no valid permission parents)",a,l),this.cascade(a,l)):this.warn("preserving child with valid permission parents",a,l,f)}else this.warn("cascade delete child",a,l),this.cascade(a,l)}catch(c){this.warn("Failed to process child during cascade",a,l,c)}}s.commitTransaction()}},Fd=class extends oa{constructor(e,t,r,n){super(),this.users=r,this.roles=n,this.relays=t,this.relayRole=e}update(e){return this.relayRole=e,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let e=this.users.get(this.relayRole.user);if(!e)throw new Error(`Unable to find user: ${this.relayRole.user}`);return e}get role(){var e;return(e=this.roles.get(this.relayRole.role))==null?void 0:e.name}get relayId(){return this.relayRole.relay}get relay(){let e=this.relays.get(this.relayRole.relay);if(!e)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return e}get aggregate_root(){return["relays",this.relayRole.relay]}get permissionParents(){return[["users",this.relayRole.user]]}},Ed=class extends oa{constructor(t,r,n,s){super();this.folderRole=t;this.remoteFolders=r;this.users=n;this.roles=s}update(t){return this.folderRole=t,this}get id(){return this.folderRole.id}get userId(){return this.folderRole.user}get user(){let t=this.users.get(this.folderRole.user);if(!t)throw new Error(`Unable to find user: ${this.folderRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.folderRole.role))==null?void 0:t.name}get sharedFolderId(){return this.folderRole.shared_folder}get sharedFolder(){let t=this.remoteFolders.get(this.folderRole.shared_folder);if(!t)throw new Error(`invalid role: unable to find folder ${this.folderRole.shared_folder} on role ${this.folderRole.id}`);return t}get aggregate_root(){return["shared_folders",this.folderRole.shared_folder]}get permissionParents(){return[["shared_folders",this.folderRole.shared_folder]]}},Pd=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Dd=class extends at{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get permissionParents(){return[["users",this.subscription.user]]}},Rd=class extends at{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get version(){return this.relay.version}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>{let r=t.relayId===this.id,n=t.permissionParents.length>0;return r&&n})}get subscriptions(){return this._subscriptions.filter(t=>t.relayId===this.id)}get permissionParents(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;return t?[["relay_roles",t]]:[]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},Zl=class extends Xe{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new Jt("users"),this.relays=new Jt("relays"),this.providers=new Jt("providers"),this.remoteFolders=new Jt("remote folders"),this.relayInvitations=new Jt("relay invitations"),this.relayRoles=new Jt("relay roles"),this.folderRoles=new Jt("folder roles"),this.roles=new Jt("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Jt("subscriptions"),this.storageQuotas=new Jt("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&(Nt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new yd(this.roles),r=new Md(this.users),n=new wd(this.providers),s=new kd(this.relays,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new Id(this.relayRoles,this.relays,this.users,this.roles),a=new Cd(this.folderRoles,this.remoteFolders,this.users,this.roles),l=new Ld(this.relayInvitations,this.relays,this.roles),c=new Sd(this.remoteFolders,this.relays,this.folderRoles,this.relayRoles,this.users,this.user),u=new Td(this.subscriptions,this.relays,this.users),f=new bd(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new Ad([t,r,s,i,a,l,c,u,f,n]),this.policyManager=new Yl(this)}getCollectionMapByName(t){switch(t){case"folder_roles":return this.folderRoles;case"relay_roles":return this.relayRoles;case"shared_folders":return this.remoteFolders;case"relays":return this.relays;case"storage_quotas":return this.storageQuotas;case"subscriptions":return this.subscriptions;default:console.warn(`Unknown collection name: ${t}`);return}}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new Ql(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relayId===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relayId===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"shared_folder_roles",expand:["user","shared_folder"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:lt})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:lt})}async refreshRemoteFolder(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("shared_folders").getOne(t.id,{expand:"shared_folder_roles_via_shared_folder"});!this.destroyed&&this.store&&this.store.ingest(r)}async refreshRelay(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("relays").getOne(t.id,{expand:"relay_roles_via_relay,shared_folders_via_relay,storage_quota"});!this.destroyed&&this.store&&this.store.ingest(r)}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user,role"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("shared_folder_roles",{expand:"user,role"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i,a;let r=Ys(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create relay");return s}async createSelfHostedRelay(t,r,n){var l;if(!this.pb)throw new Error("Not connected to relay service");let s={};if(r)s.provider=r;else if(t)s.url=t;else throw new Error("Either URL or provider ID must be provided");n&&(s.organization=n);let i=await this.pb.send("/api/collections/relays/self-host",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to create self-hosted relay");return a}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var r;return await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),!0}async createRemoteFolder(t,r,n=!1,s=void 0){var l,c;if(!this.pb)throw new Error("Failed to create folder");let i=await this.pb.collection("shared_folders").create({name:s||t.name,guid:t.guid,relay:r.id,creator:(l=this.user)==null?void 0:l.id,private:n},{expand:"relay"}),a=(c=this.store)==null?void 0:c.ingest(i);if(!a)throw new Error("Failed to create folder");return a}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}async addFolderRole(t,r,n){var l;if(!this.pb)throw new Error("Failed to add folder role");let s=this.roles.find(c=>c.name===n);if(!s)throw new Error("Failed to find role");let i=await this.pb.collection("shared_folder_roles").create({user:r,shared_folder:t.id,role:s.id}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to add folder role");return a}async removeFolderRole(t){if(!this.pb)throw new Error("Failed to remove folder role");await this.pb.collection("shared_folder_roles").delete(t.id)}async updateFolderRole(t,r){var a;if(!this.pb)throw new Error("Failed to update folder role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update folder role");let s=await this.pb.collection("shared_folder_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update folder role");return i}async updateFolderPrivacy(t,r){var i;if(!this.pb)throw new Error("Failed to update folder privacy");let n=await this.pb.collection("shared_folders").update(t.id,{private:r}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder privacy");return s}async updateRemoteFolder(t,r){var i;if(!this.pb)throw new Error("Failed to update folder");let n=await this.pb.collection("shared_folders").update(t.id,r),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder");return s}can(t,r,n,s){if(!this.policyManager)return new Qs(()=>!1,[]);let[i]=r,a=[i,n.id];return this.policyManager.can(t,r,a,s)}userCan(t,r,n){return this.user?this.can(this.user.id,t,r,n):new Qs(()=>!1,[])}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null,this.policyManager=void 0}};var Bv=require("obsidian");function xn(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!xn(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Yo(o){return o instanceof Tt}var Tt=class o extends Go{constructor(t,r,n,s){let i=s.relayId?new eo(s.relayId,s.guid,r):new Gn(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new gn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Gn&&(this.sharedFolder.relayId?this.s3rn=new eo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Gn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Pr(this._persistence.db,["updates"],"readonly"),r=await Vo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new to(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new to(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(u=>{s.add(u.id);let f=n.get(u.id);f?xn(f,u)||i.set(u.id,u):(i.set(u.id,u),u.type==="text"&&this.textNode(u))});for(let u of n.keys())s.has(u)||a.add(u);t.edges.forEach(u=>{s.add(u.id);let f=r.get(u.id);f&&xn(f,u)||l.set(u.id,u)});for(let u of r.keys())s.has(u)||c.add(u);(i.size>0||a.size>0||l.size>0||c.size>0)&&st(this.ydoc,()=>{for(let u of i.values())this.ynodes.set(u.id,u);for(let u of a)this.ynodes.delete(u);for(let u of l.values())this.yedges.set(u.id,u);for(let u of c)this.yedges.delete(u)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return _n(this.path)}get json(){let t=o.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};function na(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var ur=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Xl=class extends at{constructor(t,r){super("Settings");this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},$r=class o extends at{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new ur("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new ur(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new ur("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,f])=>{l.test(u)&&(c[u]=f)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new ur(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),u=a.match(/^\((.+?)\)$/);if(c){let[,f,d]=c,m=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:f,value:d,level:l}),n.push(a),s.push(m)}else if(u){let[,f]=u;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(f),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(f=>f[s.key]===s.value),u=this.basePath.slice(s.level+1);if(c>=0)if(u.length>0){let f=n[l][c];for(let m=0;m<u.length-1;m++){let p=u[m];f[p]=f[p]||{},f=f[p]}let d=u[u.length-1];f[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(u.length>0){let f={[s.key]:s.value},d=f;for(let p=0;p<u.length-1;p++){let v=u[p];d[v]={},d=d[v]}let m=u[u.length-1];d[m]=r,n[l].push(f)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new o(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new o(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var So=class So extends $r{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||He().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled)return!1;for(let[a,l]of Object.entries(So.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:So.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=So.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(So.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...So.defaultFlags}))}};So.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},So.defaultFlags=Object.fromEntries(Object.entries(So.schema).map(([t,r])=>[t,r.defaultEnabled]));var Zs=So;var v2={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function rc(o){return(o==null?void 0:o.type)==="markdown"}function Rv(o){return(o==null?void 0:o.type)==="canvas"}function Uv(o){return(o==null?void 0:o.type)==="folder"}function Ov(o){return(o==null?void 0:o.type)==="file"}function sa(o){return{version:0,id:o,type:"markdown"}}function Nv(o){return{version:0,id:o,type:"canvas"}}function oc(o){return{version:0,id:o,type:"folder"}}function $v(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var tc=class tc extends at{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||tc.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||He().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(v2).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=_n(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!He().enableCanvasSync&&n==="canvas"?"file":n;return"file"}};tc.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var ec=tc;var ia=require("obsidian");async function Ud(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function fr(o){return!!o&&o instanceof Sn}var nc=class extends Xe{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},Od=class extends Xe{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof ia.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof ia.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Ud(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Ud(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof ia.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},Sn=class extends at{constructor(t,r,n,s){super();this.path=t;this._guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new xo(s.relayId,s.guid,r):new Gs(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new Od(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get guid(){return this._guid}set guid(t){this._guid=t,this.s3rn=this._parent.relayId?new xo(this._parent.relayId,this._parent.guid,t):new Gs(this._parent.guid,t)}get mimetype(){return _n(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(He().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof ia.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof Nr?!1:(this.s3rn instanceof Ko&&(this.sharedFolder.relayId?this.s3rn=new xo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Gs(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};var sc=class extends Xe{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new wn;this.activeDownloads=new wn;this.syncGroups=new Jt;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Nt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(f=>{t+=f.total,r+=f.completed,n+=f.syncs,s+=f.completedSyncs,i+=f.downloads,a+=f.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,u=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc,s;n instanceof Sn?s=this.syncFile(n):s=this.syncDocument(n),s.then(()=>{r.status="completed";let i=this.syncCompletionCallbacks.get(r.guid);i&&(i.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}).catch(i=>{r.status="failed";let a=this.syncCompletionCallbacks.get(r.guid);a&&(a.reject(i instanceof Error?i:new Error(String(i))),this.syncCompletionCallbacks.delete(r.guid));let l=this.syncGroups.get(r.sharedFolder);l&&(this.error("[Sync Failed]",i),l.status="failed",this.syncGroups.set(r.sharedFolder,l))}).finally(()=>{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid),this.timeProvider.setTimeout(()=>{this.processSyncQueue()},0)})}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Startup Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{let n;r.doc instanceof Tt?n=this.getCanvas(r.doc):r.doc instanceof Sn?n=this.getSyncFile(r.doc):n=this.getDocument(r.doc),n.then(()=>{r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.completedDownloads++,i.completed++,i.completed===i.total&&(i.status="completed"),this.syncGroups.set(r.sharedFolder,i))}).catch(s=>{r.status="failed";let i=this.downloadCompletionCallbacks.get(r.guid);i&&(i.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}).finally(()=>{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid),this.timeProvider.setTimeout(()=>{this.processDownloadQueue()},0)})}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Download Startup Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(na),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(na),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(oo),n=[...t.files.values()].filter(Yo),s=[...t.files.values()].filter(fr),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r,...n,...s].sort(na);for(let c of l)this.enqueueForGroupSync(c);a.status="running",this.syncGroups.set(t,a)}async enqueueForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(na),this.processSyncQueue(),s}getAuthHeader(t){return{Authorization:`Bearer ${t.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");return s.pop(),s.push(t.docId),n.pathname=s.join("/"),((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString()}async downloadItem(t){let r=u=>u instanceof eo?u.canvasId:u.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${bt.encode(n)}`),!(n instanceof wo||n instanceof eo))throw new Error(`Unable to decode S3RN: ${bt.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,Bv.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${bt.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;Yo(t)?(s=Tt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):oo(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(Yo(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=xn(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(bt.encode(t.s3rn))),!0}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async getCanvas(t,r=3,n=3e3){try{let s=Tt.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=xn(s.edges,i.edges)&&xn(s.nodes,i.nodes),l=i.nodes.length>0,u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u);if(this.log("[getCanvas] applying content from server"),vo(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(v){}let a=s===i,l=i!=="",u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u),d=new ho;vo(d,f);let m=d.getMap("users");if(d.getText("contents").toString()===""){if(m.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",m.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),vo(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncFile(t){await t.sync()}async getSyncFile(t){await t.pull()}async syncDocument(t){try{oo(t)?await this.syncDocumentWebsocket(t):Yo(t)&&await this.syncDocumentWebsocket(t)}catch(r){console.error(r);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Nd=require("obsidian");function $d(o){return o instanceof Xs}var Xs=class o extends Xe{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof Nd.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new o(t.getVirtualPath(r.path),Ss(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Nd.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var ko=Uo(Dn());var ic=class extends at{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new ec(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+ko.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);Uv(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=Ys();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),rc(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),rc(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,u)=>{u.startsWith(a+ko.sep)&&l.set(u,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,u)=>{let f=u.slice(a.length),d=s+f;this.renames.set(d,u),this.log("setting alias",d,u)})}})}start(){yn(qo.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,u)=>{c.action==="add"&&(i+=`Added ${u}: ${this.get(u)}
`),c.action==="update"&&(i+=`Updated ${u}: ${this.get(u)}
`),c.action==="delete"&&(i+=`Deleted ${u}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=sa(s);return this.overlay.set(t,i),i}if(r){if(rc(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,ko.dirname)(a),c=(0,ko.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+ko.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+ko.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(ko.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(ko.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,sa(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=Ys();console.log("creating folder path",l,c),this.overlay.set(l,oc(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Vv(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var ac=class extends Xe{constructor(t){super();this.sharedFolder=t;let r=t.loginManager.getEndpointManager().getAuthUrl();this.pb=new Kn(r,t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(bt.encode(t.s3rn),r,t.mimetype,0);return(await lt(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(bt.encode(t.s3rn),r,t.mimetype,0),s=await lt(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await lt(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(bt.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await lt(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await lt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var Bd=class extends wn{constructor(){super(...arguments);this.notifyListeners=(0,rt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},lc=class extends Go{constructor(t,r,n,s,i,a,l,c,u,f,d,m,p=!0){var g;let v=m?new Wo(m,r):new Nr(r);super(r,v,l,s);this.appId=t;this.hashStore=u;this.backgroundSync=f;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i),l=this.getFile(s,!1);if(l){r.push(l);return}if(s instanceof rt.TFolder){let c=this.getSyncFolder(i,!1);r.push(c);return}if(wt.checkExtension(i)){if(a){let c=this.uploadDoc(i,!1);r.push(c)}else{let c=this.getDoc(i,!1);r.push(c)}return}if(Tt.checkExtension(i))if(a){if(He().enableCanvasSync){let c=this.uploadCanvas(i,!1);r.push(c);return}}else{let c=this.getFile(s,!1);if(c){r.push(c);return}}if(this.syncStore.canSync(i))if(a){let c=this.uploadSyncFile(i,!1);r.push(c)}else{let c=this.syncFile(i,!1);r.push(c)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new Bd,this.pendingUpload=new zo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((I,L)=>{this.existsSync(L)||(this.warn("deleting pending upload record because file is missing",L,I),this.pendingUpload.delete(L))}),this.relayManager=c,this.relayId=m,this.diskBufferStore=new Wl,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!p,this.syncSettingsManager=this._settings.getChild("sync",(I,L)=>new Zs(I,L)),this.syncStore=new ic(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(I=>{this.remote=I.find(L=>L.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async I=>{let L=I.find(k=>{var C;return k.id===((C=this._remote)==null?void 0:C.relay.storageQuotaId)});L!==void 0&&this.storageQuota!==L.quota&&(this.storageQuota!==void 0&&L.quota!==void 0&&L.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,L.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,L.quota),this.storageQuota=L.quota)})),this.proxy=Vv(this,this.path,I=>this.getVirtualPath(I));try{this._persistence=new gn(this.guid,this.ydoc)}catch(I){throw this.warn("Unable to open persistence.",this.guid),console.error(I),I}s.loggedIn&&this.connect(),this.cas=new ac(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",bt.encode(this.s3rn))}catch(I){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Nt.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof Go&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return((i=s.token)==null?void 0:i.folder)===this.guid}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof rt.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);if(t instanceof rt.TFolder)return r&&s;let i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof rt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return rt.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Wo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Wo(this.relayId,this.guid):new Nr(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Pr(this._persistence.db,["updates"],"readonly"),r=await Vo(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new to(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new to(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof rt.TFile){let i=(0,Sr.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,rt.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,Sr.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r)){if(i&&fr(i)&&Rv(a)){let c=this._upgradeToCanvas(i,t,r,s);return{op:"upgrade",path:r,promise:c}}if(i&&fr(i)&&i.shouldPull(a))return{op:"update",path:r,promise:i.pull()};if(!i&&Ov(a)){let c=this.syncStore.get(r),u=c?this.files.get(c):null;if(c&&u&&fr(u)){let f=this.remapIfHashMatches(u,c,t,r,a);return{op:"update",path:r,promise:f}}}return{op:"noop",path:r,promise:Promise.resolve()}}if(n.has(t)&&i){let c=this.getPath(i.path),u=this.vault.getAbstractFileByPath(c);if(u){let f=this._handleServerRename(i,r,u,s);return{op:"rename",path:r,from:c,to:r,promise:f}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}async remapIfHashMatches(t,r,n,s,i){try{await t.caf.hash()===i.hash&&(this.files.delete(r),this.pendingUpload.delete(s),this.files.set(n,t),t.guid=n,this.log(`Remapped file ${s} from local GUID ${r} to remote GUID ${n}`))}catch(a){throw this.error("Error during GUID remapping:",a),a}}async _upgradeToCanvas(t,r,n,s){try{let i=t.guid;this.files.delete(i),this.fset.delete(t),t.destroy(),s==null||s.push(`Upgrading ${n} from SyncFile to Canvas`),this.log(`Upgrading ${n} from SyncFile to Canvas (GUID: ${i} \u2192 ${r})`),await this.downloadCanvas(n,!1),this.log(`Successfully upgraded ${n} to Canvas`)}catch(i){throw this.error("Error during SyncFile to Canvas upgrade:",i),i}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof rt.TFolder),a=n.filter(c=>c instanceof rt.TFile),l=c=>{var g,I;let u=this.isSyncableTFile(c),f=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),m=this.pendingUpload.has(this.getVirtualPath(c.path)),p=this.getVirtualPath(c.path),v=((g=this._provider)==null?void 0:g.synced)&&((I=this._persistence)==null?void 0:I.synced);if(f&&u&&!d&&!m&&v){r.push(`deleted local file ${p} for remotely deleted doc`);let L=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:p,promise:L})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(u=>u.op==="create"),a=n.filter(u=>u.op==="rename"),l=n.map(u=>u.path);await Promise.all([...i,...a].map(u=>Av(u.promise,u)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Kl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Sr.join)(this.path,t.path);return this.vault.adapter.read((0,rt.normalizePath)(r))}existsSync(t){let r=(0,rt.normalizePath)((0,Sr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Sr.join)(this.path,t.path);return this.vault.adapter.exists((0,rt.normalizePath)(r))}flush(t,r){let n=(0,Sr.join)(this.path,t.path);return this.log("writing to ",(0,rt.normalizePath)(n)),this.vault.adapter.write((0,rt.normalizePath)(n),r)}getPath(t){return(0,Sr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Sr.join)(this.path,t);return this.vault.adapter.mkdir((0,rt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Sr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof rt.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!oo(s))throw new Error("getDoc(): unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof rt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!Yo(s))throw new Error("getCanvas(): unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof rt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(oo(t)){let n=sa(t.guid);r(t,n);return}if(Yo(t)){let n=Nv(t.guid);r(t,n);return}if($d(t)){let n=oc(t.guid);r(t,n);return}if(fr(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=$v(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i;let a=this.syncStore.getMeta(n);if(a){if(a.type==="markdown")return this.getDoc(n);if(a.type==="canvas")return this.getCanvas(n);if(a.type==="folder")return this.getSyncFolder(n,r);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}}if(t instanceof rt.TFolder)return this.getSyncFolder(n,r);if(t instanceof rt.TFile){if(wt.checkExtension(n))return this.getDoc(n);if(Tt.checkExtension(n)&&He().enableCanvasSync)return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new Tt(r,t,this.loginManager,this);if(!Yo(n))throw new Error("getOrCreateCanvas(): unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]);!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!oo(n))throw new Error("viewDoc(): unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!n){this.debug(`viewSyncFile(): file not loaded yet, guid=${r}, vpath=${t}`);return}if(!fr(n)){this.debug(`viewSyncFile(): file exists but is not SyncFile, guid=${r}, vpath=${t}, actual type=${n.constructor.name}`);return}return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new wt(r,t,this.loginManager,this);if(!oo(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new Xs(r,t,this);if(!$d(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new Sn(r,t,this.hashStore,this);if(!fr(s))throw new Error(`getOrCreateSyncFile(): unexpected ifile type, guid=${t}`);return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof rt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof rt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof rt.TFolder)return this.getSyncFolder(n,r);if(t instanceof rt.TFile){if(wt.checkExtension(n))return this.uploadDoc(n,r);if(Tt.checkExtension(n)&&He().enableCanvasSync)return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){var n;let r=(n=this.syncStore)==null?void 0:n.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let u=[];l instanceof Xs&&this.syncStore.forEach((f,d)=>{if(d.startsWith(i+Sr.sep)){let m=d.replace(i,s);u.push([f.id,d,m])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),u.forEach(f=>{let[d,m,p]=f;this.syncStore.move(m,p);let v=this.files.get(d);v&&v.move(p,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},cc=class extends wn{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,rt.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(u=>u.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}get manager(){return this.relayManager}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(u=>u.path==t&&u.guid==r);if(i)return i;let a=this.find(u=>u.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var Hc=require("@codemirror/state"),sY=require("@codemirror/view"),Ir=require("obsidian");function H(){}var aa=o=>o;function ie(o,e){for(let t in e)o[t]=e[t];return o}function Hv(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function Vd(o){return o()}function fc(){return Object.create(null)}function ve(o){o.forEach(Vd)}function Je(o){return typeof o=="function"}function K(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var uc;function dr(o,e){return o===e?!0:(uc||(uc=document.createElement("a")),uc.href=e,o===uc.href)}function qv(o){return Object.keys(o).length===0}function At(o,...e){if(o==null){for(let r of e)r(void 0);return H}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Io(o){let e;return At(o,t=>e=t)(),e}function le(o,e,t){o.$$.on_destroy.push(At(e,t))}function be(o,e,t,r){if(o){let n=jv(o,e,t,r);return o[0](n)}}function jv(o,e,t,r){return o[1]&&r?ie(t.ctx.slice(),o[1](r(e))):t.ctx}function _e(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function we(o,e,t,r,n,s){if(n){let i=jv(e,t,r,s);o.p(i,n)}}function xe(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Hd(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function St(o){return o==null?"":o}function ei(o,e,t){return o.set(t),e}function Jn(o){return o&&Je(o.destroy)?o.destroy:H}var zv=typeof window!="undefined",qd=zv?()=>window.performance.now():()=>Date.now(),la=zv?o=>requestAnimationFrame(o):H;var ti=new Set;function Wv(o){ti.forEach(e=>{e.c(o)||(ti.delete(e),e.f())}),ti.size!==0&&la(Wv)}function jd(o){let e;return ti.size===0&&la(Wv),{promise:new Promise(t=>{ti.add(e={c:o,f:t})}),abort(){ti.delete(e)}}}var Yn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var dc=class o{constructor(e){vt(this,"_listeners","WeakMap"in Yn?new WeakMap:void 0);vt(this,"_observer");vt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)o.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};dc.entries="WeakMap"in Yn?new WeakMap:void 0;var Kv=!1;function Gv(){Kv=!0}function Jv(){Kv=!1}function y(o,e){o.appendChild(e)}function Ce(o,e,t){let r=pc(o);if(!r.getElementById(e)){let n=_("style");n.id=e,n.textContent=t,Qv(r,n)}}function pc(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function Yv(o){let e=_("style");return e.textContent="/* empty */",Qv(pc(o),e),e.sheet}function Qv(o,e){return y(o.head||o,e),e.sheet}function x(o,e,t){o.insertBefore(e,t||null)}function w(o){o.parentNode&&o.parentNode.removeChild(o)}function je(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function _(o){return document.createElement(o)}function Kt(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function B(o){return document.createTextNode(o)}function F(){return B(" ")}function me(){return B("")}function V(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function mc(o){return function(e){return e.preventDefault(),o.call(this,e)}}function hc(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}var w2=["width","height"];function x2(o,e){let t=Object.getOwnPropertyDescriptors(o.__proto__);for(let r in e)e[r]==null?o.removeAttribute(r):r==="style"?o.style.cssText=e[r]:r==="__value"?o.value=o[r]=e[r]:t[r]&&t[r].set&&w2.indexOf(r)===-1?o[r]=e[r]:h(o,r,e[r])}function ca(o,e){for(let t in e)h(o,t,e[t])}function S2(o,e){Object.keys(e).forEach(t=>{k2(o,t,e[t])})}function k2(o,e,t){let r=e.toLowerCase();r in o?o[r]=typeof o[r]=="boolean"&&t===""?!0:t:e in o?o[e]=typeof o[e]=="boolean"&&t===""?!0:t:h(o,e,t)}function Zv(o){return/-/.test(o)?S2:x2}function Xv(o){return Array.from(o.childNodes)}function Y(o,e){e=""+e,o.data!==e&&(o.data=e)}function Ye(o,e){o.value=e==null?"":e}function ae(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function In(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Me(o,e,t){o.classList.toggle(e,!!t)}function ua(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var kn=class{constructor(e=!1){vt(this,"is_svg",!1);vt(this,"e");vt(this,"n");vt(this,"t");vt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Kt(t.nodeName):this.e=_(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)x(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(w)}};function eb(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Qo(o,e){return new o(e)}var gc=new Map,yc=0;function I2(o){let e=5381,t=o.length;for(;t--;)e=(e<<5)-e^o.charCodeAt(t);return e>>>0}function C2(o,e){let t={stylesheet:Yv(e),rules:{}};return gc.set(o,t),t}function vc(o,e,t,r,n,s,i,a=0){let l=16.666/r,c=`{
`;for(let g=0;g<=1;g+=l){let I=e+(t-e)*s(g);c+=g*100+`%{${i(I,1-I)}}
`}let u=c+`100% {${i(t,1-t)}}
}`,f=`__svelte_${I2(u)}_${a}`,d=pc(o),{stylesheet:m,rules:p}=gc.get(d)||C2(d,o);p[f]||(p[f]=!0,m.insertRule(`@keyframes ${f} ${u}`,m.cssRules.length));let v=o.style.animation||"";return o.style.animation=`${v?`${v}, `:""}${f} ${r}ms linear ${n}ms 1 both`,yc+=1,f}function zd(o,e){let t=(o.style.animation||"").split(", "),r=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),n=t.length-r.length;n&&(o.style.animation=r.join(", "),yc-=n,yc||L2())}function L2(){la(()=>{yc||(gc.forEach(o=>{let{ownerNode:e}=o.stylesheet;e&&w(e)}),gc.clear())})}var Cn;function kr(o){Cn=o}function fa(){if(!Cn)throw new Error("Function called outside component initialization");return Cn}function it(o){fa().$$.on_mount.push(o)}function Zo(o){fa().$$.on_destroy.push(o)}function et(){let o=fa();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=ua(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function pr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Qn=[];var pt=[],oi=[],Kd=[],tb=Promise.resolve(),Gd=!1;function Jd(){Gd||(Gd=!0,tb.then(da))}function Yd(){return Jd(),tb}function Co(o){oi.push(o)}function bc(o){Kd.push(o)}var Wd=new Set,ri=0;function da(){if(ri!==0)return;let o=Cn;do{try{for(;ri<Qn.length;){let e=Qn[ri];ri++,kr(e),M2(e.$$)}}catch(e){throw Qn.length=0,ri=0,e}for(kr(null),Qn.length=0,ri=0;pt.length;)pt.pop()();for(let e=0;e<oi.length;e+=1){let t=oi[e];Wd.has(t)||(Wd.add(t),t())}oi.length=0}while(Qn.length);for(;Kd.length;)Kd.pop()();Gd=!1,Wd.clear(),kr(o)}function M2(o){if(o.fragment!==null){o.update(),ve(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Co)}}function rb(o){let e=[],t=[];oi.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),oi=e}var pa;function T2(){return pa||(pa=Promise.resolve(),pa.then(()=>{pa=null})),pa}function Qd(o,e,t){o.dispatchEvent(ua(`${e?"intro":"outro"}${t}`))}var _c=new Set,Xo;function oe(){Xo={r:0,c:[],p:Xo}}function ne(){Xo.r||ve(Xo.c),Xo=Xo.p}function b(o,e){o&&o.i&&(_c.delete(o),o.i(e))}function S(o,e,t,r){if(o&&o.o){if(_c.has(o))return;_c.add(o),Xo.c.push(()=>{_c.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}var A2={duration:0};function Zn(o,e,t,r){let s=e(o,t,{direction:"both"}),i=r?0:1,a=null,l=null,c=null,u;function f(){c&&zd(o,c)}function d(p,v){let g=p.b-i;return v*=Math.abs(g),{a:i,b:p.b,d:g,duration:v,start:p.start,end:p.start+v,group:p.group}}function m(p){let{delay:v=0,duration:g=300,easing:I=aa,tick:L=H,css:k}=s||A2,C={start:qd()+v,b:p};p||(C.group=Xo,Xo.r+=1),"inert"in o&&(p?u!==void 0&&(o.inert=u):(u=o.inert,o.inert=!0)),a||l?l=C:(k&&(f(),c=vc(o,i,p,g,v,I,k)),p&&L(0,1),a=d(C,g),Co(()=>Qd(o,p,"start")),jd(T=>{if(l&&T>l.start&&(a=d(l,g),l=null,Qd(o,a.b,"start"),k&&(f(),c=vc(o,i,a.b,a.duration,0,I,s.css))),a){if(T>=a.end)L(i=a.b,1-i),Qd(o,a.b,"end"),l||(a.b?f():--a.group.r||ve(a.group.c)),a=null;else if(T>=a.start){let A=T-a.start;i=a.a+a.d*I(A/a.duration),L(i,1-i)}}return!!(a||l)}))}return{run(p){Je(s)?T2().then(()=>{s=s({direction:p?"in":"out"}),m(p)}):m(p)},end(){f(),a=l=null}}}function en(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==s&&f&&(oe(),S(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),ne())}):e.block.d(1),c.c(),b(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&da()}if(Hv(o)){let n=fa();if(o.then(s=>{kr(n),r(e.then,1,e.value,s),kr(null)},s=>{if(kr(n),r(e.catch,2,e.error,s),kr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function ni(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function he(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function si(o,e){o.d(1),e.delete(o.key)}function tn(o,e){S(o,1,1,()=>{e.delete(o.key)})}function mr(o,e,t,r,n,s,i,a,l,c,u,f){let d=o.length,m=s.length,p=d,v={};for(;p--;)v[o[p].key]=p;let g=[],I=new Map,L=new Map,k=[];for(p=m;p--;){let E=f(n,s,p),P=t(E),M=i.get(P);M?r&&k.push(()=>M.p(E,e)):(M=c(P,E),M.c()),I.set(P,g[p]=M),P in v&&L.set(P,Math.abs(p-v[P]))}let C=new Set,T=new Set;function A(E){b(E,1),E.m(a,u),i.set(E.key,E),u=E.first,m--}for(;d&&m;){let E=g[m-1],P=o[d-1],M=E.key,$=P.key;E===P?(u=E.first,d--,m--):I.has($)?!i.has(M)||C.has(M)?A(E):T.has($)?d--:L.get(M)>L.get($)?(T.add(M),A(E)):(C.add($),d--):(l(P,i),d--)}for(;d--;){let E=o[d];I.has(E.key)||l(E,i)}for(;m;)A(g[m-1]);return ve(k),g}function Pe(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function De(o){return typeof o=="object"&&o!==null?o:{}}var F2=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],E2=new Set([...F2]);function wc(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function U(o){o&&o.c()}function D(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),Co(()=>{let s=o.$$.on_mount.map(Vd).filter(Je);o.$$.on_destroy?o.$$.on_destroy.push(...s):ve(s),o.$$.on_mount=[]}),n.forEach(Co)}function R(o,e){let t=o.$$;t.fragment!==null&&(rb(t.after_update),ve(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function D2(o,e){o.$$.dirty[0]===-1&&(Qn.push(o),Jd(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function J(o,e,t,r,n,s,i=null,a=[-1]){let l=Cn;kr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:H,not_equal:n,bound:fc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fc(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(f,d,...m)=>{let p=m.length?m[0]:d;return c.ctx&&n(c.ctx[f],c.ctx[f]=p)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](p),u&&D2(o,f)),d}):[],c.update(),u=!0,ve(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){Gv();let f=Xv(e.target);c.fragment&&c.fragment.l(f),f.forEach(w)}else c.fragment&&c.fragment.c();e.intro&&b(o.$$.fragment),D(o,e.target,e.anchor),Jv(),da()}kr(l)}var R2;typeof HTMLElement=="function"&&(R2=class extends HTMLElement{constructor(e,t,r){super();vt(this,"$$ctor");vt(this,"$$s");vt(this,"$$c");vt(this,"$$cn",!1);vt(this,"$$d",{});vt(this,"$$r",!1);vt(this,"$$p_d",{});vt(this,"$$l",{});vt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=_("slot"),s!=="default"&&h(i,"name",s)},m:function(c,u){x(c,i,u)},d:function(c){c&&w(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=eb(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=Zd(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=Zd(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Zd(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Zd(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var G=class{constructor(){vt(this,"$$");vt(this,"$$set")}$destroy(){R(this,1),this.$destroy=H}$on(e,t){if(!Je(t))return H;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!qv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");var O2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Xd=O2;function ob(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function ep(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=ie(r,t[n]);return{c(){e=Kt(o[11]),ca(e,r)},m(n,s){x(n,e,s)},p(n,s){ca(e,r=Pe(t,[s&32&&n[12]]))},d(n){n&&w(e)}}}function nb(o){let e=o[11],t,r=o[11]&&ep(o);return{c(){r&&r.c(),t=me()},m(n,s){r&&r.m(n,s),x(n,t,s)},p(n,s){n[11]?e?K(e,n[11])?(r.d(1),r=ep(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=ep(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&w(t),r&&r.d(n)}}}function N2(o){let e,t,r,n,s,i=he(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=nb(ob(o,i,d));let l=o[10].default,c=be(l,o,o[9],null),u=[Xd,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],f={};for(let d=0;d<u.length;d+=1)f=ie(f,u[d]);return{c(){e=Kt("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=me(),c&&c.c(),ca(e,f)},m(d,m){x(d,e,m);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(e,null);y(e,t),c&&c.m(e,null),s=!0},p(d,[m]){if(m&32){i=he(d[5]);let p;for(p=0;p<i.length;p+=1){let v=ob(d,i,p);a[p]?a[p].p(v,m):(a[p]=nb(v),a[p].c(),a[p].m(e,t))}for(;p<a.length;p+=1)a[p].d(1);a.length=i.length}c&&c.p&&(!s||m&512)&&we(c,l,d,d[9],s?_e(l,d[9],m,null):xe(d[9]),null),ca(e,f=Pe(u,[Xd,m&128&&d[7],(!s||m&4)&&{width:d[2]},(!s||m&4)&&{height:d[2]},(!s||m&2)&&{stroke:d[1]},(!s||m&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||m&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(b(c,d),s=!0)},o(d){S(c,d),s=!1},d(d){d&&w(e),je(a,d),c&&c.d(d)}}}function $2(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Hd(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:f=!1}=e,{iconNode:d}=e,m=(...p)=>p.filter((v,g,I)=>!!v&&I.indexOf(v)===g).join(" ");return o.$$set=p=>{t(8,e=ie(ie({},e),Se(p))),t(7,n=Hd(e,r)),"name"in p&&t(0,a=p.name),"color"in p&&t(1,l=p.color),"size"in p&&t(2,c=p.size),"strokeWidth"in p&&t(3,u=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,f=p.absoluteStrokeWidth),"iconNode"in p&&t(5,d=p.iconNode),"$$scope"in p&&t(9,i=p.$$scope)},e=Se(e),[a,l,c,u,f,d,m,n,e,i,s]}var tp=class extends G{constructor(e){super(),J(this,e,$2,N2,K,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Re=tp;function B2(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function V2(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[B2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function H2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var rp=class extends G{constructor(e){super(),J(this,e,H2,V2,K,{})}},op=rp;function q2(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function j2(o){let e,t,r=[{name:"arrow-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[q2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function z2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var np=class extends G{constructor(e){super(),J(this,e,z2,j2,K,{})}},sp=np;function W2(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function K2(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[W2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function G2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var ip=class extends G{constructor(e){super(),J(this,e,G2,K2,K,{})}},ap=ip;function J2(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function Y2(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[J2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function Q2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var lp=class extends G{constructor(e){super(),J(this,e,Q2,Y2,K,{})}},ma=lp;function Z2(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function X2(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Z2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function eL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var cp=class extends G{constructor(e){super(),J(this,e,eL,X2,K,{})}},up=cp;function tL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function rL(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[tL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function oL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var fp=class extends G{constructor(e){super(),J(this,e,oL,rL,K,{})}},dp=fp;function nL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function sL(o){let e,t,r=[{name:"circle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[nL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function iL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var pp=class extends G{constructor(e){super(),J(this,e,iL,sL,K,{})}},mp=pp;function aL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function lL(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[aL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function cL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var hp=class extends G{constructor(e){super(),J(this,e,cL,lL,K,{})}},ha=hp;function uL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function fL(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[uL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function dL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var gp=class extends G{constructor(e){super(),J(this,e,dL,fL,K,{})}},ga=gp;function pL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function mL(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[pL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function hL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var yp=class extends G{constructor(e){super(),J(this,e,hL,mL,K,{})}},ya=yp;function gL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function yL(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[gL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function vL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var vp=class extends G{constructor(e){super(),J(this,e,vL,yL,K,{})}},va=vp;function bL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function _L(o){let e,t,r=[{name:"folder-lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[bL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function wL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var bp=class extends G{constructor(e){super(),J(this,e,wL,_L,K,{})}},Xn=bp;function xL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function SL(o){let e,t,r=[{name:"folder-open"},o[1],{iconNode:o[0]}],n={$$slots:{default:[xL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function kL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var _p=class extends G{constructor(e){super(),J(this,e,kL,SL,K,{})}},wp=_p;function IL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function CL(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[IL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function LL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var xp=class extends G{constructor(e){super(),J(this,e,LL,CL,K,{})}},Lo=xp;function ML(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function TL(o){let e,t,r=[{name:"home"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ML]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function AL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}],["polyline",{points:"9 22 9 12 15 12 15 22"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Sp=class extends G{constructor(e){super(),J(this,e,AL,TL,K,{})}},kp=Sp;function FL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function EL(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[FL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function PL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ip=class extends G{constructor(e){super(),J(this,e,PL,EL,K,{})}},ba=Ip;function DL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function RL(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[DL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function UL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Cp=class extends G{constructor(e){super(),J(this,e,UL,RL,K,{})}},no=Cp;function OL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function NL(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[OL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function $L(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Lp=class extends G{constructor(e){super(),J(this,e,$L,NL,K,{})}},Mp=Lp;function BL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function VL(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[BL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function HL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Tp=class extends G{constructor(e){super(),J(this,e,HL,VL,K,{})}},Ap=Tp;function qL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function jL(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[qL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function zL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Fp=class extends G{constructor(e){super(),J(this,e,zL,jL,K,{})}},Ep=Fp;function WL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function KL(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[WL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function GL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Pp=class extends G{constructor(e){super(),J(this,e,GL,KL,K,{})}},Dp=Pp;function JL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function YL(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[JL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function QL(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Rp=class extends G{constructor(e){super(),J(this,e,QL,YL,K,{})}},Up=Rp;function ZL(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function XL(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ZL]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function eM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Op=class extends G{constructor(e){super(),J(this,e,eM,XL,K,{})}},rn=Op;function tM(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function rM(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[tM]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function oM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Np=class extends G{constructor(e){super(),J(this,e,oM,rM,K,{})}},$p=Np;function nM(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function sM(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[nM]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function iM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Bp=class extends G{constructor(e){super(),J(this,e,iM,sM,K,{})}},_a=Bp;function aM(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function lM(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[aM]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function cM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Vp=class extends G{constructor(e){super(),J(this,e,cM,lM,K,{})}},es=Vp;function uM(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function fM(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[uM]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function dM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Hp=class extends G{constructor(e){super(),J(this,e,dM,fM,K,{})}},qp=Hp;function pM(o){let e,t=o[2].default,r=be(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&we(r,t,n,n[3],e?_e(t,n[3],s,null):xe(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){S(r,n),e=!1},d(n){r&&r.d(n)}}}function mM(o){let e,t,r=[{name:"x"},o[1],{iconNode:o[0]}],n={$$slots:{default:[pM]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=ie(n,r[s]);return e=new Re({props:n}),{c(){U(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Pe(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function hM(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return o.$$set=i=>{t(1,e=ie(ie({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var jp=class extends G{constructor(e){super(),J(this,e,hM,mM,K,{})}},zp=jp;function gM(o){Ce(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function yM(o){let e,t,r,n,s,i;return t=new no({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=_("button"),U(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){x(a,e,l),D(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),i=!1},d(a){a&&w(e),R(t)}}}function vM(o){let e,t,r,n,s,i,a,l,c,u,f,d,m;return t=new no({props:{class:"svg-icon inline-icon"}}),l=new rn({props:{class:"svg-icon inline-icon"}}),{c(){var p;e=_("button"),U(t.$$.fragment),i=F(),a=_("button"),U(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(p=o[0].view.file)==null?void 0:p.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(a,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(p,v){x(p,e,v),D(t,e,null),x(p,i,v),x(p,a,v),D(l,a,null),f=!0,d||(m=[V(a,"click",o[3]),V(a,"keypress",o[4])],d=!0)},p(p,v){var g;(!f||v&1&&r!==(r="clickable-icon view-action system3-view-action "+(p[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!f||v&1&&n!==(n=p[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!f||v&1&&s!==(s=(g=p[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!f||v&2&&c!==(c="system3-"+p[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(a,"class",c),(!f||v&6&&u!==(u=`${p[2].relay.name} (${p[1].status})`))&&h(a,"aria-label",u)},i(p){f||(b(t.$$.fragment,p),b(l.$$.fragment,p),f=!0)},o(p){S(t.$$.fragment,p),S(l.$$.fragment,p),f=!1},d(p){p&&(w(e),w(i),w(a)),R(t),R(l),d=!1,ve(m)}}}function bM(o){let e,t,r,n,s=[vM,yM],i=[];function a(l,c){return l[2]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,[c]){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function _M(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},a=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&a()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,a,l]}var Wp=class extends G{constructor(e){super(),J(this,e,_M,bM,K,{view:0,state:1,remote:2},gM)}},Kp=Wp;var sb=require("obsidian");var Gp=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Fe("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,sb.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.7.1"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{var t;if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,(t=this.onOffline)==null||t.forEach(r=>r(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},ib=Gp;var lW=require("obsidian"),ts=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),this.onClick=async()=>!0,!0}};var Lc=require("@codemirror/state"),cb=require("@codemirror/view");function ab(o,e){let t=Object.keys(e).map(r=>wM(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function wM(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var Mo=class Mo extends Xe{constructor(){super("Patcher");this.unsubscribes=[];this.patchedMethods=new WeakMap;typeof window!="undefined"&&(window.relayPatches&&window.relayPatches.length>0&&console.warn(`Found ${window.relayPatches.length} existing unsubscribers on window.relayPatches at startup - possible memory leak or incomplete cleanup`),window.relayPatches=[])}static getInstance(){return Mo.instance||(Mo.instance=new Mo),Mo.instance}patch(t,r){var u,f;let n=this.patchedMethods.get(t)||new Set,s=Object.keys(r),i=s.filter(d=>n.has(d));if(i.length>0){this.warn(`Methods [${i.join(", ")}] already patched on ${(u=t.constructor)==null?void 0:u.name}, skipping duplicates`);let d={};if(s.filter(m=>!i.includes(m)).forEach(m=>d[m]=r[m]),Object.keys(d).length===0)return this.debug("All methods conflicted, returning no-op unsubscriber"),()=>{};r=d}let a=new Set([...n,...Object.keys(r)]);this.patchedMethods.set(t,a);let l=ab(t,r);return this.unsubscribes.push(l),typeof window!="undefined"&&window.relayPatches&&window.relayPatches.push(l),this.debug("Applied monkeypatch",{target:(f=t.constructor)==null?void 0:f.name,methods:Object.keys(r),patchCount:this.unsubscribes.length}),()=>{Object.keys(r).forEach(m=>a.delete(m)),a.size===0&&this.patchedMethods.delete(t);let d=this.unsubscribes.indexOf(l);if(d>=0&&this.unsubscribes.splice(d,1),typeof window!="undefined"&&window.relayPatches){let m=window.relayPatches.indexOf(l);m>=0&&window.relayPatches.splice(m,1)}l()}}getCount(){return this.unsubscribes.length}cleanup(){let t=this.unsubscribes.length;this.debug("Starting cleanup of monkeypatches",{count:t}),this.unsubscribes.forEach((r,n)=>{try{r(),this.debug("Cleaned up monkeypatch",{index:n+1,total:t})}catch(s){this.error("Error during monkeypatch cleanup",{index:n+1,error:s})}}),this.unsubscribes.length=0,typeof window!="undefined"&&window.relayPatches&&(window.relayPatches.length=0),this.log("Completed cleanup of monkeypatches",{cleanedCount:t})}static destroy(){Mo.instance&&(Mo.instance.cleanup(),Mo.instance=null),typeof window!="undefined"&&window.relayPatches&&(window.relayPatches.length=0)}hasRegisteredPatches(){return this.unsubscribes.length>0}};Mo.instance=null;var wa=Mo,hr=()=>wa.getInstance();var ub=Uo(Gl());var fb=require("obsidian");var xc=class{constructor(e,t,r,n){this.containerEl=e;this.before=t;this.text=r,this.onClick=n,this.display()}display(){if(!this.containerEl||!this.before)return!0;let e=this.containerEl,t=this.before;if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var gK=require("obsidian");var oK=require("obsidian");var Sc=class extends Xe{constructor(t){var r;super();this.destroyed=!1;this.view=t,this.setLoggers(`[PreviewRenderer][${(r=t.file)==null?void 0:r.path}]`),this.debug("created")}render(t,r){var n,s;if(this.destroyed){this.debug("Skipping render - renderer destroyed");return}if(!He().enablePreviewViewHooks){this.debug("Preview view hooks disabled via flags");return}if(r!=="preview"){this.debug("Skipping render - not in preview mode");return}try{this.debug("Rendering preview from document"),this.view.text=t.text,this.view.previewMode.renderer.set(t.text),(s=(n=this.view).onInternalDataChange)==null||s.call(n),this.debug("Preview render completed")}catch(i){this.error("Error rendering preview:",i)}}destroy(){this.destroyed=!0,this.debug("destroyed"),this.view=null}};var lb=Uo(Gl());var Ic=require("obsidian");var kc=class extends Xe{constructor(t){var r;super();this.destroyed=!1;this.view=t,this.setLoggers(`[MetadataRenderer][${(r=t.file)==null?void 0:r.path}]`),this.debug("created")}render(t,r){if(this.destroyed){this.debug("Skipping render - renderer destroyed");return}if(!He().enableMetadataViewHooks){this.debug("Metadata view hooks disabled via flags");return}try{this.debug("Rendering metadata from document");let n=this.view.metadataEditor;if(!n){this.debug("No metadata editor available");return}let i=(0,Ic.getFrontMatterInfo)(t.text).frontmatter;if(i){n.synchronize((0,Ic.parseYaml)(i));for(let a of n.rendered)a.renderProperty(a.entry,!0)}else this.debug("No frontmatter found in document")}catch(n){this.error("Error rendering metadata:",n)}}destroy(){this.destroyed=!0,this.debug("destroyed"),this.view=null}};var Ln=class extends Xe{constructor(t,r){super();this.unsubscribes=[];this.destroyed=!1;this.saving=!1;this.view=t,this.document=r,this.setLoggers(`[ViewHookPlugin][${r.path}]`),this.debug("created"),this.renderers=[],this.renderers.push(new Sc(t)),this.renderers.push(new kc(t)),this._ytext=this.document.ytext,this.installMarkdownHooks(this.view),this.setupDocumentObserver(),this.renderAll()}installMarkdownHooks(t){let r=this;He().enableMetadataViewHooks&&this.unsubscribes.push(hr().patch(t,{saveFrontmatter(n){return function(s){r.debug("saveFrontmatter hook triggered"),r.saving=!0;let i=n.call(this,s);return r.saving=!1,i}}})),this.unsubscribes.push(hr().patch(t,{save(n){return function(s){var a,l;let i=n.call(this,s);try{((l=(a=r.view).getMode)==null?void 0:l.call(a))==="preview"&&r.saving&&(r.debug("Syncing metadata changes to CRDT during save"),ro(r.document.ydoc,r.view.text,r.document))}catch(c){r.error("Error syncing during save:",c)}return i}}})),He().enablePreviewViewHooks&&this.unsubscribes.push(hr().patch(t.previewMode,{edit(n){return function(s){var i,a;if(r.debug("Preview edit hook triggered"),((a=(i=r.view).getMode)==null?void 0:a.call(i))==="preview"){if(r.view.editor){let l=r.incrementalBufferChange(s);r.view.editor.cm.dispatch({changes:l}),r.debug("Dispatched preview edit to CodeMirror")}else ro(r.document.ydoc,s,r.document),r.debug("Synced preview edit directly to CRDT");return}return n.call(this,s)}}}))}setupDocumentObserver(){this.observer=async(t,r)=>{if(!this.active()){this.debug("Received yjs event against a non-active view");return}if(this.destroyed){this.debug("Received yjs event but plugin was destroyed");return}this.debug("Document changed, updating all renderers"),this.renderAll()},this._ytext.observe(this.observer)}active(){return!this.destroyed&&!!this.view}renderAll(){var r,n,s,i;let t=((n=(r=this.view).getMode)==null?void 0:n.call(r))||((i=(s=this.view).getViewType)==null?void 0:i.call(s))||"unknown";this.debug(`Rendering all components for mode: ${t}`),this.renderers.forEach(a=>{try{a.render(this.document,t)}catch(l){this.error("Error in renderer:",l)}})}incrementalBufferChange(t){let r=this.view.editor.cm.state.doc.toString(),n=new lb.default,s=n.diff_main(r,t);n.diff_cleanupSemantic(s);let i=[],a=0;for(let[l,c]of s)switch(l){case 0:a+=c.length;break;case 1:i.push({from:a,to:a,insert:c}),a+=c.length;break;case-1:i.push({from:a,to:a+c.length,insert:""});break}return i}async initialize(){await this.document.whenReady(),this.view.previewMode.renderer.set(this.document.text),this.renderAll(),this.document.connect(),this.debug("ViewHookPlugin initialized")}destroy(){var t;this.destroyed=!0,this.debug("destroyed"),this.observer&&((t=this._ytext)==null||t.unobserve(this.observer)),this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,this.renderers.forEach(r=>r.destroy()),this.renderers.length=0,this._ytext=null,this.view=null,this.document=null}};var xM=25,KK=Lc.Facet.define({combine(o){return o[o.length-1]}}),Cc=Lc.Annotation.define(),Jp=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.error=(...e)=>{};this.embed=!1;var a,l,c;this.unsubscribes=[],this.editor=e,this.sourceView=this.editor.dom.closest(".markdown-source-view"),this.connectionManager=this.editor.state.field(To);let t=this.editor.dom.closest(".relay-live-editor"),n=(a=this.sourceView)==null?void 0:a.classList.contains("mod-inside-iframe");if(!t&&!n){this.destroyed=!0;return}if(this.view=(l=this.connectionManager)==null?void 0:l.findView(this.editor),this.document=this.getDocument(),!this.document){this.destroyed=!0;return}this.view?this.viewHookPlugin=new Ln(this.view.view,this.document):this.embed=!0,this.log=Fe(`[LiveCMPluginValue][${this.document.path}]`,"log"),this.warn=Fe(`[LiveCMPluginValue][${this.document.path}]`,"warn"),this.error=Fe(`[LiveCMPluginValue][${this.document.path}]`,"error"),this.debug=Fe(`[LiveCMPluginValue][${this.document.path}]`,"debug"),this.debug("created");let s=this,i=!1;(c=this.view)!=null&&c.view?this.unsubscribes.push(hr().patch(this.view.view,{setViewData(u){return function(f,d){if(d)Br(s.view)&&s.view.document.text===f&&(s.view.tracking=!0),s.resync();else if(i){let m=s.incrementalBufferChange(f);e.dispatch({changes:m});return}return u.call(this,f,d)}},saveFrontmatter(u){return function(f){i=!0;let d=u.call(this,f);return i=!1,d}},requestSave(u){return function(){let f=u.call(this);try{this.app.metadataCache.trigger("resolve",this.file)}catch(d){}return f}}})):this.document.connect(),this.document.connected?this.resync():this.document.onceConnected().then(()=>{this.resync()}),this.viewHookPlugin&&this.viewHookPlugin.initialize().catch(u=>{this.error("Error initializing ViewHookPlugin:",u)}),this._observer=async(u,f)=>{if(this.document=this.getDocument(),!this.active(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(f.origin!==this){let d=u.delta,m=[],p=0;for(let v=0;v<d.length;v++){let g=d[v];g.insert!=null?m.push({from:p,to:p,insert:g.insert}):g.delete!=null?(m.push({from:p,to:p+g.delete,insert:""}),p+=g.delete):g.retain!=null&&(p+=g.retain)}Br(this.view)&&!this.view.tracking||He().enableEditorTweens&&this.keyFrameCounter>xM?(this.keyFrameCounter=0,m=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),this.active(this.view)&&(e.dispatch({changes:m,annotations:[Cc.of(this.editor)]}),Br(this.view)&&(this.view.tracking=!0))}},this.observer=(u,f)=>{var d;try{(d=this._observer)==null||d.call(this,u,f)}catch(m){m instanceof RangeError&&Br(this.view)&&(this.view.tracking=!1)}},this._ytext=this.document.ytext,this._ytext.observe(this.observer)}getDocument(){var r,n,s;let t=this.editor.state.field(fb.editorInfoField).file;if(t){if(((r=this.document)==null?void 0:r._tfile)===t)return this.document;let i=(n=this.connectionManager)==null?void 0:n.sharedFolders.lookup(t.path);if(i)return this.document=i.proxy.getDoc(t.path),this.document}if(this.view=(s=this.connectionManager)==null?void 0:s.findView(this.editor),this.view&&this.view.document instanceof wt)return this.view.document}active(e){return Br(e)||this.embed&&this.document}mergeBanner(){return this.banner=new xc(this.sourceView,this.editor.dom,"Merge conflict -- click to resolve",async()=>{var r;if(!this.document)return!0;let e=await this.document.diskBuffer();return await this.document.checkStale()&&((r=this.connectionManager)==null||r.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document&&(this.document.clearDiskBuffer(),this.resync())}})),!0}),()=>{}}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new ub.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(Br(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();Br(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Cc.of(this.editor)]})}else if(this.active(this.view)&&this.document){await this.document.whenSynced();let e=await this.getKeyFrame();this.active(this.view)&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Cc.of(this.editor)]})}}async getKeyFrame(e=!1){var t,r;return!this.active(this.view)||this.destroyed?[]:((t=this.document)==null?void 0:t.text)===this.editor.state.doc.toString()?(Br(this.view)&&(this.view.tracking=!0),[]):(He().enableDeltaLogging&&this.warn(`|${(r=this.document)==null?void 0:r.text}|
|${this.editor.state.doc.toString()}|`),this.document?(this.warn("ytext and editor buffer need syncing"),!this.document.hasLocalDB()&&this.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(Br(this.view)&&!this.view.tracking?this.view.checkStale():this.document&&await this.document.checkStale()&&this.mergeBanner(),this.active(this.view)&&!this.destroyed?[this.getBufferChange(this.document.text,e)]:[])):(this.warn("no document"),[]))}update(e){var r,n;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Cc)===this.editor||this.destroyed)return;this.document=this.getDocument();let t=(r=this.document)==null?void 0:r.ytext;t&&((n=t.doc)==null||n.transact(()=>{let s=0;e.changes.iterChanges((i,a,l,c,u)=>{let f=u.sliceString(0,u.length,`
`);i!==a&&t.delete(i+s,a-i),f.length>0&&t.insert(i+s,f),s+=f.length-(a-i)})},this),this.embed&&this.document&&this.document.requestSave())}destroy(){var e,t;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(r=>{r()}),this.unsubscribes.length=0,(t=this.viewHookPlugin)==null||t.destroy(),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},db=cb.ViewPlugin.fromClass(Jp);var Mc=require("@codemirror/state"),gr=require("@codemirror/view");var pb=require("obsidian");var mb=gr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),SM=Mc.Annotation.define(),Yp=class extends gr.WidgetType{constructor(e,t){super(),this.color=e,this.name=t}toDOM(e){return Li("span",[Qt("class","cm-ySelectionCaret"),Qt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Is("\u2060"),Li("div",[Qt("class","cm-ySelectionCaretDot")]),Is("\u2060"),Li("div",[Qt("class","cm-ySelectionInfo")],[Is(this.name)]),Is("\u2060")])}eq(e){return e.color===this.color}compare(e){return e.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Qp=class{constructor(e){this.destroyed=!1;var i,a;this.editor=e,this.decorations=Mc.RangeSet.of([]),this.connectionManager=this.editor.state.field(To);let t=this.editor.dom.closest(".markdown-source-view"),r=this.editor.dom.closest(".relay-live-editor"),s=t==null?void 0:t.classList.contains("mod-inside-iframe");if(!r&&!s){this.destroyed=!0;return}if(this.view=(i=this.connectionManager)==null?void 0:i.findView(e),this.view&&this.view instanceof Mn){let l=(a=this.view.document)==null?void 0:a._provider;this._listener=({added:c,updated:u,removed:f},d,m)=>{c.concat(u).concat(f).findIndex(v=>{var g;return v!==((g=this._awareness)==null?void 0:g.doc.clientID)})>=0&&e.dispatch({annotations:[SM.of([])]})},l&&(this._awareness=l.awareness,this._awareness.on("change",this._listener))}}getDocument(){var r,n,s,i;let t=this.editor.state.field(pb.editorInfoField).file;if(t){if(((r=this.document)==null?void 0:r._tfile)===t)return this.document;let a=(n=this.connectionManager)==null?void 0:n.sharedFolders.lookup(t.path);if(a)return this.document=a.proxy.getDoc(t.path),this.document}return this.view=(s=this.connectionManager)==null?void 0:s.findView(this.editor),(i=this.view)==null?void 0:i.document}destroy(){var e;this.destroyed=!0,this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c;if(this.destroyed)return;let t=e.view;this.document=this.getDocument();let r=(c=this.document)==null?void 0:c.ytext;if(!(this.document&&r&&r.doc))return;let n=this.document._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let u=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),f=u?e.state.selection.main:null,d=l.cursor==null?null:hf(l.cursor.anchor),m=l.cursor==null?null:hf(l.cursor.head);if(f!=null){let p=gf(r,f.anchor),v=gf(r,f.head);(l.cursor==null||!vf(d,p)||!vf(m,v))&&s.setLocalStateField("cursor",{anchor:p,head:v})}else l.cursor!=null&&u&&s.setLocalStateField("cursor",null)}s.getStates().forEach((u,f)=>{if(f===s.doc.clientID)return;let d=u.cursor;if(d==null||d.anchor==null||d.head==null)return;let m=yf(d.anchor,i),p=yf(d.head,i);if(m==null||p==null||m.type!==r||p.type!==r)return;if(m.index>e.state.doc.length||p.index>e.state.doc.length){Fe("[RemoteSelections]","warn")(`cursor positions (${m.index}, ${p.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=gr.Decoration.none;return}let{color:v="#30bced",name:g="Anonymous"}=u.user||{},I=u.user&&u.user.colorLight||v+"33",L=ps(m.index,p.index),k=Wr(m.index,p.index),C=e.view.state.doc.lineAt(L),T=e.view.state.doc.lineAt(k);if(C.number===T.number)a.push({from:L,to:k,value:gr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});else{a.push({from:L,to:C.from+C.length,value:gr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})}),a.push({from:T.from,to:k,value:gr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});for(let A=C.number+1;A<T.number;A++){let E=e.view.state.doc.line(A).from;a.push({from:E,to:E,value:gr.Decoration.line({attributes:{style:`background-color: ${I}`,class:"cm-yLineSelection"}})})}}a.push({from:p.index,to:p.index,value:gr.Decoration.widget({side:p.index-m.index>0?-1:1,block:!1,widget:new Yp(v,g)})})}),this.decorations=gr.Decoration.set(a,!0)}},hb=gr.ViewPlugin.fromClass(Qp,{decorations:o=>o.decorations});var Tc=require("@codemirror/state"),on=require("@codemirror/view"),gb=require("@codemirror/view"),lG=require("obsidian");var mG=Tc.Annotation.define(),Xp=class extends gb.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Zp=Tc.StateEffect.define(),em=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(To),this.decorations=on.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:Zp.of(null)})},!this.connectionManager){Fe("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Fe(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var n,s;let r=(s=(n=this.view)==null?void 0:n.document)==null?void 0:s.getTFile();if(this.connectionManager&&this.app&&r){this.connectionManager.onMeta(r,this.cb);let i=this.app.metadataCache.getFileCache(r);i&&(this.updateFromMetadata(i),this.editor.dispatch({effects:Zp.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(on.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var f;(((f=l.spec)==null?void 0:f.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let u=null;for(let[m,p]of r)if(c.from<=p.to&&c.to>=p.from){u=p,r.delete(m);break}if(!u)continue;let f=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);f&&!this.view.document.sharedFolder.checkPath(f.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>on.Decoration.widget({widget:new Xp,side:1}).range(t));e.length>0?this.decorations=on.Decoration.set(e,!0):this.decorations=on.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(Zp))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},yb=on.ViewPlugin.fromClass(em,{decorations:o=>o.decorations});function nn(){}nn.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(C){return s?(setTimeout(function(){s(void 0,C)},0),!0):C}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,f=l+c;n.maxEditLength&&(f=Math.min(f,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+d,p=[{oldPos:-1,lastComponent:void 0}],v=this.extractCommon(p[0],t,e,0);if(p[0].oldPos+1>=c&&v+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,I=1/0;function L(){for(var C=Math.max(g,-u);C<=Math.min(I,u);C+=2){var T=void 0,A=p[C-1],E=p[C+1];A&&(p[C-1]=void 0);var P=!1;if(E){var M=E.oldPos-C;P=E&&0<=M&&M<l}var $=A&&A.oldPos+1<c;if(!P&&!$){p[C]=void 0;continue}if(!$||P&&A.oldPos+1<E.oldPos?T=i.addToPath(E,!0,void 0,0):T=i.addToPath(A,void 0,!0,1),v=i.extractCommon(T,t,e,C),T.oldPos+1>=c&&v+1>=l)return a(kM(i,T.lastComponent,t,e,i.useLongestToken));p[C]=T,T.oldPos+1>=c&&(I=Math.min(I,C-1)),v+1>=l&&(g=Math.max(g,C+1))}u++}if(s)(function C(){setTimeout(function(){if(u>f||Date.now()>m)return s();L()||C()},0)})();else for(;u<=f&&Date.now()<=m;){var k=L();if(k)return k}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function kM(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,u=0;a<l;a++){var f=s[a];if(f.removed){if(f.value=o.join(r.slice(u,u+f.count)),u+=f.count,a&&s[a-1].added){var m=s[a-1];s[a-1]=s[a],s[a]=m}}else{if(!f.added&&n){var d=t.slice(c,c+f.count);d=d.map(function(v,g){var I=r[u+g];return I.length>v.length?I:v}),f.value=o.join(d)}else f.value=o.join(t.slice(c,c+f.count));c+=f.count,f.added||(u+=f.count)}}var p=s[l-1];return l>1&&typeof p.value=="string"&&(p.added||p.removed)&&o.equals("",p.value)&&(s[l-2].value+=p.value,s.pop()),s}var gG=new nn;function IM(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var vb=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,bb=/\S/,sm=new nn;sm.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!bb.test(o)&&!bb.test(e)};sm.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&vb.test(e[t])&&vb.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function _b(o,e,t){return t=IM(t,{ignoreWhitespace:!0}),sm.diff(o,e,t)}var im=new nn;im.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function CM(o,e,t){return im.diff(o,e,t)}var LM=new nn;LM.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var MM=new nn;MM.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Ac(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ac=function(e){return typeof e}:Ac=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ac(o)}function tm(o){return TM(o)||AM(o)||FM(o)||EM()}function TM(o){if(Array.isArray(o))return rm(o)}function AM(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function FM(o,e){if(o){if(typeof o=="string")return rm(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return rm(o,e)}}function rm(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function EM(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var PM=Object.prototype.toString,xa=new nn;xa.useLongestToken=!0;xa.tokenize=im.tokenize;xa.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(om(o,null,null,n),n,"  ")};xa.equals=function(o,e){return nn.prototype.equals.call(xa,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function om(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(PM.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=om(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),Ac(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=om(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var nm=new nn;nm.tokenize=function(o){return o.slice()};nm.join=nm.removeEmpty=function(o){return o};function wb(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=CM(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(I){return I.map(function(L){return" "+L})}for(var c=[],u=0,f=0,d=[],m=1,p=1,v=function(L){var k=a[L],C=k.lines||k.value.replace(/\n$/,"").split(`
`);if(k.lines=C,k.added||k.removed){var T;if(!u){var A=a[L-1];u=m,f=p,A&&(d=i.context>0?l(A.lines.slice(-i.context)):[],u-=d.length,f-=d.length)}(T=d).push.apply(T,tm(C.map(function(te){return(k.added?"+":"-")+te}))),k.added?p+=C.length:m+=C.length}else{if(u)if(C.length<=i.context*2&&L<a.length-2){var E;(E=d).push.apply(E,tm(l(C)))}else{var P,M=Math.min(C.length,i.context);(P=d).push.apply(P,tm(l(C.slice(0,M))));var $={oldStart:u,oldLines:m-u+M,newStart:f,newLines:p-f+M,lines:d};if(L>=a.length-2&&C.length<=i.context){var W=/\n$/.test(t),O=/\n$/.test(r),N=C.length==0&&d.length>$.oldLines;!W&&N&&t.length>0&&d.splice($.oldLines,0,"\\ No newline at end of file"),(!W&&!N||!O)&&d.push("\\ No newline at end of file")}c.push($),u=0,f=0,d=[]}m+=C.length,p+=C.length}},g=0;g<a.length;g++)v(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var xb=require("obsidian");var Fc=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Ec=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),f=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Fc({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:u,file2Lines:f})),n+=u.length,s+=f.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function am(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Sa(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function ka(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function ii(o){return o!==""?o:"\u200E"}var IG=require("obsidian");var yr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var Ao=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Pc=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof wt){ro(e.ydoc,t,e);return}else if(e instanceof Jo){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new yr({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),Ao.build(t),new yr({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),Ao.build(t),new yr({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),Ao.build(t),new yr({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new yr({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),Ao.build(t),new yr({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new yr({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),Ao.build(t),new yr({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Sa({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Sa({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=Sa({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=Sa({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=ka({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=ka({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=am({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=am({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=ka({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=ka({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var ai="system3-differences-view";async function Sb(o,e){e.originalLeaf||(e.originalLeaf=o.activeLeaf||void 0),o.detachLeavesOfType(ai);let t=o.getLeaf(!0);t.setViewState({type:ai,active:!0,state:e}),o.revealLeaf(t)}var Dc=class extends xb.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=Fe(`[${r}]`,"log")}async getContent(t){return t instanceof wt?t.text:t instanceof Jo?t.contents:await this.app.vault.read(t)}getViewType(){return ai}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}closeAndReturnToOriginal(){var t;(t=this.state)!=null&&t.originalLeaf&&this.state.originalLeaf.parent&&this.app.workspace.setActiveLeaf(this.state.originalLeaf,{focus:!0}),this.leaf.detach()}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=wb(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=Ec.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),He().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,u=l<i.length?i.charCodeAt(l):void 0;if(c!==u){let f=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=u!==void 0?`0x${u.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${f}), file2=${u} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.closeAndReturnToOriginal()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new yr({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),Ao.build(r),new yr({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof wt){ro(t.ydoc,r,this);return}else if(t instanceof Jo){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){var t,r;!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),await((r=(t=this.state).onResolve)==null?void 0:r.call(t)),this.closeAndReturnToOriginal())}async acceptAllFromRight(){var t,r;!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),await((r=(t=this.state).onResolve)==null?void 0:r.call(t)),this.closeAndReturnToOriginal())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===n);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let u=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:ii(u),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Pc(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=ii(t);else if(t!=null&&r!=null){let i=_b(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=ii(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=ii(t),i.classList.add(n),s.appendChild(i)}else s.textContent=ii(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var Rc=class extends Xe{constructor(t,r){super();this.connectionManager=t;if(this.view=r.view,this.canvas=r.view.canvas,this.relayCanvas=r.canvas,this.unsubscribes=[],this.relayCanvasView=r,this.observedTextNodes=new Set,this.trackedEmbedViews=new Set,this.install(),He().enableLiveEmbeds)for(let n of this.getEmbedViews())n.file&&this.connectEmbedView(n)}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}getEmbedViews(){return[...this.canvas.nodes.values()].map(t=>t.child).filter(t=>!!t)}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}isEmbedAlreadyTracked(t){return this.trackedEmbedViews.has(t)}connectEmbedView(t){t.file&&(this.trackedEmbedViews.add(t),this.unsubscribes.push((()=>{let r=new Ln(t,this.relayCanvas.sharedFolder.proxy.getDoc(t.file.path));return r.initialize().catch(n=>{this.error("Error initializing ViewHookPlugin for canvas embed:",n)}),()=>{this.trackedEmbedViews.delete(t),r.destroy()}})()))}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=Tt.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(hr().patch(this.canvas,{requestSave(u){return function(){let f=u.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return f}},applyHistory(u){return function(f){let d=u.call(this,f);try{t.relayCanvas.importFromView(t.view)}catch(m){t.log(m)}return d}}}));let i=(u,f)=>{var p,v,g,I;let d="";if(d+=`Transaction origin: ${u.transaction.origin} ${(v=(p=u.transaction.origin)==null?void 0:p.constructor)==null?void 0:v.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(u.transaction.origin===this.relayCanvas)return;let m=Tt.exportCanvasData(this.relayCanvas.ydoc);for(let[L,k]of u.changes.keys)d+=`key: ${L} action: ${k.action}

`;this.debug(d),this.debug("importing data",(I=this.view.file)==null?void 0:I.path,this.relayCanvas.path,m),this.canvas.importData(m,!0),this.canvas.requestSave();for(let L of u.keysChanged){let k=f.get(L);if(k){if(this.canvas.nodes.has(k.id)&&(this.observeNode(k.getData()),He().enableLiveEmbeds)){let C=k.child;C!=null&&C.file&&!this.isEmbedAlreadyTracked(C)&&this.connectEmbedView(C)}this.canvas.markMoved(k),this.canvas.markDirty(k)}}},a=u=>i(u,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,u]of this.relayCanvas.ynodes)this.observeNode(u);let l=u=>i(u,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var Uc=require("@codemirror/state"),Ib=require("@codemirror/view");var hJ=Uc.Facet.define({combine(o){return o[o.length-1]}}),kb=Uc.Annotation.define(),lm=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(To),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,u=[],f=0;for(let d=0;d<c.length;d++){let m=c[d];m.insert!=null?u.push({from:f,to:f,insert:m.insert}):m.delete!=null?(u.push({from:f,to:f+m.delete,insert:""}),f+=m.delete):m.retain!=null&&(f+=m.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:u,annotations:[kb.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(kb)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let u=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),u.length>0&&t.insert(s+n,u),n+=u.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Cb=Ib.ViewPlugin.fromClass(lm);var $J=require("obsidian");function RM(o){Ce(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function UM(o){let e,t;return{c(){e=_("span"),t=B(o[5]),h(e,"class","initial svelte-18fffd7"),ae(e,"font-size",o[4])},m(r,n){x(r,e,n),y(e,t)},p(r,n){n&32&&Y(t,r[5]),n&16&&ae(e,"font-size",r[4])},d(r){r&&w(e)}}}function OM(o){let e,t,r,n;return{c(){e=_("img"),dr(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){x(s,e,i),r||(n=V(e,"error",o[6]),r=!0)},p(s,i){i&1&&!dr(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&w(e),r=!1,n()}}}function NM(o){let e;function t(s,i){return!s[3]&&s[0].picture?OM:UM}let r=t(o,-1),n=r(o);return{c(){e=_("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),ae(e,"width",o[2]),ae(e,"height",o[2])},m(s,i){x(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&ae(e,"width",s[2]),i&4&&ae(e,"height",s[2])},i:H,o:H,d(s){s&&w(e),n.d()}}}function $M(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function BM(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=f=>{"user"in f&&t(0,i=f.user),"alt"in f&&t(1,a=f.alt),"size"in f&&t(2,l=f.size)},o.$$.update=()=>{o.$$.dirty&1&&t(5,r=i.name?i.name.charAt(0).toUpperCase():"?"),o.$$.dirty&4&&t(7,n=$M(l)),o.$$.dirty&132&&t(4,s=`${parseFloat(l)/2}${n}`)},[i,a,l,c,s,r,u,n]}var cm=class extends G{constructor(e){super(),J(this,e,BM,NM,K,{user:0,alt:1,size:2},RM)}},Ia=cm;var li=[];function VM(o,e){return{subscribe:Ie(o,e).subscribe}}function Ie(o,e=H){let t,r=new Set;function n(a){if(K(o,a)&&(o=a,t)){let l=!li.length;for(let c of r)c[1](),li.push(c,o);if(l){for(let c=0;c<li.length;c+=2)li[c][0](li[c+1]);li.length=0}}}function s(a){n(a(o))}function i(a,l=H){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||H),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function Ze(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return VM(t,(i,a)=>{let l=!1,c=[],u=0,f=H,d=()=>{if(u)return;f();let p=e(r?c[0]:c,i,a);s?i(p):f=Je(p)?p:H},m=n.map((p,v)=>At(p,g=>{c[v]=g,u&=~(1<<v),l&&d()},()=>{u|=1<<v}));return l=!0,d(),function(){ve(m),f(),l=!1}})}function HM(o){Ce(o,"svelte-1o6nljh",'.user-awareness-container{display:flex;align-items:center;flex-shrink:0;margin-left:12px;position:relative}.user-awareness.svelte-1o6nljh.svelte-1o6nljh{position:relative;display:flex;align-items:center}.avatar-stack.svelte-1o6nljh.svelte-1o6nljh{display:flex;align-items:center;cursor:pointer;position:relative;transition:width 0.2s ease;overflow:visible}.stacked-avatar.svelte-1o6nljh.svelte-1o6nljh{position:relative}.avatar-stack.multi-user.svelte-1o6nljh .stacked-avatar.svelte-1o6nljh{transition:margin-left 0.2s ease}@media(hover: hover) and (pointer: fine){.avatar-stack.multi-user.svelte-1o6nljh:hover .stacked-avatar.svelte-1o6nljh{margin-left:-10px !important;margin-right:2px;transition-delay:300ms}}.more-indicator.svelte-1o6nljh.svelte-1o6nljh{width:2em;height:2em;border-radius:50%;background-color:var(--background-modifier-border);border:2px solid var(--text-muted);display:flex;align-items:center;justify-content:center;font-size:0.6em;font-weight:600;color:var(--text-muted);position:relative}.user-popover.svelte-1o6nljh.svelte-1o6nljh{position:absolute;top:100%;right:0;margin-top:8px;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:8px;box-shadow:var(--shadow-s);min-width:200px;max-width:300px;z-index:1000}.user-popover.svelte-1o6nljh.svelte-1o6nljh::before{content:"";position:absolute;top:-8px;right:20px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--background-modifier-border)}.user-popover.svelte-1o6nljh.svelte-1o6nljh::after{content:"";position:absolute;top:-7px;right:20px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid var(--background-secondary)}.popover-header.svelte-1o6nljh.svelte-1o6nljh{padding:12px 16px 8px 16px;font-size:12px;font-weight:600;color:var(--text-muted);border-bottom:1px solid var(--background-modifier-border);background:var(--background-secondary);border-radius:8px 8px 0 0}.user-list.svelte-1o6nljh.svelte-1o6nljh{padding:8px 0;max-height:200px;overflow-y:auto}.user-item.svelte-1o6nljh.svelte-1o6nljh{display:flex;align-items:center;gap:12px;padding:6px 16px;cursor:default}.user-item.svelte-1o6nljh.svelte-1o6nljh:hover{background-color:var(--background-modifier-hover)}.user-name.svelte-1o6nljh.svelte-1o6nljh{font-size:14px;color:var(--text-normal);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.avatar-with-border.svelte-1o6nljh.svelte-1o6nljh{border-radius:50%;border:2px solid;display:inline-block;overflow:hidden;flex-shrink:0;background:var(--background-primary);box-sizing:border-box;padding:1px}.user-avatar.svelte-1o6nljh.svelte-1o6nljh{width:2em;height:2em;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;position:relative}.user-initial.svelte-1o6nljh.svelte-1o6nljh{color:white;font-size:1em;font-weight:600}')}function Lb(o,e,t){let r=o.slice();return r[16]=e[t],r[18]=t,r}function Mb(o,e,t){let r=o.slice();return r[16]=e[t],r[18]=t,r}function Tb(o){let e,t,r=[],n=new Map,s,i,a,l,c,u=he(o[4]),f=p=>p[16].id;for(let p=0;p<u.length;p+=1){let v=Mb(o,u,p),g=f(v);n.set(g,r[p]=Ab(g,v))}let d=o[3].length>rs&&Fb(o),m=o[0]&&Eb(o);return{c(){e=_("div"),t=_("div");for(let p=0;p<r.length;p+=1)r[p].c();s=F(),d&&d.c(),i=F(),m&&m.c(),h(t,"class","avatar-stack svelte-1o6nljh"),h(t,"role","button"),h(t,"tabindex","0"),Me(t,"multi-user",o[4].length>1),h(e,"class","user-awareness svelte-1o6nljh")},m(p,v){x(p,e,v),y(e,t);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(t,null);y(t,s),d&&d.m(t,null),o[11](t),y(e,i),m&&m.m(e,null),o[13](e),a=!0,l||(c=[V(t,"click",o[7]),V(t,"keydown",o[12])],l=!0)},p(p,v){v&16&&(u=he(p[4]),oe(),r=mr(r,v,f,1,p,u,n,t,tn,Ab,s,Mb),ne()),p[3].length>rs?d?d.p(p,v):(d=Fb(p),d.c(),d.m(t,null)):d&&(d.d(1),d=null),(!a||v&16)&&Me(t,"multi-user",p[4].length>1),p[0]?m?(m.p(p,v),v&1&&b(m,1)):(m=Eb(p),m.c(),b(m,1),m.m(e,null)):m&&(oe(),S(m,1,1,()=>{m=null}),ne())},i(p){if(!a){for(let v=0;v<u.length;v+=1)b(r[v]);b(m),a=!0}},o(p){for(let v=0;v<r.length;v+=1)S(r[v]);S(m),a=!1},d(p){p&&w(e);for(let v=0;v<r.length;v+=1)r[v].d();d&&d.d(),o[11](null),m&&m.d(),o[13](null),l=!1,ve(c)}}}function qM(o){let e,t,r,n=o[16].name.charAt(0).toUpperCase()+"",s;return{c(){e=_("div"),t=_("div"),r=_("span"),s=B(n),h(r,"class","user-initial svelte-1o6nljh"),h(t,"class","user-avatar svelte-1o6nljh"),ae(t,"background-color",o[16].color),h(e,"class","avatar-with-border svelte-1o6nljh"),ae(e,"border-color",o[16].color)},m(i,a){x(i,e,a),y(e,t),y(t,r),y(r,s)},p(i,a){a&16&&n!==(n=i[16].name.charAt(0).toUpperCase()+"")&&Y(s,n),a&16&&ae(t,"background-color",i[16].color),a&16&&ae(e,"border-color",i[16].color)},i:H,o:H,d(i){i&&w(e)}}}function jM(o){let e,t,r;return t=new Ia({props:{user:o[16].relayUser,size:"2em",alt:o[16].name}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","avatar-with-border svelte-1o6nljh"),ae(e,"border-color",o[16].color)},m(n,s){x(n,e,s),D(t,e,null),r=!0},p(n,s){let i={};s&16&&(i.user=n[16].relayUser),s&16&&(i.alt=n[16].name),t.$set(i),(!r||s&16)&&ae(e,"border-color",n[16].color)},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}function Ab(o,e){let t,r,n,s,i,a=[jM,qM],l=[];function c(u,f){return u[16].relayUser?0:1}return r=c(e,-1),n=l[r]=a[r](e),{key:o,first:null,c(){t=_("div"),n.c(),h(t,"class","stacked-avatar svelte-1o6nljh"),ae(t,"z-index",10-e[18]),ae(t,"margin-left",Db(e[18])),ae(t,"transition","all 0.2s ease"),h(t,"aria-label",s=e[16].name),this.first=t},m(u,f){x(u,t,f),l[r].m(t,null),i=!0},p(u,f){e=u;let d=r;r=c(e,f),r===d?l[r].p(e,f):(oe(),S(l[d],1,1,()=>{l[d]=null}),ne(),n=l[r],n?n.p(e,f):(n=l[r]=a[r](e),n.c()),b(n,1),n.m(t,null)),(!i||f&16)&&ae(t,"z-index",10-e[18]),(!i||f&16)&&ae(t,"margin-left",Db(e[18])),(!i||f&16&&s!==(s=e[16].name))&&h(t,"aria-label",s)},i(u){i||(b(n),i=!0)},o(u){S(n),i=!1},d(u){u&&w(t),l[r].d()}}}function Fb(o){let e,t,r=o[3].length-rs+"",n;return{c(){e=_("div"),t=B("+"),n=B(r),h(e,"class","more-indicator svelte-1o6nljh"),ae(e,"z-index","11"),ae(e,"margin-top","1em"),ae(e,"margin-left","-1em"),ae(e,"transition","all 0.2s ease")},m(s,i){x(s,e,i),y(e,t),y(e,n)},p(s,i){i&8&&r!==(r=s[3].length-rs+"")&&Y(n,r)},d(s){s&&w(e)}}}function Eb(o){let e,t,r,n=o[3].length+"",s,i,a,l,c=[],u=new Map,f,d=he(o[3]),m=p=>p[16].id;for(let p=0;p<d.length;p+=1){let v=Lb(o,d,p),g=m(v);u.set(g,c[p]=Pb(g,v))}return{c(){e=_("div"),t=_("div"),r=B("Active Users ("),s=B(n),i=B(")"),a=F(),l=_("div");for(let p=0;p<c.length;p+=1)c[p].c();h(t,"class","popover-header svelte-1o6nljh"),h(l,"class","user-list svelte-1o6nljh"),h(e,"class","user-popover svelte-1o6nljh")},m(p,v){x(p,e,v),y(e,t),y(t,r),y(t,s),y(t,i),y(e,a),y(e,l);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(l,null);f=!0},p(p,v){(!f||v&8)&&n!==(n=p[3].length+"")&&Y(s,n),v&8&&(d=he(p[3]),oe(),c=mr(c,v,m,1,p,d,u,l,tn,Pb,null,Lb),ne())},i(p){if(!f){for(let v=0;v<d.length;v+=1)b(c[v]);f=!0}},o(p){for(let v=0;v<c.length;v+=1)S(c[v]);f=!1},d(p){p&&w(e);for(let v=0;v<c.length;v+=1)c[v].d()}}}function zM(o){let e,t,r,n=o[16].name.charAt(0).toUpperCase()+"",s;return{c(){e=_("div"),t=_("div"),r=_("span"),s=B(n),h(r,"class","user-initial svelte-1o6nljh"),h(t,"class","user-avatar svelte-1o6nljh"),ae(t,"background-color",o[16].color),ae(t,"width","20px"),ae(t,"height","20px"),h(e,"class","avatar-with-border svelte-1o6nljh"),ae(e,"border-color",o[16].color)},m(i,a){x(i,e,a),y(e,t),y(t,r),y(r,s)},p(i,a){a&8&&n!==(n=i[16].name.charAt(0).toUpperCase()+"")&&Y(s,n),a&8&&ae(t,"background-color",i[16].color),a&8&&ae(e,"border-color",i[16].color)},i:H,o:H,d(i){i&&w(e)}}}function WM(o){let e,t,r;return t=new Ia({props:{user:o[16].relayUser,size:"20px",alt:o[16].name}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","avatar-with-border svelte-1o6nljh"),ae(e,"border-color",o[16].color)},m(n,s){x(n,e,s),D(t,e,null),r=!0},p(n,s){let i={};s&8&&(i.user=n[16].relayUser),s&8&&(i.alt=n[16].name),t.$set(i),(!r||s&8)&&ae(e,"border-color",n[16].color)},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}function Pb(o,e){let t,r,n,s,i,a=e[16].name+"",l,c=e[18]===0?" (You)":"",u,f,d,m=[WM,zM],p=[];function v(g,I){return g[16].relayUser?0:1}return r=v(e,-1),n=p[r]=m[r](e),{key:o,first:null,c(){t=_("div"),n.c(),s=F(),i=_("span"),l=B(a),u=B(c),f=F(),h(i,"class","user-name svelte-1o6nljh"),h(t,"class","user-item svelte-1o6nljh"),Me(t,"current-user",e[18]===0),this.first=t},m(g,I){x(g,t,I),p[r].m(t,null),y(t,s),y(t,i),y(i,l),y(i,u),y(t,f),d=!0},p(g,I){e=g;let L=r;r=v(e,I),r===L?p[r].p(e,I):(oe(),S(p[L],1,1,()=>{p[L]=null}),ne(),n=p[r],n?n.p(e,I):(n=p[r]=m[r](e),n.c()),b(n,1),n.m(t,s)),(!d||I&8)&&a!==(a=e[16].name+"")&&Y(l,a),(!d||I&8)&&c!==(c=e[18]===0?" (You)":"")&&Y(u,c),(!d||I&8)&&Me(t,"current-user",e[18]===0)},i(g){d||(b(n),d=!0)},o(g){S(n),d=!1},d(g){g&&w(t),p[r].d()}}}function KM(o){let e,t,r=o[3].length>0&&Tb(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,[s]){n[3].length>0?r?(r.p(n,s),s&8&&b(r,1)):(r=Tb(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}var rs=4;function Db(o){return o===0?"0":o===1?"-1em":o===2?"-1.4em":"-1.8em"}function GM(o,e,t){let r,n,{awareness:s}=e,{relayUsers:i}=e,a=!1,l,c,u=Ie(0),f=null,d=Ze([i,u],([k,C])=>{if(!s||!k)return[];let T=s.getStates(),A=[];return T.forEach((M,$)=>{let W=M.user;if(W&&W.name&&W.id){let O=k.get(W.id);A.push({name:W.name,id:W.id,color:W.color||"#30bced",colorLight:W.colorLight||W.color+"33"||"#30bced33",relayUser:O})}}),[...A.filter((M,$,W)=>W.findIndex(O=>O.id===M.id)===$).sort((M,$)=>{var W;let O=s.getLocalState(),N=(W=O==null?void 0:O.user)===null||W===void 0?void 0:W.id;return M.id===N?-1:$.id===N?1:M.relayUser&&!$.relayUser?-1:!M.relayUser&&$.relayUser?1:0})]});le(o,d,k=>t(3,r=k));let m=Ze([d],([k])=>{var C;if(k.length===0)return[];let T=s==null?void 0:s.getLocalState(),A=(C=T==null?void 0:T.user)===null||C===void 0?void 0:C.id,E=k.find(M=>M.id===A),P=k.filter(M=>M.id!==A);return E?k.length<=rs?[...P,E]:[...P.slice(0,rs-1),E]:P.slice(0,rs)});le(o,m,k=>t(4,n=k));function p(){t(0,a=!a)}function v(k){l&&!l.contains(k.target)&&t(0,a=!1)}it(()=>(document.addEventListener("click",v),()=>{document.removeEventListener("click",v)})),Zo(()=>{f&&f(),document.removeEventListener("click",v)});function g(k){pt[k?"unshift":"push"](()=>{c=k,t(2,c)})}let I=k=>k.key==="Enter"&&p();function L(k){pt[k?"unshift":"push"](()=>{l=k,t(1,l)})}return o.$$set=k=>{"awareness"in k&&t(8,s=k.awareness),"relayUsers"in k&&t(9,i=k.relayUsers)},o.$$.update=()=>{if(o.$$.dirty&1280&&s){f&&f();let k=()=>{u.update(C=>C+1)};s.on("change",k),u.set(0),t(10,f=()=>{s.off("change",k)})}},[a,l,c,r,n,d,m,p,s,i,f,g,I,L]}var um=class extends G{constructor(e){super(),J(this,e,GM,KM,K,{awareness:8,relayUsers:9},HM)}},Rb=um;var Oc=class extends Xe{constructor(t,r){super();this.destroyed=!1;this.view=t,this.doc=t.document,this.relayUsersStore=r,this.setLoggers(`[AwarenessView](${this.doc.path})`),this.install()}async install(){var t;!this.view||this.destroyed||(this.log("Installing awareness component for",(t=this.view.view.file)==null?void 0:t.path),await this.doc.whenReady(),!this.destroyed&&this.setupAwarenessComponent())}setupAwarenessComponent(){if(!this.view.view.containerEl||this.destroyed)return;let t=this.view.view.containerEl.querySelector(".inline-title");if(!t){this.warn("Could not find inline-title element to position awareness component");return}let r=document.createElement("div");r.className="title-with-awareness",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="space-between",r.style.width="100%",this.awarenessElement=document.createElement("div"),this.awarenessElement.className="user-awareness-container",t.parentNode&&(t.parentNode.insertBefore(r,t),r.appendChild(t),r.appendChild(this.awarenessElement));let n=this.doc._provider;if(!(n!=null&&n.awareness)){this.warn("No awareness provider available");return}try{this.awarenessComponent=new Rb({target:this.awarenessElement,props:{awareness:n.awareness,relayUsers:this.relayUsersStore}}),this.log("Awareness component successfully mounted")}catch(s){this.warn("Failed to create awareness component:",s)}}destroy(){if(this.destroyed=!0,this.awarenessComponent)try{this.awarenessComponent.$destroy(),this.awarenessComponent=void 0,this.log("Awareness component destroyed")}catch(t){this.warn("Error destroying awareness component:",t)}if(this.awarenessElement){let t=this.awarenessElement.parentElement;if(t&&t.className==="title-with-awareness"){let r=t.querySelector(".inline-title");r&&t.parentNode&&(t.parentNode.insertBefore(r,t),t.remove())}else this.awarenessElement.remove();this.awarenessElement=void 0}this.view=null,this.doc=null}};var Ub=require("obsidian");var Nc=class extends Xe{constructor(t){var s,i,a;super();this.destroyed=!1;this.saving=!1;this.view=t,this.doc=t.document,this.unsubscribes=[],this.saving=!1;let r=this.doc._tfile,n=(s=this.view.view)==null?void 0:s.file;if(r!==n){this.error("[TextViewPlugin] CRITICAL: Document TFile mismatch!",{documentPath:this.doc.path,documentTFilePath:r==null?void 0:r.path,viewFilePath:n==null?void 0:n.path,viewType:(a=(i=this.view.view)==null?void 0:i.getViewType)==null?void 0:a.call(i),documentGuid:this.doc.guid,tFilesSame:r===n});let l=this.getDocument();l&&(this.doc=l,this.warn("[TextViewPlugin] Switched to correct document:",{newDocPath:this.doc.path,newDocGuid:this.doc.guid}))}this.view.view instanceof Ub.MarkdownView&&(this.viewHookPlugin=new Ln(this.view.view,this.doc)),this.install()}getDocument(){var r,n,s,i,a;let t=this.view.view.file;if(t){if(((r=this.doc)==null?void 0:r._tfile)===t)return this.doc;this.warn("[TextViewPlugin] getDocument() lookup:",{filePath:t.path,currentDocPath:(n=this.doc)==null?void 0:n.path,currentDocTFile:(i=(s=this.doc)==null?void 0:s._tfile)==null?void 0:i.path});let l=this.view.connectionManager.sharedFolders.lookup(t.path);if(l){let c=l.proxy.getDoc(t.path);return this.warn("[TextViewPlugin] getDocument() found:",{newDocPath:c.path,newDocGuid:c.guid,newDocTFile:(a=c._tfile)==null?void 0:a.path}),this.doc=c,this.doc}}if(this.view.document)return this.warn("[TextViewPlugin] getDocument() using fallback:",{fallbackDocPath:this.view.document.path,fallbackDocGuid:this.view.document.guid}),this.view.document}async resync(){var t,r,n,s;if(os(this.view)&&!this.view.tracking&&!this.destroyed&&this.view.view.file){if(this.doc=this.getDocument(),!this.doc){this.warn("resync() - no document available");return}if(await this.doc.whenSynced(),this.doc.text===this.view.view.getViewData()){this.view.tracking=!0,this.warn("resync() - content matches, setting tracking=true");return}else this.warn("diff in resync - DETAILED DEBUG:",{documentPath:this.doc.path,documentTFilePath:(t=this.doc._tfile)==null?void 0:t.path,viewFilePath:(r=this.view.view.file)==null?void 0:r.path,documentText:this.doc.text,viewData:this.view.view.getViewData(),documentGuid:this.doc.guid,tFilesMatching:this.doc._tfile===this.view.view.file,documentTextLength:((n=this.doc.text)==null?void 0:n.length)||0,viewDataLength:((s=this.view.view.getViewData())==null?void 0:s.length)||0});if(!this.doc.hasLocalDB()&&this.doc.text===""){this.warn("local db missing, not setting buffer");return}await this.doc.checkStale()&&this.view?(this.warn("Document is stale - showing merge banner"),this.view.checkStale().then(async a=>{a||await this.syncViewToCRDT()})):(this.warn("Document is authoritative - syncing view to CRDT state"),await this.syncViewToCRDT())}}async syncViewToCRDT(){os(this.view)&&!this.destroyed&&this.doc&&this.view.view.file&&(this.warn("Syncing view to CRDT - setViewData"),this.saving=!0,this.view.view.setViewData(this.doc.text,!1),this.doc.save(),this.saving=!1,this.view.tracking=!0)}install(){var r;if(!this.view)return;if(!this.view.view.file){this.warn("view file not ready, deferring install"),setTimeout(()=>{var n,s;!this.destroyed&&((s=(n=this.view)==null?void 0:n.view)!=null&&s.file)&&this.install()},100);return}this.warn("connecting textfile view",(r=this.view.view.file)==null?void 0:r.path,this.view.document.path);let t=this;this.unsubscribes.push(hr().patch(this.view.view,{setViewData(n){return function(s,i){if(t.warn("instance hook: setViewData",this.getViewType()),!t.view.view.file)return t.warn("setViewData called before file loaded, deferring to original"),n.call(this,s,i);i&&os(t.view)&&t.doc&&t.view.view.file===t.doc.tfile&&t.view.document.text===s&&(t.view.tracking=!0);let a=n.call(this,s,i);return i&&t.resync(),a}},requestSave(n){return function(){if(t.warn("instance hook: requestSave called",this.getViewType()),os(t.view)&&!t.saving&&t.doc)if(t.view.tracking&&!t.saving){t.warn("tracking - applying diff"),ro(t.doc.ydoc,t.view.view.getViewData(),t.doc),t.doc.save();return}else t.warn("not tracking - resync"),t.resync();return n.call(this)}}})),this.observer=(n,s)=>{if(this.doc=this.getDocument(),!this.doc){this.debug("observer - no document available");return}if(!os(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}s.origin!==this.doc&&(this.view.tracking||(this.warn("resync from update, not tracking"),this.resync()),this.warn("setting view data"),this.saving=!0,this.view.view.setViewData(this.doc.text,!1),this.view.view.requestSave(),this.saving=!1,this.view.tracking=!0)},this.resync(),this.doc=this.getDocument(),this.doc&&(this._ytext=this.doc.ytext,this._ytext.observe(this.observer)),this.viewHookPlugin&&this.viewHookPlugin.initialize().catch(n=>{this.error("Error initializing ViewHookPlugin:",n)})}destroy(){var t,r;this.warn("destroying view"),this.destroyed=!0,this.observer&&((t=this._ytext)==null||t.unobserve(this.observer)),this.unsubscribes.forEach(n=>n()),this.unsubscribes.length=0,(r=this.viewHookPlugin)==null||r.destroy(),this.observer=null,this._ytext=null,this.view=null,this.doc=null}};var JM=3;function fm(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&e(t.view)})}function dm(o,e){let t=["markdown"];He().enableKanbanView&&t.push("kanban");let r=[];o.iterateAllLeaves(n=>{var s,i,a,l;r.push({viewType:((i=(s=n.view)==null?void 0:s.getViewType)==null?void 0:i.call(s))||"unknown",filePath:((l=(a=n.view)==null?void 0:a.file)==null?void 0:l.path)||"no-file",isTextFileView:n.view instanceof Ir.TextFileView,leafType:n.view.constructor.name})}),o.iterateAllLeaves(n=>{if(n.view instanceof Ir.TextFileView){let s=n.view.getViewType();if(s==="canvas")return;t.contains(s)&&e(n.view)}})}function YM(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var $c=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new ts(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){var e;this.release(),(e=this.banner)==null||e.destroy(),this.banner=void 0,this.view=null}};function Br(o){return o instanceof Mn&&o.view instanceof Ir.MarkdownView&&o.document!==void 0&&o.document.text!==void 0}function os(o){return o instanceof Mn&&o.document!==void 0&&o.document.text!==void 0}function QM(o){return o instanceof Bc&&o.document!==void 0}var Bc=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new ts(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Kp({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.view.containerEl.addClass("relay-live-editor"),this.setConnectionDot(),this.plugin||(this.plugin=new Rc(this._parent,this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;this.view.containerEl.removeClass("relay-live-editor"),(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),(r=(t=this.view.leaf).rebuildView)==null||r.call(t),this._parent=null,this.view=null,this.canvas=null}},Mn=class extends Xe{constructor(e,t,r,n=!0,s=!0){super(),this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}get connectionManager(){return this._parent}mergeBanner(){return this._banner=new ts(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer(),this._plugin&&typeof this._plugin.syncViewToCRDT=="function"&&await this._plugin.syncViewToCRDT()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new ts(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Kp({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view instanceof Ir.MarkdownView&&this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){var e,t,r;return this.document.userLock=!0,this.view instanceof Ir.MarkdownView&&this.view.containerEl.addClass("relay-live-editor"),this.view instanceof Ir.MarkdownView||this._plugin||(this.warn("[LiveView] Creating TextFileViewPlugin in attach() for:",{path:this.document.path,viewType:(t=(e=this.view).getViewType)==null?void 0:t.call(e),viewFilePath:(r=this.view.file)==null?void 0:r.path}),this._plugin=new Nc(this)),this.setConnectionDot(),Br(this)&&!this._awarenessPlugin&&He().enablePresenceAvatars&&(this._awarenessPlugin=new Oc(this,this._parent.sharedFolders.manager.users)),new Promise(n=>this.document.whenReady().then(s=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),n(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t,r,n;this.tracking&&this.document.save(),this.view instanceof Ir.MarkdownView&&this.view.containerEl.removeClass("relay-live-editor"),(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),(r=this._awarenessPlugin)==null||r.destroy(),this._awarenessPlugin=void 0,(n=this._plugin)==null||n.destroy(),this._plugin=void 0,this.document.disconnect(),this.document.userLock=!1}destroy(){var e,t;this.release(),this.clearViewActions(),(t=(e=this.view.leaf).rebuildView)==null||t.call(e),this._parent=null,this.view=null,this.document=null,this._plugin=null}},Vc=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new Hc.Compartment,this.log=Fe("[LiveViews]","log"),this.warn=Fe("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,u)=>{let f=this.metadataListeners.get(l);f==null||f(c,u)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var f,d;((f=u.document)==null?void 0:f.sharedFolder)===l&&((d=u.offlineBanner)==null||d.call(u))})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),Nt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([To.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Sb(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return dm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),fm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(dm(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),fm(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return dm(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new Mn(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new $c(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),fm(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n){let i=n.getVirtualPath(r),a=n.syncStore.getMeta(i);if((a==null?void 0:a.type)==="canvas")if(this.loginManager.loggedIn)if(n.ready){let l=n.proxy.getCanvas(r),c=new Bc(this,t,l);e.push(c)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let l=new $c(this,t,()=>this.loginManager.openLoginPage());e.push(l)}else this.log(`Skipping canvas view connection for ${r} - sync store type is ${(a==null?void 0:a.type)||"unknown"}`)}}),e}findView(e){return this.views.filter(Br).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(QM).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(os).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=JM){let r=this.workspace.getActiveViewOfType(Ir.TextFileView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof Mn&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Fe(r,"debug"),s=(f,d)=>{n(f,d.map(m=>{var p;return{type:m.constructor.name,file:(p=m.document)==null?void 0:p.path,canConnect:m.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(f){return this.warn("[System 3][Relay][Live Views] error getting views",f),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(f=>{f.connect()}):this.sharedFolders.forEach(f=>{f.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&YM(l,this.views)){let f=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",f)}else{let f=await this.viewsReady(l);s("Ready Views",f);let d=await this.viewsAttachedWithConnectionPool(f);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let u=Ir.moment.utc();return n(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Fe(e,"warn"),r=Ir.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(To.init(()=>this)),db,Cb,mb,hb,yb]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},To=Hc.StateField.define({create(o){},update(o,e){return o}});var ci=require("obsidian");function ZM(o){Ce(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Ob(o){let e,t,r,n;return{c(){e=_("span"),t=B(o[3]),r=B("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),ae(e,"opacity","1")},m(s,i){x(s,e,i),y(e,t),y(e,r)},p(s,i){i&8&&Y(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&w(e)}}}function XM(o){let e,t,r;return t=new no({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=_("span"),U(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){x(n,e,s),D(t,e,null),r=!0},p:H,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}function eT(o){let e,t,r,n,s,i,a,l;return t=new no({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new rn({props:{class:"inline-icon"}}),{c(){var c;e=_("span"),U(t.$$.fragment),r=F(),n=_("span"),U(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){x(c,e,u),D(t,e,null),x(c,r,u),x(c,n,u),D(s,n,null),l=!0},p(c,u){var f;(!l||u&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||u&5&&a!==(a=`${((f=c[2])==null?void 0:f.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(b(t.$$.fragment,c),b(s.$$.fragment,c),l=!0)},o(c){S(t.$$.fragment,c),S(s.$$.fragment,c),l=!1},d(c){c&&(w(e),w(r),w(n)),R(t),R(s)}}}function tT(o){let e,t,r,n,s,i=o[5]&&Ob(o),a=[eT,XM],l=[];function c(u,f){return u[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=_("div"),i&&i.c(),t=F(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(u,f){x(u,e,f),i&&i.m(e,null),y(e,t),l[r].m(e,null),s=!0},p(u,[f]){u[5]?i?i.p(u,f):(i=Ob(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(u,f),r===d?l[r].p(u,f):(oe(),S(l[d],1,1,()=>{l[d]=null}),ne(),n=l[r],n?n.p(u,f):(n=l[r]=a[r](u),n.c()),b(n,1),n.m(e,null))},i(u){s||(b(n),s=!0)},o(u){S(n),s=!1},d(u){u&&w(e),i&&i.d(),l[r].d()}}}function rT(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{o.$$.dirty&24&&t(5,r=(l!=="completed"||a<100)&&a>0)},[n,s,i,a,l,r]}var pm=class extends G{constructor(e){super(),J(this,e,rT,tT,K,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},ZM)}},Nb=pm;function oT(o){Ce(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function nT(o){let e,t,r;return{c(){e=_("div"),t=_("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){x(n,e,s),y(e,t),y(t,r)},p(n,[s]){s&1&&Y(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:H,o:H,d(n){n&&w(e)}}}function sT(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var mm=class extends G{constructor(e){super(),J(this,e,sT,nT,K,{text:0,label:1},oT)}},$b=mm;function iT(o){Ce(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function aT(o){let e,t,r,n;return{c(){e=_("div"),t=_("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){x(s,e,i),y(e,t),y(t,r)},p(s,[i]){i&1&&Y(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:H,o:H,d(s){s&&w(e)}}}function lT(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var hm=class extends G{constructor(e){super(),J(this,e,lT,aT,K,{text:0,label:1,color:2},iT)}},Bb=hm;var gm=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},Tn=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},ym=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new gm(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},vm=class extends Tn{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new ym(t.selfEl,n):(r&&r.destroy(),null)}},bm=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Nb({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},_m=class extends Tn{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new bm(t.selfEl,n):(r&&r.destroy(),null)}},wm=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},xm=class extends Tn{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&wt.checkExtension(t.path)?n||new wm(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Sm=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new Bb({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},km=class extends Tn{visitFile(e,t,r,n){if(n&&!wt.checkExtension(e.path)&&!Tt.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected)try{let s=n.proxy.viewSyncFile(e.path);if(s&&fr(s))return r&&r.file===s?r:new Sm(t.selfEl,s)}catch(s){Fe("FilePillVisitor.visitFile","error")(s)}return r&&r.destroy(),null}},Im=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new $b({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Cm=class extends Tn{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new Im(t.selfEl):(r&&r.destroy(),null)}},Lm=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Mm=class extends Tn{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof wt)||!a?null:r||new Lm(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},qc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof ci.TFolder)this.walk(s,r);else if(s instanceof ci.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),u=l.visitFile(s,i,c,r);c&&!u?a.delete(i):u&&a.set(i,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},jc=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{rv([qo.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new vm),e.push(new _m),yn(qo.enableDocumentStatus,()=>{e.push(new Mm),e.push(new xm(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new km),e.push(new Cm),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new qc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof ci.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new qc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof ci.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var wx=require("obsidian");function Ae(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(f){i(f)}}function l(u){try{c(r.throw(u))}catch(f){i(f)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var so=require("obsidian");function cT(o){let e,t,r;return{c(){e=Kt("svg"),t=Kt("g"),r=Kt("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){x(n,e,s),y(e,t),y(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:H,o:H,d(n){n&&w(e)}}}function uT(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Tm=class extends G{constructor(e){super(),J(this,e,uT,cT,K,{size:0})}},zc=Tm;function fT(o){Ce(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Vb(o){let e,t,r,n,s,i,a,l,c,u,f,d,m;return a=new zc({props:{size:20}}),{c(){e=_("div"),t=_("div"),r=F(),n=_("div"),s=_("span"),i=_("a"),U(a.$$.fragment),l=F(),c=_("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),ae(s,"text-align","center"),ae(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(p,v){x(p,e,v),y(e,t),y(e,r),y(e,n),y(n,s),y(s,i),D(a,i,null),y(i,l),y(i,c),f=!0,d||(m=Jn(u=o[1].call(null,e)),d=!0)},i(p){f||(b(a.$$.fragment,p),f=!0)},o(p){S(a.$$.fragment,p),f=!1},d(p){p&&w(e),R(a),d=!1,m()}}}function dT(o){let e,t,r,n,s,i,a;r=new Ap({props:{size:"20px"}});let l=o[0]&&Vb(o);return{c(){e=_("div"),t=_("button"),U(r.$$.fragment),n=F(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,u){x(c,e,u),y(e,t),D(r,t,null),y(e,n),l&&l.m(e,null),s=!0,i||(a=V(t,"click",hc(o[2])),i=!0)},p(c,[u]){c[0]?l?u&1&&b(l,1):(l=Vb(c),l.c(),b(l,1),l.m(e,null)):l&&(oe(),S(l,1,1,()=>{l=null}),ne())},i(c){s||(b(r.$$.fragment,c),b(l),s=!0)},o(c){S(r.$$.fragment,c),S(l),s=!1},d(c){c&&w(e),R(r),l&&l.d(),i=!1,a()}}}function pT(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var Am=class extends G{constructor(e){super(),J(this,e,pT,dT,K,{},fT)}},Hb=Am;function mT(o){Ce(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function hT(o){let e,t;return{c(){e=Kt("svg"),t=Kt("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){x(r,e,n),y(e,t)},p:H,i:H,o:H,d(r){r&&w(e)}}}function gT(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var Fm=class extends G{constructor(e){super(),J(this,e,gT,hT,K,{size:2},mT)}},Wc=Fm;function yT(o){Ce(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function vT(o){let e,t,r,n,s,i;return e=new Wc({props:{size:140}}),{c(){U(e.$$.fragment),t=F(),r=_("p"),r.textContent="Real-time collaboration in Obsidian",n=F(),s=_("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){D(e,a,l),x(a,t,l),x(a,r,l),x(a,n,l),x(a,s,l),i=!0},p:H,i(a){i||(b(e.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),i=!1},d(a){a&&(w(t),w(r),w(n),w(s)),R(e,a)}}}var Em=class extends G{constructor(e){super(),J(this,e,null,vT,K,{},yT)}},qb=Em;var Kc=require("obsidian");function bT(o){Ce(o,"svelte-1rfjxfa",`.help-section.svelte-1rfjxfa{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1rfjxfa{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1rfjxfa{position:relative;max-width:640px;margin:0 auto}.why-signin.svelte-1rfjxfa:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-signin.svelte-1rfjxfa{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-signin.svelte-1rfjxfa:hover{color:var(--text-normal)}.help-content.svelte-1rfjxfa{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1rfjxfa{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1rfjxfa{opacity:1;visibility:visible}.popover.svelte-1rfjxfa:not(.visible){transition-delay:0s}.arrow.svelte-1rfjxfa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1rfjxfa{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function _T(o){let e,t,r,n;return{c(){e=_("div"),t=_("div"),r=F(),n=_("p"),n.textContent=`${zb}`,h(t,"class","arrow svelte-1rfjxfa"),h(e,"class","popover svelte-1rfjxfa"),Me(e,"visible",o[0])},m(s,i){x(s,e,i),y(e,t),y(e,r),y(e,n),o[9](e)},p(s,i){i&1&&Me(e,"visible",s[0])},d(s){s&&w(e),o[9](null)}}}function wT(o){let e,t=o[0]&&jb(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=jb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function jb(o){let e,t;return{c(){e=_("div"),t=_("p"),t.textContent=`${zb}`,h(e,"class","help-content svelte-1rfjxfa")},m(r,n){x(r,e,n),y(e,t)},p:H,d(r){r&&w(e)}}}function xT(o){let e,t,r,n,s,i,a,l,c,u,f,d;function m(g,I){return g[1]?wT:_T}let p=m(o,-1),v=p(o);return l=new zc({}),{c(){e=_("div"),t=_("div"),r=_("button"),r.textContent="Why do I need to sign in?",n=F(),v.c(),s=F(),i=_("div"),a=_("a"),U(l.$$.fragment),c=B(`
		Join the project on Discord`),h(r,"class","why-signin svelte-1rfjxfa"),Me(r,"mobile",o[1]),h(t,"class","help-container svelte-1rfjxfa"),h(e,"class","help-section svelte-1rfjxfa"),h(a,"href","https://discord.system3.md"),h(a,"class","discord-link svelte-1rfjxfa"),h(i,"class","footer svelte-1rfjxfa")},m(g,I){x(g,e,I),y(e,t),y(t,r),o[8](r),y(t,n),v.m(t,null),x(g,s,I),x(g,i,I),y(i,a),D(l,a,null),y(a,c),u=!0,f||(d=[V(r,"mouseenter",o[4]),V(r,"mouseleave",o[5]),V(r,"click",o[6])],f=!0)},p(g,[I]){(!u||I&2)&&Me(r,"mobile",g[1]),p===(p=m(g,I))&&v?v.p(g,I):(v.d(1),v=p(g),v&&(v.c(),v.m(t,null)))},i(g){u||(b(l.$$.fragment,g),u=!0)},o(g){S(l.$$.fragment,g),u=!1},d(g){g&&(w(e),w(s),w(i)),o[8](null),v.d(),R(l),f=!1,ve(d)}}}var zb="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. Using an identity provider helps to prevent spam accounts and ensures secure authentication.";function ST(o,e,t){var r;let n=!1,s=!1,i,a;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function u(){s&&t(0,n=!n)}function f(m){pt[m?"unshift":"push"](()=>{i=m,t(2,i)})}function d(m){pt[m?"unshift":"push"](()=>{a=m,t(3,a)})}return o.$$.update=()=>{o.$$.dirty&128&&t(1,s=t(7,r=Kc.Platform===null||Kc.Platform===void 0?void 0:Kc.Platform.isMobile)!==null&&r!==void 0?r:!1)},[n,s,i,a,l,c,u,r,f,d]}var Pm=class extends G{constructor(e){super(),J(this,e,ST,xT,K,{},bT)}},Wb=Pm;var PQ=require("obsidian");function kT(o){Ce(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function IT(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,u,f=(o[0].email||"")+"",d,m,p,v;t=new Ia({props:{size:"2.5em",user:o[0]}});let g=o[2].default,I=be(g,o,o[1],null);return{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("div"),s=_("div"),a=B(i),l=F(),c=_("br"),u=F(),d=B(f),m=F(),p=_("div"),I&&I.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),ae(n,"display","grid"),h(p,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(L,k){x(L,e,k),D(t,e,null),y(e,r),y(e,n),y(n,s),y(s,a),y(s,l),y(s,c),y(s,u),y(s,d),y(e,m),y(e,p),I&&I.m(p,null),v=!0},p(L,[k]){let C={};k&1&&(C.user=L[0]),t.$set(C),(!v||k&1)&&i!==(i=(L[0].name||"")+"")&&Y(a,i),(!v||k&1)&&f!==(f=(L[0].email||"")+"")&&Y(d,f),I&&I.p&&(!v||k&2)&&we(I,g,L,L[1],v?_e(g,L[1],k,null):xe(L[1]),null)},i(L){v||(b(t.$$.fragment,L),b(I,L),v=!0)},o(L){S(t.$$.fragment,L),S(I,L),v=!1},d(L){L&&w(e),R(t),I&&I.d(L)}}}function CT(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var Dm=class extends G{constructor(e){super(),J(this,e,CT,IT,K,{user:0},kT)}},ui=Dm;var Gc=require("obsidian");function LT(o){Ce(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function Kb(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),r=F(),n=_("p"),s=B(o[0]),h(t,"class","arrow svelte-1da9go9"),Me(t,"left",o[4]==="left"),Me(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Me(e,"left",o[4]==="left"),Me(e,"right",o[4]==="right")},m(i,a){x(i,e,a),y(e,t),y(e,r),y(e,n),y(n,s),o[9](e)},p(i,a){a&16&&Me(t,"left",i[4]==="left"),a&16&&Me(t,"right",i[4]==="right"),a&1&&Y(s,i[0]),a&16&&Me(e,"left",i[4]==="left"),a&16&&Me(e,"right",i[4]==="right")},d(i){i&&w(e),o[9](null)}}}function MT(o){let e,t,r,n,s,i,a;r=new ga({props:{size:16}});let l=o[1]&&Kb(o);return{c(){e=_("div"),t=_("button"),U(r.$$.fragment),n=F(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,u){x(c,e,u),y(e,t),D(r,t,null),o[8](t),y(e,n),l&&l.m(e,null),s=!0,i||(a=[V(t,"mouseenter",o[5]),V(t,"mouseleave",o[6]),V(t,"click",o[7])],i=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=Kb(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(b(r.$$.fragment,c),s=!0)},o(c){S(r.$$.fragment,c),s=!1},d(c){c&&w(e),R(r),o[8](null),l&&l.d(),i=!1,ve(a)}}}function TT(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function u(){t(1,n=!n)}function f(m){pt[m?"unshift":"push"](()=>{i=m,t(2,i)})}function d(m){pt[m?"unshift":"push"](()=>{a=m,t(3,a)})}return o.$$set=m=>{"helpText"in m&&t(0,r=m.helpText)},o.$$.update=()=>{if(o.$$.dirty&14&&n&&i&&a){let m=i.getBoundingClientRect(),p=a.getBoundingClientRect(),v=window.innerWidth;t(4,s=m.right+p.width>v-20?"left":"right")}},[r,n,i,a,s,l,c,u,f,d]}var Rm=class extends G{constructor(e){super(),J(this,e,TT,MT,K,{helpText:0},LT)}},Gb=Rm;function AT(o){Ce(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var FT=o=>({}),Jb=o=>({}),ET=o=>({}),Yb=o=>({}),PT=o=>({}),Qb=o=>({});function DT(o){let e;return{c(){e=B(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function Zb(o){let e,t,r,n,s=[UT,RT],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function RT(o){let e,t;return e=new Gb({props:{helpText:o[1]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function UT(o){let e,t,r,n,s;return t=new ga({props:{size:16}}),{c(){e=_("button"),U(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){x(i,e,a),D(t,e,null),r=!0,n||(s=V(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(b(t.$$.fragment,i),r=!0)},o(i){S(t.$$.fragment,i),r=!1},d(i){i&&w(e),R(t),n=!1,s()}}}function OT(o){let e,t,r=o[7].description,n=be(r,o,o[6],Jb);return{c(){e=_("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){x(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&we(n,r,s,s[6],t?_e(r,s[6],i,FT):xe(s[6]),Jb)},i(s){t||(b(n,s),t=!0)},o(s){S(n,s),t=!1},d(s){s&&w(e),n&&n.d(s)}}}function Xb(o){let e,t,r;return{c(){e=_("div"),t=_("p"),r=B(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Me(e,"expanded",o[2])},m(n,s){x(n,e,s),y(e,t),y(t,r)},p(n,s){s&2&&Y(r,n[1]),s&4&&Me(e,"expanded",n[2])},d(n){n&&w(e)}}}function NT(o){let e,t,r,n,s,i,a,l,c,u=o[7].name,f=be(u,o,o[6],Qb),d=f||DT(o),m=o[1]&&Zb(o),p=o[7].description,v=be(p,o,o[6],Yb),g=v||OT(o),I=o[1]&&o[2]&&o[3]&&Xb(o),L=o[7].default,k=be(L,o,o[6],null);return{c(){e=_("div"),t=_("div"),r=_("div"),d&&d.c(),n=F(),m&&m.c(),s=F(),g&&g.c(),i=F(),I&&I.c(),a=F(),l=_("div"),k&&k.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(C,T){x(C,e,T),y(e,t),y(t,r),d&&d.m(r,null),y(r,n),m&&m.m(r,null),y(t,s),g&&g.m(t,null),y(t,i),I&&I.m(t,null),y(e,a),y(e,l),k&&k.m(l,null),c=!0},p(C,[T]){f?f.p&&(!c||T&64)&&we(f,u,C,C[6],c?_e(u,C[6],T,PT):xe(C[6]),Qb):d&&d.p&&(!c||T&1)&&d.p(C,c?T:-1),C[1]?m?(m.p(C,T),T&2&&b(m,1)):(m=Zb(C),m.c(),b(m,1),m.m(r,null)):m&&(oe(),S(m,1,1,()=>{m=null}),ne()),v?v.p&&(!c||T&64)&&we(v,p,C,C[6],c?_e(p,C[6],T,ET):xe(C[6]),Yb):g&&g.p&&(!c||T&64)&&g.p(C,c?T:-1),C[1]&&C[2]&&C[3]?I?I.p(C,T):(I=Xb(C),I.c(),I.m(t,null)):I&&(I.d(1),I=null),k&&k.p&&(!c||T&64)&&we(k,L,C,C[6],c?_e(L,C[6],T,null):xe(C[6]),null)},i(C){c||(b(d,C),b(m),b(g,C),b(k,C),c=!0)},o(C){S(d,C),S(m),S(g,C),S(k,C),c=!1},d(C){C&&w(e),d&&d.d(C),m&&m.d(),g&&g.d(C),I&&I.d(),k&&k.d(C)}}}function $T(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=f=>{"name"in f&&t(0,i=f.name),"helpText"in f&&t(1,a=f.helpText),"$$scope"in f&&t(6,n=f.$$scope)},o.$$.update=()=>{o.$$.dirty&32&&t(3,c=t(5,s=Gc.Platform===null||Gc.Platform===void 0?void 0:Gc.Platform.isMobile)!==null&&s!==void 0?s:!1)},[i,a,l,c,u,s,n,r]}var Um=class extends G{constructor(e){super(),J(this,e,$T,NT,K,{name:0,helpText:1},AT)}},ze=Um;function e_(o){let e=o-1;return e*e*e+1}function ns(o){return--o*o*o*o*o+1}function ss(o,{delay:e=0,duration:t=400,easing:r=e_,axis:n="y"}={}){let s=getComputedStyle(o),i=+s.opacity,a=n==="y"?"height":"width",l=parseFloat(s[a]),c=n==="y"?["top","bottom"]:["left","right"],u=c.map(I=>`${I[0].toUpperCase()}${I.slice(1)}`),f=parseFloat(s[`padding${u[0]}`]),d=parseFloat(s[`padding${u[1]}`]),m=parseFloat(s[`margin${u[0]}`]),p=parseFloat(s[`margin${u[1]}`]),v=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:t,easing:r,css:I=>`overflow: hidden;opacity: ${Math.min(I*20,1)*i};${a}: ${I*l}px;padding-${c[0]}: ${I*f}px;padding-${c[1]}: ${I*d}px;margin-${c[0]}: ${I*m}px;margin-${c[1]}: ${I*p}px;border-${c[0]}-width: ${I*v}px;border-${c[1]}-width: ${I*g}px;`}}function BT(o){Ce(o,"svelte-18ny0l5",`.continue.svelte-18ny0l5{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-18ny0l5{color:var(--text-muted)}.link.svelte-18ny0l5:hover{color:var(--text-normal)}.not-working.svelte-18ny0l5{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-18ny0l5{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-18ny0l5:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-18ny0l5{height:auto;padding:0}.welcome.svelte-18ny0l5{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHdpZHRoPSIxOCIgICBoZWlnaHQ9IjE4IiAgIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzYiICAgc29kaXBvZGk6ZG9jbmFtZT0iZGlzY29yZC5zdmciICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICA8ZGVmcyAgICAgaWQ9ImRlZnMxMCIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJuYW1lZHZpZXc4IiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBpbmtzY2FwZTp6b29tPSIyNC4yNSIgICAgIGlua3NjYXBlOmN4PSI0LjM3MTEzNCIgICAgIGlua3NjYXBlOmN5PSIxNC40NTM2MDgiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDY0IiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTA5NiIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc2IiAvPiAgPGcgICAgIGlkPSJnNCIgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDg4NzYxMiwwLDAsMS4wNDc4NTU0LC0xMC40NTgyNzYsMzMuNDI2NTI1KSI+ICAgIDxwYXRoICAgICAgIGQ9Ik0gMjE2Ljg1NjM0LDE2LjU5NjYwMyBDIDIwMC4yODUsOC44NDMyODY3IDE4Mi41NjYxNCwzLjIwODQ5ODggMTY0LjA0MTU2LDAgYyAtMi4yNzUwNCw0LjExMzE4MTEgLTQuOTMyOTQsOS42NDU0OTkxIC02Ljc2NTQ2LDE0LjA0NjQzOCAtMTkuNjkyMTEsLTIuOTYxNDQ4IC0zOS4yMDMxMywtMi45NjE0NDggLTU4LjUzMzA4NCwwIEMgOTYuOTEwODQyLDkuNjQ1NDk5MSA5NC4xOTI1ODQsNC4xMTMxODExIDkxLjg5NzE4OSwwIDczLjM1MjYwNywzLjIwODQ5ODggNTUuNjEzMzk1LDguODYzOTkxMiAzOS4wNDIwNTgsMTYuNjM3NjYxIDUuNjE3NTIyOSw2Ny4xNDY1MTQgLTMuNDQzMzE5MSwxMTYuNDAwODEgMS4wODcxMTA3LDE2NC45NTU3MiAyMy4yNTYwMiwxODEuNTEwOTEgNDQuNzQwMzYzLDE5MS41Njc3IDY1Ljg2MjEzMywxOTguMTQ4NTggYyA1LjIxNTA4MiwtNy4xNzc0NSA5Ljg2NjIzLC0xNC44MDcyNSAxMy44NzMwODEsLTIyLjg0ODMyIC03LjYzMTE5NSwtMi44OTk2OSAtMTQuOTQwMjQyLC02LjQ3ODA2IC0yMS44NDY0MjcsLTEwLjYzMjMgMS44MzIxNzQsLTEuMzU3MzcgMy42MjQzNDMsLTIuNzc2NTEgNS4zNTU4MDMsLTQuMjM2NyA0Mi4xMjI4MiwxOS43MDE5MyA4Ny44OTAzNCwxOS43MDE5MyAxMjkuNTA5OTMsMCAxLjc1MTgyLDEuNDYwMTkgMy41NDM2MywyLjg3OTMzIDUuMzU1ODEsNC4yMzY3IC02LjkyNjU0LDQuMTc0NiAtMTQuMjU1NTksNy43NTI5NyAtMjEuODg2NzksMTAuNjUzIDQuMDA2ODUsOC4wMjAzNyA4LjYzOCwxNS42NzA4NyAxMy44NzMwOCwyMi44NDc5NyAyMS4xNDIxMywtNi41ODA4OCA0Mi42NDY0LC0xNi42MzczMSA2NC44MTUzMywtMzMuMjEzMjEgNS4zMTU4LC01Ni4yODc1MiAtOS4wODA4NiwtMTA1LjA4OTQ3NyAtMzguMDU1NjEsLTE0OC4zNTkxMTcgeiBNIDg1LjQ3Mzg3NSwxMzUuMDk0ODkgYyAtMTIuNjQ0ODQ3LDAgLTIzLjAxNDY1MywtMTEuODA0NzMgLTIzLjAxNDY1MywtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODM3MywtMjYuMjAwMzQxIDIzLjAxNDY1MywtMjYuMjAwMzQxIDEyLjg2NjYzMSwwIDIzLjIzNjA4NSwxMS44MDQzODQgMjMuMDE0NjU1LDI2LjIwMDM0MSAwLjAyLDE0LjM3NTI2IC0xMC4xNDgwMjQsMjYuMTc5OTkgLTIzLjAxNDY1NSwyNi4xNzk5OSB6IG0gODUuMDUxMzY1LDAgYyAtMTIuNjQ0ODUsMCAtMjMuMDE0NjYsLTExLjgwNDczIC0yMy4wMTQ2NiwtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODAzLC0yNi4yMDAzNDEgMjMuMDE0NjYsLTI2LjIwMDM0MSAxMi44NjYyOCwwIDIzLjIzNjA4LDExLjgwNDM4NCAyMy4wMTQ2NSwyNi4yMDAzNDEgMCwxNC4zNzUyNiAtMTAuMTQ4MzcsMjYuMTc5OTkgLTIzLjAxNDY1LDI2LjE3OTk5IHoiICAgICAgIGZpbGw9IiM1ODY1ZjIiICAgICAgIGZpbGwtcnVsZT0ibm9uemVybyIgICAgICAgaWQ9InBhdGgyIiAvPiAgPC9nPjwvc3ZnPg==);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.discord-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4gICAgPHRpdGxlPk1pY3Jvc29mdDwvdGl0bGU+ICAgIDxnPiAgICAgICAgPHBvbHlnb24gZmlsbD0iI0YxNTExQiIgcG9pbnRzPSIxMjEuNjY2MDk1IDEyMS42NjYwOTUgMCAxMjEuNjY2MDk1IDAgMCAxMjEuNjY2MDk1IDAiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiM4MENDMjgiIHBvaW50cz0iMjU2IDEyMS42NjYwOTUgMTM0LjMzNTM1NiAxMjEuNjY2MDk1IDEzNC4zMzUzNTYgMCAyNTYgMCIvPiAgICAgICAgPHBvbHlnb24gZmlsbD0iIzAwQURFRiIgcG9pbnRzPSIxMjEuNjYzMTk0IDI1Ni4wMDIxODggMCAyNTYuMDAyMTg4IDAgMTM0LjMzNjA5NSAxMjEuNjYzMTk0IDEzNC4zMzYwOTUiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiNGQkJDMDkiIHBvaW50cz0iMjU2IDI1Ni4wMDIxODggMTM0LjMzNTM1NiAyNTYuMDAyMTg4IDEzNC4zMzUzNTYgMTM0LjMzNjA5NSAyNTYgMTM0LjMzNjA5NSIvPiAgICA8L2c+PC9zdmc+);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.microsoft-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjE2LjE5NjU4NSIKICAgaGVpZ2h0PSIxNS42NTQ3NjgiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzQiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImdoLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3NiIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp6b29tPSI0OC41IgogICAgIGlua3NjYXBlOmN4PSI4IgogICAgIGlua3NjYXBlOmN5PSI4LjAxMDMwOTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIzNzY0IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjIxMTIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjgiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjQwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnNCIgLz4KICA8cGF0aAogICAgIGZpbGwtcnVsZT0iZXZlbm9kZCIKICAgICBjbGlwLXJ1bGU9ImV2ZW5vZGQiCiAgICAgZD0ibSA4LjAwMTc3OTksMC4wMDIzNzIxNiBhIDgsOCAwIDAgMCAtMi41MywxNS41ODk5OTk4NCBjIDAuNCwwLjA3IDAuNTUsLTAuMTcgMC41NSwtMC4zOCB2IC0xLjMzIGMgLTIuMjIsMC40OCAtMi42OSwtMS4wNyAtMi42OSwtMS4wNyAtMC4zNiwtMC45MiAtMC44OCwtMS4xNyAtMC44OCwtMS4xNyAtMC43MywtMC40OSAwLjA1LC0wLjQ4IDAuMDUsLTAuNDggMC44LDAuMDYgMS4yMywwLjgzIDEuMjMsMC44MyAwLjcyLDEuMjMgMS44OCwwLjg3IDIuMzMsMC42NiAwLjA3LC0wLjUyIDAuMjgsLTAuODcgMC41MSwtMS4wNyAtMS43OCwtMC4yIC0zLjY1LC0wLjg5IC0zLjY1LC0zLjk0OTk5OTggMCwtMC44NyAwLjMxLC0xLjU4IDAuODIsLTIuMTQgLTAuMDgsLTAuMiAtMC4zNiwtMS4wMSAwLjA4LC0yLjEgMCwwIDAuNjcsLTAuMjIgMi4yLDAuODIgYSA3LjY1LDcuNjUgMCAwIDEgNC4wMDAwMDAxLDAgYyAxLjUzLC0xLjA0IDIuMiwtMC44MiAyLjIsLTAuODIgMC40NCwxLjA5IDAuMTYsMS45IDAuMDgsMi4xIDAuNTEsMC41NiAwLjgyLDEuMjcgMC44MiwyLjE0IDAsMy4wNjk5OTk4IC0xLjg3LDMuNzQ5OTk5OCAtMy42NTAwMDAxLDMuOTQ5OTk5OCAwLjI5LDAuMjUgMC41NDAwMDAxLDAuNzQgMC41NDAwMDAxLDEuNDggdiAyLjIgYyAwLDAuMjEgMC4xNSwwLjQ1IDAuNTUsMC4zOCBBIDgsOCAwIDAgMCA4LjAwMTc3OTksMC4wMDIzNzIxNiBaIgogICAgIGZpbGw9IiMyNDI5MmYiCiAgICAgaWQ9InBhdGgyIiAvPgo8L3N2Zz4K)}.theme-dark .github-sign-in-button.svelte-18ny0l5{background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYuMTk2NTg1IiBoZWlnaHQ9IjE1LjY1NDc2OCIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJtIDguMDAxNzc5OSwwLjAwMjM3MjE2IGEgOCw4IDAgMCAwIC0yLjUzLDE1LjU4OTk5OTg0IGMgMC40LDAuMDcgMC41NSwtMC4xNyAwLjU1LC0wLjM4IHYgLTEuMzMgYyAtMi4yMiwwLjQ4IC0yLjY5LC0xLjA3IC0yLjY5LC0xLjA3IC0wLjM2LC0wLjkyIC0wLjg4LC0xLjE3IC0wLjg4LC0xLjE3IC0wLjczLC0wLjQ5IDAuMDUsLTAuNDggMC4wNSwtMC40OCAwLjgsMC4wNiAxLjIzLDAuODMgMS4yMywwLjgzIDAuNzIsMS4yMyAxLjg4LDAuODcgMi4zMywwLjY2IDAuMDcsLTAuNTIgMC4yOCwtMC44NyAwLjUxLC0xLjA3IC0xLjc4LC0wLjIgLTMuNjUsLTAuODkgLTMuNjUsLTMuOTQ5OTk5OCAwLC0wLjg3IDAuMzEsLTEuNTggMC44MiwtMi4xNCAtMC4wOCwtMC4yIC0wLjM2LC0xLjAxIDAuMDgsLTIuMSAwLDAgMC42NywtMC4yMiAyLjIsMC44MiBhIDcuNjUsNy42NSAwIDAgMSA0LjAwMDAwMDEsMCBjIDEuNTMsLTEuMDQgMi4yLC0wLjgyIDIuMiwtMC44MiAwLjQ0LDEuMDkgMC4xNiwxLjkgMC4wOCwyLjEgMC41MSwwLjU2IDAuODIsMS4yNyAwLjgyLDIuMTQgMCwzLjA2OTk5OTggLTEuODcsMy43NDk5OTk4IC0zLjY1MDAwMDEsMy45NDk5OTk4IDAuMjksMC4yNSAwLjU0MDAwMDEsMC43NCAwLjU0MDAwMDEsMS40OCB2IDIuMiBjIDAsMC4yMSAwLjE1LDAuNDUgMC41NSwwLjM4IEEgOCw4IDAgMCAwIDguMDAxNzc5OSwwLjAwMjM3MjE2IFoiIGZpbGw9IiNmZmZmZmYiIC8+Cjwvc3ZnPgo=)}.github-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-18ny0l5{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnoiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTggMTJoOE0xMiA4bDQgNC00IDQiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.oidc-sign-in-button.svelte-18ny0l5:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-18ny0l5:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.login-buttons.svelte-18ny0l5{display:flex;flex-direction:column;gap:0.85rem;padding:1rem;background:var(--background-modifier-border-hover);border-radius:0.5rem}.choose-another.svelte-18ny0l5{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}`)}function t_(o,e,t){let r=o.slice();return r[58]=e[t],r}function r_(o,e,t){let r=o.slice();return r[58]=e[t],r}function VT(o){let e,t,r,n,s,i,a,l,c,u;t=new qb({});let f=[jT,qT],d=[];function m(L,k){return L[5]?0:1}n=m(o,[-1,-1,-1]),s=d[n]=f[n](o);function p(L,k){if(L[11])return GT;if(L[7])return KT}let v=p(o,[-1,-1,-1]),g=v&&v(o),I=o[3].provider&&!o[7]&&i_(o);return c=new Wb({}),{c(){e=_("div"),U(t.$$.fragment),r=F(),s.c(),i=F(),g&&g.c(),a=F(),I&&I.c(),l=F(),U(c.$$.fragment),h(e,"class","welcome svelte-18ny0l5")},m(L,k){x(L,e,k),D(t,e,null),y(e,r),d[n].m(e,null),y(e,i),g&&g.m(e,null),x(L,a,k),I&&I.m(L,k),x(L,l,k),D(c,L,k),u=!0},p(L,k){let C=n;n=m(L,k),n===C?d[n].p(L,k):(oe(),S(d[C],1,1,()=>{d[C]=null}),ne(),s=d[n],s?s.p(L,k):(s=d[n]=f[n](L),s.c()),b(s,1),s.m(e,i)),v===(v=p(L,k))&&g?g.p(L,k):(g&&g.d(1),g=v&&v(L),g&&(g.c(),g.m(e,null))),L[3].provider&&!L[7]?I?I.p(L,k):(I=i_(L),I.c(),I.m(l.parentNode,l)):I&&(I.d(1),I=null)},i(L){u||(b(t.$$.fragment,L),b(s),b(c.$$.fragment,L),u=!0)},o(L){S(t.$$.fragment,L),S(s),S(c.$$.fragment,L),u=!1},d(L){L&&(w(e),w(a),w(l)),R(t),d[n].d(),g&&g.d(),I&&I.d(L),R(c,L)}}}function HT(o){let e,t,r,n,s,i,a;e=new ze({props:{$$slots:{name:[YT],default:[JT]},$$scope:{ctx:o}}}),r=new ze({props:{name:"Account"}}),s=new ui({props:{user:o[4].user,$$slots:{default:[QT]},$$scope:{ctx:o}}});let l=o[34].default,c=be(l,o,o[42],null);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment),i=F(),c&&c.c()},m(u,f){D(e,u,f),x(u,t,f),D(r,u,f),x(u,n,f),D(s,u,f),x(u,i,f),c&&c.m(u,f),a=!0},p(u,f){let d={};f[1]&2048&&(d.$$scope={dirty:f,ctx:u}),e.$set(d);let m={};f[0]&16&&(m.user=u[4].user),f[1]&2048&&(m.$$scope={dirty:f,ctx:u}),s.$set(m),c&&c.p&&(!a||f[1]&2048)&&we(c,l,u,u[42],a?_e(l,u[42],f,null):xe(u[42]),null)},i(u){a||(b(e.$$.fragment,u),b(r.$$.fragment,u),b(s.$$.fragment,u),b(c,u),a=!0)},o(u){S(e.$$.fragment,u),S(r.$$.fragment,u),S(s.$$.fragment,u),S(c,u),a=!1},d(u){u&&(w(t),w(n),w(i)),R(e,u),R(r,u),R(s,u),c&&c.d(u)}}}function qT(o){let e,t=[],r=new Map,n=he(o[6]),s=i=>i[58];for(let i=0;i<n.length;i+=1){let a=t_(o,n,i),l=s(a);r.set(l,t[i]=o_(l,a))}return{c(){e=_("div");for(let i=0;i<t.length;i+=1)t[i].c();h(e,"class","login-buttons svelte-18ny0l5")},m(i,a){x(i,e,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(i,a){a[0]&18114|a[1]&2&&(n=he(i[6]),t=mr(t,a,s,1,i,n,r,e,si,o_,null,t_))},i:H,o:H,d(i){i&&w(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function jT(o){let e,t=[],r=new Map,n,s=he(o[6]),i=a=>a[58];for(let a=0;a<s.length;a+=1){let l=r_(o,s,a),c=i(l);r.set(c,t[a]=n_(c,l))}return{c(){e=_("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","login-buttons svelte-18ny0l5")},m(a,l){x(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,l){l[0]&1073760192&&(s=he(a[6]),oe(),t=mr(t,l,i,1,a,s,r,e,tn,n_,null,r_),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)S(t[l]);n=!1},d(a){a&&w(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function zT(o){let e,t,r=(o[10][o[58]]||is(o[58]))+"",n,s,i,a,l;return{c(){e=_("button"),t=B("Sign in with "),n=B(r),h(e,"class",s=St(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"),e.disabled=i=!0},m(c,u){x(c,e,u),y(e,t),y(e,n),l=!0},p(c,u){o=c,(!l||u[0]&1088)&&r!==(r=(o[10][o[58]]||is(o[58]))+"")&&Y(n,r),(!l||u[0]&64&&s!==(s=St(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(e,"class",s)},i(c){l||(c&&Co(()=>{l&&(a||(a=Zn(e,ss,{duration:o[9]?300:0,easing:ns},!0)),a.run(1))}),l=!0)},o(c){c&&(a||(a=Zn(e,ss,{duration:o[9]?300:0,easing:ns},!1)),a.run(0)),l=!1},d(c){c&&w(e),c&&a&&a.end()}}}function WT(o){let e,t,r,n=(o[10][o[58]]||is(o[58]))+"",s,i,a,l,c,u,f,d,m;function p(){return o[37](o[58])}return{c(){e=_("a"),t=_("button"),r=B("Sign in with "),s=B(n),c=F(),h(t,"class",i=St(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"),t.disabled=a=o[7]||!o[1][o[58]],h(e,"href",u=o[1][o[58]].fullAuthUrl),h(e,"target","_blank")},m(v,g){x(v,e,g),y(e,t),y(t,r),y(t,s),y(e,c),f=!0,d||(m=V(t,"click",p),d=!0)},p(v,g){o=v,(!f||g[0]&1088)&&n!==(n=(o[10][o[58]]||is(o[58]))+"")&&Y(s,n),(!f||g[0]&64&&i!==(i=St(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(t,"class",i),(!f||g[0]&194&&a!==(a=o[7]||!o[1][o[58]]))&&(t.disabled=a),(!f||g[0]&66&&u!==(u=o[1][o[58]].fullAuthUrl))&&h(e,"href",u)},i(v){f||(v&&Co(()=>{f&&(l||(l=Zn(t,ss,{duration:o[9]?300:0,easing:ns},!0)),l.run(1))}),f=!0)},o(v){v&&(l||(l=Zn(t,ss,{duration:o[9]?300:0,easing:ns},!1)),l.run(0)),f=!1},d(v){v&&w(e),v&&l&&l.end(),d=!1,m()}}}function o_(o,e){let t,r,n,s,i=[WT,zT],a=[];function l(c,u){return c[1][c[58]]?0:1}return r=l(e,[-1,-1,-1]),n=a[r]=i[r](e),{key:o,first:null,c(){t=me(),n.c(),s=me(),this.first=t},m(c,u){x(c,t,u),a[r].m(c,u),x(c,s,u)},p(c,u){e=c;let f=r;r=l(e,u),r===f?a[r].p(e,u):(oe(),S(a[f],1,1,()=>{a[f]=null}),ne(),n=a[r],n?n.p(e,u):(n=a[r]=i[r](e),n.c()),b(n,1),n.m(s.parentNode,s))},d(c){c&&(w(t),w(s)),a[r].d(c)}}}function n_(o,e){let t,r,n=(e[10][e[58]]||is(e[58]))+"",s,i,a,l,c,u,f;function d(){return e[36](e[58])}return{key:o,first:null,c(){t=_("button"),r=B("Sign in with "),s=B(n),h(t,"class",i=St(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-18ny0l5"),t.disabled=a=e[7]||!e[8].contains(e[58]),this.first=t},m(m,p){x(m,t,p),y(t,r),y(t,s),c=!0,u||(f=V(t,"click",function(){Je((0,so.debounce)(d))&&(0,so.debounce)(d).apply(this,arguments)}),u=!0)},p(m,p){e=m,(!c||p[0]&1088)&&n!==(n=(e[10][e[58]]||is(e[58]))+"")&&Y(s,n),(!c||p[0]&64&&i!==(i=St(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-18ny0l5"))&&h(t,"class",i),(!c||p[0]&448&&a!==(a=e[7]||!e[8].contains(e[58])))&&(t.disabled=a)},i(m){c||(m&&Co(()=>{c&&(l||(l=Zn(t,ss,{duration:e[9]?300:0,easing:ns},!0)),l.run(1))}),c=!0)},o(m){m&&(l||(l=Zn(t,ss,{duration:e[9]?300:0,easing:ns},!1)),l.run(0)),c=!1},d(m){m&&w(t),m&&l&&l.end(),u=!1,f()}}}function KT(o){let e,t,r,n,s,i,a,l;return{c(){e=_("div"),t=_("p"),t.textContent="Continue in your browser...",r=F(),n=_("p"),s=B(`Not working?
					`),i=_("button"),i.textContent="(try again)",h(t,"class","continue svelte-18ny0l5"),h(i,"class","link link-button svelte-18ny0l5"),h(n,"class","not-working svelte-18ny0l5")},m(c,u){x(c,e,u),y(e,t),y(e,r),y(e,n),y(n,s),y(n,i),a||(l=V(i,"click",o[40]),a=!0)},p:H,d(c){c&&w(e),a=!1,l()}}}function GT(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[12]&&o[2]&&s_(o);return{c(){e=_("p"),t=B(o[11]),r=B("."),n=_("br"),s=F(),d&&d.c(),i=F(),a=_("p"),l=B(`Not working?
				`),c=_("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-18ny0l5"),h(a,"class","not-working svelte-18ny0l5")},m(m,p){x(m,e,p),y(e,t),y(e,r),y(e,n),y(e,s),d&&d.m(e,null),x(m,i,p),x(m,a,p),y(a,l),y(a,c),u||(f=V(c,"click",o[39]),u=!0)},p(m,p){p[0]&2048&&Y(t,m[11]),m[12]&&m[2]?d?d.p(m,p):(d=s_(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(m){m&&(w(e),w(i),w(a)),d&&d.d(),u=!1,f()}}}function s_(o){let e,t,r,n;return{c(){e=B("Already logged in? "),t=_("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-18ny0l5")},m(s,i){x(s,e,i),x(s,t,i),r||(n=V(t,"click",function(){Je((0,so.debounce)(o[38]))&&(0,so.debounce)(o[38]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(w(e),w(t)),r=!1,n()}}}function i_(o){let e,t,r,n;return{c(){e=_("p"),t=_("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-18ny0l5"),h(e,"class","choose-another svelte-18ny0l5")},m(s,i){x(s,e,i),y(e,t),r||(n=V(t,"click",(0,so.debounce)(o[41])),r=!0)},p:H,d(s){s&&w(e),r=!1,n()}}}function JT(o){let e,t;return e=new Hb({}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function YT(o){let e,t;return e=new Wc({props:{slot:"name"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:H,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function QT(o){let e,t,r;return{c(){e=_("button"),e.textContent="Logout"},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,so.debounce)(o[35])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function ZT(o){let e,t,r,n,s=[HT,VT],i=[];function a(l,c){return l[4].hasUser&&l[4].user?0:1}return e=a(o,[-1,-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}var XT="system3-relay-auth-providers-";function is(o){return o?o=="oidc"?"OIDC":o=="github"?"GitHub":o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function eA(o,e,t){let r,n,s,i,a,l,c,u,f=H,d=()=>(f(),f=At(M,ke=>t(4,u=ke)),M),m,p,v,g,I,L,k,C;o.$$.on_destroy.push(()=>f());let{$$slots:T={},$$scope:A}=e,{plugin:E}=e,P=Fe("LoggedIn.svelte","error"),M,$=Ie(!so.Platform.isIosApp);le(o,$,ke=>t(5,m=ke));let W=Ie(!1);le(o,W,ke=>t(7,v=ke)),d(M=E.loginManager);let O=Ie(!1);le(o,O,ke=>t(12,C=ke));let N=Ie(!1),te=Ie(!0);le(o,te,ke=>t(44,s=ke));let Z=Ie("");le(o,Z,ke=>t(2,r=ke));let Q=lr.getInstance();le(o,Q,ke=>t(45,i=ke));let ye={},z=Ie(!1);le(o,z,ke=>t(47,l=ke));let q=M.loginSettings;le(o,q,ke=>t(3,c=ke));let X=Ie([]);le(o,X,ke=>t(46,a=ke));let fe=Ie(!1);le(o,fe,ke=>t(9,I=ke));function j(){var ke;let Ge=((ke=M.pb)===null||ke===void 0?void 0:ke.baseUrl)||"default";return`${XT}${Ge}`}function ee(){let ke=["github","google","microsoft"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke}function re(){try{let ke=j(),Ge=localStorage.getItem(ke);if(Ge)return JSON.parse(Ge)}catch(ke){P("Failed to load cached providers:",ke)}return ee()}function de(ke){try{let Ge=j();localStorage.setItem(Ge,JSON.stringify(ke))}catch(Ge){P("Failed to save cached providers:",Ge)}}let Le=Ze([Z,Q],()=>{let ke=["github","google","microsoft","oidc"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke});le(o,Le,ke=>t(43,n=ke));let pe=Ze([Z,M.loginSettings,Q,z,X],()=>{if(c&&c.provider)return[c.provider];if(r!=="")return[r];if(l&&Object.keys(ye).length>0){let Ge=Object.keys(ye),tt=[];Ge.includes("google")&&tt.push("google"),Ge.includes("microsoft")&&tt.push("microsoft"),Ge.includes("discord")&&i.getFlag("enableDiscordLogin")&&tt.push("discord"),Ge.includes("github")&&tt.push("github"),Ge.forEach(an=>{an.startsWith("oidc")&&tt.push(an)});let Tr=JSON.stringify(tt.sort())!==JSON.stringify(a.sort());return fe.set(Tr),de(tt),tt}if(a.length>0&&!l)return a;let ke=["github","google","microsoft"];return i.getFlag("enableDiscordLogin")&&ke.push("discord"),ke});le(o,pe,ke=>t(6,p=ke));function Ee(){M.clearPreferredProvider(),Z.set(""),io()}let Oe=Ze([Z,E.loginSettings,Q,z],()=>r?[r]:Object.keys(ye));le(o,Oe,ke=>t(8,g=ke));let Te=Ze([z],()=>{var ke;let Ge={};for(let tt of Object.keys(ye)){let Tr=ye[tt];!((ke=Tr==null?void 0:Tr.info)===null||ke===void 0)&&ke.displayName?Ge[tt]=Tr.info.displayName:Ge[tt]=is(tt)}return Ge});le(o,Te,ke=>t(10,L=ke));let nt,ct=Ie("");le(o,ct,ke=>t(11,k=ke));function Dt(){return Ae(this,void 0,void 0,function*(){E.loginManager.logout(),N.set(!1),W.set(!1),Z.set(""),O.set(!1)})}function Ro(ke){return Ae(this,void 0,void 0,function*(){try{Z.set(ke),(yield E.loginManager.login(ke))&&N.set(!0)}catch(Ge){$.set(!1),N.set(!1);let tt=ye[ke];tt&&(window.open(tt.fullAuthUrl,"_blank"),qt(ke))}})}let Cr=Ie(E.loginManager.pb);function Lr(){Cr.set(E.loginManager.pb)}function io(){try{let ke=s?lt:fetch;M.initiateManualOAuth2CodeFlow(ke,n).then(Ge=>{t(1,ye=Ge),z.set(!0),M.updateWebviewIntercepts(Ge)}).catch(Ge=>{let tt=Ge.message;throw tt=tt,ct.set(tt),N.set(!1),Z.set(""),Ge})}catch(ke){ct.set(ke.message)}}it(()=>{N.set(!1);let ke=re();X.set(ke),io()});function qt(ke){return Ae(this,void 0,void 0,function*(){let Ge=ye[ke];if(Ge)return Z.set(ke),yield E.loginManager.poll(Ge).then(tt=>{N.set(!0),W.set(!1),ct.set("")}).catch(tt=>{O.set(!0),W.set(!1),N.set(!1),ct.set(tt.message)})})}function sn(ke){let Ge=ke.target;Ge.focus(),Ge.select(),navigator.clipboard.writeText(Ge.value).then(()=>new so.Notice("Invite link copied")).catch(tt=>{}),qt(r)}let cs=()=>{Dt()},vr=async ke=>{W.set(!0),await Ro(ke)},Mr=ke=>{W.set(!0),qt(ke)},ao=()=>{qt(r)},En=()=>{W.set(!1),$.set(!1),ct.set(""),Z.set(""),z.set(!1),io()},lo=()=>{W.set(!1),$.set(!1),ct.set(""),Z.set("")},Pn=()=>{Ee()};return o.$$set=ke=>{"plugin"in ke&&t(33,E=ke.plugin),"$$scope"in ke&&t(42,A=ke.$$scope)},[M,ye,r,c,u,m,p,v,g,I,L,k,C,$,W,O,te,Z,Q,z,q,X,fe,Le,pe,Ee,Oe,Te,ct,Dt,Ro,io,qt,E,T,cs,vr,Mr,ao,En,lo,Pn,A]}var Om=class extends G{constructor(e){super(),J(this,e,eA,ZT,K,{plugin:33},BT,[-1,-1,-1])}},a_=Om;function l_(o,e,t){let r=o.slice();return r[5]=e[t],r}var tA=o=>({}),c_=o=>({}),rA=o=>({}),u_=o=>({});function oA(o){let e;return{c(){e=B(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function nA(o){let e,t=he(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=f_(l_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s&2){t=he(n[1]);let i;for(i=0;i<t.length;i+=1){let a=l_(n,t,i);r[i]?r[i].p(a,s):(r[i]=f_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function f_(o){let e;return{c(){e=_("div"),e.textContent=`${o[5]} `},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function sA(o){let e,t=o[1].length>0&&nA(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&w(e),t&&t.d(r)}}}function iA(o){let e,t,r,n,s,i,a,l,c=o[4].name,u=be(c,o,o[3],u_),f=u||oA(o),d=o[4].description,m=be(d,o,o[3],c_),p=m||sA(o),v=o[4].default,g=be(v,o,o[3],null);return{c(){e=_("div"),t=_("div"),r=_("div"),f&&f.c(),n=F(),s=_("div"),p&&p.c(),i=F(),a=_("div"),g&&g.c(),h(r,"class","setting-item-name"),ae(r,"display","grid"),ae(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),ae(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(I,L){x(I,e,L),y(e,t),y(t,r),f&&f.m(r,null),y(t,n),y(t,s),p&&p.m(s,null),y(e,i),y(e,a),g&&g.m(a,null),l=!0},p(I,[L]){u?u.p&&(!l||L&8)&&we(u,c,I,I[3],l?_e(c,I[3],L,rA):xe(I[3]),u_):f&&f.p&&(!l||L&1)&&f.p(I,l?L:-1),m&&m.p&&(!l||L&8)&&we(m,d,I,I[3],l?_e(d,I[3],L,tA):xe(I[3]),c_),g&&g.p&&(!l||L&8)&&we(g,v,I,I[3],l?_e(v,I[3],L,null):xe(I[3]),null)},i(I){l||(b(f,I),b(p,I),b(g,I),l=!0)},o(I){S(f,I),S(p,I),S(g,I),l=!1},d(I){I&&w(e),f&&f.d(I),p&&p.d(I),g&&g.d(I)}}}function aA(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var Nm=class extends G{constructor(e){super(),J(this,e,aA,iA,K,{name:0,description:2})}},Ue=Nm;function lA(o){Ce(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var cA=o=>({}),d_=o=>({}),uA=o=>({}),p_=o=>({});function fA(o){let e;return{c(){e=B(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function m_(o){let e,t;return{c(){e=_("div"),t=B(o[1]),h(e,"class","setting-item-description")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n&2&&Y(t,r[1])},d(r){r&&w(e)}}}function dA(o){let e,t=o[1]&&m_(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=m_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function pA(o){let e,t,r,n,s,i,a,l=o[3].name,c=be(l,o,o[2],p_),u=c||fA(o),f=o[3].description,d=be(f,o,o[2],d_),m=d||dA(o),p=o[3].default,v=be(p,o,o[2],null);return{c(){e=_("div"),t=_("div"),r=_("div"),u&&u.c(),n=F(),m&&m.c(),s=F(),i=_("div"),v&&v.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,I){x(g,e,I),y(e,t),y(t,r),u&&u.m(r,null),y(t,n),m&&m.m(t,null),y(e,s),y(e,i),v&&v.m(i,null),a=!0},p(g,[I]){c?c.p&&(!a||I&4)&&we(c,l,g,g[2],a?_e(l,g[2],I,uA):xe(g[2]),p_):u&&u.p&&(!a||I&1)&&u.p(g,a?I:-1),d?d.p&&(!a||I&4)&&we(d,f,g,g[2],a?_e(f,g[2],I,cA):xe(g[2]),d_):m&&m.p&&(!a||I&2)&&m.p(g,a?I:-1),v&&v.p&&(!a||I&4)&&we(v,p,g,g[2],a?_e(p,g[2],I,null):xe(g[2]),null)},i(g){a||(b(u,g),b(m,g),b(v,g),a=!0)},o(g){S(u,g),S(m,g),S(v,g),a=!1},d(g){g&&w(e),u&&u.d(g),m&&m.d(g),v&&v.d(g)}}}function mA(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var $m=class extends G{constructor(e){super(),J(this,e,mA,pA,K,{name:0,description:1},lA)}},Ft=$m;function hA(o){Ce(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function gA(o){let e,t;return e=new $p({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:H,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function yA(o){let e,t,r,n,s=o[3].default,i=be(s,o,o[2],null),a=i||gA(o);return{c(){e=_("div"),a&&a.c(),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label",o[0]),h(e,"role","button"),h(e,"tabindex","0")},m(l,c){x(l,e,c),a&&a.m(e,null),t=!0,r||(n=[V(e,"click",o[1]),V(e,"keydown",o[1])],r=!0)},p(l,[c]){i&&i.p&&(!t||c&4)&&we(i,s,l,l[2],t?_e(s,l[2],c,null):xe(l[2]),null),(!t||c&1)&&h(e,"aria-label",l[0])},i(l){t||(b(a,l),t=!0)},o(l){S(a,l),t=!1},d(l){l&&w(e),a&&a.d(l),r=!1,ve(n)}}}function vA(o,e,t){let{$$slots:r={},$$scope:n}=e,s=et(),{label:i="Options"}=e;function a(l){(l instanceof MouseEvent||l instanceof KeyboardEvent&&(l.key==="Enter"||l.key===" "))&&s("settings")}return o.$$set=l=>{"label"in l&&t(0,i=l.label),"$$scope"in l&&t(2,n=l.$$scope)},[i,a,n,r]}var Bm=class extends G{constructor(e){super(),J(this,e,vA,yA,K,{label:0},hA)}},as=Bm;function bA(o){let e,t,r,n,s,i;t=new rn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=be(a,o,o[2],null);return{c(){e=_("span"),U(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ae(e,"display","flex"),ae(e,"align-items","center"),ae(e,"width","100%")},m(c,u){x(c,e,u),D(t,e,null),y(e,r),l&&l.m(e,null),n=!0,s||(i=[V(e,"keypress",o[0]),V(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&4)&&we(l,a,c,c[2],n?_e(a,c[2],u,null):xe(c[2]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){S(t.$$.fragment,c),S(l,c),n=!1},d(c){c&&w(e),R(t),l&&l.d(c),s=!1,ve(i)}}}function _A(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=et();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var Vm=class extends G{constructor(e){super(),J(this,e,_A,bA,K,{relay:1})}},Ca=Vm;function wA(o){let e,t,r,n,s,i;t=new Lo({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[4].default,l=be(a,o,o[3],null);return{c(){e=_("span"),U(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ae(e,"display","inline-flex"),ae(e,"align-items","center"),ae(e,"width","100%")},m(c,u){x(c,e,u),D(t,e,null),y(e,r),l&&l.m(e,null),n=!0,s||(i=[V(e,"keypress",o[0]),V(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&8)&&we(l,a,c,c[3],n?_e(a,c[3],u,null):xe(c[3]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){S(t.$$.fragment,c),S(l,c),n=!1},d(c){c&&w(e),R(t),l&&l.d(c),s=!1,ve(i)}}}function xA(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,{remoteFolder:i=void 0}=e,a=et();function l(){var c;s&&a("manageSharedFolder",{folder:s,relay:((c=s==null?void 0:s.remote)===null||c===void 0?void 0:c.relay)||(i==null?void 0:i.relay),remoteFolder:i})}return o.$$set=c=>{"folder"in c&&t(1,s=c.folder),"remoteFolder"in c&&t(2,i=c.remoteFolder),"$$scope"in c&&t(3,n=c.$$scope)},[l,s,i,n,r]}var Hm=class extends G{constructor(e){super(),J(this,e,xA,wA,K,{folder:1,remoteFolder:2})}},La=Hm;function SA(o){let e,t;return e=new Lo({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function kA(o){let e,t;return e=new Xn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function IA(o){let e,t,r,n,s,i,a,l=[kA,SA],c=[];function u(m,p){var v;return(v=m[0])!=null&&v.private?0:1}t=u(o,-1),r=c[t]=l[t](o);let f=o[3].default,d=be(f,o,o[2],null);return{c(){e=_("span"),r.c(),n=F(),d&&d.c(),h(e,"role","button"),h(e,"tabindex","0"),ae(e,"display","inline-flex"),ae(e,"align-items","center"),ae(e,"width","100%")},m(m,p){x(m,e,p),c[t].m(e,null),y(e,n),d&&d.m(e,null),s=!0,i||(a=[V(e,"keypress",o[1]),V(e,"click",o[1])],i=!0)},p(m,[p]){let v=t;t=u(m,p),t!==v&&(oe(),S(c[v],1,1,()=>{c[v]=null}),ne(),r=c[t],r||(r=c[t]=l[t](m),r.c()),b(r,1),r.m(e,n)),d&&d.p&&(!s||p&4)&&we(d,f,m,m[2],s?_e(f,m[2],p,null):xe(m[2]),null)},i(m){s||(b(r),b(d,m),s=!0)},o(m){S(r),S(d,m),s=!1},d(m){m&&w(e),c[t].d(),d&&d.d(m),i=!1,ve(a)}}}function CA(o,e,t){let{$$slots:r={},$$scope:n}=e,{remoteFolder:s}=e,i=et();function a(){i("manageRemoteFolder",{remoteFolder:s,relay:s==null?void 0:s.relay})}return o.$$set=l=>{"remoteFolder"in l&&t(0,s=l.remoteFolder),"$$scope"in l&&t(2,n=l.$$scope)},[s,a,n,r]}var qm=class extends G{constructor(e){super(),J(this,e,CA,IA,K,{remoteFolder:0})}},Jc=qm;function LA(o){let e,t;return e=new La({props:{folder:o[0],$$slots:{default:[TA]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[2]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.folder=r[0]),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function MA(o){let e,t;return e=new Jc({props:{remoteFolder:o[0].remote,$$slots:{default:[AA]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",o[1]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.remoteFolder=r[0].remote),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function TA(o){let e,t=o[0].name+"",r;return{c(){e=_("span"),r=B(t),ae(e,"overflow","hidden"),ae(e,"text-overflow","ellipsis"),ae(e,"white-space","nowrap")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Y(r,t)},d(n){n&&w(e)}}}function AA(o){let e,t=o[0].name+"",r;return{c(){e=_("span"),r=B(t),ae(e,"flex","1"),ae(e,"min-width","0"),ae(e,"text-overflow","ellipsis"),ae(e,"white-space","nowrap")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Y(r,t)},d(n){n&&w(e)}}}function h_(o){let e,t,r,n,s;return t=new op({props:{size:16,class:"svg-icon"}}),n=new Ca({props:{relay:o[0].remote.relay,$$slots:{default:[FA]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=_("span"),U(t.$$.fragment),r=F(),U(n.$$.fragment),ae(e,"width","16px"),ae(e,"flex-shrink","0"),ae(e,"display","flex"),ae(e,"justify-content","center")},m(i,a){x(i,e,a),D(t,e,null),x(i,r,a),D(n,i,a),s=!0},p(i,a){let l={};a&1&&(l.relay=i[0].remote.relay),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){S(t.$$.fragment,i),S(n.$$.fragment,i),s=!1},d(i){i&&(w(e),w(r)),R(t),R(n,i)}}}function FA(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=_("span"),r=B(t),ae(e,"flex","1"),ae(e,"min-width","0"),ae(e,"text-overflow","ellipsis"),ae(e,"white-space","nowrap")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&Y(r,t)},d(n){n&&w(e)}}}function EA(o){let e,t,r,n,s,i,a=[MA,LA],l=[];function c(f,d){return f[0].remote?0:1}r=c(o,-1),n=l[r]=a[r](o);let u=o[0].remote&&h_(o);return{c(){e=_("span"),t=_("span"),n.c(),s=F(),u&&u.c(),ae(t,"display","inline-flex"),ae(t,"align-items","center"),ae(t,"width","200px"),ae(t,"min-width","200px"),ae(t,"flex-shrink","0"),ae(e,"display","inline-flex"),ae(e,"align-items","center"),ae(e,"width","100%"),ae(e,"gap","8px")},m(f,d){x(f,e,d),y(e,t),l[r].m(t,null),y(e,s),u&&u.m(e,null),i=!0},p(f,[d]){let m=r;r=c(f,d),r===m?l[r].p(f,d):(oe(),S(l[m],1,1,()=>{l[m]=null}),ne(),n=l[r],n?n.p(f,d):(n=l[r]=a[r](f),n.c()),b(n,1),n.m(t,null)),f[0].remote?u?(u.p(f,d),d&1&&b(u,1)):(u=h_(f),u.c(),b(u,1),u.m(e,null)):u&&(oe(),S(u,1,1,()=>{u=null}),ne())},i(f){i||(b(n),b(u),i=!0)},o(f){S(n),S(u),i=!1},d(f){f&&w(e),l[r].d(),u&&u.d()}}}function PA(o,e,t){let{folder:r}=e;function n(a){pr.call(this,o,a)}function s(a){pr.call(this,o,a)}function i(a){pr.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder)},[r,n,s,i]}var jm=class extends G{constructor(e){super(),J(this,e,PA,EA,K,{folder:0})}},g_=jm;var rr=require("obsidian");var Fo=require("obsidian");function DA(o){Ce(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function RA(o){let e,t,r,n;return{c(){e=_("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=St(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){x(s,e,i),r||(n=[V(e,"click",function(){Je(o[4]?(0,Fo.debounce)(o[12]):null)&&(o[4]?(0,Fo.debounce)(o[12]):null).apply(this,arguments)}),V(e,"input",o[15]),V(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=St(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&w(e),r=!1,ve(n)}}}function UA(o){let e,t,r,n;return{c(){e=_("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=St(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){x(s,e,i),r||(n=[V(e,"click",function(){Je(o[4]?(0,Fo.debounce)(o[12]):null)&&(o[4]?(0,Fo.debounce)(o[12]):null).apply(this,arguments)}),V(e,"input",o[14]),V(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=St(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&w(e),r=!1,ve(n)}}}function OA(o){let e,t,r,n,s,i,a;function l(f,d){return f[6]?UA:RA}let c=l(o,-1),u=c(o);return{c(){e=_("div"),u.c(),t=F(),r=_("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(f,d){x(f,e,d),u.m(e,null),y(e,t),y(e,r),i||(a=[Jn(s=o[11].call(null,r)),V(r,"click",o[16]),V(r,"keypress",o[17])],i=!0)},p(f,[d]){c===(c=l(f,d))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(e,t))),d&64&&n!==(n=f[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:H,o:H,d(f){f&&w(e),u.d(),i=!1,ve(a)}}}function NA(o,e,t){let r,n,s=et(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:u=!0}=e,{successMessage:f="Copied to clipboard"}=e,{invalid:d=!1}=e,m=Ie(!1);le(o,m,E=>t(6,r=E));let p=Ie(!1);le(o,p,E=>t(19,n=E));let v;function g(E){E.key==="Enter"&&!a&&s("enter")}function I(E){v=E;let P=()=>{n?((0,Fo.setIcon)(E,"clipboard-check"),E.addClass("mod-success")):((0,Fo.setIcon)(E,r?"eye-off":"eye"),E.removeClass("mod-success"))},M=m.subscribe(()=>{P()}),$=p.subscribe(()=>{P()});return P(),{destroy(){M(),$()}}}function L(E){!u||!i||a||navigator.clipboard.writeText(i).then(()=>{new Fo.Notice(f),p.set(!0),setTimeout(()=>{p.set(!1)},800)}).catch(P=>{console.error("Failed to copy: ",P)})}let k=E=>{t(0,i=E.currentTarget.value),s("input",E)},C=E=>{t(0,i=E.currentTarget.value),s("input",E)},T=()=>m.update(E=>!E),A=()=>m.update(E=>!E);return o.$$set=E=>{"value"in E&&t(0,i=E.value),"disabled"in E&&t(1,a=E.disabled),"placeholder"in E&&t(2,l=E.placeholder),"readonly"in E&&t(3,c=E.readonly),"copyOnClick"in E&&t(4,u=E.copyOnClick),"successMessage"in E&&t(13,f=E.successMessage),"invalid"in E&&t(5,d=E.invalid)},[i,a,l,c,u,d,r,s,m,p,g,I,L,f,k,C,T,A]}var zm=class extends G{constructor(e){super(),J(this,e,NA,OA,K,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},DA)}},Yc=zm;var th=require("obsidian");var $_=require("obsidian");var Xm=require("obsidian");var __=require("obsidian");function $A(o){Ce(o,"svelte-1dpxzin",".folder-suggest-wrapper.svelte-1dpxzin{position:relative;width:100%}.folder-suggest-input.svelte-1dpxzin{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.suggestion-container.svelte-1dpxzin{position:fixed;z-index:9999;box-sizing:border-box;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:6px;box-shadow:var(--shadow-s);overflow-y:auto;overflow-x:hidden}.suggestion.svelte-1dpxzin{overflow-y:auto;overflow-x:hidden;max-height:100%}.suggestion-note.svelte-1dpxzin{color:var(--text-muted);font-style:italic}")}function y_(o,e,t){let r=o.slice();return r[31]=e[t],r[33]=t,r}function v_(o){let e,t,r,n,s,i,a=he(o[2]),l=[];for(let c=0;c<a.length;c+=1)l[c]=b_(y_(o,a,c));return{c(){e=_("div"),t=_("div");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","suggestion svelte-1dpxzin"),h(e,"class","suggestion-container svelte-1dpxzin")},m(c,u){x(c,e,u),y(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);s||(i=[Jn(r=qA.call(null,e)),Jn(n=o[6].call(null,e))],s=!0)},p(c,u){if(u[0]&2060){a=he(c[2]);let f;for(f=0;f<a.length;f+=1){let d=y_(c,a,f);l[f]?l[f].p(d,u):(l[f]=b_(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}},d(c){c&&w(e),je(l,c),s=!1,ve(i)}}}function BA(o){let e=o[31]+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&4&&e!==(e=r[31]+"")&&Y(t,e)},d(r){r&&w(t)}}}function VA(o){let e,t=o[31].substring(9)+"",r;return{c(){e=_("span"),e.textContent=`Create:
								`,r=B(t),h(e,"class","suggestion-note svelte-1dpxzin")},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s[0]&4&&t!==(t=n[31].substring(9)+"")&&Y(r,t)},d(n){n&&(w(e),w(r))}}}function b_(o){let e,t,r,n,s,i,a,l,c,u;function f(I,L){return L[0]&4&&(n=null),n==null&&(n=!!I[31].startsWith("[Create] ")),n?VA:BA}let d=f(o,[-1,-1]),m=d(o);function p(){return o[18](o[31])}function v(...I){return o[19](o[31],...I)}function g(){return o[20](o[33])}return{c(){e=_("div"),t=_("div"),r=_("div"),m.c(),s=F(),i=_("div"),i.innerHTML='<div class="suggestion-icon"></div>',a=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(i,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",l=o[33]===o[3]),h(e,"tabindex","-1"),Me(e,"is-selected",o[33]===o[3])},m(I,L){x(I,e,L),y(e,t),y(t,r),m.m(r,null),y(e,s),y(e,i),y(e,a),c||(u=[V(e,"mousedown",mc(o[15])),V(e,"click",p),V(e,"keydown",v),V(e,"mouseenter",g)],c=!0)},p(I,L){o=I,d===(d=f(o,L))&&m?m.p(o,L):(m.d(1),m=d(o),m&&(m.c(),m.m(r,null))),L[0]&8&&l!==(l=o[33]===o[3])&&h(e,"aria-selected",l),L[0]&8&&Me(e,"is-selected",o[33]===o[3])},d(I){I&&w(e),m.d(),c=!1,ve(u)}}}function HA(o){let e,t,r,n,s,i,a=o[4]&&o[2].length>0&&v_(o);return{c(){e=_("div"),t=_("input"),r=F(),a&&a.c(),n=me(),h(t,"type","text"),h(t,"placeholder",o[0]),h(t,"class","folder-suggest-input svelte-1dpxzin"),h(e,"class","folder-suggest-wrapper svelte-1dpxzin")},m(l,c){x(l,e,c),y(e,t),o[16](t),Ye(t,o[5]),x(l,r,c),a&&a.m(l,c),x(l,n,c),s||(i=[V(t,"input",o[17]),V(t,"input",o[8]),V(t,"keydown",o[7]),V(t,"focus",o[9]),V(t,"blur",o[10])],s=!0)},p(l,c){c[0]&1&&h(t,"placeholder",l[0]),c[0]&32&&t.value!==l[5]&&Ye(t,l[5]),l[4]&&l[2].length>0?a?a.p(l,c):(a=v_(l),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:H,o:H,d(l){l&&(w(e),w(r),w(n)),o[16](null),a&&a.d(l),s=!1,ve(i)}}}function qA(o){return document.body.appendChild(o),{destroy(){o.remove()}}}function jA(o,e,t){function r(z){return setTimeout(()=>{u=z,k()},0),{destroy(){}}}let{app:n}=e,{value:s=""}=e,{placeholder:i="Choose or create folder..."}=e,{blockedPaths:a=new Set}=e,l=et(),c,u,f=[],d=-1,m=!1,p=s||"/",v=!1;function g(z){let q=z.toLowerCase(),X=[],fe=re=>{if(a.has(re.path)&&re.path!=="/")return;let de=re.path.toLowerCase(),Le=(re.path.startsWith("/")?re.path:"/"+re.path).toLowerCase();if((!q||de.includes(q)||Le.includes(q))&&!a.has(re.path)){let Ee=re.path.startsWith("/")?re.path:"/"+re.path;X.push(Ee)}for(let Ee of re.children)Ee instanceof __.TFolder&&fe(Ee)},j=n.vault.getRoot();fe(j);let ee=z.trim();if(ee&&!X.includes(ee)){let re=ee.startsWith("/")?ee:"/"+ee;X.unshift(`[Create] ${re}`)}return X.slice(0,100)}function I(){return Ae(this,void 0,void 0,function*(){t(2,f=g(p)),f.length>0?(t(4,m=!0),t(3,d=0),yield Yd()):L()})}function L(){t(4,m=!1),t(2,f=[]),t(3,d=-1)}function k(){if(!c||!u)return;let z=c.getBoundingClientRect(),q=window.innerWidth,X=window.innerHeight;u.style.position="fixed",u.style.zIndex="9999";let fe=q<768,re=Math.min(f.length*40+8,fe?240:300);if(u.style.top="",u.style.bottom="",u.style.left="",u.style.right="",u.style.transform="",fe){let de=X-z.bottom,Le=z.top;u.style.left="10px",u.style.right="10px",u.style.width="auto",de<re+10&&Le>re+10?(u.style.bottom=`${X-z.top+2}px`,u.style.maxHeight=`${re}px`,u.style.height=""):(u.style.bottom=`${X-z.bottom-2}px`,u.style.maxHeight=`${Math.min(re,de-10)}px`,u.style.height="",u.style.transform="translateY(-100%)")}else{let de=Math.max(z.width,350),Le=Math.min(de,q-z.left-20);u.style.left=`${z.left}px`,u.style.top=`${z.bottom+2}px`,u.style.width=`${Le}px`,u.style.maxHeight=`${re}px`,u.style.height=""}}function C(z){let q=z;z.startsWith("[Create] ")&&(q=z.substring(9)),t(5,p=q),t(12,s=q),l("select",{value:q}),L(),c==null||c.blur()}function T(z){if(!m){(z.key==="Enter"&&p.trim()||z.key==="Tab"&&!z.shiftKey&&p.trim())&&(z.preventDefault(),C(p.trim()));return}switch(z.key){case"ArrowDown":z.preventDefault(),t(3,d=Math.min(d+1,f.length-1));break;case"ArrowUp":z.preventDefault(),t(3,d=Math.max(d-1,-1));break;case"Enter":z.preventDefault(),d>=0?C(f[d]):p.trim()&&C(p.trim());break;case"Escape":z.preventDefault(),L();break;case"Tab":z.shiftKey||(z.preventDefault(),d>=0?C(f[d]):f.length>0?C(f[0]):p.trim()&&C(p.trim()));break}}function A(){v=!0,t(12,s=p),l("input",{value:p}),I()}function E(){!v&&p==="/"&&(t(5,p=""),t(12,s="")),t(2,f=g(p||"")),f.length>0&&(t(4,m=!0),t(3,d=0))}function P(z){setTimeout(()=>{u!=null&&u.contains(document.activeElement)||L()},200)}function M(z){C(z)}function $(z){!(c!=null&&c.contains(z.target))&&!(u!=null&&u.contains(z.target))&&L()}function W(){m&&k()}it(()=>{document.addEventListener("click",$),window.addEventListener("resize",W)}),Zo(()=>{document.removeEventListener("click",$),window.removeEventListener("resize",W)});function O(z){pr.call(this,o,z)}function N(z){pt[z?"unshift":"push"](()=>{c=z,t(1,c)})}function te(){p=this.value,t(5,p)}let Z=z=>M(z),Q=(z,q)=>q.key==="Enter"&&M(z),ye=z=>t(3,d=z);return o.$$set=z=>{"app"in z&&t(13,n=z.app),"value"in z&&t(12,s=z.value),"placeholder"in z&&t(0,i=z.placeholder),"blockedPaths"in z&&t(14,a=z.blockedPaths)},[i,c,f,d,m,p,r,T,A,E,P,M,s,n,a,O,N,te,Z,Q,ye]}var Wm=class extends G{constructor(e){super(),J(this,e,jA,HA,K,{app:13,value:12,placeholder:0,blockedPaths:14},$A,[-1,-1])}},w_=Wm;function zA(o){let e,t,r,n;function s(a){o[8](a)}let i={app:o[0],placeholder:o[2],blockedPaths:o[4]()};return o[3]!==void 0&&(i.value=o[3]),t=new w_({props:i}),pt.push(()=>wc(t,"value",s)),t.$on("select",o[5]),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","folder-select-input")},m(a,l){x(a,e,l),D(t,e,null),n=!0},p(a,[l]){let c={};l&1&&(c.app=a[0]),l&4&&(c.placeholder=a[2]),!r&&l&8&&(r=!0,c.value=a[3],bc(()=>r=!1)),t.$set(c)},i(a){n||(b(t.$$.fragment,a),n=!0)},o(a){S(t.$$.fragment,a),n=!1},d(a){a&&w(e),R(t)}}}function WA(o,e,t){let r,n=H,s=()=>(n(),n=At(l,p=>t(7,r=p)),l);o.$$.on_destroy.push(()=>n());let{app:i}=e,{sharedFolders:a}=e,{selectedFolder:l}=e;s();let{placeholder:c="Choose or create folder..."}=e,u="";function f(){return new Set(a.filter(p=>!!p.relayId).map(p=>p.path))}function d(p){let v=p.detail.value;t(3,u=v),l.set(v)}function m(p){u=p,t(3,u),t(7,r)}return o.$$set=p=>{"app"in p&&t(0,i=p.app),"sharedFolders"in p&&t(6,a=p.sharedFolders),"selectedFolder"in p&&s(t(1,l=p.selectedFolder)),"placeholder"in p&&t(2,c=p.placeholder)},o.$$.update=()=>{o.$$.dirty&136&&r&&r!==u&&t(3,u=r)},[i,l,c,u,f,d,a,r,m]}var Km=class extends G{constructor(e){super(),J(this,e,WA,zA,K,{app:0,sharedFolders:6,selectedFolder:1,placeholder:2})}},x_=Km;function KA(o){Ce(o,"svelte-1cvg97u",".faint.svelte-1cvg97u.svelte-1cvg97u{color:var(--text-faint)}.breadcrumb-container.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:8px;overflow:hidden}.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;min-width:0}.breadcrumb-item.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;cursor:pointer;min-width:0}.breadcrumb-text.svelte-1cvg97u.svelte-1cvg97u{display:inline-block}@media(max-width: 768px){.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u:last-child{flex:1;min-width:0;overflow:hidden}.middle-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{display:none}.last-item.svelte-1cvg97u.svelte-1cvg97u{overflow:hidden}.last-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}")}function S_(o,e,t){let r=o.slice();return r[6]=e[t],r[8]=t,r}function GA(o){let e,t;return e=new dp({props:{size:16,class:"breadcrumb-separator"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function k_(o){let e,t,r;var n=o[2](o[6]);function s(i,a){return{props:{class:"svg-icon breadcrumb-icon"}}}return n&&(e=Qo(n,s(o))),{c(){e&&U(e.$$.fragment),t=me()},m(i,a){e&&D(e,i,a),x(i,t,a),r=!0},p(i,a){if(a&1&&n!==(n=i[2](i[6]))){if(e){oe();let l=e;S(l.$$.fragment,1,0,()=>{R(l,1)}),ne()}n?(e=Qo(n,s(i,a)),U(e.$$.fragment),b(e.$$.fragment,1),D(e,t.parentNode,t)):e=null}},i(i){r||(e&&b(e.$$.fragment,i),r=!0)},o(i){e&&S(e.$$.fragment,i),r=!1},d(i){i&&w(t),e&&R(e,i)}}}function JA(o){let e;function t(s,i){return s[6].remoteFolder.name?eF:XA}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function YA(o){let e=o[6].folder.name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].folder.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function QA(o){let e;function t(s,i){return s[6].relay.name?rF:tF}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function ZA(o){let e=o[6].text+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].text+"")&&Y(t,e)},d(r){r&&w(t)}}}function XA(o){let e;return{c(){e=_("span"),e.textContent="(Untitled folder)",h(e,"class","faint svelte-1cvg97u")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function eF(o){let e=o[6].remoteFolder.name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].remoteFolder.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function tF(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-1cvg97u")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function rF(o){let e=o[6].relay.name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].relay.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function I_(o){let e,t,r,n=o[2](o[6]),s,i,a,l,c,u,f,d=o[8]>0&&GA(o),m=n&&k_(o);function p(k,C){if(k[6].type==="text")return ZA;if(k[6].type==="relay")return QA;if(k[6].type==="folder")return YA;if(k[6].type==="remoteFolder")return JA}let v=p(o,-1),g=v&&v(o);function I(){return o[3](o[6])}function L(...k){return o[4](o[6],...k)}return{c(){d&&d.c(),e=F(),t=_("span"),r=_("span"),m&&m.c(),s=F(),i=_("span"),g&&g.c(),l=F(),h(i,"class","breadcrumb-text svelte-1cvg97u"),h(r,"tabindex","0"),h(r,"role","button"),h(r,"class",a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"),h(t,"class","breadcrumb-item-wrapper svelte-1cvg97u")},m(k,C){d&&d.m(k,C),x(k,e,C),x(k,t,C),y(t,r),m&&m.m(r,null),y(r,s),y(r,i),g&&g.m(i,null),y(t,l),c=!0,u||(f=[V(r,"click",I),V(r,"keypress",L)],u=!0)},p(k,C){o=k,C&1&&(n=o[2](o[6])),n?m?(m.p(o,C),C&1&&b(m,1)):(m=k_(o),m.c(),b(m,1),m.m(r,s)):m&&(oe(),S(m,1,1,()=>{m=null}),ne()),v===(v=p(o,C))&&g?g.p(o,C):(g&&g.d(1),g=v&&v(o),g&&(g.c(),g.m(i,null))),(!c||C&1&&a!==(a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"))&&h(r,"class",a)},i(k){c||(b(d),b(m),c=!0)},o(k){S(d),S(m),c=!1},d(k){k&&(w(e),w(t)),d&&d.d(k),m&&m.d(),g&&g.d(),u=!1,ve(f)}}}function Gm(o){let e,t,r=he(o[0]),n=[];for(let i=0;i<r.length;i+=1)n[i]=I_(S_(o,r,i));let s=i=>S(n[i],1,1,()=>{n[i]=null});return{c(){e=_(o[1]);for(let i=0;i<n.length;i+=1)n[i].c();Zv(o[1])(e,{class:"breadcrumb-container svelte-1cvg97u"})},m(i,a){x(i,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);t=!0},p(i,a){if(a&5){r=he(i[0]);let l;for(l=0;l<r.length;l+=1){let c=S_(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=I_(c),n[l].c(),b(n[l],1),n[l].m(e,null))}for(oe(),l=r.length;l<n.length;l+=1)s(l);ne()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)S(n[a]);t=!1},d(i){i&&w(e),je(n,i)}}}function oF(o){let e=o[1],t,r,n=o[1]&&Gm(o);return{c(){n&&n.c(),t=me()},m(s,i){n&&n.m(s,i),x(s,t,i)},p(s,[i]){s[1]?e?K(e,s[1])?(n.d(1),n=Gm(s),e=s[1],n.c(),n.m(t.parentNode,t)):n.p(s,i):(n=Gm(s),e=s[1],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=s[1])},i:H,o(s){S(n,s),r=!1},d(s){s&&w(t),n&&n.d(s)}}}function C_(o){o.onClick&&o.onClick()}function nF(o,e,t){let{items:r}=e,{element:n="h4"}=e,s=et();function i(c){var u;switch(c.type){case"home":return kp;case"relay":return rn;case"folder":return no;case"remoteFolder":return!((u=c.remoteFolder)===null||u===void 0)&&u.private?Xn:Lo;default:return null}}let a=c=>C_(c),l=(c,u)=>{(u.key==="Enter"||u.key===" ")&&C_(c)};return o.$$set=c=>{"items"in c&&t(0,r=c.items),"element"in c&&t(1,n=c.element)},[r,n,i,a,l]}var Jm=class extends G{constructor(e){super(),J(this,e,nF,oF,K,{items:0,element:1},KA)}},Eo=Jm;function sF(o){Ce(o,"svelte-1r8auw9",".folder-transformation.svelte-1r8auw9{display:flex;align-items:center;padding:8px 12px;background:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;gap:8px}.folder-transformation.readonly.svelte-1r8auw9{background:var(--background-secondary);border:1px solid var(--background-modifier-border)}.folder-state.svelte-1r8auw9{display:flex;align-items:center;gap:6px}.folder-name.svelte-1r8auw9{font-weight:500;color:var(--text-normal);white-space:nowrap}.clear-button.svelte-1r8auw9{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:2px;margin-left:auto}.clear-button.svelte-1r8auw9:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.folder-select-button.svelte-1r8auw9{width:100%;min-height:3em;text-align:left}")}function iF(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("button"),r=B(o[3]),h(t,"class","mod-cta folder-select-button svelte-1r8auw9"),h(e,"class","folder-suggest-container")},m(i,a){x(i,e,a),y(e,t),y(t,r),n||(s=V(t,"click",o[8]),n=!0)},p(i,a){a&8&&Y(r,i[3])},i:H,o:H,d(i){i&&w(e),n=!1,s()}}}function aF(o){let e,t,r,n,s,i=[uF,cF,lF],a=[];function l(u,f){return u[6]?0:u[2]?1:2}t=l(o,-1),r=a[t]=i[t](o);let c=!o[4]&&L_(o);return{c(){e=_("div"),r.c(),n=F(),c&&c.c(),h(e,"class","folder-transformation svelte-1r8auw9"),Me(e,"readonly",o[4])},m(u,f){x(u,e,f),a[t].m(e,null),y(e,n),c&&c.m(e,null),s=!0},p(u,f){let d=t;t=l(u,f),t===d?a[t].p(u,f):(oe(),S(a[d],1,1,()=>{a[d]=null}),ne(),r=a[t],r?r.p(u,f):(r=a[t]=i[t](u),r.c()),b(r,1),r.m(e,n)),u[4]?c&&(c.d(1),c=null):c?c.p(u,f):(c=L_(u),c.c(),c.m(e,null)),(!s||f&16)&&Me(e,"readonly",u[4])},i(u){s||(b(r),s=!0)},o(u){S(r),s=!1},d(u){u&&w(e),a[t].d(),c&&c.d()}}}function lF(o){let e,t,r,n,s,i;return t=new Lo({props:{class:"svg-icon folder-icon"}}),{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("span"),s=B(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9")},m(a,l){x(a,e,l),D(t,e,null),y(e,r),y(e,n),y(n,s),i=!0},p(a,l){(!i||l&32)&&Y(s,a[5])},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),i=!1},d(a){a&&w(e),R(t)}}}function cF(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v;t=new wp({props:{class:"svg-icon folder-icon"}}),a=new sp({props:{class:"svg-icon arrow-icon"}});let g=[dF,fF],I=[];function L(k,C){return k[1]?0:1}return u=L(o,-1),f=I[u]=g[u](o),{c(){e=_("div"),U(t.$$.fragment),r=F(),n=_("span"),s=B(o[5]),i=F(),U(a.$$.fragment),l=F(),c=_("div"),f.c(),d=F(),m=_("span"),p=B(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9"),h(m,"class","folder-name svelte-1r8auw9"),h(c,"class","folder-state svelte-1r8auw9")},m(k,C){x(k,e,C),D(t,e,null),y(e,r),y(e,n),y(n,s),x(k,i,C),D(a,k,C),x(k,l,C),x(k,c,C),I[u].m(c,null),y(c,d),y(c,m),y(m,p),v=!0},p(k,C){(!v||C&32)&&Y(s,k[5]);let T=u;u=L(k,C),u!==T&&(oe(),S(I[T],1,1,()=>{I[T]=null}),ne(),f=I[u],f||(f=I[u]=g[u](k),f.c()),b(f,1),f.m(c,d)),(!v||C&32)&&Y(p,k[5])},i(k){v||(b(t.$$.fragment,k),b(a.$$.fragment,k),b(f),v=!0)},o(k){S(t.$$.fragment,k),S(a.$$.fragment,k),S(f),v=!1},d(k){k&&(w(e),w(i),w(l),w(c)),R(t),R(a,k),I[u].d()}}}function uF(o){let e,t;return e=new Eo({props:{element:"div",items:[{type:"relay",relay:o[0].relay},{type:"remoteFolder",remoteFolder:o[0]}]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.items=[{type:"relay",relay:r[0].relay},{type:"remoteFolder",remoteFolder:r[0]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fF(o){let e,t;return e=new Lo({props:{class:"svg-icon folder-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dF(o){let e,t;return e=new Xn({props:{class:"svg-icon folder-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function L_(o){let e,t,r;return{c(){e=_("button"),e.textContent="\xD7",h(e,"class","clear-button svelte-1r8auw9")},m(n,s){x(n,e,s),t||(r=V(e,"click",o[7]),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function pF(o){let e,t,r,n,s=[aF,iF],i=[];function a(l,c){return l[0]?0:1}return t=a(o,-1),r=i[t]=s[t](o),{c(){e=_("div"),r.c(),h(e,"class","folder-selector")},m(l,c){x(l,e,c),i[t].m(e,null),n=!0},p(l,[c]){let u=t;t=a(l,c),t===u?i[t].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){S(r),n=!1},d(l){l&&w(e),i[t].d()}}}function mF(o,e,t){let r,n,s,{selectedItem:i=void 0}=e,{isPrivate:a=!1}=e,{showTransformation:l=!1}=e,{selectButtonText:c="Choose a folder..."}=e,{readonly:u=!1}=e,f=et();function d(){f("clear")}function m(){f("select")}return o.$$set=p=>{"selectedItem"in p&&t(0,i=p.selectedItem),"isPrivate"in p&&t(1,a=p.isPrivate),"showTransformation"in p&&t(2,l=p.showTransformation),"selectButtonText"in p&&t(3,c=p.selectButtonText),"readonly"in p&&t(4,u=p.readonly)},o.$$.update=()=>{o.$$.dirty&1&&t(6,r=i&&typeof i=="object"),o.$$.dirty&1&&t(9,n=typeof i=="string"?i:""),o.$$.dirty&512&&t(5,s=n?n.split("/").pop()||n:"")},[i,a,l,c,u,s,r,d,m,n]}var Ym=class extends G{constructor(e){super(),J(this,e,mF,pF,K,{selectedItem:0,isPrivate:1,showTransformation:2,selectButtonText:3,readonly:4},sF)}},Ma=Ym;var KX=require("obsidian");function M_(o,e,t){let r=o.slice();return r[23]=e[t],r}function T_(o,e,t){let r=o.slice();return r[26]=e[t],r[28]=t,r}var hF=o=>({item:o&8}),A_=o=>({item:o[26],index:o[28]}),gF=o=>({item:o&8}),F_=o=>({item:o[26],index:o[28]});function yF(o){let e=o[26]+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&8&&e!==(e=r[26]+"")&&Y(t,e)},d(r){r&&w(t)}}}function vF(o){let e;return{c(){e=_("div"),h(e,"class","suggestion-icon")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function E_(o){let e,t,r,n,s,i,a,l,c,u,f=o[13].suggestion,d=be(f,o,o[12],F_),m=d||yF(o),p=o[13]["suggestion-aux"],v=be(p,o,o[12],A_),g=v||vF(o);function I(){return o[17](o[26])}function L(...C){return o[18](o[26],...C)}function k(){return o[19](o[28])}return{c(){e=_("div"),t=_("div"),r=_("div"),m&&m.c(),n=F(),s=_("div"),g&&g.c(),i=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(s,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",a=o[28]===o[4]),h(e,"tabindex","-1"),Me(e,"is-selected",o[28]===o[4])},m(C,T){x(C,e,T),y(e,t),y(t,r),m&&m.m(r,null),y(e,n),y(e,s),g&&g.m(s,null),y(e,i),l=!0,c||(u=[V(e,"mousedown",mc(o[14])),V(e,"click",I),V(e,"keydown",L),V(e,"mouseenter",k)],c=!0)},p(C,T){o=C,d?d.p&&(!l||T&4104)&&we(d,f,o,o[12],l?_e(f,o[12],T,gF):xe(o[12]),F_):m&&m.p&&(!l||T&8)&&m.p(o,l?T:-1),v&&v.p&&(!l||T&4104)&&we(v,p,o,o[12],l?_e(p,o[12],T,hF):xe(o[12]),A_),(!l||T&16&&a!==(a=o[28]===o[4]))&&h(e,"aria-selected",a),(!l||T&16)&&Me(e,"is-selected",o[28]===o[4])},i(C){l||(b(m,C),b(g,C),l=!0)},o(C){S(m,C),S(g,C),l=!1},d(C){C&&w(e),m&&m.d(C),g&&g.d(C),c=!1,ve(u)}}}function P_(o){let e,t,r=o[23].command+"",n,s,i,a=o[23].purpose+"",l,c;return{c(){e=_("div"),t=_("span"),n=B(r),s=F(),i=_("span"),l=B(a),c=F(),h(t,"class","prompt-instruction-command"),h(e,"class","prompt-instruction")},m(u,f){x(u,e,f),y(e,t),y(t,n),y(e,s),y(e,i),y(i,l),y(e,c)},p(u,f){f&2&&r!==(r=u[23].command+"")&&Y(n,r),f&2&&a!==(a=u[23].purpose+"")&&Y(l,a)},d(u){u&&w(e)}}}function bF(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v=he(o[3]),g=[];for(let C=0;C<v.length;C+=1)g[C]=E_(T_(o,v,C));let I=C=>S(g[C],1,1,()=>{g[C]=null}),L=he(o[1]),k=[];for(let C=0;C<L.length;C+=1)k[C]=P_(M_(o,L,C));return{c(){e=_("div"),t=_("div"),r=_("input"),n=F(),s=_("div"),i=F(),a=_("div"),l=F(),c=_("div");for(let C=0;C<g.length;C+=1)g[C].c();u=F(),f=_("div");for(let C=0;C<k.length;C+=1)k[C].c();h(r,"type","text"),h(r,"placeholder",o[0]),h(r,"class","prompt-input"),h(r,"autocapitalize","off"),h(r,"spellcheck","false"),h(r,"enterkeyhint","done"),h(s,"class","prompt-input-cta"),h(a,"class","search-input-clear-button"),h(t,"class","prompt-input-container"),h(c,"class","prompt-results"),h(f,"class","prompt-instructions"),h(e,"class","prompt")},m(C,T){x(C,e,T),y(e,t),y(t,r),o[15](r),Ye(r,o[5]),y(t,n),y(t,s),y(t,i),y(t,a),y(e,l),y(e,c);for(let A=0;A<g.length;A+=1)g[A]&&g[A].m(c,null);y(e,u),y(e,f);for(let A=0;A<k.length;A+=1)k[A]&&k[A].m(f,null);d=!0,m||(p=[V(r,"input",o[16]),V(r,"input",o[7]),V(r,"keydown",o[6])],m=!0)},p(C,[T]){if((!d||T&1)&&h(r,"placeholder",C[0]),T&32&&r.value!==C[5]&&Ye(r,C[5]),T&4376){v=he(C[3]);let A;for(A=0;A<v.length;A+=1){let E=T_(C,v,A);g[A]?(g[A].p(E,T),b(g[A],1)):(g[A]=E_(E),g[A].c(),b(g[A],1),g[A].m(c,null))}for(oe(),A=v.length;A<g.length;A+=1)I(A);ne()}if(T&2){L=he(C[1]);let A;for(A=0;A<L.length;A+=1){let E=M_(C,L,A);k[A]?k[A].p(E,T):(k[A]=P_(E),k[A].c(),k[A].m(f,null))}for(;A<k.length;A+=1)k[A].d(1);k.length=L.length}},i(C){if(!d){for(let T=0;T<v.length;T+=1)b(g[T]);d=!0}},o(C){g=g.filter(Boolean);for(let T=0;T<g.length;T+=1)S(g[T]);d=!1},d(C){C&&w(e),o[15](null),je(g,C),je(k,C),m=!1,ve(p)}}}function _F(o,e,t){let{$$slots:r={},$$scope:n}=e,{placeholder:s="Search..."}=e,{autofocus:i=!1}=e,{onSelect:a=()=>{}}=e,{getSuggestions:l=()=>[]}=e,{instructions:c=[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Select"},{command:"Esc",purpose:"Cancel"}]}=e,u=et(),f,d=[],m=0,p="";function v(){t(3,d=l(p)),t(4,m=0)}function g($){a($),u("select",{item:$})}function I($){switch($.key){case"ArrowDown":$.preventDefault(),t(4,m=Math.min(m+1,d.length-1));break;case"ArrowUp":$.preventDefault(),t(4,m=Math.max(m-1,-1));break;case"Enter":$.preventDefault(),m>=0?g(d[m]):p.trim()&&d.length===0&&u("customInput",{value:p.trim()});break;case"Tab":$.shiftKey||($.preventDefault(),m>=0?g(d[m]):d.length>0&&g(d[0]));break}}function L(){v(),u("input",{value:p})}function k($){g($)}it(()=>{i&&f&&setTimeout(()=>{f.focus()},10),v()});function C($){pr.call(this,o,$)}function T($){pt[$?"unshift":"push"](()=>{f=$,t(2,f)})}function A(){p=this.value,t(5,p)}let E=$=>k($),P=($,W)=>W.key==="Enter"&&k($),M=$=>t(4,m=$);return o.$$set=$=>{"placeholder"in $&&t(0,s=$.placeholder),"autofocus"in $&&t(9,i=$.autofocus),"onSelect"in $&&t(10,a=$.onSelect),"getSuggestions"in $&&t(11,l=$.getSuggestions),"instructions"in $&&t(1,c=$.instructions),"$$scope"in $&&t(12,n=$.$$scope)},[s,c,f,d,m,p,I,L,k,i,a,l,n,r,C,T,A,E,P,M]}var Qm=class extends G{constructor(e){super(),J(this,e,_F,bF,K,{placeholder:0,autofocus:9,onSelect:10,getSuggestions:11,instructions:1})}},Qc=Qm;function wF(o){let e,t;return e=new Eo({props:{element:"div",items:[{type:"relay",relay:o[5].relay},{type:"remoteFolder",remoteFolder:o[5]}]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.items=[{type:"relay",relay:r[5].relay},{type:"remoteFolder",remoteFolder:r[5]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function xF(o){let e,t;return e=new Qc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[2],getSuggestions:o[3],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Add folder to vault"},{command:"Esc",purpose:"Cancel"}],$$slots:{suggestion:[wF,({item:r})=>({5:r}),({item:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&4&&(s.onSelect=r[2]),n&96&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function SF(o,e,t){let{availableFolders:r}=e,{placeholder:n="Search folders..."}=e,{autofocus:s=!1}=e,{onSelect:i=()=>{}}=e;function a(l){let c=l.toLowerCase();return r.filter(f=>{var d;let m=(f.name||"").toLowerCase(),p=(((d=f.relay)===null||d===void 0?void 0:d.name)||"").toLowerCase();return!!f.relay.name&&f.name&&(m.includes(c)||p.includes(c))}).sort((f,d)=>{let m=`${f.relay.name} / ${f.name}`,p=`${d.relay.name} / ${d.name}`;return m.localeCompare(p)}).slice(0,100)}return o.$$set=l=>{"availableFolders"in l&&t(4,r=l.availableFolders),"placeholder"in l&&t(0,n=l.placeholder),"autofocus"in l&&t(1,s=l.autofocus),"onSelect"in l&&t(2,i=l.onSelect)},[n,s,i,a,r]}var Zm=class extends G{constructor(e){super(),J(this,e,SF,xF,K,{availableFolders:4,placeholder:0,autofocus:1,onSelect:2})}},D_=Zm;var R_=require("obsidian"),fi=class extends R_.Modal{constructor(t,r,n,s){super(t);this.ComponentClass=r;this.componentProps=n;this.onSelect=s}onOpen(){let{modalEl:t}=this,r=t.closest(".modal-container");t.style.display="none";let n=r||t;this.component=new this.ComponentClass({target:n,props:{...this.componentProps,autofocus:!0,onSelect:s=>{this.onSelect(s),this.close()}}})}onClose(){var t;(t=this.component)==null||t.$destroy()}destroy(){this.onSelect=null,this.componentProps=null,this.ComponentClass=null}};var Zc=class extends fi{constructor(e,t,r){super(e,D_,{availableFolders:t,placeholder:"Search folders..."},r)}};function kF(o){Ce(o,"svelte-djtxkf","span.error.svelte-djtxkf{flex:auto;align-content:center}.section.svelte-djtxkf{margin-bottom:24px}")}function U_(o){let e,t,r,n,s;return t=new ze({props:{name:"Remote folder"}}),n=new Ma({props:{selectedItem:o[5],selectButtonText:"Choose a folder..."}}),n.$on("clear",o[12]),n.$on("select",o[13]),{c(){e=_("div"),U(t.$$.fragment),r=F(),U(n.$$.fragment),h(e,"class","section svelte-djtxkf")},m(i,a){x(i,e,a),D(t,e,null),y(e,r),D(n,e,null),s=!0},p(i,a){let l={};a&32&&(l.selectedItem=i[5]),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){S(t.$$.fragment,i),S(n.$$.fragment,i),s=!1},d(i){i&&w(e),R(t),R(n)}}}function IF(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),e.disabled=t=!o[5]},m(s,i){x(s,e,i),Ye(e,o[6]),r||(n=V(e,"input",o[14]),r=!0)},p(s,i){i&32&&t!==(t=!s[5])&&(e.disabled=t),i&64&&e.value!==s[6]&&Ye(e,s[6])},d(s){s&&w(e),r=!1,n()}}}function CF(o){let e,t;return e=new x_({props:{app:o[0],sharedFolders:o[3],selectedFolder:o[9]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&8&&(s.sharedFolders=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function O_(o){let e,t;return{c(){e=_("span"),t=B(o[7]),h(e,"class","mod-warning error svelte-djtxkf")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n&128&&Y(t,r[7])},d(r){r&&w(e)}}}function LF(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v,g,I=!o[1]&&o[2].length>0&&U_(o);s=new Ue({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[IF]},$$scope:{ctx:o}}}),a=new Ue({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[CF]},$$scope:{ctx:o}}});let L=o[7]&&O_(o);return{c(){e=_("div"),e.textContent="Add to vault",t=F(),r=_("div"),I&&I.c(),n=F(),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),c=_("div"),L&&L.c(),u=F(),f=_("button"),d=B("Confirm"),h(e,"class","modal-title"),h(f,"class","mod-cta"),f.disabled=m=!o[5]||!o[6].trim(),h(c,"class","modal-button-container"),h(r,"class","modal-content")},m(k,C){x(k,e,C),x(k,t,C),x(k,r,C),I&&I.m(r,null),y(r,n),D(s,r,null),y(r,i),D(a,r,null),y(r,l),y(r,c),L&&L.m(c,null),y(c,u),y(c,f),y(f,d),p=!0,v||(g=V(f,"click",function(){Je((0,Xm.debounce)(o[15]))&&(0,Xm.debounce)(o[15]).apply(this,arguments)}),v=!0)},p(k,[C]){o=k,!o[1]&&o[2].length>0?I?(I.p(o,C),C&6&&b(I,1)):(I=U_(o),I.c(),b(I,1),I.m(r,n)):I&&(oe(),S(I,1,1,()=>{I=null}),ne());let T={};C&65632&&(T.$$scope={dirty:C,ctx:o}),s.$set(T);let A={};C&65545&&(A.$$scope={dirty:C,ctx:o}),a.$set(A),o[7]?L?L.p(o,C):(L=O_(o),L.c(),L.m(c,u)):L&&(L.d(1),L=null),(!p||C&96&&m!==(m=!o[5]||!o[6].trim()))&&(f.disabled=m)},i(k){p||(b(I),b(s.$$.fragment,k),b(a.$$.fragment,k),p=!0)},o(k){S(I),S(s.$$.fragment,k),S(a.$$.fragment,k),p=!1},d(k){k&&(w(e),w(t),w(r)),I&&I.d(),R(s),R(a),L&&L.d(),v=!1,g()}}}function MF(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{availableFolders:i=[]}=e,{sharedFolders:a}=e,{onConfirm:l}=e,c=s,u=(s==null?void 0:s.name)||"",f=Ie("/");le(o,f,k=>t(8,r=k));let d="",m=s,p=new Zc(n,i,k=>{t(5,c=k)});it(()=>{!s&&i.length>0&&setTimeout(()=>{p.open()},100)}),Zo(()=>{p.close(),p.destroy()});let v=()=>{t(5,c=void 0),t(6,u="")},g=()=>{p.open()};function I(){u=this.value,t(6,u),t(5,c),t(11,m)}let L=async()=>{if(!c){t(7,d="Please select a remote folder");return}if(!u.trim()){t(7,d="Please enter a folder name");return}l(c,u,r||"/").catch(k=>{t(7,d=k.message)})};return o.$$set=k=>{"app"in k&&t(0,n=k.app),"remoteFolder"in k&&t(1,s=k.remoteFolder),"availableFolders"in k&&t(2,i=k.availableFolders),"sharedFolders"in k&&t(3,a=k.sharedFolders),"onConfirm"in k&&t(4,l=k.onConfirm)},o.$$.update=()=>{o.$$.dirty&2080&&c!==m&&(c&&t(6,u=c.name||""),t(11,m=c))},[n,s,i,a,l,c,u,d,r,f,p,m,v,g,I,L]}var eh=class extends G{constructor(e){super(),J(this,e,MF,LF,K,{app:0,remoteFolder:1,availableFolders:2,sharedFolders:3,onConfirm:4},kF)}},N_=eh;var An=class extends $_.Modal{constructor(t,r,n,s,i){super(t);this.sharedFolders=r;this.remoteFolder=n;this.availableFolders=s;this.onConfirm=i;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new N_({target:t,props:{remoteFolder:this.remoteFolder,availableFolders:this.availableFolders,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy(),this.onConfirm=null,this.sharedFolders=null,this.remoteFolder=void 0,this.availableFolders.length=0}};var Y_=require("obsidian"),Q_=Uo(Dn());function TF(o){Ce(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function B_(o,e,t){let r=o.slice();return r[33]=e[t],r[34]=e,r[35]=t,r}function V_(o,e,t){let r=o.slice();return r[36]=e[t],r}function H_(o,e,t){let r=o.slice();return r[39]=e[t],r}function AF(o){let e,t,r,n,s,i,a,l;function c(f){o[18](f)}let u={disabled:o[5],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[4]};return o[3]!==void 0&&(u.value=o[3]),e=new Yc({props:u}),pt.push(()=>wc(e,"value",c)),e.$on("input",o[14]),e.$on("enter",function(){Je((0,rr.debounce)(o[19]))&&(0,rr.debounce)(o[19]).apply(this,arguments)}),{c(){U(e.$$.fragment),r=F(),n=_("button"),s=B("Join"),h(n,"class","mod-cta"),n.disabled=o[5]},m(f,d){D(e,f,d),x(f,r,d),x(f,n,d),y(n,s),i=!0,a||(l=V(n,"click",function(){Je((0,rr.debounce)(o[20]))&&(0,rr.debounce)(o[20]).apply(this,arguments)}),a=!0)},p(f,d){o=f;let m={};d[0]&32&&(m.disabled=o[5]),d[0]&16&&(m.invalid=o[4]),!t&&d[0]&8&&(t=!0,m.value=o[3],bc(()=>t=!1)),e.$set(m),(!i||d[0]&32)&&(n.disabled=o[5])},i(f){i||(b(e.$$.fragment,f),i=!0)},o(f){S(e.$$.fragment,f),i=!1},d(f){f&&(w(r),w(n)),R(e,f),a=!1,l()}}}function FF(o){let e;return{c(){e=_("span"),e.textContent="Relay Servers",h(e,"slot","name"),ae(e,"display","inline-flex"),ae(e,"align-items","center")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function EF(o){let e,t;function r(){return o[22](o[39])}return e=new as({}),e.$on("settings",r),{c(){U(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function PF(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function DF(o){let e=o[39].name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[39].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function RF(o){let e;function t(s,i){return s[39].name?DF:PF}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function UF(o){let e,t;return e=new Ca({props:{slot:"name",relay:o[39],$$slots:{default:[RF]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[39]),n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function q_(o){let e,t;return e=new Ft({props:{$$slots:{name:[UF],default:[EF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function OF(o){let e,t,r;return{c(){e=_("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,rr.debounce)(o[23])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function j_(o){let e,t;return e=new Ue({props:{description:"No shared folders on this device. Share folders from a Relay Server's settings page to begin collaboration."}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function NF(o){let e,t;function r(){return o[28](o[36])}return e=new as({}),e.$on("settings",function(){Je((0,rr.debounce)(r))&&(0,rr.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function $F(o){let e,t;function r(){return o[27](o[36])}return e=new as({}),e.$on("settings",function(){Je((0,rr.debounce)(r))&&(0,rr.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function BF(o){let e,t,r,n,s=[$F,NF],i=[];function a(l,c){return l[36].remote?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function VF(o){let e,t;return e=new g_({props:{folder:o[36],slot:"name"}}),e.$on("manageSharedFolder",o[24]),e.$on("manageRemoteFolder",o[25]),e.$on("manageRelay",o[26]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.folder=r[36]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function z_(o){let e,t;return e=new Ft({props:{$$slots:{name:[VF],default:[BF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&192|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HF(o){let e,t,r;return{c(){e=_("button"),e.textContent="Add folder",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),ae(e,"max-width","8em")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,rr.debounce)(o[17])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function W_(o){let e,t,r,n,s,i;r=new ze({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}});let a=he(o[8].values()),l=[];for(let u=0;u<a.length;u+=1)l[u]=K_(B_(o,a,u));let c=u=>S(l[u],1,1,()=>{l[u]=null});return{c(){e=_("div"),t=F(),U(r.$$.fragment),n=F();for(let u=0;u<l.length;u+=1)l[u].c();s=me(),h(e,"class","spacer svelte-zmx7zz")},m(u,f){x(u,e,f),x(u,t,f),D(r,u,f),x(u,n,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);x(u,s,f),i=!0},p(u,f){if(f[0]&2305){a=he(u[8].values());let d;for(d=0;d<a.length;d+=1){let m=B_(u,a,d);l[d]?(l[d].p(m,f),b(l[d],1)):(l[d]=K_(m),l[d].c(),b(l[d],1),l[d].m(s.parentNode,s))}for(oe(),d=a.length;d<l.length;d+=1)c(d);ne()}},i(u){if(!i){b(r.$$.fragment,u);for(let f=0;f<a.length;f+=1)b(l[f]);i=!0}},o(u){S(r.$$.fragment,u),l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)S(l[f]);i=!1},d(u){u&&(w(e),w(t),w(n),w(s)),R(r,u),je(l,u)}}}function qF(o){let e,t,r,n;function s(){return o[30](o[33],o[34],o[35])}return{c(){e=_("button"),e.textContent="Manage",t=F()},m(i,a){x(i,e,a),x(i,t,a),r||(n=V(e,"click",function(){Je((0,rr.debounce)(s))&&(0,rr.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(w(e),w(t)),r=!1,n()}}}function jF(o){let e;return{c(){e=_("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function zF(o){let e=o[33].relay.name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&256&&e!==(e=r[33].relay.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function WF(o){let e;function t(s,i){return s[33].relay.name?zF:jF}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=F()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function KF(o){let e,t;return e=new Ca({props:{slot:"name",relay:o[33].relay,$$slots:{default:[WF]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[29]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.relay=r[33].relay),n[0]&256|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function K_(o){let e,t;return e=new Ft({props:{name:"",description:o[33].cancelAt?o[11](o[33].cancelAt):"",$$slots:{name:[KF],default:[qF]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.description=r[33].cancelAt?r[11](r[33].cancelAt):""),n[0]&257|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function GF(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[6].items().length===0,m,p,v,g,I=o[2].values().length>0,L,k;e=new ze({props:{name:"Join a Relay Server"}}),r=new Ue({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[AF]},$$scope:{ctx:o}}}),s=new ze({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[FF]},$$scope:{ctx:o}}});let C=he(o[7].values().filter(pd).sort(G_)),T=[];for(let O=0;O<C.length;O+=1)T[O]=q_(H_(o,C,O));let A=O=>S(T[O],1,1,()=>{T[O]=null});l=new Ue({props:{name:"",description:"",$$slots:{default:[OF]},$$scope:{ctx:o}}}),u=new ze({props:{name:"My vault",helpText:"The following Shared Folders have been added to your vault. You can see what Relay Server a Shared Folder is connected to below."}});let E=d&&j_(o),P=he(o[6].items().sort(J_)),M=[];for(let O=0;O<P.length;O+=1)M[O]=z_(V_(o,P,O));let $=O=>S(M[O],1,1,()=>{M[O]=null});v=new Ft({props:{name:"",$$slots:{default:[HF]},$$scope:{ctx:o}}});let W=I&&W_(o);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment),i=F();for(let O=0;O<T.length;O+=1)T[O].c();a=F(),U(l.$$.fragment),c=F(),U(u.$$.fragment),f=F(),E&&E.c(),m=F();for(let O=0;O<M.length;O+=1)M[O].c();p=F(),U(v.$$.fragment),g=F(),W&&W.c(),L=me()},m(O,N){D(e,O,N),x(O,t,N),D(r,O,N),x(O,n,N),D(s,O,N),x(O,i,N);for(let te=0;te<T.length;te+=1)T[te]&&T[te].m(O,N);x(O,a,N),D(l,O,N),x(O,c,N),D(u,O,N),x(O,f,N),E&&E.m(O,N),x(O,m,N);for(let te=0;te<M.length;te+=1)M[te]&&M[te].m(O,N);x(O,p,N),D(v,O,N),x(O,g,N),W&&W.m(O,N),x(O,L,N),k=!0},p(O,N){let te={};N[0]&56|N[1]&2048&&(te.$$scope={dirty:N,ctx:O}),r.$set(te);let Z={};if(N[1]&2048&&(Z.$$scope={dirty:N,ctx:O}),s.$set(Z),N[0]&1152){C=he(O[7].values().filter(pd).sort(G_));let z;for(z=0;z<C.length;z+=1){let q=H_(O,C,z);T[z]?(T[z].p(q,N),b(T[z],1)):(T[z]=q_(q),T[z].c(),b(T[z],1),T[z].m(a.parentNode,a))}for(oe(),z=C.length;z<T.length;z+=1)A(z);ne()}let Q={};if(N[1]&2048&&(Q.$$scope={dirty:N,ctx:O}),l.$set(Q),N[0]&64&&(d=O[6].items().length===0),d?E?N[0]&64&&b(E,1):(E=j_(O),E.c(),b(E,1),E.m(m.parentNode,m)):E&&(oe(),S(E,1,1,()=>{E=null}),ne()),N[0]&12480){P=he(O[6].items().sort(J_));let z;for(z=0;z<P.length;z+=1){let q=V_(O,P,z);M[z]?(M[z].p(q,N),b(M[z],1)):(M[z]=z_(q),M[z].c(),b(M[z],1),M[z].m(p.parentNode,p))}for(oe(),z=P.length;z<M.length;z+=1)$(z);ne()}let ye={};N[1]&2048&&(ye.$$scope={dirty:N,ctx:O}),v.$set(ye),N[0]&4&&(I=O[2].values().length>0),I?W?(W.p(O,N),N[0]&4&&b(W,1)):(W=W_(O),W.c(),b(W,1),W.m(L.parentNode,L)):W&&(oe(),S(W,1,1,()=>{W=null}),ne())},i(O){if(!k){b(e.$$.fragment,O),b(r.$$.fragment,O),b(s.$$.fragment,O);for(let N=0;N<C.length;N+=1)b(T[N]);b(l.$$.fragment,O),b(u.$$.fragment,O),b(E);for(let N=0;N<P.length;N+=1)b(M[N]);b(v.$$.fragment,O),b(W),k=!0}},o(O){S(e.$$.fragment,O),S(r.$$.fragment,O),S(s.$$.fragment,O),T=T.filter(Boolean);for(let N=0;N<T.length;N+=1)S(T[N]);S(l.$$.fragment,O),S(u.$$.fragment,O),S(E),M=M.filter(Boolean);for(let N=0;N<M.length;N+=1)S(M[N]);S(v.$$.fragment,O),S(W),k=!1},d(O){O&&(w(t),w(n),w(i),w(a),w(c),w(f),w(m),w(p),w(g),w(L)),R(e,O),R(r,O),R(s,O),je(T,O),R(l,O),R(u,O),E&&E.d(O),je(M,O),R(v,O),W&&W.d(O)}}}function G_(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function J_(o,e){return o.remote&&!e.remote?-1:e.remote&&!o.remote||o.name>e.name?1:-1}function JF(o,e,t){let r,n,s=H,i=()=>(s(),s=At(f,re=>t(7,n=re)),f),a,l=H,c=()=>(l(),l=At(d,re=>t(8,a=re)),d);o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>l());let{plugin:u}=e,{relays:f}=e;i();let{subscriptions:d}=e;c();let m=u.sharedFolders;le(o,m,re=>t(6,r=re));let p="",v=!1,g=!1,I=et();function L(re){re&&I("manageRelay",{relay:re})}function k(re){if(!re)return"Active";let de=th.moment.utc(),Le=th.moment.utc(re),pe=Le.diff(de,"days");return pe<=0?"Subscription has ended":pe===1?"Active for 1 more day":pe>31?`Ends on ${Le.format("YYYY-MM-DD")}`:`Active for ${pe} more days`}function C(re,de){re&&I("manageSharedFolder",{folder:re,relay:de})}function T(re){re&&I("manageRemoteFolder",{remoteFolder:re})}function A(){t(4,v=!1)}function E(re){return Ae(this,void 0,void 0,function*(){try{t(5,g=!0);let de=yield u.relayManager.acceptInvitation(re).catch(Le=>{throw Le.status===429&&new rr.Notice("Slow down"),Le});t(5,g=!1),I("joinRelay",{relay:de})}catch(de){t(4,v=!0),t(5,g=!1)}})}function P(){I("createRelay")}function M(re,de,Le){return Ae(this,void 0,void 0,function*(){let pe=(0,Y_.normalizePath)((0,Q_.join)(Le,de));u.app.vault.getFolderByPath(pe)===null&&(yield u.app.vault.createFolder(pe));let Ee=u.sharedFolders.new(pe,re.guid,re.relay.guid);return Ee.remote=re,Ee})}function $(){let re=[];n.values().forEach(Le=>{Le.folders&&Le.folders.values().forEach(pe=>{r.items().some(Oe=>{var Te;return((Te=Oe.remote)===null||Te===void 0?void 0:Te.id)===pe.id})||re.push(pe)})}),new An(u.app,u.sharedFolders,void 0,re,M).open()}function W(re){p=re,t(3,p)}let O=()=>E(p),N=()=>E(p);function te(re){pr.call(this,o,re)}let Z=re=>{L(re)},Q=()=>P();function ye(re){pr.call(this,o,re)}function z(re){pr.call(this,o,re)}function q(re){pr.call(this,o,re)}let X=re=>{T(re.remote)},fe=re=>{let de=n.values().find(Le=>{var pe;return((pe=re.remote)==null?void 0:pe.relay.guid)===Le.guid});C(re,de)};function j(re){pr.call(this,o,re)}let ee=async(re,de,Le)=>{if(!re.token){let Oe=await u.relayManager.getSubscriptionToken(re);ei(d,de[Le].token=Oe,a)}let pe=re.id,Ee=re.token;window.open(u.buildApiUrl(`/subscriptions/${pe}/manage?token=${Ee}`),"_blank")};return o.$$set=re=>{"plugin"in re&&t(0,u=re.plugin),"relays"in re&&i(t(1,f=re.relays)),"subscriptions"in re&&c(t(2,d=re.subscriptions))},[u,f,d,p,v,g,r,n,a,m,L,k,C,T,A,E,P,$,W,O,N,te,Z,Q,ye,z,q,X,fe,j,ee]}var rh=class extends G{constructor(e){super(),J(this,e,JF,GF,K,{plugin:0,relays:1,subscriptions:2},TF,[-1,-1])}},Po=rh;var kt=require("obsidian");var Dw=Uo(Dn());function YF(o){Ce(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function QF(o){let e,t,r;return t=new Mp({props:{class:"svg-icon"}}),{c(){e=_("span"),U(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){x(n,e,s),D(t,e,null),r=!0},p:H,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}var oh=class extends G{constructor(e){super(),J(this,e,null,QF,K,{},YF)}},Xc=oh;function ZF(o){Ce(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function XF(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("div"),n=F(),s=_("div"),i=B(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),ae(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){x(a,e,l),y(e,t),x(a,n,l),x(a,s,l),y(s,i)},p(a,[l]){l&1&&ae(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&Y(i,a[1])},i:H,o:H,d(a){a&&(w(e),w(n),w(s))}}}function eE(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var nh=class extends G{constructor(e){super(),J(this,e,eE,XF,K,{diskUsagePercentage:0,text:1},ZF)}},Z_=nh;var lw=require("obsidian");var qee=require("obsidian");var X_=require("obsidian");function tE(o){Ce(o,"svelte-pb1sr8",".suggestion-create-prefix.svelte-pb1sr8{color:var(--text-muted);font-style:italic}.suggestion-action.svelte-pb1sr8{color:var(--text-muted);font-size:var(--font-smaller)}.suggestion-icon.svelte-pb1sr8{display:flex;align-items:center}.system3-svg-icon{color:var(--text-muted);opacity:0.6}")}function rE(o){let e=o[10].path+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1024&&e!==(e=r[10].path+"")&&Y(t,e)},d(r){r&&w(t)}}}function oE(o){let e,t=o[10].path+"",r;return{c(){e=_("span"),e.textContent="Create: ",r=B(t),h(e,"class","suggestion-create-prefix svelte-pb1sr8")},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s&1024&&t!==(t=n[10].path+"")&&Y(r,t)},d(n){n&&(w(e),w(r))}}}function nE(o){let e;function t(s,i){return s[10].isCreate?oE:rE}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function sE(o){let e;return{c(){e=_("div"),h(e,"class","suggestion-icon svelte-pb1sr8")},m(t,r){x(t,e,r)},i:H,o:H,d(t){t&&w(e)}}}function iE(o){let e,t,r;return t=new no({props:{class:"system3-svg-icon",size:16}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","suggestion-icon svelte-pb1sr8")},m(n,s){x(n,e,s),D(t,e,null),r=!0},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}function aE(o){let e;return{c(){e=_("span"),e.textContent="Enter to create",h(e,"class","suggestion-action svelte-pb1sr8")},m(t,r){x(t,e,r)},i:H,o:H,d(t){t&&w(e)}}}function lE(o){let e,t,r,n,s=[aE,iE,sE],i=[];function a(l,c){return l[10].isCreate?0:l[10].isShared&&!l[10].hasRelay?1:2}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e!==u&&(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t||(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function cE(o){let e,t;return e=new Qc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[3],getSuggestions:o[2],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}],$$slots:{"suggestion-aux":[lE,({item:r})=>({10:r}),({item:r})=>r?1024:0],suggestion:[nE,({item:r})=>({10:r}),({item:r})=>r?1024:0]},$$scope:{ctx:o}}}),e.$on("customInput",o[9]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&3072&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uE(o,e,t){let{app:r}=e,{placeholder:n="Choose or create folder..."}=e,{blockedPaths:s=new Set}=e,{sharedFolders:i}=e,{autofocus:a=!1}=e,{onSelect:l=()=>{}}=e;function c(m){let p=new Map;i&&i.forEach(T=>{p.set(T.path,!!T.relayId)});let v=m.toLowerCase(),g=[],I=new Set,L=T=>{if(!(s.has(T.path)&&T.path!=="/")){if((!v||T.path.toLowerCase().includes(v))&&!s.has(T.path)){let A=p.has(T.path),E=p.get(T.path)||!1;g.push({path:T.path,isCreate:!1,isShared:A,hasRelay:E}),I.add(T.path.toLowerCase())}for(let A of T.children)A instanceof X_.TFolder&&L(A)}},k=r.vault.getRoot();L(k);let C=m.trim();return C&&!I.has(C.toLowerCase())&&g.unshift({path:C,isCreate:!0,isShared:!1,hasRelay:!1}),g.sort((T,A)=>T.isCreate&&!A.isCreate?-1:!T.isCreate&&A.isCreate?1:T.isShared&&!T.hasRelay&&(!A.isShared||A.hasRelay)?-1:A.isShared&&!A.hasRelay&&(!T.isShared||T.hasRelay)?1:T.path.localeCompare(A.path)),g.slice(0,100)}function u(m){l(m.path)}function f(m){l(m)}let d=m=>f(m.detail.value);return o.$$set=m=>{"app"in m&&t(5,r=m.app),"placeholder"in m&&t(0,n=m.placeholder),"blockedPaths"in m&&t(6,s=m.blockedPaths),"sharedFolders"in m&&t(7,i=m.sharedFolders),"autofocus"in m&&t(1,a=m.autofocus),"onSelect"in m&&t(8,l=m.onSelect)},[n,a,c,u,f,r,s,i,l,d]}var sh=class extends G{constructor(e){super(),J(this,e,uE,cE,K,{app:5,placeholder:0,blockedPaths:6,sharedFolders:7,autofocus:1,onSelect:8},tE)}},ew=sh;var di=class extends fi{constructor(e,t="Choose or create folder...",r=new Set,n,s){super(e,ew,{app:e,placeholder:t,blockedPaths:r,sharedFolders:n},s)}};var tu=Ie({});function fE(o,e,t,r="error",n,s="client"){tu.update(i=>({...i,[o]:{message:e,details:t,type:r,visible:!0,autoDismiss:n!=null?n:5e3,source:s}}))}function tw(o){tu.update(e=>({...e,[o]:{...e[o],visible:!1}}))}function eu(o,e,t,r="error",n){fE(o,e,t,r,n,"server")}function Yt(o,e="An error occurred"){var r,n,s;let t=`server-error-${Date.now()}`;if(o.status===403){let i=((r=o.body)==null?void 0:r.message)||o.message||"Permission denied",a=(n=o.body)==null?void 0:n.details;eu(t,i,a,"error",7e3)}else if(o.status>=400&&o.status<500){let i=((s=o.body)==null?void 0:s.message)||o.message||e;eu(t,i,void 0,"error",5e3)}else o.status>=500?eu(t,"Server error occurred",o.message,"error",8e3):eu(t,e,o.message,"error",5e3)}function dE(o){Ce(o,"svelte-y144a4",".share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:500px;max-width:600px}@media(max-width: 768px){.share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:100vw;max-width:100vw;margin:0;border-radius:0;height:100vh;max-height:100vh}}.section.svelte-y144a4.svelte-y144a4{margin-bottom:24px}.search-container.svelte-y144a4.svelte-y144a4{margin-bottom:12px}.search-input.svelte-y144a4.svelte-y144a4{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-y144a4.svelte-y144a4{max-height:300px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary)}.user-item.svelte-y144a4.svelte-y144a4{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);gap:12px}.user-item.svelte-y144a4.svelte-y144a4:last-child{border-bottom:none}.user-item.svelte-y144a4.svelte-y144a4:hover:not(.is-current-user){background:var(--background-modifier-hover)}.user-item.is-current-user.svelte-y144a4.svelte-y144a4{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-y144a4.svelte-y144a4{margin:0;cursor:pointer}.user-avatar.svelte-y144a4.svelte-y144a4{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-y144a4 img.svelte-y144a4{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-y144a4.svelte-y144a4{flex:1;min-width:0}.user-name.svelte-y144a4.svelte-y144a4{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-y144a4.svelte-y144a4{font-size:0.8em;color:var(--text-muted);font-style:italic;margin-left:auto}.no-users.svelte-y144a4.svelte-y144a4{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-y144a4.svelte-y144a4{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.modal-button-container.users-step.svelte-y144a4.svelte-y144a4{justify-content:space-between}button.svelte-y144a4.svelte-y144a4:disabled{opacity:0.5;cursor:not-allowed}.checkbox-container.svelte-y144a4.svelte-y144a4{cursor:pointer}")}function rw(o,e,t){let r=o.slice();return r[38]=e[t],r}function pE(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v,g,I,L,k,C,T,A,E,P;s=new ze({props:{name:"Selected Folder"}}),a=new Ma({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],readonly:!0}}),u=new ze({props:{name:"Users"}});function M(O,N){return O[7].length===0?gE:hE}let $=M(o,[-1,-1]),W=$(o);return{c(){e=_("div"),e.textContent="Add Users to Folder",t=F(),r=_("div"),n=_("div"),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),c=_("div"),U(u.$$.fragment),f=F(),d=_("div"),m=_("input"),p=F(),v=_("div"),W.c(),g=F(),I=_("div"),L=_("button"),L.textContent="Back",k=F(),C=_("button"),C.textContent="Share",h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(m,"type","text"),h(m,"placeholder","Search users by name..."),h(m,"class","search-input svelte-y144a4"),h(d,"class","search-container svelte-y144a4"),h(v,"class","user-list svelte-y144a4"),h(c,"class","section svelte-y144a4"),h(L,"class","mod-muted svelte-y144a4"),h(C,"class","mod-cta svelte-y144a4"),C.disabled=T=!1,h(I,"class","modal-button-container users-step svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(O,N){x(O,e,N),x(O,t,N),x(O,r,N),y(r,n),D(s,n,null),y(n,i),D(a,n,null),y(r,l),y(r,c),D(u,c,null),y(c,f),y(c,d),y(d,m),Ye(m,o[6]),y(c,p),y(c,v),W.m(v,null),y(r,g),y(r,I),y(I,L),y(I,k),y(I,C),o[28](r),A=!0,E||(P=[V(m,"input",o[25]),V(L,"click",o[15]),V(C,"click",o[14])],E=!0)},p(O,N){let te={};N[0]&16&&(te.selectedItem=O[4]),N[0]&4&&(te.isPrivate=O[2]),a.$set(te),N[0]&64&&m.value!==O[6]&&Ye(m,O[6]),$===($=M(O,N))&&W?W.p(O,N):(W.d(1),W=$(O),W&&(W.c(),W.m(v,null)))},i(O){A||(b(s.$$.fragment,O),b(a.$$.fragment,O),b(u.$$.fragment,O),A=!0)},o(O){S(s.$$.fragment,O),S(a.$$.fragment,O),S(u.$$.fragment,O),A=!1},d(O){O&&(w(e),w(t),w(r)),R(s),R(a),R(u),W.d(),o[28](null),E=!1,ve(P)}}}function mE(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[2]?"Add Users":"Share",m,p,v,g,I;s=new ze({props:{name:"Folder"}}),a=new Ma({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],selectButtonText:"Choose or create folder..."}}),a.$on("clear",o[11]),a.$on("select",o[16]);let L=o[0].version>0&&sw(o);return{c(){e=_("div"),e.textContent="Share a folder",t=F(),r=_("div"),n=_("div"),U(s.$$.fragment),i=F(),U(a.$$.fragment),l=F(),L&&L.c(),c=F(),u=_("div"),f=_("button"),m=B(d),h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(f,"class","mod-cta svelte-y144a4"),f.disabled=p=!o[4]&&!o[3].trim(),h(u,"class","modal-button-container svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(k,C){x(k,e,C),x(k,t,C),x(k,r,C),y(r,n),D(s,n,null),y(n,i),D(a,n,null),y(r,l),L&&L.m(r,null),y(r,c),y(r,u),y(u,f),y(f,m),o[24](r),v=!0,g||(I=V(f,"click",o[12]),g=!0)},p(k,C){let T={};C[0]&16&&(T.selectedItem=k[4]),C[0]&4&&(T.isPrivate=k[2]),a.$set(T),k[0].version>0?L?(L.p(k,C),C[0]&1&&b(L,1)):(L=sw(k),L.c(),b(L,1),L.m(r,c)):L&&(oe(),S(L,1,1,()=>{L=null}),ne()),(!v||C[0]&4)&&d!==(d=k[2]?"Add Users":"Share")&&Y(m,d),(!v||C[0]&24&&p!==(p=!k[4]&&!k[3].trim()))&&(f.disabled=p)},i(k){v||(b(s.$$.fragment,k),b(a.$$.fragment,k),b(L),v=!0)},o(k){S(s.$$.fragment,k),S(a.$$.fragment,k),S(L),v=!1},d(k){k&&(w(e),w(t),w(r)),R(s),R(a),L&&L.d(),o[24](null),g=!1,I()}}}function hE(o){let e,t=he(o[7]),r=[];for(let n=0;n<t.length;n+=1)r[n]=nw(rw(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s[0]&8320){t=he(n[7]);let i;for(i=0;i<t.length;i+=1){let a=rw(n,t,i);r[i]?r[i].p(a,s):(r[i]=nw(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function gE(o){let e,t=o[6]?"No users found":"No users available",r;return{c(){e=_("div"),r=B(t),h(e,"class","no-users svelte-y144a4")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&64&&t!==(t=n[6]?"No users found":"No users available")&&Y(r,t)},d(n){n&&w(e)}}}function yE(o){let e=iw(o[38].user.name)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&128&&e!==(e=iw(r[38].user.name)+"")&&Y(t,e)},d(r){r&&w(t)}}}function vE(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[38].user.picture)||h(e,"src",t),h(e,"alt",r=o[38].user.name),h(e,"class","svelte-y144a4")},m(n,s){x(n,e,s)},p(n,s){s[0]&128&&!dr(e.src,t=n[38].user.picture)&&h(e,"src",t),s[0]&128&&r!==(r=n[38].user.name)&&h(e,"alt",r)},d(n){n&&w(e)}}}function ow(o){let e;return{c(){e=_("div"),e.textContent="Required (You)",h(e,"class","user-status svelte-y144a4")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function nw(o){let e,t,r,n,s,i,a,l,c,u=o[38].user.name+"",f,d,m,p,v;function g(A,E){return A[38].user.picture?vE:yE}let I=g(o,[-1,-1]),L=I(o),k=o[38].isCurrentUser&&ow(o);function C(){return o[26](o[38])}function T(...A){return o[27](o[38],...A)}return{c(){e=_("div"),t=_("input"),s=F(),i=_("div"),L.c(),a=F(),l=_("div"),c=_("div"),f=B(u),d=F(),k&&k.c(),m=F(),h(t,"type","checkbox"),t.checked=r=o[38].selected,t.disabled=n=o[38].isCurrentUser,h(t,"class","user-checkbox svelte-y144a4"),h(t,"tabindex","-1"),h(i,"class","user-avatar svelte-y144a4"),h(c,"class","user-name svelte-y144a4"),h(l,"class","user-info svelte-y144a4"),h(e,"class","user-item svelte-y144a4"),h(e,"role","button"),h(e,"tabindex","0"),Me(e,"is-current-user",o[38].isCurrentUser)},m(A,E){x(A,e,E),y(e,t),y(e,s),y(e,i),L.m(i,null),y(e,a),y(e,l),y(l,c),y(c,f),y(e,d),k&&k.m(e,null),y(e,m),p||(v=[V(e,"click",C),V(e,"keydown",T)],p=!0)},p(A,E){o=A,E[0]&128&&r!==(r=o[38].selected)&&(t.checked=r),E[0]&128&&n!==(n=o[38].isCurrentUser)&&(t.disabled=n),I===(I=g(o,E))&&L?L.p(o,E):(L.d(1),L=I(o),L&&(L.c(),L.m(i,null))),E[0]&128&&u!==(u=o[38].user.name+"")&&Y(f,u),o[38].isCurrentUser?k||(k=ow(o),k.c(),k.m(e,m)):k&&(k.d(1),k=null),E[0]&128&&Me(e,"is-current-user",o[38].isCurrentUser)},d(A){A&&w(e),L.d(),k&&k.d(),p=!1,ve(v)}}}function sw(o){let e,t;return e=new Ue({props:{name:"Private",description:"Only selected users can access this folder",$$slots:{default:[bE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&4|n[1]&1024&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function bE(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[2]),h(e,"tabindex","0"),h(e,"class","checkbox-container svelte-y144a4"),Me(e,"is-enabled",o[2])},m(a,l){x(a,e,l),y(e,t),t.checked=o[2],y(e,r),y(e,n),s||(i=[V(t,"change",o[21]),V(e,"keypress",o[22]),V(e,"click",o[23])],s=!0)},p(a,l){l[0]&4&&(t.checked=a[2]),l[0]&4&&h(e,"aria-checked",a[2]),l[0]&4&&Me(e,"is-enabled",a[2])},d(a){a&&w(e),s=!1,ve(i)}}}function _E(o){let e,t,r,n,s=[mE,pE],i=[];function a(l,c){return l[1]==="main"?0:l[1]==="users"?1:-1}return~(e=a(o,[-1,-1]))&&(t=i[e]=s[e](o)),{c(){t&&t.c(),r=me()},m(l,c){~e&&i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?~e&&i[e].p(l,c):(t&&(oe(),S(i[u],1,1,()=>{i[u]=null}),ne()),~e?(t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r)):t=null)},i(l){n||(b(t),n=!0)},o(l){S(t),n=!1},d(l){l&&w(r),~e&&i[e].d(l)}}}function iw(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function wE(o,e,t){let r,n,s;var i;let{app:a}=e,{relay:l}=e,{relayManager:c}=e,{sharedFolders:u}=e,{onConfirm:f}=e,d="main",m=!1,p="",v="",g=Ie(new Set(!((i=c.user)===null||i===void 0)&&i.id?[c.user.id]:[]));le(o,g,de=>t(30,r=de));let I=Ie("");le(o,I,de=>t(6,n=de));let L,k=()=>new Set(u.filter(de=>!!de.relayId).map(de=>de.path)).add("/"),C=Ze([c.relayRoles],([de])=>Array.from(de.values()).filter(Le=>Le.relayId===l.id).map(Le=>Le.user)),T=Ze([C,g],([de,Le])=>{var pe;let Ee=(pe=c.user)===null||pe===void 0?void 0:pe.id;return de.map(Oe=>{let Te=Ee===Oe.id,nt=Le.has(Oe.id)||Te;return{user:Oe,selected:nt,isCurrentUser:Te}})}),A=Ze([T,I],([de,Le])=>{if(!Le||Le.trim()==="")return de;let pe=Le.toLowerCase().trim();return de.filter(Ee=>Ee.user.name.toLowerCase().includes(pe))}),E=Ze([A],([de])=>de.sort((Le,pe)=>Le.user.name.localeCompare(pe.user.name)));le(o,E,de=>t(7,s=de));function P(){t(4,v=""),t(3,p="")}function M(){!v&&p.trim()&&t(4,v=p.trim()),m?t(1,d="users"):W()}function $(de){de.isCurrentUser||g.update(Le=>{let pe=new Set(Le);return pe.has(de.user.id)?pe.delete(de.user.id):pe.add(de.user.id),pe})}function W(){return Ae(this,void 0,void 0,function*(){var de;!v&&p.trim()&&t(4,v=p.trim());try{let Le=(de=c.user)===null||de===void 0?void 0:de.id,Ee=Array.from(r).filter(Oe=>Oe!==Le);yield f(v,v.split("/").pop()||"",m,Ee)}catch(Le){Yt(Le,"Failed to share folder.")}})}function O(){t(1,d="main")}function N(de){t(4,v=de),t(3,p=de)}function te(){new di(a,"Choose or create folder...",k(),u,N).open()}let Z=de=>{de.key==="Tab"&&Q(de)};it(()=>(document.addEventListener("keydown",Z),v||setTimeout(()=>{te()},100),()=>{document.removeEventListener("keydown",Z)}));function Q(de){if(!L)return;let Le=L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),pe=Le[0],Ee=Le[Le.length-1];de.shiftKey?document.activeElement===pe&&(de.preventDefault(),Ee.focus()):document.activeElement===Ee&&(de.preventDefault(),pe.focus())}function ye(){m=this.checked,t(2,m)}let z=()=>t(2,m=!m),q=()=>t(2,m=!m);function X(de){pt[de?"unshift":"push"](()=>{L=de,t(5,L)})}function fe(){n=this.value,I.set(n)}let j=de=>$(de),ee=(de,Le)=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),$(de))};function re(de){pt[de?"unshift":"push"](()=>{L=de,t(5,L)})}return o.$$set=de=>{"app"in de&&t(17,a=de.app),"relay"in de&&t(0,l=de.relay),"relayManager"in de&&t(18,c=de.relayManager),"sharedFolders"in de&&t(19,u=de.sharedFolders),"onConfirm"in de&&t(20,f=de.onConfirm)},[l,d,m,p,v,L,n,s,g,I,E,P,M,$,W,O,te,a,c,u,f,ye,z,q,X,fe,j,ee,re]}var ih=class extends G{constructor(e){super(),J(this,e,wE,_E,K,{app:17,relay:0,relayManager:18,sharedFolders:19,onConfirm:20},dE,[-1,-1])}},aw=ih;var ru=class extends lw.Modal{constructor(t,r,n,s,i){super(t);this.relay=r;this.sharedFolders=n;this.relayManager=s;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new aw({target:t,props:{app:this.app,relay:this.relay,relayManager:this.relayManager,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s,i)=>{let a=await this.onConfirm(r,n,s,i);return this.close(),a}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}destroy(){this.relay=null,this.sharedFolders=null,this.relayManager=null,this.onConfirm=null}};function xE(o){Ce(o,"svelte-1r0liue",`.el-pre.svelte-1r0liue.svelte-1r0liue{position:relative;margin:1em 0}pre.language-toml.svelte-1r0liue.svelte-1r0liue{position:relative;background:var(--code-background);border-radius:var(--radius-s);padding:1em;overflow-x:auto;font-family:var(--font-monospace);font-size:var(--code-size);line-height:var(--line-height-normal);tab-size:4;border:1px solid var(--background-modifier-border)}code.language-toml.svelte-1r0liue.svelte-1r0liue{display:block;color:var(--code-normal);white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:inherit;user-select:text;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text}.copy-code-button.svelte-1r0liue.svelte-1r0liue{position:absolute;top:0.5em;right:0.5em;padding:0.25em;background:transparent;border:none;color:var(--text-muted);cursor:pointer;opacity:0;transition:opacity 0.2s ease,
			color 0.2s ease;display:flex;align-items:center;justify-content:center;box-shadow:none !important}.el-pre.svelte-1r0liue:hover .copy-code-button.svelte-1r0liue{opacity:0.7;box-shadow:none}.copy-code-button.svelte-1r0liue.svelte-1r0liue:hover{opacity:1 !important;color:var(--text-normal);background:transparent;border:none;box-shadow:none !important}.copy-code-button.svelte-1r0liue.svelte-1r0liue:focus{outline:none;border:none;opacity:1;color:var(--interactive-accent);background:transparent;box-shadow:none !important}.svg-icon.svelte-1r0liue.svelte-1r0liue{width:16px;height:16px}.error-message.svelte-1r0liue.svelte-1r0liue{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function SE(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1r0liue")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function kE(o){let e,t,r,n,s,i,a,l,c;function u(m,p){return m[1]?CE:IE}let f=u(o,-1),d=f(o);return{c(){e=_("div"),t=_("pre"),r=_("code"),n=_("button"),s=B(`
				`),d.c(),i=B(`
			`),h(r,"class","language-toml is-loaded svelte-1r0liue"),h(n,"class","copy-code-button svelte-1r0liue"),h(n,"aria-label",a=o[1]?"Copied to clipboard":"Copy"),h(t,"class","language-toml svelte-1r0liue"),h(e,"class","el-pre svelte-1r0liue")},m(m,p){x(m,e,p),y(e,t),y(t,r),r.innerHTML=o[2],y(t,n),y(n,s),d.m(n,null),y(n,i),l||(c=[V(n,"click",o[3]),V(n,"keydown",o[4])],l=!0)},p(m,p){p&4&&(r.innerHTML=m[2]),f!==(f=u(m,p))&&(d.d(1),d=f(m),d&&(d.c(),d.m(n,i))),p&2&&a!==(a=m[1]?"Copied to clipboard":"Copy")&&h(n,"aria-label",a)},d(m){m&&w(e),d.d(),l=!1,ve(c)}}}function IE(o){let e,t,r;return{c(){e=Kt("svg"),t=Kt("rect"),r=Kt("path"),h(t,"x","8"),h(t,"y","8"),h(t,"width","14"),h(t,"height","14"),h(t,"rx","2"),h(t,"ry","2"),h(r,"d","M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-copy svelte-1r0liue")},m(n,s){x(n,e,s),y(e,t),y(e,r)},d(n){n&&w(e)}}}function CE(o){let e,t;return{c(){e=Kt("svg"),t=Kt("polyline"),h(t,"points","20,6 9,17 4,12"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","24"),h(e,"height","24"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","svg-icon lucide-check svelte-1r0liue")},m(r,n){x(r,e,n),y(e,t)},d(r){r&&w(e)}}}function LE(o){let e;function t(s,i){return s[0]?kE:SE}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},i:H,o:H,d(s){s&&w(e),n.d(s)}}}function ME(o){let e=[],t=o.split(`
`);for(let r of t){let n=r.trim();if(n==="")e.push({type:"newline",value:r});else if(n.startsWith("#"))e.push({type:"comment",value:r});else if(n.startsWith("[[")&&n.endsWith("]]")){let s=r.match(/^(\s*)\[\[([^\]]+)\]\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"array-table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.startsWith("[")&&n.endsWith("]")){let s=r.match(/^(\s*)\[([^\]]+)\](\s*)$/);if(s){let[,i,a,l]=s;e.push({type:"table",value:r,parts:{leading:i,tableName:a,trailing:l}})}else e.push({type:"text",value:r})}else if(n.includes("=")){let s=r.match(/^(\s*)([^=]+?)\s*=\s*(.+)(\s*)$/);if(s){let[,i,a,l,c]=s;e.push({type:"key-value",value:r,parts:{leading:i,key:a.trim(),value:l.trim(),trailing:c}})}else e.push({type:"text",value:r})}else e.push({type:"text",value:r})}return e}function TE(o){return o.map(e=>{switch(e.type){case"comment":return`<span class="token comment">${e.value}</span>`;case"newline":return e.value;case"table":let{leading:t,tableName:r,trailing:n}=e.parts;return`${t}<span class="token punctuation">[</span><span class="token table class-name">${r}</span><span class="token punctuation">]</span>${n}`;case"array-table":let{leading:s,tableName:i,trailing:a}=e.parts;return`${s}<span class="token punctuation">[[</span><span class="token table class-name">${i}</span><span class="token punctuation">]]</span>${a}`;case"key-value":let{leading:l,key:c,value:u,trailing:f}=e.parts,d=u;return u.startsWith('"')&&u.endsWith('"')?d=`<span class="token string">${u}</span>`:/^\d+$/.test(u)?d=`<span class="token number">${u}</span>`:d=`<span class="token string">${u}</span>`,`${l}<span class="token key property">${c}</span> <span class="token punctuation">=</span> ${d}${f}`;default:return e.value}}).join(`
`)}function AE(o,e,t){let r,{toml:n=""}=e,s=!1;function i(){return Ae(this,void 0,void 0,function*(){try{yield navigator.clipboard.writeText(n),t(1,s=!0),setTimeout(()=>{t(1,s=!1)},2e3)}catch(l){console.error("Failed to copy text: ",l)}})}function a(l){l.key==="Enter"&&(l.preventDefault(),i())}return o.$$set=l=>{"toml"in l&&t(0,n=l.toml)},o.$$.update=()=>{o.$$.dirty&1&&t(2,r=n?TE(ME(n)):"")},[n,s,r,i,a]}var ah=class extends G{constructor(e){super(),J(this,e,AE,LE,K,{toml:0},xE)}},ou=ah;var lh=require("obsidian");function FE(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function EE(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function Fn(o){let e=FE(o);return EE(e)}function PE(o){Ce(o,"svelte-sj7m72",`div.spacer.svelte-sj7m72{height:3em}.faint.svelte-sj7m72{color:var(--text-faint) !important}.edit-members-button.svelte-sj7m72{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-sj7m72:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-sj7m72:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-sj7m72{width:100%}.share-key-disabled-notice.svelte-sj7m72{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-sj7m72{text-align:right}input.system3-updating.svelte-sj7m72{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-sj7m72{border:1px solid var(--color-red) !important}.admin-toggle-btn.svelte-sj7m72{background:none;border:none;box-shadow:none;color:var(--text-muted);font-size:0.9em;cursor:pointer;padding:0;margin-left:8px}.admin-toggle-btn.svelte-sj7m72:hover{color:var(--text-normal);text-decoration:underline}.relay-auth-section.svelte-sj7m72{margin:16px 0}.loading-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-sj7m72{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}`)}function cw(o,e,t){let r=o.slice();return r[87]=e[t],r}function uw(o,e,t){let r=o.slice();return r[90]=e[t],r}function fw(o,e,t){let r=o.slice();return r[93]=e[t],r}function dw(o){let e,t;return e=new Ue({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[DE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&132225|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function DE(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=St((o[17]?"system3-updating":"")+(o[10]?"":" system3-input-invalid"))+" svelte-sj7m72")},m(s,i){x(s,e,i),Ye(e,o[0].name),o[68](e),r||(n=[V(e,"input",o[67]),V(e,"input",o[51])],r=!0)},p(s,i){i[0]&132096&&t!==(t=St((s[17]?"system3-updating":"")+(s[10]?"":" system3-input-invalid"))+" svelte-sj7m72")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&Ye(e,s[0].name)},d(s){s&&w(e),o[68](null),r=!1,ve(n)}}}function pw(o){let e,t=o[20]?"View as member":"View as admin",r,n,s;return{c(){e=_("button"),r=B(t),h(e,"class","admin-toggle-btn svelte-sj7m72")},m(i,a){x(i,e,a),y(e,r),n||(s=V(e,"click",o[69]),n=!0)},p(i,a){a[0]&1048576&&t!==(t=i[20]?"View as member":"View as admin")&&Y(r,t)},d(i){i&&w(e),n=!1,s()}}}function RE(o){let e,t=o[18]&&o[19]&&pw(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[18]&&r[19]?t?t.p(r,n):(t=pw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function mw(o){let e,t;return e=new Ft({props:{$$slots:{name:[$E],default:[OE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&6291458|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function hw(o){let e,t;function r(){return o[71](o[93])}return e=new as({props:{label:"Add to vault",$$slots:{default:[UE]},$$scope:{ctx:o}}}),e.$on("settings",function(){Je((0,kt.debounce)(r))&&(0,kt.debounce)(r).apply(this,arguments)}),{c(){U(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n;let i={};s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function UE(o){let e,t;return e=new va({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:H,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function OE(o){let e=!o[22].some(s)&&Io(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n;function s(...l){return o[65](o[93],...l)}let i=e&&hw(o);function a(){return o[72](o[93])}return r=new as({}),r.$on("settings",function(){Je((0,kt.debounce)(a))&&(0,kt.debounce)(a).apply(this,arguments)}),{c(){i&&i.c(),t=F(),U(r.$$.fragment)},m(l,c){i&&i.m(l,c),x(l,t,c),D(r,l,c),n=!0},p(l,c){o=l,c[0]&6291458&&(e=!o[22].some(s)&&Io(o[1].relayManager.userCan(["folder","read_content"],o[93]))),e?i?(i.p(o,c),c[0]&6291458&&b(i,1)):(i=hw(o),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(oe(),S(i,1,1,()=>{i=null}),ne())},i(l){n||(b(i),b(r.$$.fragment,l),n=!0)},o(l){S(i),S(r.$$.fragment,l),n=!1},d(l){l&&w(t),i&&i.d(l),R(r,l)}}}function NE(o){let e=o[93].name+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&2097152&&e!==(e=r[93].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function $E(o){let e,t;function r(){return o[70](o[93])}return e=new Jc({props:{remoteFolder:o[93],slot:"name",$$slots:{default:[NE]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",r),{c(){U(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&2097152&&(i.remoteFolder=o[93]),s[0]&2097152|s[3]&8&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function gw(o){let e=o[20]?Io(o[1].relayManager.userCan(["folder","manage_users"],o[93])):Io(o[1].relayManager.userCan(["folder","read_content"],o[93])),t,r,n=e&&mw(o);return{c(){n&&n.c(),t=me()},m(s,i){n&&n.m(s,i),x(s,t,i),r=!0},p(s,i){i[0]&3145730&&(e=s[20]?Io(s[1].relayManager.userCan(["folder","manage_users"],s[93])):Io(s[1].relayManager.userCan(["folder","read_content"],s[93]))),e?n?(n.p(s,i),i[0]&3145730&&b(n,1)):(n=mw(s),n.c(),b(n,1),n.m(t.parentNode,t)):n&&(oe(),S(n,1,1,()=>{n=null}),ne())},i(s){r||(b(n),r=!0)},o(s){S(n),r=!1},d(s){s&&w(t),n&&n.d(s)}}}function BE(o){let e,t,r;return{c(){e=_("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){x(n,e,s),t||(r=V(e,"click",function(){Je((0,kt.debounce)(o[73]))&&(0,kt.debounce)(o[73]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function yw(o){let e,t,r,n,s,i,a,l=[HE,VE],c=[];function u(f,d){return f[23]?0:1}return t=u(o,[-1,-1,-1,-1]),r=c[t]=l[t](o),{c(){e=_("div"),r.c(),h(e,"class","edit-members-button svelte-sj7m72"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[23]?"Done editing":"Edit members")},m(f,d){x(f,e,d),c[t].m(e,null),s=!0,i||(a=[V(e,"click",o[55]),V(e,"keypress",o[55])],i=!0)},p(f,d){let m=t;t=u(f,d),t!==m&&(oe(),S(c[m],1,1,()=>{c[m]=null}),ne(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&8388608&&n!==(n=f[23]?"Done editing":"Edit members"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){S(r),s=!1},d(f){f&&w(e),c[t].d(),i=!1,ve(a)}}}function VE(o){let e,t;return e=new _a({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HE(o){let e,t;return e=new ma({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function qE(o){let e,t,r=o[18]&&yw(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[18]?r?(r.p(n,s),s[0]&262144&&b(r,1)):(r=yw(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function jE(o){let e,t=o[87].role+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","role-label")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&512&&t!==(t=n[87].role+"")&&Y(r,t)},d(n){n&&w(e)}}}function zE(o){let e;function t(s,i){return s[23]?KE:WE}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function WE(o){let e,t,r,n,s,i,a,l,c=he(o[24]),u=[];for(let f=0;f<c.length;f+=1)u[f]=vw(uw(o,c,f));return{c(){var f,d;e=_("div"),t=_("select");for(let m=0;m<u.length;m+=1)u[m].c();h(t,"class","dropdown"),t.disabled=r=o[87].userId===((f=o[1].loginManager.user)==null?void 0:f.id),h(t,"aria-label",n=o[87].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",i=o[87].id),ae(e,"display","flex"),ae(e,"gap","8px"),ae(e,"align-items","center")},m(f,d){x(f,e,d),y(e,t);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(t,null);In(t,o[87].role),a||(l=V(t,"change",o[54]),a=!0)},p(f,d){var m,p;if(d[0]&16777216){c=he(f[24]);let v;for(v=0;v<c.length;v+=1){let g=uw(f,c,v);u[v]?u[v].p(g,d):(u[v]=vw(g),u[v].c(),u[v].m(t,null))}for(;v<u.length;v+=1)u[v].d(1);u.length=c.length}d[0]&16777730&&r!==(r=f[87].userId===((m=f[1].loginManager.user)==null?void 0:m.id))&&(t.disabled=r),d[0]&16777730&&n!==(n=f[87].userId===((p=f[1].loginManager.user)==null?void 0:p.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",n),d[0]&16777728&&s!==(s=f[87].role)&&In(t,f[87].role),d[0]&16777728&&i!==(i=f[87].id)&&h(t,"data-role-id",i)},d(f){f&&w(e),je(u,f),a=!1,l()}}}function KE(o){var r;let e,t=o[87].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&bw(o);return{c(){t&&t.c(),e=me()},m(n,s){t&&t.m(n,s),x(n,e,s)},p(n,s){var i;n[87].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=bw(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&w(e),t&&t.d(n)}}}function vw(o){let e,t=o[90].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[90].name,Ye(e,e.__value)},m(s,i){x(s,e,i),y(e,r)},p(s,i){i[0]&16777216&&t!==(t=s[90].name+"")&&Y(r,t),i[0]&16777216&&n!==(n=s[90].name)&&(e.__value=n,Ye(e,e.__value))},d(s){s&&w(e)}}}function bw(o){let e,t,r;function n(){return o[74](o[87])}return{c(){e=_("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){x(s,e,i),t||(r=V(e,"click",function(){Je((0,kt.debounce)(n))&&(0,kt.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&w(e),t=!1,r()}}}function GE(o){let e;function t(s,i){return s[18]?zE:jE}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function _w(o){let e,t;return e=new ui({props:{user:o[87].user,$$slots:{default:[GE]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[87].user),n[0]&25428482|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function JE(o){let e,t=o[9].values().length+"",r,n,s=o[14].userLimit+"",i,a;return{c(){e=_("span"),r=B(t),n=B(" of "),i=B(s),a=B(" seats used"),h(e,"class","faint svelte-sj7m72")},m(l,c){x(l,e,c),y(e,r),y(e,n),y(e,i),y(e,a)},p(l,c){c[0]&512&&t!==(t=l[9].values().length+"")&&Y(r,t),c[0]&16384&&s!==(s=l[14].userLimit+"")&&Y(i,s)},d(l){l&&w(e)}}}function ww(o){let e,t;return e=new Xc({}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function YE(o){let e,t,r,n,s,i,a,l,c,u,f,d=!o[12]&&ww(o);return{c(){e=_("div"),d&&d.c(),t=F(),r=_("div"),n=_("input"),i=F(),a=_("div"),h(n,"type","checkbox"),n.checked=o[11],n.disabled=s=!o[12],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[11]),h(r,"tabindex","0"),h(r,"class",l=o[12]?"checkbox-container":"checkbox-container checkbox-locked"),Me(r,"is-enabled",o[11]),h(e,"class","setting-item-control")},m(m,p){x(m,e,p),d&&d.m(e,null),y(e,t),y(e,r),y(r,n),y(r,i),y(r,a),c=!0,u||(f=[V(n,"change",o[75]),V(r,"keypress",o[76]),V(r,"click",o[77])],u=!0)},p(m,p){m[12]?d&&(oe(),S(d,1,1,()=>{d=null}),ne()):d?p[0]&4096&&b(d,1):(d=ww(m),d.c(),b(d,1),d.m(e,t)),(!c||p[0]&2048)&&(n.checked=m[11]),(!c||p[0]&4096&&s!==(s=!m[12]))&&(n.disabled=s),(!c||p[0]&2048)&&h(r,"aria-checked",m[11]),(!c||p[0]&4096&&l!==(l=m[12]?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||p[0]&6144)&&Me(r,"is-enabled",m[11])},i(m){c||(b(d),c=!0)},o(m){S(d),c=!1},d(m){m&&w(e),d&&d.d(),u=!1,ve(f)}}}function QE(o){let e;return{c(){e=_("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function ZE(o){let e;return{c(){e=_("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function XE(o){let e;return{c(){e=_("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function eP(o){let e;function t(s,i){return s[12]?XE:s[11]?ZE:QE}let r=t(o,[-1,-1,-1,-1]),n=r(o);return{c(){e=_("fragment"),n.c(),h(e,"slot","description")},m(s,i){x(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&w(e),n.d()}}}function xw(o){let e,t,r,n;e=new Ue({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[oP]},$$scope:{ctx:o}}});let s=o[12]&&Sw(o);return{c(){U(e.$$.fragment),t=F(),s&&s.c(),r=me()},m(i,a){D(e,i,a),x(i,t,a),s&&s.m(i,a),x(i,r,a),n=!0},p(i,a){let l={};a[0]&2304|a[3]&8&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[12]?s?(s.p(i,a),a[0]&4096&&b(s,1)):(s=Sw(i),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(oe(),S(s,1,1,()=>{s=null}),ne())},i(i){n||(b(e.$$.fragment,i),b(s),n=!0)},o(i){S(e.$$.fragment,i),S(s),n=!1},d(i){i&&(w(t),w(r)),R(e,i),s&&s.d(i)}}}function tP(o){let e,t;return e=new Yc({props:{value:o[8]?o[8].key:"please wait...",disabled:!o[11],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.value=r[8]?r[8].key:"please wait..."),n[0]&2048&&(s.disabled=!r[11]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function rP(o){let e;return{c(){e=_("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-sj7m72")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function oP(o){let e,t,r,n,s=[rP,tP],i=[];function a(l,c){return l[11]?1:0}return t=a(o,[-1,-1,-1,-1]),r=i[t]=s[t](o),{c(){e=_("div"),r.c(),h(e,"class","share-key-container svelte-sj7m72")},m(l,c){x(l,e,c),i[t].m(e,null),n=!0},p(l,c){let u=t;t=a(l,c),t===u?i[t].p(l,c):(oe(),S(i[u],1,1,()=>{i[u]=null}),ne(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){S(r),n=!1},d(l){l&&w(e),i[t].d()}}}function Sw(o){let e,t;return e=new Ue({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[nP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function nP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,kt.debounce)(o[49])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function kw(o){let e,t,r,n,s,i,a,l;e=new ze({props:{name:"Plan"}});let c=[iP,sP],u=[];function f(p,v){return p[26]?0:1}r=f(o,[-1,-1,-1,-1]),n=u[r]=c[r](o);let d=o[27]&&o[27].quota>0&&Lw(o),m=o[0].provider&&o[0].provider.selfHosted&&Mw(o);return{c(){U(e.$$.fragment),t=F(),n.c(),s=F(),d&&d.c(),i=F(),m&&m.c(),a=me()},m(p,v){D(e,p,v),x(p,t,v),u[r].m(p,v),x(p,s,v),d&&d.m(p,v),x(p,i,v),m&&m.m(p,v),x(p,a,v),l=!0},p(p,v){let g=r;r=f(p,v),r===g?u[r].p(p,v):(oe(),S(u[g],1,1,()=>{u[g]=null}),ne(),n=u[r],n?n.p(p,v):(n=u[r]=c[r](p),n.c()),b(n,1),n.m(s.parentNode,s)),p[27]&&p[27].quota>0?d?(d.p(p,v),v[0]&134217728&&b(d,1)):(d=Lw(p),d.c(),b(d,1),d.m(i.parentNode,i)):d&&(oe(),S(d,1,1,()=>{d=null}),ne()),p[0].provider&&p[0].provider.selfHosted?m?(m.p(p,v),v[0]&1&&b(m,1)):(m=Mw(p),m.c(),b(m,1),m.m(a.parentNode,a)):m&&(oe(),S(m,1,1,()=>{m=null}),ne())},i(p){l||(b(e.$$.fragment,p),b(n),b(d),b(m),l=!0)},o(p){S(e.$$.fragment,p),S(n),S(d),S(m),l=!1},d(p){p&&(w(t),w(s),w(i),w(a)),R(e,p),u[r].d(p),d&&d.d(p),m&&m.d(p)}}}function sP(o){let e,t;return e=new Ue({props:{name:`Plan: ${o[14].plan}`,description:o[14].cta||"Thanks for supporting Relay development",$$slots:{default:[aP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&16384&&(s.name=`Plan: ${r[14].plan}`),n[0]&16384&&(s.description=r[14].cta||"Thanks for supporting Relay development"),n[0]&16384|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function iP(o){let e,t,r=!o[15].values()[0].active||o[15].values()[0].cancelAt,n,s;e=new Ue({props:{name:`Plan: ${o[14].plan}`,description:"",$$slots:{description:[cP],default:[lP]},$$scope:{ctx:o}}});let i=r&&Cw(o);return{c(){U(e.$$.fragment),t=F(),i&&i.c(),n=me()},m(a,l){D(e,a,l),x(a,t,l),i&&i.m(a,l),x(a,n,l),s=!0},p(a,l){let c={};l[0]&16384&&(c.name=`Plan: ${a[14].plan}`),l[0]&67158016|l[3]&8&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&32768&&(r=!a[15].values()[0].active||a[15].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&32768&&b(i,1)):(i=Cw(a),i.c(),b(i,1),i.m(n.parentNode,n)):i&&(oe(),S(i,1,1,()=>{i=null}),ne())},i(a){s||(b(e.$$.fragment,a),b(i),s=!0)},o(a){S(e.$$.fragment,a),S(i),s=!1},d(a){a&&(w(t),w(n)),R(e,a),i&&i.d(a)}}}function aP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=V(e,"click",function(){Je((0,kt.debounce)(o[80]))&&(0,kt.debounce)(o[80]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function Iw(o){let e,t,r;return{c(){e=_("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=V(e,"click",function(){Je((0,kt.debounce)(o[79]))&&(0,kt.debounce)(o[79]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function lP(o){let e,t,r=o[15].values()[0].active&&!o[15].values()[0].cancelAt,n,s,i,a=r&&Iw(o);return{c(){e=_("button"),e.textContent="Manage",t=F(),a&&a.c(),n=me()},m(l,c){x(l,e,c),x(l,t,c),a&&a.m(l,c),x(l,n,c),s||(i=V(e,"click",function(){Je((0,kt.debounce)(o[78]))&&(0,kt.debounce)(o[78]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&32768&&(r=o[15].values()[0].active&&!o[15].values()[0].cancelAt),r?a?a.p(o,c):(a=Iw(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(w(e),w(t),w(n)),a&&a.d(l),s=!1,i()}}}function cP(o){let e,t=o[14].cta+"",r;return{c(){e=_("fragment"),r=B(t),h(e,"slot","description")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&16384&&t!==(t=n[14].cta+"")&&Y(r,t)},d(n){n&&w(e)}}}function Cw(o){let e,t;return e=new Ue({props:{description:"",$$slots:{name:[fP],default:[uP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&32768|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uP(o){let e=o[33](o[15].values()[0].cancelAt)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&32768&&e!==(e=r[33](r[15].values()[0].cancelAt)+"")&&Y(t,e)},d(r){r&&w(t)}}}function fP(o){let e;return{c(){e=_("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function Lw(o){let e,t,r,n,s,i,a;e=new ze({props:{name:"Storage"}});let l=[pP,dP],c=[];function u(f,d){return f[27].metered?0:1}return r=u(o,[-1,-1,-1,-1]),n=c[r]=l[r](o),i=new Ft({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[yP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),n.c(),s=F(),U(i.$$.fragment)},m(f,d){D(e,f,d),x(f,t,d),c[r].m(f,d),x(f,s,d),D(i,f,d),a=!0},p(f,d){let m=r;r=u(f,d),r===m?c[r].p(f,d):(oe(),S(c[m],1,1,()=>{c[m]=null}),ne(),n=c[r],n?n.p(f,d):(n=c[r]=l[r](f),n.c()),b(n,1),n.m(s.parentNode,s));let p={};d[0]&134217728|d[3]&8&&(p.$$scope={dirty:d,ctx:f}),i.$set(p)},i(f){a||(b(e.$$.fragment,f),b(n),b(i.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(n),S(i.$$.fragment,f),a=!1},d(f){f&&(w(t),w(s)),R(e,f),c[r].d(f),R(i,f)}}}function dP(o){let e,t;return e=new Ft({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[mP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function pP(o){let e,t,r,n,s,i;return e=new Z_({props:{diskUsagePercentage:Math.round(o[27].usage*100/o[27].quota)}}),r=new Ft({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[hP]},$$scope:{ctx:o}}}),s=new Ft({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[gP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment)},m(a,l){D(e,a,l),x(a,t,l),D(r,a,l),x(a,n,l),D(s,a,l),i=!0},p(a,l){let c={};l[0]&134217728&&(c.diskUsagePercentage=Math.round(a[27].usage*100/a[27].quota)),e.$set(c);let u={};l[0]&134217728|l[3]&8&&(u.$$scope={dirty:l,ctx:a}),r.$set(u);let f={};l[0]&134217728|l[3]&8&&(f.$$scope={dirty:l,ctx:a}),s.$set(f)},i(a){i||(b(e.$$.fragment,a),b(r.$$.fragment,a),b(s.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),S(r.$$.fragment,a),S(s.$$.fragment,a),i=!1},d(a){a&&(w(t),w(n)),R(e,a),R(r,a),R(s,a)}}}function mP(o){let e;return{c(){e=B("Unmetered by Relay")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function hP(o){let e=pi(o[27].usage)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].usage)+"")&&Y(t,e)},d(r){r&&w(t)}}}function gP(o){let e=pi(o[27].quota)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].quota)+"")&&Y(t,e)},d(r){r&&w(t)}}}function yP(o){let e=pi(o[27].maxFileSize)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&134217728&&e!==(e=pi(r[27].maxFileSize)+"")&&Y(t,e)},d(r){r&&w(t)}}}function Mw(o){let e,t,r,n,s,i,a,l;e=new ze({props:{name:"Host"}}),r=new Ue({props:{name:"URL",description:"",$$slots:{default:[vP]},$$scope:{ctx:o}}});let c={ctx:o,current:null,token:null,hasCatch:!1,pending:xP,then:_P,catch:bP,value:86,blocks:[,,,]};en(s=o[32](o[0]),c);let u=o[0].provider.publicKey&&Fw(o);return{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),c.block.c(),i=F(),u&&u.c(),a=me()},m(f,d){D(e,f,d),x(f,t,d),D(r,f,d),x(f,n,d),c.block.m(f,c.anchor=d),c.mount=()=>i.parentNode,c.anchor=i,x(f,i,d),u&&u.m(f,d),x(f,a,d),l=!0},p(f,d){o=f;let m={};d[0]&1|d[3]&8&&(m.$$scope={dirty:d,ctx:o}),r.$set(m),c.ctx=o,d[0]&1&&s!==(s=o[32](o[0]))&&en(s,c)||ni(c,o,d),o[0].provider.publicKey?u?(u.p(o,d),d[0]&1&&b(u,1)):(u=Fw(o),u.c(),b(u,1),u.m(a.parentNode,a)):u&&(oe(),S(u,1,1,()=>{u=null}),ne())},i(f){l||(b(e.$$.fragment,f),b(r.$$.fragment,f),b(c.block),b(u),l=!0)},o(f){S(e.$$.fragment,f),S(r.$$.fragment,f);for(let d=0;d<3;d+=1){let m=c.blocks[d];S(m)}S(u),l=!1},d(f){f&&(w(t),w(n),w(i),w(a)),R(e,f),R(r,f),c.block.d(f),c.token=null,c=null,u&&u.d(f)}}}function vP(o){let e=o[0].provider.url+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&Y(t,e)},d(r){r&&w(t)}}}function bP(o){return{c:H,m:H,p:H,i:H,o:H,d:H}}function _P(o){let e,t,r=o[86].level==="warning"&&Tw(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[86].level==="warning"?r?(r.p(n,s),s[0]&1&&b(r,1)):(r=Tw(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function Tw(o){let e,t;return e=new Ue({props:{name:"Status",description:"",$$slots:{default:[wP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&1|n[3]&8&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Aw(o){let e,t,r,n=Fn(o[86].link.text)+"",s;return{c(){e=_("br"),t=F(),r=_("a"),h(r,"href",s=o[86].link.url)},m(i,a){x(i,e,a),x(i,t,a),x(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=Fn(i[86].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[86].link.url)&&h(r,"href",s)},d(i){i&&(w(e),w(t),w(r))}}}function wP(o){let e,t,r=Fn(o[86].status)+"",n,s=o[86].link&&Aw(o);return{c(){e=_("p"),t=new kn(!1),n=F(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-sj7m72")},m(i,a){x(i,e,a),t.m(r,e),y(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=Fn(i[86].status)+"")&&t.p(r),i[86].link?s?s.p(i,a):(s=Aw(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&w(e),s&&s.d()}}}function xP(o){return{c:H,m:H,p:H,i:H,o:H,d:H}}function Fw(o){let e,t,r,n,s,i,a,l,c=[CP,IP,kP,SP],u=[];function f(d,m){return d[4]?0:d[5]?1:d[6]?2:3}return i=f(o,[-1,-1,-1,-1]),a=u[i]=c[i](o),{c(){e=_("div"),t=_("div"),t.textContent="Relay Server Configuration",r=F(),n=_("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=F(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","relay-auth-section svelte-sj7m72")},m(d,m){x(d,e,m),y(e,t),y(e,r),y(e,n),y(e,s),u[i].m(e,null),l=!0},p(d,m){let p=i;i=f(d,m),i===p?u[i].p(d,m):(oe(),S(u[p],1,1,()=>{u[p]=null}),ne(),a=u[i],a?a.p(d,m):(a=u[i]=c[i](d),a.c()),b(a,1),a.m(e,null))},i(d){l||(b(a),l=!0)},o(d){S(a),l=!1},d(d){d&&w(e),u[i].d()}}}function SP(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-sj7m72")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function kP(o){let e,t;return e=new ou({props:{toml:o[6]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.toml=r[6]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function IP(o){let e,t;return{c(){e=_("div"),t=B(o[5]),h(e,"class","error-message svelte-sj7m72")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n[0]&32&&Y(t,r[5])},i:H,o:H,d(r){r&&w(e)}}}function CP(o){let e;return{c(){e=_("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-sj7m72")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function Ew(o){let e,t,r,n;return e=new ze({props:{name:"Membership"}}),r=new Ue({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[LP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){D(e,s,i),x(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&w(t),R(e,s),R(r,s)}}}function LP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,kt.debounce)(o[81])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function Pw(o){let e,t,r,n;return e=new ze({props:{name:"Danger zone"}}),r=new Ue({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[AP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){D(e,s,i),x(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[0]&32768|i[3]&8&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&w(t),R(e,s),R(r,s)}}}function MP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,kt.debounce)(o[52])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function TP(o){let e,t;return{c(){e=_("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){x(r,e,n)},p:H,d(r){r&&w(e)}}}function AP(o){let e,t;function r(i,a){return a[0]&32768&&(e=null),e==null&&(e=i[15].values().length>0&&!i[15].values()[0].cancelAt),e?TP:MP}let n=r(o,[-1,-1,-1,-1]),s=n(o);return{c(){s.c(),t=me()},m(i,a){s.m(i,a),x(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&w(t),s.d(i)}}}function FP(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v,g,I,L,k,C,T,A,E=!o[14].owner||o[13].filter(o[64]).values().length>1,P,M,$;e=new Eo({props:{items:[{type:"home",onClick:o[66]},{type:"relay",relay:o[0]}]}});let W=o[16]&&dw(o);n=new ze({props:{name:"Shared Folders on this Relay Server",$$slots:{default:[RE]},$$scope:{ctx:o}}});let O=he(o[21].values()),N=[];for(let j=0;j<O.length;j+=1)N[j]=gw(fw(o,O,j));let te=j=>S(N[j],1,1,()=>{N[j]=null});a=new Ue({props:{description:"",name:"",$$slots:{default:[BE]},$$scope:{ctx:o}}}),d=new ze({props:{name:"Users",$$slots:{default:[qE]},$$scope:{ctx:o}}});let Z=he(o[9].values().sort(o[34])),Q=[];for(let j=0;j<Z.length;j+=1)Q[j]=_w(cw(o,Z,j));let ye=j=>S(Q[j],1,1,()=>{Q[j]=null});v=new Ue({props:{description:"",name:"",$$slots:{default:[JE]},$$scope:{ctx:o}}}),I=new ze({props:{name:"Sharing",helpText:"Share keys can be shared with collaborators so that they can join the Relay Server. Once you have added all of your collaborators, you can disable the share key to prevent anyone from joining, even if they have the key."}}),k=new Ft({props:{name:o[12]?"Enable key sharing":"Key sharing",$$slots:{description:[eP],default:[YE]},$$scope:{ctx:o}}});let z=o[11]&&xw(o),q=o[25]&&kw(o),X=E&&Ew(o),fe=o[28]&&Pw(o);return{c(){U(e.$$.fragment),t=F(),W&&W.c(),r=F(),U(n.$$.fragment),s=F();for(let j=0;j<N.length;j+=1)N[j].c();i=F(),U(a.$$.fragment),l=F(),c=_("div"),u=F(),f=_("div"),U(d.$$.fragment),m=F();for(let j=0;j<Q.length;j+=1)Q[j].c();p=F(),U(v.$$.fragment),g=F(),U(I.$$.fragment),L=F(),U(k.$$.fragment),C=F(),z&&z.c(),T=F(),q&&q.c(),A=F(),X&&X.c(),P=F(),fe&&fe.c(),M=me(),h(c,"class","spacer svelte-sj7m72"),h(f,"class","users-header")},m(j,ee){D(e,j,ee),x(j,t,ee),W&&W.m(j,ee),x(j,r,ee),D(n,j,ee),x(j,s,ee);for(let re=0;re<N.length;re+=1)N[re]&&N[re].m(j,ee);x(j,i,ee),D(a,j,ee),x(j,l,ee),x(j,c,ee),x(j,u,ee),x(j,f,ee),D(d,f,null),x(j,m,ee);for(let re=0;re<Q.length;re+=1)Q[re]&&Q[re].m(j,ee);x(j,p,ee),D(v,j,ee),x(j,g,ee),D(I,j,ee),x(j,L,ee),D(k,j,ee),x(j,C,ee),z&&z.m(j,ee),x(j,T,ee),q&&q.m(j,ee),x(j,A,ee),X&&X.m(j,ee),x(j,P,ee),fe&&fe.m(j,ee),x(j,M,ee),$=!0},p(j,ee){let re={};ee[0]&1&&(re.items=[{type:"home",onClick:j[66]},{type:"relay",relay:j[0]}]),e.$set(re),j[16]?W?(W.p(j,ee),ee[0]&65536&&b(W,1)):(W=dw(j),W.c(),b(W,1),W.m(r.parentNode,r)):W&&(oe(),S(W,1,1,()=>{W=null}),ne());let de={};if(ee[0]&1835008|ee[3]&8&&(de.$$scope={dirty:ee,ctx:j}),n.$set(de),ee[0]&7340034|ee[1]&1024|ee[2]&2){O=he(j[21].values());let Te;for(Te=0;Te<O.length;Te+=1){let nt=fw(j,O,Te);N[Te]?(N[Te].p(nt,ee),b(N[Te],1)):(N[Te]=gw(nt),N[Te].c(),b(N[Te],1),N[Te].m(i.parentNode,i))}for(oe(),Te=O.length;Te<N.length;Te+=1)te(Te);ne()}let Le={};ee[0]&7|ee[3]&8&&(Le.$$scope={dirty:ee,ctx:j}),a.$set(Le);let pe={};if(ee[0]&8650752|ee[3]&8&&(pe.$$scope={dirty:ee,ctx:j}),d.$set(pe),ee[0]&25428482|ee[1]&12582920){Z=he(j[9].values().sort(j[34]));let Te;for(Te=0;Te<Z.length;Te+=1){let nt=cw(j,Z,Te);Q[Te]?(Q[Te].p(nt,ee),b(Q[Te],1)):(Q[Te]=_w(nt),Q[Te].c(),b(Q[Te],1),Q[Te].m(p.parentNode,p))}for(oe(),Te=Z.length;Te<Q.length;Te+=1)ye(Te);ne()}let Ee={};ee[0]&16896|ee[3]&8&&(Ee.$$scope={dirty:ee,ctx:j}),v.$set(Ee);let Oe={};ee[0]&4096&&(Oe.name=j[12]?"Enable key sharing":"Key sharing"),ee[0]&6144|ee[3]&8&&(Oe.$$scope={dirty:ee,ctx:j}),k.$set(Oe),j[11]?z?(z.p(j,ee),ee[0]&2048&&b(z,1)):(z=xw(j),z.c(),b(z,1),z.m(T.parentNode,T)):z&&(oe(),S(z,1,1,()=>{z=null}),ne()),j[25]?q?(q.p(j,ee),ee[0]&33554432&&b(q,1)):(q=kw(j),q.c(),b(q,1),q.m(A.parentNode,A)):q&&(oe(),S(q,1,1,()=>{q=null}),ne()),ee[0]&24577&&(E=!j[14].owner||j[13].filter(j[64]).values().length>1),E?X?(X.p(j,ee),ee[0]&24577&&b(X,1)):(X=Ew(j),X.c(),b(X,1),X.m(P.parentNode,P)):X&&(oe(),S(X,1,1,()=>{X=null}),ne()),j[28]?fe?(fe.p(j,ee),ee[0]&268435456&&b(fe,1)):(fe=Pw(j),fe.c(),b(fe,1),fe.m(M.parentNode,M)):fe&&(oe(),S(fe,1,1,()=>{fe=null}),ne())},i(j){if(!$){b(e.$$.fragment,j),b(W),b(n.$$.fragment,j);for(let ee=0;ee<O.length;ee+=1)b(N[ee]);b(a.$$.fragment,j),b(d.$$.fragment,j);for(let ee=0;ee<Z.length;ee+=1)b(Q[ee]);b(v.$$.fragment,j),b(I.$$.fragment,j),b(k.$$.fragment,j),b(z),b(q),b(X),b(fe),$=!0}},o(j){S(e.$$.fragment,j),S(W),S(n.$$.fragment,j),N=N.filter(Boolean);for(let ee=0;ee<N.length;ee+=1)S(N[ee]);S(a.$$.fragment,j),S(d.$$.fragment,j),Q=Q.filter(Boolean);for(let ee=0;ee<Q.length;ee+=1)S(Q[ee]);S(v.$$.fragment,j),S(I.$$.fragment,j),S(k.$$.fragment,j),S(z),S(q),S(X),S(fe),$=!1},d(j){j&&(w(t),w(r),w(s),w(i),w(l),w(c),w(u),w(f),w(m),w(p),w(g),w(L),w(C),w(T),w(A),w(P),w(M)),R(e,j),W&&W.d(j),R(n,j),je(N,j),R(a,j),R(d),je(Q,j),R(v,j),R(I,j),R(k,j),z&&z.d(j),q&&q.d(j),X&&X.d(j),fe&&fe.d(j)}}}function pi(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function EP(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function PP(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function DP(o,e,t){let r,n,s,i,a,l=H,c=()=>(l(),l=At(j,se=>t(13,a=se)),j),u,f=H,d=()=>(f(),f=At(N,se=>t(14,u=se)),N),m,p,v,g,I,L,k,C,T=H,A=()=>(T(),T=At(fe,se=>t(22,C=se)),fe),E,P,M,$,W,O;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>T());let{relay:N}=e;d();let te=N.folders;le(o,te,se=>t(21,k=se));let Z=Ie(!1);le(o,Z,se=>t(20,L=se));let{plugin:Q}=e,ye=!1,z=null,q="",X=Ze([te,Q.relayManager.relayRoles,Q.relayManager.folderRoles],([se,$e,Qe])=>{let It=Array.from(se.values()),Hr=It.filter(qr=>Io(Q.relayManager.userCan(["folder","read_content"],qr))),br=It.filter(qr=>Io(Q.relayManager.userCan(["folder","manage_users"],qr)));return Hr.length!==br.length});le(o,X,se=>t(19,I=se));let{sharedFolders:fe}=e;A();let{relayRoles:j}=e;c(),Q.relayManager.refreshRelay(N);function ee(se){return Ae(this,void 0,void 0,function*(){let $e=yield Q.loginManager.checkRelayHost(se.guid);if($e.status===200)return $e.json})}function re(se){if(!se)return"Active";let $e=lh.moment.utc(),Qe=lh.moment.utc(se),It=Qe.diff($e,"days");return It<=0?"Subscription has ended":It===1?"Active for 1 more day":It>31?`Ends on ${Qe.format("YYYY-MM-DD")}`:`Active for ${It} more days`}function de(se,$e){var Qe;return se.role==="Owner"&&$e.role==="Owner"?se.userId===((Qe=Q.loginManager.user)===null||Qe===void 0?void 0:Qe.id)?-1:1:se.role==="Owner"&&$e.role!=="Owner"?-1:se.role!=="Owner"&&$e.role==="Owner"||se.user.name>$e.user.name?1:-1}let Le=Ze([Q.relayManager.roles],([se])=>se.values().sort(EP));le(o,Le,se=>t(24,P=se));let pe=u.subscriptions;le(o,pe,se=>t(15,m=se));let Ee=Ze(m,se=>{if(se.values().length===0)return;let $e=se.values()[0];return $e.token||Q.relayManager.getSubscriptionToken($e).then(Qe=>{$e.token=Qe}),$e});le(o,Ee,se=>t(26,$=se));let Oe=u.storageQuota;le(o,Oe,se=>t(27,W=se));let Te=a.filter(se=>se.relayId===N.id);le(o,Te,se=>t(9,r=se));let nt=Ie(!0);le(o,nt,se=>t(10,n=se));let ct;it(()=>{ct&&ct.value===""&&ct.focus()});let Dt=et();function Ro(){return Ae(this,void 0,void 0,function*(){var se,$e;if(!(!((se=Q.relayManager)===null||se===void 0)&&se.pb)){t(5,z="Not connected to relay service");return}t(4,ye=!0),t(5,z=null);try{let Qe=Q.relayManager.pb.baseUrl+`/api/collections/relays/records/${N.id}/relay.toml`,Hr=yield(yield lt(Qe,{method:"GET",headers:{Authorization:Q.relayManager.pb.authStore.token?`Bearer ${Q.relayManager.pb.authStore.token}`:""}})).text();t(6,q=Hr.replace(/\{url\}/g,(($e=N.provider)===null||$e===void 0?void 0:$e.url)||""))}catch(Qe){t(5,z=Qe instanceof Error?Qe.message:"Failed to fetch relay configuration")}finally{t(4,ye=!1)}})}it(()=>{var se;ct&&ct.value===""&&ct.focus(),!((se=N.provider)===null||se===void 0)&&se.selfHosted&&Ro()});function Cr(se){return Ae(this,void 0,void 0,function*(){var $e;if(!(!(($e=Q.loginManager)===null||$e===void 0)&&$e.user))return;let Qe={relay:se.id,quantity:10,user_email:Q.loginManager.user.email},It=btoa(JSON.stringify(Qe)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(Q.buildApiUrl(`/subscribe/${It}`),"_blank")})}function Lr(se){return Ae(this,void 0,void 0,function*(){let $e=se.token,Qe=se.id;window.open(Q.buildApiUrl(`/subscriptions/${Qe}/manage?token=${$e}`),"_blank")})}function io(se){return Ae(this,void 0,void 0,function*(){let $e=se.token,Qe=se.id;window.open(Q.buildApiUrl(`/subscriptions/${Qe}/cancel?token=${$e}`),"_blank")})}function qt(se){i&&(Mr.set(se),Q.relayManager.toggleRelayInvitation(vr,s).then($e=>{Mr.set($e.enabled)}).catch($e=>{Mr.set(!se),Yt($e,"Failed to toggle share key")}))}function sn(){return Ae(this,void 0,void 0,function*(){Q.relayManager.leaveRelay(N),Dt("goBack",{clear:!0})})}function cs(){return Ae(this,void 0,void 0,function*(){Dt("goBack",{clear:!0})})}let vr,Mr=Ie(!0);le(o,Mr,se=>t(11,s=se));let ao=Ie(!1);le(o,ao,se=>t(23,E=se)),Q.relayManager.getRelayInvitation(N).then(se=>{se&&(t(8,vr=se),Mr.set(se.enabled))});function En(){return Ae(this,void 0,void 0,function*(){if(vr)try{t(8,vr=yield Q.relayManager.rotateKey(vr))}catch(se){Yt(se,"Failed to rotate key.")}})}let lo=Ie(!1);le(o,lo,se=>t(17,v=se));let Pn=Q.timeProvider.debounce(()=>{Q.relayManager.updateRelay(N).then(()=>{lo.set(!1)})},500);function ke(){nt.set(PP(ct.value)),n&&ct.value!==""&&(lo.set(!0),Pn())}function Ge(){Q.relayManager.destroyRelay(N),Dt("goBack",{})}function tt(se){Q.relayManager.kick(se).catch($e=>{Yt($e,"Failed to remove user")})}function Tr(se,$e){return Ae(this,void 0,void 0,function*(){try{yield Q.relayManager.updateRelayRole(se,$e)}catch(Qe){throw Yt(Qe,"Failed to change user role."),Qe}})}function an(se){return Ae(this,void 0,void 0,function*(){let $e=se.target,Qe=r.get($e.dataset.roleId);if(Qe){let It=Qe.role;try{yield Tr(Qe,$e.value)}catch(Hr){$e.value=It}}})}function ce(se){(se instanceof MouseEvent||se instanceof KeyboardEvent&&(se.key==="Enter"||se.key===" "))&&ao.update($e=>!$e)}let Ne=Q.relayManager.userCan(["relay","manage_users"],N);le(o,Ne,se=>t(18,g=se));let mt=Q.relayManager.userCan(["relay","manage_sharing"],N);le(o,mt,se=>t(12,i=se));let Vr=Q.relayManager.userCan(["relay","rename"],N);le(o,Vr,se=>t(16,p=se));let or=Q.relayManager.userCan(["relay","delete"],N);le(o,or,se=>t(28,O=se));let Fa=Q.relayManager.userCan(["subscription","manage"],N);le(o,Fa,se=>t(25,M=se));function hi(se,$e,Qe,It){return Ae(this,void 0,void 0,function*(){let Hr=(0,kt.normalizePath)(se),br=fe.find(yi=>yi.path==Hr);if(Q.vault.getFolderByPath(Hr)===null&&(yield Q.vault.createFolder(Hr)),br)br.relayId=N.guid;else{let yi=Ss();br=fe.new(Hr,yi,N.guid,!0)}let qr=yield Q.relayManager.createRemoteFolder(br,N,Qe!=null?Qe:!1,$e);if(Qe&&It&&It.length>0)for(let yi of It)yield Q.relayManager.addFolderRole(qr,yi,"Member");return br.remote=qr,br.connect(),Q.sharedFolders.notifyListeners(),It&&It.length>0&&setTimeout(()=>{Dt("manageRemoteFolder",{remoteFolder:qr})},100),br})}let ue=new ru(Q.app,N,fe,Q.relayManager,hi);function Ve(se){return Ae(this,void 0,void 0,function*(){function $e(Qe,It,Hr){return Ae(this,void 0,void 0,function*(){let br=(0,kt.normalizePath)((0,Dw.join)(Hr,It));Q.vault.getFolderByPath(br)===null&&(yield Q.vault.createFolder(br));let qr=Q.sharedFolders.new(br,Qe.guid,Qe.relay.guid,!0);return qr.remote=Qe,Q.sharedFolders.notifyListeners(),Dt("manageRemoteFolder",{remoteFolder:qr.remote}),qr})}new An(Q.app,Q.sharedFolders,se,[],$e).open()})}Zo(()=>{ue==null||ue.destroy()});let gt=se=>se.role==="Owner"&&se.relayId===N.id,yt=(se,$e)=>$e.guid===se.guid,nr=()=>Dt("goBack",{clear:!0});function ln(){N.name=this.value,d(t(0,N))}function gi(se){pt[se?"unshift":"push"](()=>{ct=se,t(7,ct)})}let g0=()=>Z.update(se=>!se),y0=se=>{Dt("manageRemoteFolder",{remoteFolder:se})},v0=se=>{Ve(se)},b0=se=>{Dt("manageRemoteFolder",{remoteFolder:se})},_0=()=>{N.version===0?new di(Q.app,"Choose or create folder...",new Set(fe.filter($e=>!!$e.relayId).map($e=>$e.path)).add("/"),fe,hi).open():ue.open()},w0=se=>{tt(se)},x0=se=>qt(se.currentTarget.checked),S0=()=>qt(!s),k0=()=>qt(!s),I0=()=>{Lr($)},C0=()=>{io($)},L0=()=>{Cr(u)},M0=()=>{sn()};return o.$$set=se=>{"relay"in se&&d(t(0,N=se.relay)),"plugin"in se&&t(1,Q=se.plugin),"sharedFolders"in se&&A(t(2,fe=se.sharedFolders)),"relayRoles"in se&&c(t(3,j=se.relayRoles))},[N,Q,fe,j,ye,z,q,ct,vr,r,n,s,i,a,u,m,p,v,g,I,L,k,C,E,P,M,$,W,O,te,Z,X,ee,re,de,Le,pe,Ee,Oe,Te,nt,Dt,Cr,Lr,io,qt,sn,Mr,ao,En,lo,ke,Ge,tt,an,ce,Ne,mt,Vr,or,Fa,hi,ue,Ve,gt,yt,nr,ln,gi,g0,y0,v0,b0,_0,w0,x0,S0,k0,I0,C0,L0,M0]}var ch=class extends G{constructor(e){super(),J(this,e,DP,FP,K,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},PE,[-1,-1,-1,-1])}},mi=ch;function RP(o){let e,t,r,n,s,i;return r=new up({}),{c(){e=_("div"),t=_("div"),U(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){x(a,e,l),y(e,t),D(r,t,null),n=!0,s||(i=[V(t,"click",o[0]),V(t,"keypress",o[1])],s=!0)},p:H,i(a){n||(b(r.$$.fragment,a),n=!0)},o(a){S(r.$$.fragment,a),n=!1},d(a){a&&w(e),R(r),s=!1,ve(i)}}}function UP(o){let e=et();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var uh=class extends G{constructor(e){super(),J(this,e,UP,RP,K,{})}},Rw=uh;var dh=require("obsidian");function Uw(o){let e,t,r,n,s,i;return e=new ze({props:{name:"Danger zone"}}),r=new Ue({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[OP]},$$scope:{ctx:o}}}),s=new Ue({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[NP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment),n=F(),U(s.$$.fragment)},m(a,l){D(e,a,l),x(a,t,l),D(r,a,l),x(a,n,l),D(s,a,l),i=!0},p(a,l){let c={};l&256&&(c.$$scope={dirty:l,ctx:a}),r.$set(c);let u={};l&256&&(u.$$scope={dirty:l,ctx:a}),s.$set(u)},i(a){i||(b(e.$$.fragment,a),b(r.$$.fragment,a),b(s.$$.fragment,a),i=!0)},o(a){S(e.$$.fragment,a),S(r.$$.fragment,a),S(s.$$.fragment,a),i=!1},d(a){a&&(w(t),w(n)),R(e,a),R(r,a),R(s,a)}}}function OP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Delete metadata",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,dh.debounce)(o[6])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function NP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,dh.debounce)(o[7])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function $P(o){let e,t,r,n,s,i;e=new Eo({props:{items:[{type:"home",onClick:o[5]},{type:"folder",folder:o[0]}]}});let a=o[0]&&Uw(o);return{c(){U(e.$$.fragment),t=F(),r=_("div"),r.innerHTML=`<p style="margin: 1em; text-align: center">This Shared Folder is not on a Relay Server, or else you do not have
		permission to access it.</p>`,n=F(),a&&a.c(),s=me(),ae(r,"padding","1em"),ae(r,"margin","1em"),ae(r,"background","var(--background-secondary)")},m(l,c){D(e,l,c),x(l,t,c),x(l,r,c),x(l,n,c),a&&a.m(l,c),x(l,s,c),i=!0},p(l,[c]){let u={};c&1&&(u.items=[{type:"home",onClick:l[5]},{type:"folder",folder:l[0]}]),e.$set(u),l[0]?a?(a.p(l,c),c&1&&b(a,1)):(a=Uw(l),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(oe(),S(a,1,1,()=>{a=null}),ne())},i(l){i||(b(e.$$.fragment,l),b(a),i=!0)},o(l){S(e.$$.fragment,l),S(a),i=!1},d(l){l&&(w(t),w(r),w(n),w(s)),R(e,l),a&&a.d(l)}}}function BP(o,e,t){let{plugin:r}=e,{sharedFolder:n}=e,s=et();function i(){return Ae(this,void 0,void 0,function*(){n&&r.sharedFolders.delete(n),s("goBack",{clear:!0})})}function a(){if(n){let f=r.vault.getFolderByPath(n.path);f&&r.app.vault.trash(f,!1)}s("goBack",{})}let l=()=>s("goBack",{clear:!0}),c=()=>{i()},u=()=>{a()};return o.$$set=f=>{"plugin"in f&&t(4,r=f.plugin),"sharedFolder"in f&&t(0,n=f.sharedFolder)},[n,s,i,a,r,l,c,u]}var fh=class extends G{constructor(e){super(),J(this,e,BP,$P,K,{plugin:4,sharedFolder:0})}},nu=fh;var Do=require("obsidian");var fx=require("obsidian"),dx=Uo(Dn());var Vw=require("obsidian");function VP(o){Ce(o,"svelte-1iq1qoa",".search-container.svelte-1iq1qoa.svelte-1iq1qoa{margin-bottom:16px}.search-input.svelte-1iq1qoa.svelte-1iq1qoa{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;max-height:400px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);margin-bottom:16px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);cursor:pointer;gap:12px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:last-child{border-bottom:none}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:hover:not(.has-access){background:var(--background-modifier-hover)}.user-item.has-access.svelte-1iq1qoa.svelte-1iq1qoa{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-1iq1qoa.svelte-1iq1qoa{margin:0;cursor:pointer}.user-avatar.svelte-1iq1qoa.svelte-1iq1qoa{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-1iq1qoa img.svelte-1iq1qoa{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;min-width:0}.user-name.svelte-1iq1qoa.svelte-1iq1qoa{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-1iq1qoa.svelte-1iq1qoa{font-size:0.8em;color:var(--text-muted);font-style:italic}.no-users.svelte-1iq1qoa.svelte-1iq1qoa{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;justify-content:space-between;align-items:center;margin-top:16px}.selection-count.svelte-1iq1qoa.svelte-1iq1qoa{color:var(--text-muted);font-size:0.9em}button.svelte-1iq1qoa.svelte-1iq1qoa:disabled{opacity:0.5;cursor:not-allowed}")}function Ow(o,e,t){let r=o.slice();return r[22]=e[t],r}function HP(o){let e,t=he(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Nw(Ow(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s&130){t=he(n[1]);let i;for(i=0;i<t.length;i+=1){let a=Ow(n,t,i);r[i]?r[i].p(a,s):(r[i]=Nw(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function qP(o){let e,t=o[0]?"No users found":"No users available",r;return{c(){e=_("div"),r=B(t),h(e,"class","no-users svelte-1iq1qoa")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0]?"No users found":"No users available")&&Y(r,t)},d(n){n&&w(e)}}}function jP(o){let e=$w(o[22].user.name)+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&2&&e!==(e=$w(r[22].user.name)+"")&&Y(t,e)},d(r){r&&w(t)}}}function zP(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[22].user.picture)||h(e,"src",t),h(e,"alt",r=o[22].user.name),h(e,"class","svelte-1iq1qoa")},m(n,s){x(n,e,s)},p(n,s){s&2&&!dr(e.src,t=n[22].user.picture)&&h(e,"src",t),s&2&&r!==(r=n[22].user.name)&&h(e,"alt",r)},d(n){n&&w(e)}}}function WP(o){let e;return{c(){e=_("div"),e.textContent="(You)",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function KP(o){let e;return{c(){e=_("div"),e.textContent="Already has access",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function Nw(o){let e,t,r,n,s,i,a,l,c,u=o[22].user.name+"",f,d,m,p,v;function g(...M){return o[14](o[22],...M)}function I(M,$){return M[22].user.picture?zP:jP}let L=I(o,-1),k=L(o);function C(M,$){if(M[22].hasAccess)return KP;if(M[22].isCurrentUser)return WP}let T=C(o,-1),A=T&&T(o);function E(){return o[15](o[22])}function P(...M){return o[16](o[22],...M)}return{c(){e=_("div"),t=_("input"),s=F(),i=_("div"),k.c(),a=F(),l=_("div"),c=_("div"),f=B(u),d=F(),A&&A.c(),m=F(),h(t,"type","checkbox"),t.checked=r=o[22].selected,t.disabled=n=o[22].hasAccess,h(t,"class","user-checkbox svelte-1iq1qoa"),h(i,"class","user-avatar svelte-1iq1qoa"),h(c,"class","user-name svelte-1iq1qoa"),h(l,"class","user-info svelte-1iq1qoa"),h(e,"class","user-item svelte-1iq1qoa"),h(e,"role","button"),h(e,"tabindex","0"),Me(e,"has-access",o[22].hasAccess),Me(e,"is-owner",o[22].isOwner),Me(e,"is-current-user",o[22].isCurrentUser)},m(M,$){x(M,e,$),y(e,t),y(e,s),y(e,i),k.m(i,null),y(e,a),y(e,l),y(l,c),y(c,f),y(e,d),A&&A.m(e,null),y(e,m),p||(v=[V(t,"click",g),V(e,"click",E),V(e,"keydown",P)],p=!0)},p(M,$){o=M,$&2&&r!==(r=o[22].selected)&&(t.checked=r),$&2&&n!==(n=o[22].hasAccess)&&(t.disabled=n),L===(L=I(o,$))&&k?k.p(o,$):(k.d(1),k=L(o),k&&(k.c(),k.m(i,null))),$&2&&u!==(u=o[22].user.name+"")&&Y(f,u),T!==(T=C(o,$))&&(A&&A.d(1),A=T&&T(o),A&&(A.c(),A.m(e,m))),$&2&&Me(e,"has-access",o[22].hasAccess),$&2&&Me(e,"is-owner",o[22].isOwner),$&2&&Me(e,"is-current-user",o[22].isCurrentUser)},d(M){M&&w(e),k.d(),A&&A.d(),p=!1,ve(v)}}}function GP(o){let e,t,r,n,s,i,a,l,c,u,f=o[2]===0?"No users selected":`${o[2]} user${o[2]===1?"":"s"} selected`,d,m,p,v,g,I,L;function k(A,E){return A[1].length===0?qP:HP}let C=k(o,-1),T=C(o);return{c(){e=_("div"),e.textContent="Invite users to this folder",t=F(),r=_("div"),n=_("div"),s=_("input"),i=F(),a=_("div"),T.c(),l=F(),c=_("div"),u=_("span"),d=B(f),m=F(),p=_("button"),v=B("Add Users"),h(e,"class","modal-title"),h(s,"type","text"),h(s,"placeholder","Search users by name..."),h(s,"class","search-input svelte-1iq1qoa"),h(n,"class","search-container svelte-1iq1qoa"),h(a,"class","user-list svelte-1iq1qoa"),h(u,"class","selection-count svelte-1iq1qoa"),h(p,"class","mod-cta svelte-1iq1qoa"),p.disabled=g=o[2]===0,h(c,"class","modal-button-container svelte-1iq1qoa"),h(r,"class","modal-content user-select-modal")},m(A,E){x(A,e,E),x(A,t,E),x(A,r,E),y(r,n),y(n,s),Ye(s,o[0]),y(r,i),y(r,a),T.m(a,null),y(r,l),y(r,c),y(c,u),y(u,d),y(c,m),y(c,p),y(p,v),I||(L=[V(s,"input",o[13]),V(p,"click",o[8])],I=!0)},p(A,[E]){E&1&&s.value!==A[0]&&Ye(s,A[0]),C===(C=k(A,E))&&T?T.p(A,E):(T.d(1),T=C(A),T&&(T.c(),T.m(a,null))),E&4&&f!==(f=A[2]===0?"No users selected":`${A[2]} user${A[2]===1?"":"s"} selected`)&&Y(d,f),E&4&&g!==(g=A[2]===0)&&(p.disabled=g)},i:H,o:H,d(A){A&&(w(e),w(t),w(r)),T.d(),I=!1,ve(L)}}}function $w(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function JP(o,e,t){let r,n,s,i,{relayManager:a}=e,{folder:l}=e,{onAdd:c}=e,{preSelectedUserIds:u=[]}=e,f=Ie(new Set([...u]));le(o,f,M=>t(17,r=M));let d=Ie("");le(o,d,M=>t(0,n=M));let m=Ze([a.relayRoles],([M])=>M.values().filter($=>$.relayId===l.relayId).map($=>$.user)),p=Ze([a.folderRoles],([M])=>M.values().filter($=>$.sharedFolderId===l.id)),v=Ze([m,p,f],([M,$,W])=>{var O;let N=new Set($.map(Q=>Q.userId)),te=new Set($.filter(Q=>Q.role==="Owner").map(Q=>Q.userId)),Z=(O=a.user)===null||O===void 0?void 0:O.id;return M.map(Q=>{let ye=te.has(Q.id),z=Z===Q.id,q=W.has(Q.id);return{user:Q,hasAccess:N.has(Q.id),selected:q,isOwner:ye,isCurrentUser:z}})}),g=Ze([v,d],([M,$])=>{if(!$)return M;let W=$.toLowerCase();return M.filter(O=>O.user.name.toLowerCase().includes(W))}),I=Ze([g],([M])=>M.sort(($,W)=>$.hasAccess&&!W.hasAccess?1:!$.hasAccess&&W.hasAccess?-1:$.user.name.localeCompare(W.user.name)));le(o,I,M=>t(1,s=M));let L=Ze([f],([M])=>M.size);le(o,L,M=>t(2,i=M));function k(M){M.hasAccess||f.update($=>{let W=new Set($);return W.has(M.user.id)?W.delete(M.user.id):W.add(M.user.id),W})}function C(){return Ae(this,void 0,void 0,function*(){let M=r;if(M.size!==0)try{yield c(Array.from(M),"Member")}catch($){Yt($)}})}function T(){n=this.value,d.set(n)}let A=(M,$)=>{$.stopPropagation(),k(M)},E=M=>k(M),P=(M,$)=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),k(M))};return o.$$set=M=>{"relayManager"in M&&t(9,a=M.relayManager),"folder"in M&&t(10,l=M.folder),"onAdd"in M&&t(11,c=M.onAdd),"preSelectedUserIds"in M&&t(12,u=M.preSelectedUserIds)},[n,s,i,f,d,I,L,k,C,a,l,c,u,T,A,E,P]}var ph=class extends G{constructor(e){super(),J(this,e,JP,GP,K,{relayManager:9,folder:10,onAdd:11,preSelectedUserIds:12},VP)}},Bw=ph;var su=class extends Vw.Modal{constructor(t,r,n,s,i){super(t);this.relayManager=r;this.folder=n;this.onAdd=s;this.preSelectedUserIds=i}onOpen(){let{contentEl:t}=this;this.component=new Bw({target:t,props:{relayManager:this.relayManager,folder:this.folder,preSelectedUserIds:this.preSelectedUserIds,onAdd:async(r,n)=>{await this.onAdd(r,n),this.close()}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function YP(o){Ce(o,"svelte-fmnezc",`div.spacer.svelte-fmnezc{height:3em}.local-settings.svelte-fmnezc{margin-left:-1em;padding-left:1em;border-left:1px solid var(--color-accent)}.system3-input-invalid.svelte-fmnezc{border:1px solid var(--color-red) !important}input.system3-updating.svelte-fmnezc{border:1px solid var(--color-accent) !important}.edit-members-button.svelte-fmnezc{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-fmnezc:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-fmnezc:focus{outline:none;color:var(--icon-color-focus)}select.dropdown.svelte-fmnezc:disabled{opacity:1 !important;color:var(--text-muted) !important;-webkit-text-fill-color:var(--text-muted) !important}`)}function Hw(o,e,t){let r=o.slice();return r[68]=e[t][0],r[69]=e[t][1],r}function qw(o,e,t){let r=o.slice();return r[72]=e[t],r}function jw(o,e,t){let r=o.slice();return r[72]=e[t],r}function zw(o){let e;return{c(){e=_("div"),e.innerHTML=`<p style="margin: 1em; text-align: center">As Relay Server owner, you can manage this Shared Folder but cannot access
			its contents. You must be added to the Shared Folder in order to
			collaborate.</p>`,ae(e,"padding","1em"),ae(e,"margin","1em"),ae(e,"background","var(--background-secondary)")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function Ww(o){let e,t;return e=new Ue({props:{name:"Name",description:"Set the Shared Folder's default name. A Shared Folder can always be renamed locally.",$$slots:{default:[QP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&33048|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function QP(o){let e,t,r,n;return{c(){e=_("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=St((o[15]?"system3-updating":"")+(o[8]?"":" system3-input-invalid"))+" svelte-fmnezc")},m(s,i){x(s,e,i),Ye(e,o[3]),o[56](e),r||(n=[V(e,"input",o[55]),V(e,"input",o[48])],r=!0)},p(s,i){i[0]&33024&&t!==(t=St((s[15]?"system3-updating":"")+(s[8]?"":" system3-input-invalid"))+" svelte-fmnezc")&&h(e,"class",t),i[0]&8&&e.value!==s[3]&&Ye(e,s[3])},d(s){s&&w(e),o[56](null),r=!1,ve(n)}}}function Kw(o){let e,t,r,n;return e=new ze({props:{name:"Add to vault"}}),r=new Ue({props:{name:"Add this folder to your vault",description:"Download and sync this folder to your local device",$$slots:{default:[ZP]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){D(e,s,i),x(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[2]&32768&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&w(t),R(e,s),R(r,s)}}}function ZP(o){let e,t,r;return{c(){e=_("button"),e.textContent="Add to vault",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,Do.debounce)(o[47])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function Gw(o){let e,t,r,n,s;e=new ze({props:{name:"Users with access",helpText:o[7]?"":"This folder is accessible to everyone on this Relay Server.",$$slots:{default:[tD]},$$scope:{ctx:o}}});let i=he(o[9]),a=[];for(let u=0;u<i.length;u+=1)a[u]=Zw(qw(o,i,u));let l=u=>S(a[u],1,1,()=>{a[u]=null}),c=o[7]&&o[12]&&Xw(o);return{c(){U(e.$$.fragment),t=F();for(let u=0;u<a.length;u+=1)a[u].c();r=F(),c&&c.c(),n=me()},m(u,f){D(e,u,f),x(u,t,f);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(u,f);x(u,r,f),c&&c.m(u,f),x(u,n,f),s=!0},p(u,f){let d={};if(f[0]&128&&(d.helpText=u[7]?"":"This folder is accessible to everyone on this Relay Server."),f[0]&135172|f[2]&32768&&(d.$$scope={dirty:f,ctx:u}),e.$set(d),f[0]&397952|f[1]&36864){i=he(u[9]);let m;for(m=0;m<i.length;m+=1){let p=qw(u,i,m);a[m]?(a[m].p(p,f),b(a[m],1)):(a[m]=Zw(p),a[m].c(),b(a[m],1),a[m].m(r.parentNode,r))}for(oe(),m=i.length;m<a.length;m+=1)l(m);ne()}u[7]&&u[12]?c?(c.p(u,f),f[0]&4224&&b(c,1)):(c=Xw(u),c.c(),b(c,1),c.m(n.parentNode,n)):c&&(oe(),S(c,1,1,()=>{c=null}),ne())},i(u){if(!s){b(e.$$.fragment,u);for(let f=0;f<i.length;f+=1)b(a[f]);b(c),s=!0}},o(u){S(e.$$.fragment,u),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)S(a[f]);S(c),s=!1},d(u){u&&(w(t),w(r),w(n)),R(e,u),je(a,u),c&&c.d(u)}}}function Jw(o){let e,t,r,n,s,i,a,l=[eD,XP],c=[];function u(f,d){return f[17]?0:1}return t=u(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=_("div"),r.c(),h(e,"class","edit-members-button svelte-fmnezc"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[17]?"Cancel editing users":"Edit users")},m(f,d){x(f,e,d),c[t].m(e,null),s=!0,i||(a=[V(e,"click",o[42]),V(e,"keypress",o[42])],i=!0)},p(f,d){let m=t;t=u(f,d),t!==m&&(oe(),S(c[m],1,1,()=>{c[m]=null}),ne(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&131072&&n!==(n=f[17]?"Cancel editing users":"Edit users"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){S(r),s=!1},d(f){f&&w(e),c[t].d(),i=!1,ve(a)}}}function XP(o){let e,t;return e=new _a({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function eD(o){let e,t;return e=new ma({props:{class:"svg-icon"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function tD(o){let e,t,r=o[2].private&&o[12]&&Jw(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[2].private&&n[12]?r?(r.p(n,s),s[0]&4100&&b(r,1)):(r=Jw(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function Yw(o){let e;function t(s,i){return s[17]?nD:s[12]?oD:rD}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function rD(o){let e,t=o[72].role+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","role-label")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&512&&t!==(t=n[72].role+"")&&Y(r,t)},d(n){n&&w(e)}}}function oD(o){let e,t,r,n,s,i,a=he(o[18]),l=[];for(let c=0;c<a.length;c+=1)l[c]=Qw(jw(o,a,c));return{c(){e=_("div"),t=_("select");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","dropdown svelte-fmnezc"),h(t,"data-role-id",n=o[72].id),ae(e,"display","flex"),ae(e,"gap","8px"),ae(e,"align-items","center")},m(c,u){x(c,e,u),y(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);In(t,o[72].role),s||(i=V(t,"change",o[46]),s=!0)},p(c,u){if(u[0]&262144){a=he(c[18]);let f;for(f=0;f<a.length;f+=1){let d=jw(c,a,f);l[f]?l[f].p(d,u):(l[f]=Qw(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}u[0]&262656&&r!==(r=c[72].role)&&In(t,c[72].role),u[0]&262656&&n!==(n=c[72].id)&&h(t,"data-role-id",n)},d(c){c&&w(e),je(l,c),s=!1,i()}}}function nD(o){let e,t,r;function n(){return o[57](o[72])}return{c(){e=_("button"),e.textContent="Remove",h(e,"class","mod-destructive")},m(s,i){x(s,e,i),t||(r=V(e,"click",function(){Je((0,Do.debounce)(n))&&(0,Do.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&w(e),t=!1,r()}}}function Qw(o){let e,t=o[72].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[72].name,Ye(e,e.__value)},m(s,i){x(s,e,i),y(e,r)},p(s,i){i[0]&262144&&t!==(t=s[72].name+"")&&Y(r,t),i[0]&262144&&n!==(n=s[72].name)&&(e.__value=n,Ye(e,e.__value))},d(s){s&&w(e)}}}function sD(o){let e,t=o[7]&&Yw(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[7]?t?t.p(r,n):(t=Yw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function Zw(o){let e,t;return e=new ui({props:{user:o[72].user,$$slots:{default:[sD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.user=r[72].user),n[0]&397952|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Xw(o){let e,t;return e=new Ue({props:{description:"",name:"",$$slots:{default:[iD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&131072|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function iD(o){let e,t,r,n;return{c(){e=_("button"),t=B("Add User"),h(e,"class","mod-cta"),h(e,"aria-label","Add user to private folder"),e.disabled=o[17]},m(s,i){x(s,e,i),y(e,t),r||(n=V(e,"click",(0,Do.debounce)(o[45])),r=!0)},p(s,i){i[0]&131072&&(e.disabled=s[17])},d(s){s&&w(e),r=!1,n()}}}function ex(o){let e,t,r,n,s,i;t=new ze({props:{name:"Sync settings for this device",helpText:"You must have attachment storage available in order to sync attachments."}});let a=o[3]!==o[10].name&&tx(o),l=he(o[6]),c=[];for(let d=0;d<l.length;d+=1)c[d]=ox(Hw(o,l,d));let u=d=>S(c[d],1,1,()=>{c[d]=null}),f=o[11]&&o[16]&&nx(o);return{c(){e=_("div"),U(t.$$.fragment),r=F(),a&&a.c(),n=F();for(let d=0;d<c.length;d+=1)c[d].c();s=F(),f&&f.c(),h(e,"class","local-settings svelte-fmnezc")},m(d,m){x(d,e,m),D(t,e,null),y(e,r),a&&a.m(e,null),y(e,n);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(e,null);y(e,s),f&&f.m(e,null),i=!0},p(d,m){if(d[3]!==d[10].name?a?(a.p(d,m),m[0]&1032&&b(a,1)):(a=tx(d),a.c(),b(a,1),a.m(e,n)):a&&(oe(),S(a,1,1,()=>{a=null}),ne()),m[0]&526432|m[1]&2){l=he(d[6]);let p;for(p=0;p<l.length;p+=1){let v=Hw(d,l,p);c[p]?(c[p].p(v,m),b(c[p],1)):(c[p]=ox(v),c[p].c(),b(c[p],1),c[p].m(e,s))}for(oe(),p=l.length;p<c.length;p+=1)u(p);ne()}d[11]&&d[16]?f?(f.p(d,m),m[0]&67584&&b(f,1)):(f=nx(d),f.c(),b(f,1),f.m(e,null)):f&&(oe(),S(f,1,1,()=>{f=null}),ne())},i(d){if(!i){b(t.$$.fragment,d),b(a);for(let m=0;m<l.length;m+=1)b(c[m]);b(f),i=!0}},o(d){S(t.$$.fragment,d),S(a),c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)S(c[m]);S(f),i=!1},d(d){d&&w(e),R(t),a&&a.d(),je(c,d),f&&f.d()}}}function tx(o){let e,t;return e=new Ue({props:{name:"Local path",description:"This folder has a different name in your Vault",$$slots:{default:[aD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&1024|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function aD(o){let e,t=o[10].path+"",r;return{c(){e=B("/"),r=B(t)},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[10].path+"")&&Y(r,t)},d(n){n&&(w(e),w(r))}}}function rx(o){let e,t;return e=new Xc({}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lD(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[11]&&rx(o);function m(...g){return o[58](o[68],...g)}function p(){return o[59](o[68])}function v(){return o[60](o[68])}return{c(){e=_("div"),d&&d.c(),t=F(),r=_("div"),n=_("input"),i=F(),a=_("div"),h(n,"type","checkbox"),n.checked=s=o[19][o[68]]&&!o[11],n.disabled=o[5],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[19][o[68]]&&!o[11]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Me(r,"is-enabled",o[19][o[68]]&&!o[11]),h(e,"class","setting-item-control")},m(g,I){x(g,e,I),d&&d.m(e,null),y(e,t),y(e,r),y(r,n),y(r,i),y(r,a),c=!0,u||(f=[V(n,"change",m),V(r,"keypress",p),V(r,"click",v)],u=!0)},p(g,I){o=g,o[11]?d?I[0]&2048&&b(d,1):(d=rx(o),d.c(),b(d,1),d.m(e,t)):d&&(oe(),S(d,1,1,()=>{d=null}),ne()),(!c||I[0]&526400&&s!==(s=o[19][o[68]]&&!o[11]))&&(n.checked=s),(!c||I[0]&32)&&(n.disabled=o[5]),(!c||I[0]&526400&&l!==(l=o[19][o[68]]&&!o[11]))&&h(r,"aria-checked",l),(!c||I[0]&526400)&&Me(r,"is-enabled",o[19][o[68]]&&!o[11])},i(g){c||(b(d),c=!0)},o(g){S(d),c=!1},d(g){g&&w(e),d&&d.d(),u=!1,ve(f)}}}function ox(o){let e,t;return e=new Ft({props:{name:o[69].name,description:o[69].description,$$slots:{default:[lD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.name=r[69].name),n[0]&64&&(s.description=r[69].description),n[0]&526432|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function nx(o){let e,t;return e=new Ft({props:{name:"",$$slots:{default:[cD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&65536|n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function cD(o){let e,t,r;return{c(){e=_("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=V(e,"click",function(){Je((0,Do.debounce)(o[61]))&&(0,Do.debounce)(o[61]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function sx(o){let e,t;return e=new ze({props:{name:"Danger zone"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ix(o){let e,t,r,n=o[21]&&ax(o),s=o[20]&&cx(o);return{c(){n&&n.c(),e=F(),s&&s.c(),t=me()},m(i,a){n&&n.m(i,a),x(i,e,a),s&&s.m(i,a),x(i,t,a),r=!0},p(i,a){i[21]?n?(n.p(i,a),a[0]&2097152&&b(n,1)):(n=ax(i),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(oe(),S(n,1,1,()=>{n=null}),ne()),i[20]?s?(s.p(i,a),a[0]&1048576&&b(s,1)):(s=cx(i),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(oe(),S(s,1,1,()=>{s=null}),ne())},i(i){r||(b(n),b(s),r=!0)},o(i){S(n),S(s),r=!1},d(i){i&&(w(e),w(t)),n&&n.d(i),s&&s.d(i)}}}function ax(o){var n,s;let e,t,r=!((n=o[0])!=null&&n.private)&&((s=o[0])==null?void 0:s.relay.version)>0&&lx(o);return{c(){r&&r.c(),e=me()},m(i,a){r&&r.m(i,a),x(i,e,a),t=!0},p(i,a){var l,c;!((l=i[0])!=null&&l.private)&&((c=i[0])==null?void 0:c.relay.version)>0?r?(r.p(i,a),a[0]&1&&b(r,1)):(r=lx(i),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(i){t||(b(r),t=!0)},o(i){S(r),t=!1},d(i){i&&w(e),r&&r.d(i)}}}function lx(o){let e,t;return e=new Ue({props:{name:"Make private",description:"Convert this folder to a private folder and manage access",$$slots:{default:[uD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uD(o){let e,t,r;return{c(){e=_("button"),e.textContent="Make private",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,Do.debounce)(o[44])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function cx(o){let e,t;return e=new Ue({props:{name:"Remove from Relay Server",description:"Deletes the remote folder from the Relay Server. Local files will be preserved.",$$slots:{default:[fD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fD(o){let e,t,r;return{c(){e=_("button"),e.textContent="Delete from Relay Server",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,Do.debounce)(o[41])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function ux(o){let e,t;return e=new Ue({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[dD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[2]&32768&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dD(o){let e,t,r;return{c(){e=_("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,Do.debounce)(o[62])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function pD(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v;e=new Eo({props:{items:[{type:"home",onClick:o[53]},{type:"relay",relay:o[2].relay,onClick:o[54]},{type:"remoteFolder",remoteFolder:{...o[2],name:o[3],private:o[7]}}]}});let g=o[12]&&!o[13]&&zw(o),I=o[14]&&Ww(o),L=!o[10]&&o[13]&&Kw(o),k=o[16]&&Gw(o),C=o[10]&&o[19]&&o[16]&&ex(o),T=(o[20]||o[21]||o[10])&&sx(o),A=o[16]&&ix(o),E=o[10]&&ux(o);return{c(){U(e.$$.fragment),t=F(),g&&g.c(),r=F(),I&&I.c(),n=F(),L&&L.c(),s=F(),k&&k.c(),i=F(),a=_("div"),l=F(),C&&C.c(),c=F(),u=_("div"),f=F(),T&&T.c(),d=F(),A&&A.c(),m=F(),E&&E.c(),p=me(),h(a,"class","spacer svelte-fmnezc"),h(u,"class","spacer svelte-fmnezc")},m(P,M){D(e,P,M),x(P,t,M),g&&g.m(P,M),x(P,r,M),I&&I.m(P,M),x(P,n,M),L&&L.m(P,M),x(P,s,M),k&&k.m(P,M),x(P,i,M),x(P,a,M),x(P,l,M),C&&C.m(P,M),x(P,c,M),x(P,u,M),x(P,f,M),T&&T.m(P,M),x(P,d,M),A&&A.m(P,M),x(P,m,M),E&&E.m(P,M),x(P,p,M),v=!0},p(P,M){let $={};M[0]&140&&($.items=[{type:"home",onClick:P[53]},{type:"relay",relay:P[2].relay,onClick:P[54]},{type:"remoteFolder",remoteFolder:{...P[2],name:P[3],private:P[7]}}]),e.$set($),P[12]&&!P[13]?g||(g=zw(P),g.c(),g.m(r.parentNode,r)):g&&(g.d(1),g=null),P[14]?I?(I.p(P,M),M[0]&16384&&b(I,1)):(I=Ww(P),I.c(),b(I,1),I.m(n.parentNode,n)):I&&(oe(),S(I,1,1,()=>{I=null}),ne()),!P[10]&&P[13]?L?(L.p(P,M),M[0]&9216&&b(L,1)):(L=Kw(P),L.c(),b(L,1),L.m(s.parentNode,s)):L&&(oe(),S(L,1,1,()=>{L=null}),ne()),P[16]?k?(k.p(P,M),M[0]&65536&&b(k,1)):(k=Gw(P),k.c(),b(k,1),k.m(i.parentNode,i)):k&&(oe(),S(k,1,1,()=>{k=null}),ne()),P[10]&&P[19]&&P[16]?C?(C.p(P,M),M[0]&590848&&b(C,1)):(C=ex(P),C.c(),b(C,1),C.m(c.parentNode,c)):C&&(oe(),S(C,1,1,()=>{C=null}),ne()),P[20]||P[21]||P[10]?T?M[0]&3146752&&b(T,1):(T=sx(P),T.c(),b(T,1),T.m(d.parentNode,d)):T&&(oe(),S(T,1,1,()=>{T=null}),ne()),P[16]?A?(A.p(P,M),M[0]&65536&&b(A,1)):(A=ix(P),A.c(),b(A,1),A.m(m.parentNode,m)):A&&(oe(),S(A,1,1,()=>{A=null}),ne()),P[10]?E?(E.p(P,M),M[0]&1024&&b(E,1)):(E=ux(P),E.c(),b(E,1),E.m(p.parentNode,p)):E&&(oe(),S(E,1,1,()=>{E=null}),ne())},i(P){v||(b(e.$$.fragment,P),b(I),b(L),b(k),b(C),b(T),b(A),b(E),v=!0)},o(P){S(e.$$.fragment,P),S(I),S(L),S(k),S(C),S(T),S(A),S(E),v=!1},d(P){P&&(w(t),w(r),w(n),w(s),w(i),w(a),w(l),w(c),w(u),w(f),w(d),w(m),w(p)),R(e,P),g&&g.d(P),I&&I.d(P),L&&L.d(P),k&&k.d(P),C&&C.d(P),T&&T.d(P),A&&A.d(P),E&&E.d(P)}}}function mD(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function hD(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function gD(o,e,t){let r,n,s,i,a,l,c,u=H,f=()=>(u(),u=At($,ue=>t(2,c=ue)),$),d,m=H,p=()=>(m(),m=At(W,ue=>t(64,d=ue)),W),v,g,I,L,k,C,T,A,E,P;o.$$.on_destroy.push(()=>u()),o.$$.on_destroy.push(()=>m());let{plugin:M}=e,{remoteFolder:$}=e;f();let{sharedFolders:W}=e;p();let{relayRoles:O}=e,{folderRoles:N}=e,te=$.name,{errorLog:Z=Fe("ManageRemoveFolder.svelte","error")}=e;M.relayManager.refreshRemoteFolder($);let Q=Ze([O],([ue])=>{var Ve;return(Ve=ue.find(gt=>gt.relayId===c.relayId))===null||Ve===void 0?void 0:Ve.relay});le(o,Q,ue=>t(16,k=ue));let ye=Ze(d,ue=>ue.items().find(Ve=>Ve.guid===$.guid));le(o,ye,ue=>t(10,a=ue));let z=Ze([M.relayManager.roles],([ue])=>ue.values().sort(mD));le(o,z,ue=>t(18,T=ue));let q=Ze([N,O],([ue,Ve])=>{if(c.private){let yt=[];for(let nr of ue.values())nr.sharedFolderId===c.id&&Ve.some(ln=>ln.userId===nr.userId)&&yt.push(nr);return yt}let gt=[];for(let yt of Ve.values())yt.relayId===c.relayId&&gt.push(yt);return gt});le(o,q,ue=>t(9,i=ue));let X=Ie(!1);le(o,X,ue=>t(17,C=ue));let fe=Ie(!0);le(o,fe,ue=>t(8,s=ue));let j,ee=Ie(!1);le(o,ee,ue=>t(15,L=ue));let re=$.name;it(()=>{j&&j.value===""&&j.focus()});function de(ue){return Ae(this,void 0,void 0,function*(){var Ve;if(!(!((Ve=M.loginManager)===null||Ve===void 0)&&Ve.user))return;let gt={relay:ue.id,quantity:10,user_email:M.loginManager.user.email},yt=btoa(JSON.stringify(gt)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(M.buildApiUrl(`/subscribe/${yt}?action="buy_storage"`),"_blank")})}let Le=a==null?void 0:a.syncSettingsManager;le(o,Le,ue=>t(19,A=ue));let pe=Ze([ye,O],([ue,Ve])=>{var gt,yt,nr;return((nr=(yt=(gt=Ve.find(ln=>{var gi;return ln.relay===((gi=ue==null?void 0:ue.remote)===null||gi===void 0?void 0:gi.relay)}))===null||gt===void 0?void 0:gt.relay)===null||yt===void 0?void 0:yt.storageQuota)===null||nr===void 0?void 0:nr.quota)===0});le(o,pe,ue=>t(11,l=ue));let Ee=!1;function Oe(ue,Ve){return Ae(this,void 0,void 0,function*(){if(!Ee&&!l&&Le){t(5,Ee=!0);try{yield Le.toggleCategory(ue,Ve),t(6,n=Object.entries(Le.getCategories()))}catch(gt){}finally{t(5,Ee=!1)}}})}let Te=et(),nt=M.relayManager.userCan(["folder","read_content"],$);le(o,nt,ue=>t(13,g=ue));let ct=M.relayManager.userCan(["folder","rename"],$);le(o,ct,ue=>t(14,I=ue));let Dt=M.relayManager.userCan(["folder","delete"],$);le(o,Dt,ue=>t(20,E=ue));let Ro=M.relayManager.userCan(["folder","manage_users"],$);le(o,Ro,ue=>t(12,v=ue));let Cr=M.relayManager.userCan(["folder","make_private"],$);le(o,Cr,ue=>t(21,P=ue));function Lr(ue){ue&&Te("manageRelay",{relay:ue})}function io(){return Ae(this,void 0,void 0,function*(){a&&M.sharedFolders.delete(a),Te("goBack",{clear:!0})})}function qt(){if(a){let ue=M.vault.getFolderByPath(a.path);ue&&M.app.vault.trash(ue,!1)}}function sn(){return Ae(this,void 0,void 0,function*(){try{if(yield M.relayManager.deleteRemote($),a){ei(ye,a.remote=void 0,a),M.sharedFolders.notifyListeners(),Te("manageSharedFolder",{folder:a});return}}catch(ue){Z("Failed to delete remote folder:",ue)}Te("goBack",{})})}function cs(ue){(ue instanceof MouseEvent||ue instanceof KeyboardEvent&&(ue.key==="Enter"||ue.key===" "))&&X.update(Ve=>!Ve)}function vr(ue){return Ae(this,void 0,void 0,function*(){try{yield M.relayManager.removeFolderRole(ue)}catch(Ve){Yt(Ve,"Failed to remove user from folder.")}})}function Mr(){return Ae(this,void 0,void 0,function*(){try{let ue=yield M.relayManager.updateFolderPrivacy($,!0);ao()}catch(ue){Yt(ue,"Failed to make folder private. Permission denied.")}})}function ao(){new su(M.app,M.relayManager,$,(Ve,gt)=>Ae(this,void 0,void 0,function*(){try{for(let yt of Ve)yield M.relayManager.addFolderRole($,yt,gt)}catch(yt){Yt(yt,"Failed to add users to folder.")}})).open()}function En(ue,Ve){return Ae(this,void 0,void 0,function*(){try{yield M.relayManager.updateFolderRole(ue,Ve)}catch(gt){throw Yt(gt,"Failed to change user role."),gt}})}function lo(ue){return Ae(this,void 0,void 0,function*(){let Ve=ue.target,gt=i.find(yt=>yt.id===Ve.dataset.roleId);if(gt){let yt=gt.role;try{yield En(gt,Ve.value)}catch(nr){Ve.value=yt}}})}function Pn(){return Ae(this,void 0,void 0,function*(){function ue(Ve,gt,yt){return Ae(this,void 0,void 0,function*(){let nr=(0,fx.normalizePath)((0,dx.join)(yt,gt));M.vault.getFolderByPath(nr)===null&&(yield M.vault.createFolder(nr));let ln=M.sharedFolders.new(nr,Ve.guid,Ve.relay.guid,!0);return ln.remote=Ve,M.sharedFolders.notifyListeners(),Te("manageRemoteFolder",{remoteFolder:Ve}),ln})}new An(M.app,M.sharedFolders,$,[],ue).open()})}let ke=M.timeProvider.debounce(ue=>Ae(void 0,void 0,void 0,function*(){try{let Ve=yield M.relayManager.updateRemoteFolder($,{name:ue});re=Ve.name,t(3,te=Ve.name),ee.set(!1)}catch(Ve){Z("Failed to update folder name:",Ve),(Ve==null?void 0:Ve.status)===400&&fe.set(!1),ee.set(!1)}}),500);function Ge(){fe.set(hD(j.value));let ue=j.value.trim();s&&ue!==""&&ue!==re&&(ee.set(!0),ke(ue))}let tt=()=>Te("goBack",{clear:!0}),Tr=()=>Lr(c.relay);function an(){te=this.value,t(3,te)}function ce(ue){pt[ue?"unshift":"push"](()=>{j=ue,t(4,j)})}let Ne=ue=>{"sharedFolder"in ue&&vr(ue)},mt=(ue,Ve)=>Oe(ue,Ve.currentTarget.checked),Vr=ue=>Oe(ue,!A[ue]),or=ue=>Oe(ue,!A[ue]),Fa=()=>{de(k)},hi=()=>{qt()};return o.$$set=ue=>{"plugin"in ue&&t(49,M=ue.plugin),"remoteFolder"in ue&&f(t(0,$=ue.remoteFolder)),"sharedFolders"in ue&&p(t(1,W=ue.sharedFolders)),"relayRoles"in ue&&t(50,O=ue.relayRoles),"folderRoles"in ue&&t(51,N=ue.folderRoles),"errorLog"in ue&&t(52,Z=ue.errorLog)},o.$$.update=()=>{o.$$.dirty[0]&4&&t(7,r=(c==null?void 0:c.private)||!1)},t(6,n=Le?Object.entries(Le.getCategories()):[]),[$,W,c,te,j,Ee,n,r,s,i,a,l,v,g,I,L,k,C,T,A,E,P,Q,ye,z,q,X,fe,ee,de,Le,pe,Oe,Te,nt,ct,Dt,Ro,Cr,Lr,qt,sn,cs,vr,Mr,ao,lo,Pn,Ge,M,O,N,Z,tt,Tr,an,ce,Ne,mt,Vr,or,Fa,hi]}var mh=class extends G{constructor(e){super(),J(this,e,gD,pD,K,{plugin:49,remoteFolder:0,sharedFolders:1,relayRoles:50,folderRoles:51,errorLog:52},YP,[-1,-1,-1])}},iu=mh;function yD(o){Ce(o,"svelte-gjlxvj",".toast.svelte-gjlxvj.svelte-gjlxvj{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-radius:8px;border:1px solid;background:var(--background-primary);color:var(--text-normal);box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);min-height:48px;max-width:500px;min-width:300px;width:max-content;animation:svelte-gjlxvj-slideDown 0.3s ease-out;pointer-events:auto}.toast-error.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-error)}.toast-warning.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-warning)}.toast-success.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--interactive-accent)}@keyframes svelte-gjlxvj-slideDown{from{opacity:0;transform:translateX(-50%) translateY(-10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}.toast-icon.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;flex-shrink:0;margin-top:1px}.toast-error.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-error)}.toast-warning.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-warning)}.toast-success.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--interactive-accent)}.toast-content.svelte-gjlxvj.svelte-gjlxvj{flex:1;min-width:0}.toast-message.svelte-gjlxvj.svelte-gjlxvj{font-weight:500;margin-bottom:2px;line-height:1.4;color:var(--text-normal)}.toast-details.svelte-gjlxvj.svelte-gjlxvj{font-size:0.9em;color:var(--text-muted);line-height:1.3}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;background:transparent;border-radius:4px;cursor:pointer;color:var(--text-muted);transition:all 0.15s ease-in-out;padding:0;flex-shrink:0}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:hover{background:var(--background-modifier-hover);color:var(--text-error)}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:focus{outline:2px solid var(--interactive-accent);outline-offset:1px}")}function px(o){let e,t;return{c(){e=_("div"),t=B(o[1]),h(e,"class","toast-details svelte-gjlxvj")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n&2&&Y(t,r[1])},d(r){r&&w(e)}}}function vD(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v;var g=o[3];function I(k,C){return{props:{class:"svg-icon"}}}g&&(r=Qo(g,I(o)));let L=o[1]&&px(o);return f=new zp({props:{class:"svg-icon"}}),{c(){e=_("div"),t=_("div"),r&&U(r.$$.fragment),n=F(),s=_("div"),i=_("div"),a=B(o[0]),l=F(),L&&L.c(),c=F(),u=_("button"),U(f.$$.fragment),h(t,"class","toast-icon svelte-gjlxvj"),h(i,"class","toast-message svelte-gjlxvj"),h(s,"class","toast-content svelte-gjlxvj"),h(u,"class","toast-dismiss svelte-gjlxvj"),h(u,"aria-label","Dismiss error"),h(e,"class",d=St(o[2])+" svelte-gjlxvj"),h(e,"role","alert"),h(e,"aria-live","polite")},m(k,C){x(k,e,C),y(e,t),r&&D(r,t,null),y(e,n),y(e,s),y(s,i),y(i,a),y(s,l),L&&L.m(s,null),y(e,c),y(e,u),D(f,u,null),m=!0,p||(v=V(u,"click",o[4]),p=!0)},p(k,[C]){if(C&8&&g!==(g=k[3])){if(r){oe();let T=r;S(T.$$.fragment,1,0,()=>{R(T,1)}),ne()}g?(r=Qo(g,I(k,C)),U(r.$$.fragment),b(r.$$.fragment,1),D(r,t,null)):r=null}(!m||C&1)&&Y(a,k[0]),k[1]?L?L.p(k,C):(L=px(k),L.c(),L.m(s,null)):L&&(L.d(1),L=null),(!m||C&4&&d!==(d=St(k[2])+" svelte-gjlxvj"))&&h(e,"class",d)},i(k){m||(r&&b(r.$$.fragment,k),b(f.$$.fragment,k),m=!0)},o(k){r&&S(r.$$.fragment,k),S(f.$$.fragment,k),m=!1},d(k){k&&w(e),r&&R(r),L&&L.d(),R(f),p=!1,v()}}}function bD(o,e,t){let r,n,{message:s}=e,{details:i=""}=e,{type:a="error"}=e,{autoDismiss:l=5e3}=e,c=et(),u;it(()=>(l>0&&(u=window.setTimeout(()=>{c("dismiss")},l)),()=>{u&&clearTimeout(u)}));function f(){u&&clearTimeout(u),c("dismiss")}return o.$$set=d=>{"message"in d&&t(0,s=d.message),"details"in d&&t(1,i=d.details),"type"in d&&t(5,a=d.type),"autoDismiss"in d&&t(6,l=d.autoDismiss)},o.$$.update=()=>{o.$$.dirty&32&&t(3,r=a==="error"?es:a==="warning"?mp:a==="success"?ha:ba),o.$$.dirty&32&&t(2,n=`toast toast-${a}`)},[s,i,n,r,f,a,l]}var hh=class extends G{constructor(e){super(),J(this,e,bD,vD,K,{message:0,details:1,type:5,autoDismiss:6},yD)}},mx=hh;function _D(o){Ce(o,"svelte-ml1z9c",".toast-container.svelte-ml1z9c{position:fixed;top:0;left:0;width:100vw;height:0;pointer-events:none;z-index:1000}")}function hx(o,e,t){let r=o.slice();return r[3]=e[t][0],r[4]=e[t][1],r}function gx(o,e){let t,r,n;function s(){return e[2](e[3])}return r=new mx({props:{message:e[4].message,details:e[4].details,type:e[4].type,autoDismiss:e[4].autoDismiss,source:e[4].source}}),r.$on("dismiss",s),{key:o,first:null,c(){t=me(),U(r.$$.fragment),this.first=t},m(i,a){x(i,t,a),D(r,i,a),n=!0},p(i,a){e=i;let l={};a&1&&(l.message=e[4].message),a&1&&(l.details=e[4].details),a&1&&(l.type=e[4].type),a&1&&(l.autoDismiss=e[4].autoDismiss),a&1&&(l.source=e[4].source),r.$set(l)},i(i){n||(b(r.$$.fragment,i),n=!0)},o(i){S(r.$$.fragment,i),n=!1},d(i){i&&w(t),R(r,i)}}}function wD(o){let e,t=[],r=new Map,n,s=he(o[0]),i=a=>a[3];for(let a=0;a<s.length;a+=1){let l=hx(o,s,a),c=i(l);r.set(c,t[a]=gx(c,l))}return{c(){e=_("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","toast-container svelte-ml1z9c")},m(a,l){x(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(s=he(a[0]),oe(),t=mr(t,l,i,1,a,s,r,e,tn,gx,null,hx),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)S(t[l]);n=!1},d(a){a&&w(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function xD(o,e,t){let r,n;le(o,tu,i=>t(1,n=i));let s=i=>tw(i);return o.$$.update=()=>{o.$$.dirty&2&&t(0,r=Object.entries(n).filter(([i,a])=>a.visible))},[r,n,s]}var gh=class extends G{constructor(e){super(),J(this,e,xD,wD,K,{},_D)}},yx=gh;function SD(o){Ce(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function kD(o){let e,t,r,n,s=o[0].networkStatus.status&&vx(o);return{c(){e=_("div"),t=_("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),ae(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),ae(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){x(i,e,a),y(e,t),s&&s.m(t,null),r||(n=[V(e,"click",o[22]),V(e,"keypress",o[23])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=vx(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&ae(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&ae(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:H,o:H,d(i){i&&w(e),s&&s.d(),r=!1,ve(n)}}}function ID(o){let e,t;return e=new Rw({}),e.$on("goBack",o[14]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:H,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function vx(o){let e,t=Fn(o[0].networkStatus.status.status)+"",r;return{c(){e=new kn(!1),r=me(),e.a=r},m(n,s){e.m(t,n,s),x(n,r,s)},p(n,s){s&1&&t!==(t=Fn(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(w(r),e.d())}}}function CD(o){let e,t;return e=new a_({props:{plugin:o[0],$$slots:{default:[AD]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&134217729&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function LD(o){let e,t;return e=new mi({props:{plugin:o[0],relayRoles:o[5],relay:o[2],sharedFolders:o[9]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function MD(o){let e,t;return e=new nu({props:{plugin:o[0],sharedFolder:o[1]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function TD(o){let e,t;return e=new iu({props:{plugin:o[0],remoteFolder:o[3],sharedFolders:o[9],relayRoles:o[5],folderRoles:o[4].folderRoles}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8&&(s.remoteFolder=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function AD(o){let e,t;return e=new Po({props:{relays:o[6],subscriptions:o[7],providers:o[8],plugin:o[0]}}),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),e.$on("createRelay",o[13]),e.$on("joinRelay",o[16]),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function FD(o){let e,t;return e=new yx({}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function bx(o){let e,t=o[0].version+"",r;return{c(){e=_("span"),r=B(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&Y(r,t)},d(n){n&&w(e)}}}function ED(o){let e,t,r,n,s,i,a,l=He().enableToasts,c,u,f,d=[ID,kD],m=[];function p(C,T){return C[2]||C[1]||C[3]?0:C[0].networkStatus.status?1:-1}~(e=p(o,-1))&&(t=m[e]=d[e](o));let v=[TD,MD,LD,CD],g=[];function I(C,T){return C[3]?0:C[1]?1:C[2]?2:3}s=I(o,-1),i=g[s]=v[s](o);let L=l&&FD(o),k=o[0].manifest.version!==o[0].version&&bx(o);return{c(){t&&t.c(),r=F(),n=_("div"),i.c(),a=F(),L&&L.c(),c=F(),k&&k.c(),u=me(),h(n,"class","vertical-tab-content svelte-d22j3")},m(C,T){~e&&m[e].m(C,T),x(C,r,T),x(C,n,T),g[s].m(n,null),x(C,a,T),L&&L.m(C,T),x(C,c,T),k&&k.m(C,T),x(C,u,T),f=!0},p(C,[T]){let A=e;e=p(C,T),e===A?~e&&m[e].p(C,T):(t&&(oe(),S(m[A],1,1,()=>{m[A]=null}),ne()),~e?(t=m[e],t?t.p(C,T):(t=m[e]=d[e](C),t.c()),b(t,1),t.m(r.parentNode,r)):t=null);let E=s;s=I(C,T),s===E?g[s].p(C,T):(oe(),S(g[E],1,1,()=>{g[E]=null}),ne(),i=g[s],i?i.p(C,T):(i=g[s]=v[s](C),i.c()),b(i,1),i.m(n,null)),C[0].manifest.version!==C[0].version?k?k.p(C,T):(k=bx(C),k.c(),k.m(u.parentNode,u)):k&&(k.d(1),k=null)},i(C){f||(b(t),b(i),b(L),f=!0)},o(C){S(t),S(i),S(L),f=!1},d(C){C&&(w(r),w(n),w(a),w(c),w(u)),~e&&m[e].d(C),g[s].d(),L&&L.d(C),k&&k.d(C)}}}function PD(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;le(o,c,te=>t(21,r=te));let u=a.subscriptions,f=a.providers,d=n.sharedFolders,m,p=Po,v,g,I=[{component:Po}],{close:L}=e;function k(te){if(t(2,v=void 0),t(1,m=void 0),t(3,g=void 0),te==="/"){t(20,p=Po);return}let Z=new URLSearchParams(te.split("?")[1]||""),Q=Z.get("id");if(te.startsWith("/relays")){Q?(t(2,v=a.relays.find(ye=>ye.guid===Q||ye.id===Q)),t(20,p=mi)):t(20,p=Po);return}if(te.startsWith("/shared-folders")){if(Q){t(1,m=d.find(z=>z.guid===Q));let ye=Z.get("relay");ye&&t(2,v=a.relays.find(z=>z.guid===ye||z.id===ye)),m!=null&&m.remote?(t(3,g=m.remote),t(2,v=m.remote.relay),t(20,p=iu)):t(20,p=nu)}return}}function C(te){I.push({currentRelay:v,sharedFolder:m,remoteFolder:g,component:p}),t(2,v=te.detail.relay),t(1,m=void 0),t(3,g=void 0),t(20,p=mi)}function T(te){I.push({currentRelay:v,sharedFolder:m,remoteFolder:g,component:p}),t(1,m=te.detail.folder),t(3,g=te.detail.remoteFolder),t(2,v=te.detail.relay),t(20,p=nu)}function A(te){I.push({currentRelay:v,sharedFolder:m,remoteFolder:g,component:p}),t(1,m=void 0),t(3,g=te.detail.remoteFolder),t(2,v=te.detail.relay),t(20,p=iu)}function E(te){return Ae(this,void 0,void 0,function*(){try{I.push({currentRelay:v,sharedFolder:m,remoteFolder:g,component:p}),t(2,v=yield n.relayManager.createRelay("")),t(20,p=mi)}catch(Z){Yt(Z,"Failed to create relay")}})}function P(te){if(te.detail.clear){I.length=0,t(2,v=void 0),t(1,m=void 0),t(3,g=void 0),t(20,p=Po);return}let Z=I.pop();if(Z)for(;Z;){if(!Z.currentRelay&&!Z.sharedFolder&&!Z.remoteFolder)t(2,v=Z.currentRelay),t(1,m=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,p=Z.component);else if(Z.sharedFolder&&d.has(Z.sharedFolder)){t(2,v=Z.currentRelay),t(1,m=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,p=Z.component);break}else if(Z.remoteFolder){t(2,v=Z.currentRelay),t(1,m=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,p=Z.component);break}else if(Z.currentRelay&&a.relays.get(Z.currentRelay.id)){t(2,v=Z.currentRelay),t(1,m=Z.sharedFolder),t(3,g=Z.remoteFolder),t(20,p=Z.component);break}Z=I.pop()}else t(2,v=void 0),t(1,m=void 0),t(3,g=void 0),t(20,p=Po)}function M(te){I.length=0,L()}function $(te){t(2,v=te.detail.relay),t(20,p=mi)}function W(){var te;!((te=n.networkStatus.status)===null||te===void 0)&&te.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let O=()=>{var te,Z;(te=n.networkStatus.status)!=null&&te.versions?W():(Z=n.networkStatus.status)!=null&&Z.link&&window.open(n.networkStatus.status.link)},N=()=>{var te,Z;(te=n.networkStatus.status)!=null&&te.versions?W():(Z=n.networkStatus.status)!=null&&Z.link&&window.open(n.networkStatus.status.link)};return o.$$set=te=>{"plugin"in te&&t(0,n=te.plugin),"path"in te&&t(18,s=te.path),"close"in te&&t(19,L=te.close)},o.$$.update=()=>{o.$$.dirty&262144&&s&&k(s),o.$$.dirty&2097156&&v&&!r.has(v.id)&&(t(2,v=void 0),t(20,p=Po)),o.$$.dirty&2&&m&&!d.has(m)&&(t(1,m=void 0),t(3,g=void 0),t(20,p=Po)),o.$$.dirty&1048590&&(p||v||m||g)&&setTimeout(()=>{let te=document.querySelector(".vertical-tab-content");te&&(te.scrollTop=0)},0)},[n,m,v,g,a,l,c,u,f,d,C,T,A,E,P,M,$,W,s,L,p,r,O,N]}var yh=class extends G{constructor(e){super(),J(this,e,PD,ED,K,{plugin:0,path:18,close:19},SD)}},_x=yh;var au=class extends wx.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;this.targetEl=e.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new _x({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(e){var t;(t=this.component)==null||t.$set({path:e})}hide(){var e;try{(e=this.component)==null||e.$destroy()}catch(t){console.warn(t)}}destroy(){this.hide(),this.plugin=null}};var Tx=require("obsidian");function DD(o){Ce(o,"svelte-74c8lg",".endpoint-config-modal.svelte-74c8lg.svelte-74c8lg{padding:0}.tenant-list-section.svelte-74c8lg.svelte-74c8lg{margin:16px 0}.tenant-card.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.tenant-card.svelte-74c8lg.svelte-74c8lg:hover{background:var(--background-modifier-hover)}.tenant-card.active.svelte-74c8lg.svelte-74c8lg{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.tenant-info.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:12px;flex:1}.tenant-logo.svelte-74c8lg.svelte-74c8lg{width:4em;height:4em;object-fit:contain;border-radius:4px;background:var(--background-secondary);padding:4px}.tenant-details.svelte-74c8lg.svelte-74c8lg{flex:1}.tenant-name.svelte-74c8lg.svelte-74c8lg{font-weight:500;color:var(--text-normal);margin-bottom:2px}.tenant-url.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.tenant-env.svelte-74c8lg.svelte-74c8lg{font-size:0.8em;color:var(--text-faint);text-transform:capitalize}.tenant-actions.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:8px}.add-tenant-container.svelte-74c8lg.svelte-74c8lg{display:flex;gap:8px;align-items:center}.endpoint-url-input.svelte-74c8lg.svelte-74c8lg{flex:1;padding:6px 12px;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);color:var(--text-normal)}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg{border-color:var(--text-error) !important;box-shadow:0 0 0 1px var(--text-error) !important;transition:border-color 0.3s ease, box-shadow 0.3s ease}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg:focus{border-color:var(--text-error) !important;box-shadow:0 0 0 2px var(--text-error) !important}.add-tenant-container.svelte-74c8lg button.mod-cta.svelte-74c8lg{background:var(--interactive-accent);color:var(--text-on-accent);padding:6px 12px;white-space:nowrap}.error-banner.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;justify-content:space-between;margin:12px 0;padding:10px 12px;background-color:rgba(255, 0, 0, 0.1);color:var(--text-normal);border:1px solid rgba(255, 0, 0, 0.3);border-radius:var(--radius-s);animation:svelte-74c8lg-error-slide-in 0.3s ease-out}.error-content.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;gap:8px;flex:1}.error-icon.svelte-74c8lg.svelte-74c8lg{font-size:1em;line-height:1.2;margin-top:2px}.error-text.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;line-height:1.4;color:var(--text-normal)}.error-dismiss.svelte-74c8lg.svelte-74c8lg{background:none;border:none;color:var(--text-muted);font-size:1.2em;font-weight:normal;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s ease;opacity:0.6}.error-dismiss.svelte-74c8lg.svelte-74c8lg:hover{opacity:1}@keyframes svelte-74c8lg-error-slide-in{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}.apply-section.svelte-74c8lg.svelte-74c8lg{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--background-modifier-border)}.apply-btn.svelte-74c8lg.svelte-74c8lg{padding:8px 20px;font-size:0.9em}")}function xx(o,e,t){let r=o.slice();return r[32]=e[t],r}function RD(o){let e,t,r,n,s,i=o[5]?"Adding...":"Add Tenant",a,l,c,u;return{c(){e=_("div"),t=_("input"),n=F(),s=_("button"),a=B(i),h(t,"type","text"),h(t,"placeholder","https://auth.example.com"),h(t,"class","endpoint-url-input svelte-74c8lg"),h(t,"title",r=o[6].error),Me(t,"endpoint-input-invalid",!o[6].isValid||o[2]),h(s,"class","mod-cta svelte-74c8lg"),s.disabled=l=o[5]||!o[0].trim()||!o[6].isValid,h(e,"class","add-tenant-container svelte-74c8lg")},m(f,d){x(f,e,d),y(e,t),Ye(t,o[0]),y(e,n),y(e,s),y(s,a),c||(u=[V(t,"input",o[20]),V(s,"click",o[12])],c=!0)},p(f,d){d[0]&64&&r!==(r=f[6].error)&&h(t,"title",r),d[0]&1&&t.value!==f[0]&&Ye(t,f[0]),d[0]&68&&Me(t,"endpoint-input-invalid",!f[6].isValid||f[2]),d[0]&32&&i!==(i=f[5]?"Adding...":"Add Tenant")&&Y(a,i),d[0]&97&&l!==(l=f[5]||!f[0].trim()||!f[6].isValid)&&(s.disabled=l)},d(f){f&&w(e),c=!1,ve(u)}}}function Sx(o){let e,t,r,n,s,i,a,l,c,u;return{c(){e=_("div"),t=_("div"),r=_("span"),r.textContent="\u26A0\uFE0F",n=F(),s=_("span"),i=B(o[1]),a=F(),l=_("button"),l.textContent="\xD7",h(r,"class","error-icon svelte-74c8lg"),h(s,"class","error-text svelte-74c8lg"),h(t,"class","error-content svelte-74c8lg"),h(l,"class","error-dismiss svelte-74c8lg"),h(l,"title","Dismiss error"),h(e,"class","error-banner svelte-74c8lg")},m(f,d){x(f,e,d),y(e,t),y(t,r),y(t,n),y(t,s),y(s,i),y(e,a),y(e,l),c||(u=V(l,"click",o[11]),c=!0)},p(f,d){d[0]&2&&Y(i,f[1])},d(f){f&&w(e),c=!1,u()}}}function kx(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[8].logo)||h(e,"src",t),h(e,"alt",r=o[8].customer||"Default Tenant"),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){x(n,e,s)},p(n,s){s[0]&256&&!dr(e.src,t=n[8].logo)&&h(e,"src",t),s[0]&256&&r!==(r=n[8].customer||"Default Tenant")&&h(e,"alt",r)},d(n){n&&w(e)}}}function Ix(o){let e,t,r;return{c(){e=_("img"),dr(e.src,t=o[32].logo)||h(e,"src",t),h(e,"alt",r=o[32].name),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){x(n,e,s)},p(n,s){s[0]&16&&!dr(e.src,t=n[32].logo)&&h(e,"src",t),s[0]&16&&r!==(r=n[32].name)&&h(e,"alt",r)},d(n){n&&w(e)}}}function Cx(o){let e,t=o[32].environment+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","tenant-env svelte-74c8lg")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&16&&t!==(t=n[32].environment+"")&&Y(r,t)},d(n){n&&w(e)}}}function Lx(o,e){let t,r,n,s,i,a=e[32].name+"",l,c,u,f=e[32].tenantUrl+"",d,m,p,v,g,I,L,k,C=e[32].logo&&Ix(e),T=e[32].environment&&Cx(e);function A(){return e[22](e[32])}function E(){return e[23](e[32])}function P(...M){return e[24](e[32],...M)}return{key:o,first:null,c(){t=_("div"),r=_("div"),C&&C.c(),n=F(),s=_("div"),i=_("div"),l=B(a),c=F(),u=_("div"),d=B(f),m=F(),T&&T.c(),p=F(),v=_("div"),g=_("button"),g.textContent="Remove",I=F(),h(i,"class","tenant-name svelte-74c8lg"),h(u,"class","tenant-url svelte-74c8lg"),h(s,"class","tenant-details svelte-74c8lg"),h(r,"class","tenant-info svelte-74c8lg"),h(g,"class","mod-destructive"),h(g,"title","Remove this tenant"),h(v,"class","tenant-actions svelte-74c8lg"),h(t,"class","tenant-card svelte-74c8lg"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to switch to this tenant"),Me(t,"active",e[32].id===e[3]),this.first=t},m(M,$){x(M,t,$),y(t,r),C&&C.m(r,null),y(r,n),y(r,s),y(s,i),y(i,l),y(s,c),y(s,u),y(u,d),y(s,m),T&&T.m(s,null),y(t,p),y(t,v),y(v,g),y(t,I),L||(k=[V(g,"click",hc(A)),V(t,"click",E),V(t,"keydown",P)],L=!0)},p(M,$){e=M,e[32].logo?C?C.p(e,$):(C=Ix(e),C.c(),C.m(r,n)):C&&(C.d(1),C=null),$[0]&16&&a!==(a=e[32].name+"")&&Y(l,a),$[0]&16&&f!==(f=e[32].tenantUrl+"")&&Y(d,f),e[32].environment?T?T.p(e,$):(T=Cx(e),T.c(),T.m(s,null)):T&&(T.d(1),T=null),$[0]&24&&Me(t,"active",e[32].id===e[3])},d(M){M&&w(t),C&&C.d(),T&&T.d(),L=!1,ve(k)}}}function UD(o){var re,de,Le;let e,t,r,n,s,i=o[1]&&o[1].trim(),a,l,c,u,f,d,m,p,v,g,I=(((re=o[8])==null?void 0:re.customer)||"Default Tenant")+"",L,k,C,T,A,E=(((de=o[8])==null?void 0:de.environment)||o[10].environment)+"",P,M,$,W,O=[],N=new Map,te,Z,Q,ye,z,q;n=new Ue({props:{name:"Add Enterprise Tenant",description:"Enter your organization's tenant URL",$$slots:{default:[RD]},$$scope:{ctx:o}}});let X=i&&Sx(o),fe=((Le=o[8])==null?void 0:Le.logo)&&kx(o),j=he(o[4]),ee=pe=>pe[32].id;for(let pe=0;pe<j.length;pe+=1){let Ee=xx(o,j,pe),Oe=ee(Ee);N.set(Oe,O[pe]=Lx(Oe,Ee))}return{c(){e=_("div"),t=_("div"),t.innerHTML="<p>Manage your organization&#39;s enterprise Relay tenants. Add tenants to switch between different enterprise deployments.</p>",r=F(),U(n.$$.fragment),s=F(),X&&X.c(),a=F(),l=_("div"),c=_("div"),c.textContent="Available Tenants",u=F(),f=_("div"),d=_("div"),m=_("div"),fe&&fe.c(),p=F(),v=_("div"),g=_("div"),L=B(I),k=F(),C=_("div"),C.textContent=`${o[10].authUrl}`,T=F(),A=_("div"),P=B(E),M=F(),$=_("div"),$.innerHTML="",W=F();for(let pe=0;pe<O.length;pe+=1)O[pe].c();te=F(),Z=_("div"),Q=_("button"),Q.textContent="Apply",h(t,"class","setting-item-description"),ae(t,"margin-bottom","16px"),h(c,"class","setting-item-name"),h(g,"class","tenant-name svelte-74c8lg"),h(C,"class","tenant-url svelte-74c8lg"),h(A,"class","tenant-env svelte-74c8lg"),h(v,"class","tenant-details svelte-74c8lg"),h(m,"class","tenant-info svelte-74c8lg"),h($,"class","tenant-actions svelte-74c8lg"),h(d,"class","tenant-card svelte-74c8lg"),h(d,"role","button"),h(d,"tabindex","0"),h(d,"title","Click to use default tenant"),Me(d,"active",!o[3]),h(f,"class","tenant-list"),h(l,"class","tenant-list-section svelte-74c8lg"),h(Q,"class","mod-cta apply-btn svelte-74c8lg"),h(Z,"class","apply-section svelte-74c8lg"),h(e,"class","endpoint-config-modal svelte-74c8lg")},m(pe,Ee){x(pe,e,Ee),y(e,t),y(e,r),D(n,e,null),y(e,s),X&&X.m(e,null),y(e,a),y(e,l),y(l,c),y(l,u),y(l,f),y(f,d),y(d,m),fe&&fe.m(m,null),y(m,p),y(m,v),y(v,g),y(g,L),y(v,k),y(v,C),y(v,T),y(v,A),y(A,P),y(d,M),y(d,$),y(f,W);for(let Oe=0;Oe<O.length;Oe+=1)O[Oe]&&O[Oe].m(f,null);y(e,te),y(e,Z),y(Z,Q),ye=!0,z||(q=[V(d,"click",o[15]),V(d,"keydown",o[21]),V(Q,"click",o[25])],z=!0)},p(pe,Ee){var Te,nt,ct;let Oe={};Ee[0]&101|Ee[1]&16&&(Oe.$$scope={dirty:Ee,ctx:pe}),n.$set(Oe),Ee[0]&2&&(i=pe[1]&&pe[1].trim()),i?X?X.p(pe,Ee):(X=Sx(pe),X.c(),X.m(e,a)):X&&(X.d(1),X=null),(Te=pe[8])!=null&&Te.logo?fe?fe.p(pe,Ee):(fe=kx(pe),fe.c(),fe.m(m,p)):fe&&(fe.d(1),fe=null),(!ye||Ee[0]&256)&&I!==(I=(((nt=pe[8])==null?void 0:nt.customer)||"Default Tenant")+"")&&Y(L,I),(!ye||Ee[0]&256)&&E!==(E=(((ct=pe[8])==null?void 0:ct.environment)||pe[10].environment)+"")&&Y(P,E),(!ye||Ee[0]&8)&&Me(d,"active",!pe[3]),Ee[0]&24600&&(j=he(pe[4]),O=mr(O,Ee,ee,1,pe,j,N,f,si,Lx,null,xx))},i(pe){ye||(b(n.$$.fragment,pe),ye=!0)},o(pe){S(n.$$.fragment,pe),ye=!1},d(pe){pe&&w(e),R(n),X&&X.d(),fe&&fe.d();for(let Ee=0;Ee<O.length;Ee+=1)O[Ee].d();z=!1,ve(q)}}}function OD(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=et(),u="",f=!1,d={isValid:!0,error:""},m="",p=!1,v="",g=!1,I=0,L=l.loginManager.getEndpointManager().getDefaultUrls(),k=null;function C(){t(18,I++,I)}function T(){t(1,m=""),t(2,p=!1)}function A(q){if(!q.trim())return{isValid:!0,error:""};try{let X=new URL(q);if(l.loginManager.getEndpointManager().isStaging()){if(X.protocol!=="https:"&&X.protocol!=="http:")return{isValid:!1,error:"Only HTTP and HTTPS URLs are allowed in development"}}else if(X.protocol!=="https:")return{isValid:!1,error:"Only HTTPS URLs are allowed in production"};return X.hostname.length<3?{isValid:!1,error:"Invalid hostname"}:{isValid:!0,error:""}}catch(X){return{isValid:!1,error:"Invalid URL format"}}}function E(){return Ae(this,void 0,void 0,function*(){if(u.trim()&&d.isValid){t(5,f=!0);try{let q=yield l.loginManager.getEndpointManager().addTenant(u);q.success?(t(0,u=""),t(1,m=""),t(2,p=!1),C(),t(7,g=!0),q.tenantId&&(yield P(q.tenantId))):(console.log("Add tenant failed with error:",q.error),t(1,m=q.error||"Failed to add tenant"),t(2,p=!0),C())}catch(q){let X=q instanceof Error?q.message:"Unknown error occurred";t(1,m=`Error adding tenant: ${X}`),t(2,p=!0)}finally{t(5,f=!1)}}})}function P(q){return Ae(this,void 0,void 0,function*(){try{let X=yield l.loginManager.getEndpointManager().switchToTenant(q);X.success?(t(7,g=!0),C()):t(1,m=X.error||"Failed to switch tenant")}catch(X){let fe=X instanceof Error?X.message:"Unknown error occurred";t(1,m=`Error switching tenant: ${fe}`)}})}function M(q){return Ae(this,void 0,void 0,function*(){try{(yield l.loginManager.getEndpointManager().removeTenant(q))?(t(7,g=!0),C()):t(1,m="Failed to remove tenant")}catch(X){let fe=X instanceof Error?X.message:"Unknown error occurred";t(1,m=`Error removing tenant: ${fe}`)}})}function $(){return Ae(this,void 0,void 0,function*(){yield l.endpointSettings.update(q=>Object.assign(Object.assign({},q),{activeTenantId:void 0})),l.loginManager.getEndpointManager().clearValidatedEndpoints(),t(7,g=!0),C()})}function W(){return Ae(this,void 0,void 0,function*(){try{return yield l.loginManager.getEndpointManager().getCustomerInfo()}catch(q){return null}})}function O(){return Ae(this,void 0,void 0,function*(){try{let q=l.loginManager.getEndpointManager();t(8,k=yield q.getDefaultTenantInfo())}catch(q){console.log("Failed to load default tenant info:",q),t(8,k=null)}})}it(()=>{O()});function N(){u=this.value,t(0,u)}let te=q=>q.key==="Enter"||q.key===" "?$():null,Z=q=>M(q.id),Q=q=>P(q.id),ye=(q,X)=>X.key==="Enter"||X.key===" "?P(q.id):null,z=()=>{c(g?"apply":"close")};return o.$$set=q=>{"plugin"in q&&t(16,l=q.plugin)},o.$$.update=()=>{o.$$.dirty[0]&327680&&t(19,r=l.endpointSettings.get()),o.$$.dirty[0]&524288&&t(4,n=r.tenants||[]),o.$$.dirty[0]&524288&&t(3,s=r.activeTenantId),o.$$.dirty[0]&24&&(i=n.find(q=>q.id===s)),o.$$.dirty[0]&65536&&(a=l.loginManager.getEndpointManager().hasValidatedEndpoints()),o.$$.dirty[0]&131079&&(t(6,d=A(u)),u!==v&&v!==""&&(p&&t(2,p=!1),m&&t(1,m="")),t(17,v=u))},[u,m,p,s,n,f,d,g,k,c,L,T,E,P,M,$,l,v,I,r,N,te,Z,Q,ye,z]}var vh=class extends G{constructor(e){super(),J(this,e,OD,UD,K,{plugin:16},DD,[-1,-1])}},Mx=vh;var lu=class extends Tx.Modal{constructor(t,r,n){super(t);this.plugin=r;this.reload=n;this.setTitle("Enterprise Tenant Configuration")}onOpen(){let{contentEl:t}=this;this.component=new Mx({target:t,props:{plugin:this.plugin,reload:this.reload}}),this.component.$on("close",()=>{this.close()}),this.component.$on("apply",()=>{this.close(),setTimeout(()=>{this.reload()},100)})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var h0=require("obsidian");var Dx=require("obsidian");var Ex=require("obsidian");function ND(o){Ce(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Ax(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Fx(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",u,f,d,m,p,v,g,I,L,k,C,T;function A(){return o[6](o[8])}function E(){return o[7](o[8])}return{c(){e=_("div"),t=_("div"),r=_("div"),s=B(n),i=F(),a=_("div"),l=B("Toggle "),u=B(c),f=B(" on or off"),d=F(),m=_("div"),p=_("div"),v=_("input"),I=F(),L=_("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(v,"type","checkbox"),h(v,"tabindex","-1"),v.checked=g=o[9],h(L,"class","checkbox-toggle"),h(p,"role","checkbox"),h(p,"aria-checked",k=o[9]),h(p,"tabindex","0"),h(p,"class","checkbox-container svelte-4kkvmr"),Me(p,"is-enabled",o[9]),h(m,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(P,M){x(P,e,M),y(e,t),y(t,r),y(r,s),y(t,i),y(t,a),y(a,l),y(a,u),y(a,f),y(e,d),y(e,m),y(m,p),y(p,v),y(p,I),y(p,L),C||(T=[V(p,"keypress",A),V(p,"click",E)],C=!0)},p(P,M){o=P,M&2&&n!==(n=o[8]+"")&&Y(s,n),M&2&&c!==(c=o[8]+"")&&Y(u,c),M&2&&g!==(g=o[9])&&(v.checked=g),M&2&&k!==(k=o[9])&&h(p,"aria-checked",k),M&2&&Me(p,"is-enabled",o[9])},d(P){P&&w(e),C=!1,ve(T)}}}function $D(o){let e,t,r,n,s,i,a,l,c,u=he(Object.entries(o[1]).filter(o[5]).sort()),f=[];for(let d=0;d<u.length;d+=1)f[d]=Fx(Ax(o,u,d));return{c(){e=_("div"),t=_("h2"),t.textContent="Feature Flags",r=F();for(let d=0;d<f.length;d+=1)f[d].c();n=F(),s=_("div"),i=_("div"),a=_("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,m){x(d,e,m),y(e,t),y(e,r);for(let p=0;p<f.length;p+=1)f[p]&&f[p].m(e,null);y(e,n),y(e,s),y(s,i),y(i,a),l||(c=[V(a,"click",function(){Je(o[0])&&o[0].apply(this,arguments)}),V(a,"keypress",function(){Je(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[m]){if(o=d,m&10){u=he(Object.entries(o[1]).filter(o[5]).sort());let p;for(p=0;p<u.length;p+=1){let v=Ax(o,u,p);f[p]?f[p].p(v,m):(f[p]=Fx(v),f[p].c(),f[p].m(e,n))}for(;p<f.length;p+=1)f[p].d(1);f.length=u.length}},i:H,o:H,d(d){d&&w(e),je(f,d),l=!1,ve(c)}}}function BD(o,e,t){let r,n,{reload:s}=e,i=lr.getInstance();le(o,i,f=>t(4,n=f));function a(f){let d=!r[f];t(1,r[f]=d,r),i.setFlag(f,r[f])}it(()=>{Object.keys(r).forEach(f=>{let d=document.getElementById(`toggle-${f}`);d&&(0,Ex.setIcon)(d,"check")})});let l=([f,d])=>kl(f),c=f=>{if(!kl(f))throw new Error("Unexpected feature flag!");a(f)},u=f=>{if(!kl(f))throw new Error("Unexpected feature flag!");a(f)};return o.$$set=f=>{"reload"in f&&t(0,s=f.reload)},o.$$.update=()=>{o.$$.dirty&16&&t(1,r=Object.assign({},n.flags))},[s,r,i,a,n,l,c,u]}var bh=class extends G{constructor(e){super(),J(this,e,BD,$D,K,{reload:0},ND)}},Px=bh;var cu=class extends Dx.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Px({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var jx=require("obsidian");var Hx=require("obsidian");function Rx(o,e,t){let r=o.slice();return r[13]=e[t],r}function Ux(o,e,t){let r=o.slice();return r[16]=e[t],r}function VD(o){let e,t,r;return{c(){e=_("button"),e.textContent="Refresh"},m(n,s){x(n,e,s),t||(r=V(e,"click",(0,Hx.debounce)(o[12])),t=!0)},p:H,d(n){n&&w(e),t=!1,r()}}}function HD(o){let e=navigator.userAgent+"",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p:H,d(r){r&&w(t)}}}function qD(o){let e;return{c(){e=B(o[1])},m(t,r){x(t,e,r)},p(t,r){r&2&&Y(e,t[1])},d(t){t&&w(e)}}}function jD(o){let e;return{c(){e=B(o[2])},m(t,r){x(t,e,r)},p(t,r){r&4&&Y(e,t[2])},d(t){t&&w(e)}}}function zD(o){let e;return{c(){e=B(o[3])},m(t,r){x(t,e,r)},p(t,r){r&8&&Y(e,t[3])},d(t){t&&w(e)}}}function WD(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=B(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&Y(t,e)},d(r){r&&w(t)}}}function Ox(o){let e,t=`${o[16]}`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&Y(r,t)},d(s){s&&w(e)}}}function KD(o){let e,t=he(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=Ox(Ux(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=he(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=Ux(n,t,i);r[i]?r[i].p(a,s):(r[i]=Ox(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function Nx(o){let e,t=`${o[13]}`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&Y(r,t)},d(s){s&&w(e)}}}function GD(o){let e,t=he(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Nx(Rx(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=he(n[5]);let i;for(i=0;i<t.length;i+=1){let a=Rx(n,t,i);r[i]?r[i].p(a,s):(r[i]=Nx(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function JD(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v,g,I,L,k,C,T,A,E;return n=new ze({props:{name:"Environment",$$slots:{default:[VD]},$$scope:{ctx:o}}}),i=new Ue({props:{name:"User Agent",description:"",$$slots:{default:[HD]},$$scope:{ctx:o}}}),l=new Ue({props:{name:"Fetch",description:"",$$slots:{default:[qD]},$$scope:{ctx:o}}}),u=new Ue({props:{name:"Response",description:"",$$slots:{default:[jD]},$$scope:{ctx:o}}}),d=new Ue({props:{name:"Blink Fetch",description:"",$$slots:{default:[zD]},$$scope:{ctx:o}}}),p=new Ue({props:{name:"Startup Time",description:"",$$slots:{default:[WD]},$$scope:{ctx:o}}}),g=new ze({props:{name:"Connections"}}),L=new Ue({props:{name:"",description:"",$$slots:{description:[KD]},$$scope:{ctx:o}}}),C=new ze({props:{name:"Log Files"}}),A=new Ue({props:{name:"",description:"",$$slots:{description:[GD]},$$scope:{ctx:o}}}),{c(){e=_("div"),e.textContent="Debug Info",t=F(),r=_("div"),U(n.$$.fragment),s=F(),U(i.$$.fragment),a=F(),U(l.$$.fragment),c=F(),U(u.$$.fragment),f=F(),U(d.$$.fragment),m=F(),U(p.$$.fragment),v=F(),U(g.$$.fragment),I=F(),U(L.$$.fragment),k=F(),U(C.$$.fragment),T=F(),U(A.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(P,M){x(P,e,M),x(P,t,M),x(P,r,M),D(n,r,null),y(r,s),D(i,r,null),y(r,a),D(l,r,null),y(r,c),D(u,r,null),y(r,f),D(d,r,null),y(r,m),D(p,r,null),y(r,v),D(g,r,null),y(r,I),D(L,r,null),y(r,k),D(C,r,null),y(r,T),D(A,r,null),E=!0},p(P,[M]){let $={};M&524288&&($.$$scope={dirty:M,ctx:P}),n.$set($);let W={};M&524288&&(W.$$scope={dirty:M,ctx:P}),i.$set(W);let O={};M&524290&&(O.$$scope={dirty:M,ctx:P}),l.$set(O);let N={};M&524292&&(N.$$scope={dirty:M,ctx:P}),u.$set(N);let te={};M&524296&&(te.$$scope={dirty:M,ctx:P}),d.$set(te);let Z={};M&524289&&(Z.$$scope={dirty:M,ctx:P}),p.$set(Z);let Q={};M&524304&&(Q.$$scope={dirty:M,ctx:P}),L.$set(Q);let ye={};M&524320&&(ye.$$scope={dirty:M,ctx:P}),A.$set(ye)},i(P){E||(b(n.$$.fragment,P),b(i.$$.fragment,P),b(l.$$.fragment,P),b(u.$$.fragment,P),b(d.$$.fragment,P),b(p.$$.fragment,P),b(g.$$.fragment,P),b(L.$$.fragment,P),b(C.$$.fragment,P),b(A.$$.fragment,P),E=!0)},o(P){S(n.$$.fragment,P),S(i.$$.fragment,P),S(l.$$.fragment,P),S(u.$$.fragment,P),S(d.$$.fragment,P),S(p.$$.fragment,P),S(g.$$.fragment,P),S(L.$$.fragment,P),S(C.$$.fragment,P),S(A.$$.fragment,P),E=!1},d(P){P&&(w(e),w(t),w(r)),R(n),R(i),R(l),R(u),R(d),R(p),R(g),R(L),R(C),R(A)}}}function $x(){try{return Response.toString()}catch(o){return"undefined"}}function Bx(){try{return fetch.toString()}catch(o){return"undefined"}}function Vx(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function YD(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=Ie($x());le(o,c,g=>t(2,n=g));let u=Ie(Bx());le(o,u,g=>t(1,r=g));let f=Ie(Vx());le(o,f,g=>t(3,s=g));let d=Ie(l.loginManager.pb);le(o,d,g=>t(4,i=g));let m=Ie([]);le(o,m,g=>t(5,a=g)),_l().then(g=>{m.set(g)});function p(){c.set($x()),u.set(Bx()),f.set(Vx()),d.set(l.loginManager.pb)}let v=()=>{p()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,u,f,d,m,p,v]}var _h=class extends G{constructor(e){super(),J(this,e,YD,JD,K,{plugin:0})}},qx=_h;var uu=class extends jx.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new qx({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var zx=require("obsidian"),fu=class{notify(e){new zx.Notice(e)}},du=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var e1=require("obsidian");var Zx=require("obsidian");function QD(o){Ce(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function Wx(o,e,t){let r=o.slice();return r[21]=e[t],r}function ZD(o){let e,t,r,n,s,i,a,l,c,u,f,d,m;r=new Ue({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new Ue({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[tR]},$$scope:{ctx:o}}});let p=o[4]&&Kx(o);return u=new Ue({props:{name:"",description:"",$$slots:{default:[oR]},$$scope:{ctx:o}}}),{c(){e=_("div"),t=_("div"),U(r.$$.fragment),n=F(),s=_("textarea"),i=F(),U(a.$$.fragment),l=F(),p&&p.c(),c=F(),U(u.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(v,g){x(v,e,g),y(e,t),D(r,t,null),y(t,n),y(t,s),Ye(s,o[3]),y(t,i),D(a,t,null),y(t,l),p&&p.m(t,null),y(e,c),D(u,e,null),f=!0,d||(m=V(s,"input",o[13]),d=!0)},p(v,g){g&8&&Ye(s,v[3]);let I={};g&16777232&&(I.$$scope={dirty:g,ctx:v}),a.$set(I),v[4]?p?(p.p(v,g),g&16&&b(p,1)):(p=Kx(v),p.c(),b(p,1),p.m(t,null)):p&&(oe(),S(p,1,1,()=>{p=null}),ne());let L={};g&16777293&&(L.$$scope={dirty:g,ctx:v}),u.$set(L)},i(v){f||(b(r.$$.fragment,v),b(a.$$.fragment,v),b(p),b(u.$$.fragment,v),f=!0)},o(v){S(r.$$.fragment,v),S(a.$$.fragment,v),S(p),S(u.$$.fragment,v),f=!1},d(v){v&&w(e),R(r),R(a),p&&p.d(),R(u),d=!1,m()}}}function XD(o){let e;return{c(){e=_("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function eR(o){let e,t,r;return t=new Ue({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=_("div"),U(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){x(n,e,s),D(t,e,null),r=!0},p:H,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){S(t.$$.fragment,n),r=!1},d(n){n&&w(e),R(t)}}}function tR(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Me(e,"is-enabled",o[4])},m(a,l){x(a,e,l),y(e,t),y(e,r),y(e,n),s||(i=[V(e,"keypress",sR),V(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Me(e,"is-enabled",a[4])},d(a){a&&w(e),s=!1,ve(i)}}}function Kx(o){let e,t;return e=new Ue({props:{name:"Logs",description:"",$$slots:{description:[rR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Gx(o){let e,t=`${o[21]}
`,r,n;return{c(){e=_("div"),r=B(t),n=F()},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&Y(r,t)},d(s){s&&w(e)}}}function rR(o){let e,t=he(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Gx(Wx(o,t,n));return{c(){e=_("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=he(n[5]);let i;for(i=0;i<t.length;i+=1){let a=Wx(n,t,i);r[i]?r[i].p(a,s):(r[i]=Gx(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function oR(o){let e,t,r,n;return{c(){e=_("button"),t=B("Send"),e.disabled=o[2]},m(s,i){x(s,e,i),y(e,t),r||(n=V(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&w(e),r=!1,n()}}}function nR(o){let e,t,r,n,s,i,a=[eR,XD,ZD],l=[];function c(u,f){return u[1]?0:u[2]&&!u[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=_("div"),e.textContent="Send Bug Report",t=F(),r=_("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,f){x(u,e,f),x(u,t,f),x(u,r,f),l[n].m(r,null),i=!0},p(u,[f]){let d=n;n=c(u,f),n===d?l[n].p(u,f):(oe(),S(l[d],1,1,()=>{l[d]=null}),ne(),s=l[n],s?s.p(u,f):(s=l[n]=a[n](u),s.c()),b(s,1),s.m(r,null))},i(u){i||(b(s),i=!0)},o(u){S(s),i=!1},d(u){u&&(w(e),w(t),w(r)),l[n].d()}}}function Jx(){try{return Response.toString()}catch(o){return"undefined"}}function Yx(){try{return fetch.toString()}catch(o){return"undefined"}}function Qx(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var sR=()=>{};function iR(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,u=Ie(Jx()),f=Ie(Yx()),d=Ie(Qx()),m=Ie("");le(o,m,P=>t(3,s=P));let p=Ie(!1);le(o,p,P=>t(4,i=P));let v=Ie(!1),g=Ie(!1);le(o,g,P=>t(2,n=P));let I=Ie(!1);le(o,I,P=>t(1,r=P));let L=Ie(c.loginManager.pb);le(o,L,P=>t(6,l=P));let k=Ie([]);le(o,k,P=>t(5,a=P)),_l().then(P=>{k.set(P)});function C(){u.set(Jx()),f.set(Yx()),d.set(Qx()),L.set(c.loginManager.pb)}function T(){s=this.value,m.set(s)}let A=()=>{let P=!i;p.set(P)},E=async()=>{var M;let P=`Bug Report

`;if(P+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(M=l==null?void 0:l.authStore.model)==null?void 0:M.id,loadTime:c.loadTime,description:s},null,2),P+=`

`,p){let $=await Gy();P+=$}(0,Zx.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:P,headers:{"Content-Type":"text/plain"}}).then(()=>{I.set(!0)}),g.set(!0)};return o.$$set=P=>{"plugin"in P&&t(0,c=P.plugin)},[c,r,n,s,i,a,l,m,p,g,I,L,k,T,A,E]}var wh=class extends G{constructor(e){super(),J(this,e,iR,nR,K,{plugin:0},QD)}},Xx=wh;var pu=class extends e1.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Xx({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var c1=require("obsidian");async function t1(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,u=0;for(let f of n)if(f.name){try{let d=await new Promise((m,p)=>{let v=indexedDB.open(f.name);v.onerror=()=>p(v.error),v.onsuccess=g=>m(g.target.result)});try{let m=Array.from(d.objectStoreNames);if(!m.includes("updates")||!m.includes("custom"))continue;let p=d.transaction(["updates","custom"],"readonly"),v=p.objectStore("updates"),g=p.objectStore("custom"),I=await new Promise(k=>{let C=g.get("appId");C.onsuccess=()=>k(C.result||"")});a++;let L=await new Promise((k,C)=>{let T=v.count();T.onsuccess=()=>k(T.result),T.onerror=()=>C(T.error)});if(l+=L,L>0){let k=0;if(await new Promise((C,T)=>{let A=v.openCursor();A.onsuccess=E=>{let P=E.target.result;if(P){let M=P.value instanceof Uint8Array?P.value.byteLength:JSON.stringify(P.value).length;k+=M,P.continue()}else C()},A.onerror=()=>T(A.error)}),c+=k,k>1024*1024&&(!t||I===e)){let C=await new Promise(E=>{let P=g.get("path");P.onsuccess=()=>E(P.result||"")}),T=await new Promise(E=>{let P=g.get("relay");P.onsuccess=()=>E(P.result||"")}),A=!f.name.startsWith(`${e}-relay`);i.push({slug:`${f.name}/${v.name}`,path:C,relay:T,appId:I||"unknown",count:L,estimatedSizeMB:Math.round(k/(1024*1024)*100)/100,isLegacy:A})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${f.name}:`,d);continue}u++,r&&r(u/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((f,d)=>d.estimatedSizeMB-f.estimatedSizeMB)}}async function r1(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var gne=require("obsidian");function aR(o){Ce(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function o1(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function n1(o,e,t){let r=o.slice();return r[22]=e[t],r}function lR(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,u,f,d,m,p,v=o[0].totalStores+"",g,I,L,k,C,T,A=o[0].totalItems.toLocaleString()+"",E,P,M,$,W,O,N=o[0].totalSizeMB.toFixed(2)+"",te,Z,Q,ye,z;function q(ee,re){if(ee[0].databaseCount>45e3)return dR;if(ee[0].databaseCount>4e4)return fR}let X=q(o,-1),fe=X&&X(o),j=o[0].largeStores.length>0&&s1(o);return{c(){e=_("div"),t=_("div"),r=_("div"),r.textContent="Global Database Limit",n=F(),s=_("div"),a=B(i),l=B(" / 50,000"),c=F(),fe&&fe.c(),u=F(),f=_("div"),d=_("div"),d.textContent="Relay Databases",m=F(),p=_("div"),g=B(v),I=F(),L=_("div"),k=_("div"),k.textContent="Document Updates",C=F(),T=_("div"),E=B(A),P=F(),M=_("div"),$=_("div"),$.textContent="Total Size",W=F(),O=_("div"),te=B(N),Z=B(" MB"),Q=F(),j&&j.c(),ye=me(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Me(s,"system3-warning",o[0].databaseCount>4e4),Me(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(p,"class","system3-stat-value svelte-1n3w4sk"),h(f,"class","system3-stat-item svelte-1n3w4sk"),h(k,"class","system3-stat-label svelte-1n3w4sk"),h(T,"class","system3-stat-value svelte-1n3w4sk"),h(L,"class","system3-stat-item svelte-1n3w4sk"),h($,"class","system3-stat-label svelte-1n3w4sk"),h(O,"class","system3-stat-value svelte-1n3w4sk"),h(M,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(ee,re){x(ee,e,re),y(e,t),y(t,r),y(t,n),y(t,s),y(s,a),y(s,l),y(t,c),fe&&fe.m(t,null),y(e,u),y(e,f),y(f,d),y(f,m),y(f,p),y(p,g),y(e,I),y(e,L),y(L,k),y(L,C),y(L,T),y(T,E),y(e,P),y(e,M),y(M,$),y(M,W),y(M,O),y(O,te),y(O,Z),x(ee,Q,re),j&&j.m(ee,re),x(ee,ye,re),z=!0},p(ee,re){(!z||re&1)&&i!==(i=ee[0].databaseCount.toLocaleString()+"")&&Y(a,i),(!z||re&1)&&Me(s,"system3-warning",ee[0].databaseCount>4e4),(!z||re&1)&&Me(s,"system3-critical",ee[0].databaseCount>45e3),X!==(X=q(ee,re))&&(fe&&fe.d(1),fe=X&&X(ee),fe&&(fe.c(),fe.m(t,null))),(!z||re&1)&&v!==(v=ee[0].totalStores+"")&&Y(g,v),(!z||re&1)&&A!==(A=ee[0].totalItems.toLocaleString()+"")&&Y(E,A),(!z||re&1)&&N!==(N=ee[0].totalSizeMB.toFixed(2)+"")&&Y(te,N),ee[0].largeStores.length>0?j?(j.p(ee,re),re&1&&b(j,1)):(j=s1(ee),j.c(),b(j,1),j.m(ye.parentNode,ye)):j&&(oe(),S(j,1,1,()=>{j=null}),ne())},i(ee){z||(b(j),z=!0)},o(ee){S(j),z=!1},d(ee){ee&&(w(e),w(Q),w(ye)),fe&&fe.d(),j&&j.d(ee)}}}function cR(o){let e,t;return{c(){e=_("div"),t=B(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n&32&&Y(t,r[5])},i:H,o:H,d(r){r&&w(e)}}}function uR(o){let e,t,r,n,s,i,a;return{c(){e=_("div"),t=_("div"),r=F(),n=_("div"),n.textContent="Analyzing Databases...",s=F(),i=_("div"),a=_("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),ae(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){x(l,e,c),y(e,t),y(e,r),y(e,n),y(e,s),y(e,i),y(i,a)},p(l,c){c&16&&ae(a,"width",l[4]+"%")},i:H,o:H,d(l){l&&w(e)}}}function fR(o){let e;return{c(){e=_("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function dR(o){let e;return{c(){e=_("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function s1(o){let e,t,r,n;e=new ze({props:{name:"Large Stores (>1MB)"}});let s=he(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=a1(o1(o,s,l));let a=l=>S(i[l],1,1,()=>{i[l]=null});return{c(){U(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=me()},m(l,c){D(e,l,c),x(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);x(l,r,c),n=!0},p(l,c){if(c&2052){s=he(l[2]);let u;for(u=0;u<s.length;u+=1){let f=o1(l,s,u);i[u]?(i[u].p(f,c),b(i[u],1)):(i[u]=a1(f),i[u].c(),b(i[u],1),i[u].m(r.parentNode,r))}for(oe(),u=s.length;u<i.length;u+=1)a(u);ne()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){S(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)S(i[c]);n=!1},d(l){l&&(w(t),w(r)),R(e,l),je(i,l)}}}function pR(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=_("div"),t=_("button"),t.textContent="Delete",r=F(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){x(a,e,l),y(e,t),x(a,r,l),n||(s=V(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(w(e),w(r)),n=!1,s()}}}function i1(o){let e,t;return e=new Ue({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[pR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function a1(o){let e,t,r,n;e=new ze({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=he(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=i1(n1(o,s,l));let a=l=>S(i[l],1,1,()=>{i[l]=null});return{c(){U(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=me()},m(l,c){D(e,l,c),x(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);x(l,r,c),n=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){s=he(l[19]);let f;for(f=0;f<s.length;f+=1){let d=n1(l,s,f);i[f]?(i[f].p(d,c),b(i[f],1)):(i[f]=i1(d),i[f].c(),b(i[f],1),i[f].m(r.parentNode,r))}for(oe(),f=s.length;f<i.length;f+=1)a(f);ne()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){S(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)S(i[c]);n=!1},d(l){l&&(w(t),w(r)),R(e,l),je(i,l)}}}function mR(o){let e,t,r,n,s,i,a,l,c,u,f,d,m,p,v,g,I,L=[uR,cR,lR],k=[];function C(T,A){return T[3]?0:T[5]?1:T[0]?2:-1}return~(m=C(o,-1))&&(p=k[m]=L[m](o)),{c(){e=_("div"),e.textContent="Relay database analysis",t=F(),r=_("div"),n=_("div"),s=_("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=F(),a=_("div"),l=_("div"),c=_("input"),u=F(),f=_("div"),d=F(),p&&p.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(f,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Me(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(T,A){x(T,e,A),x(T,t,A),x(T,r,A),y(r,n),y(n,s),y(n,i),y(n,a),y(a,l),y(l,c),y(l,u),y(l,f),y(r,d),~m&&k[m].m(r,null),v=!0,g||(I=[V(l,"keypress",o[15]),V(l,"click",o[16])],g=!0)},p(T,[A]){(!v||A&2)&&(c.checked=T[1]),(!v||A&2)&&h(l,"aria-checked",T[1]),(!v||A&2)&&Me(l,"is-enabled",T[1]);let E=m;m=C(T,A),m===E?~m&&k[m].p(T,A):(p&&(oe(),S(k[E],1,1,()=>{k[E]=null}),ne()),~m?(p=k[m],p?p.p(T,A):(p=k[m]=L[m](T),p.c()),b(p,1),p.m(r,null)):p=null)},i(T){v||(b(p),v=!0)},o(T){S(p),v=!1},d(T){T&&(w(e),w(t),w(r)),~m&&k[m].d(),g=!1,ve(I)}}}function hR(o,e,t){let r,n,s,i,a,l;var c;let{plugin:u}=e,f=Ie(!0);le(o,f,T=>t(3,i=T));let d=Ie(0);le(o,d,T=>t(4,a=T));let m=Ie(null);le(o,m,T=>t(0,s=T));let p=Ie(null);le(o,p,T=>t(5,l=T));let v=!1;function g(){return Ae(this,void 0,void 0,function*(){f.set(!0),p.set(null);try{let T=yield t1({appId:u.appId,filterByAppId:!v,onProgress:A=>d.set(A)});m.set(T)}catch(T){p.set(`Analysis failed: ${T.message}`)}finally{f.set(!1)}})}function I(T){return Ae(this,void 0,void 0,function*(){try{yield r1(T),s&&ei(m,s.largeStores=s.largeStores.filter(A=>A.slug!==T),s)}catch(A){p.set(`Failed to delete ${T}: ${A.message}`)}})}it(()=>{g()});let L=()=>{t(1,v=!v),g()},k=()=>{t(1,v=!v),g()},C=T=>I(T.slug);return o.$$set=T=>{"plugin"in T&&t(12,u=T.plugin)},o.$$.update=()=>{o.$$.dirty&8193&&t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((T,A)=>{let E=A.relay||"local";return T[E]||(T[E]=[]),T[E].push(A),T},{}))!==null&&c!==void 0?c:{}),o.$$.dirty&16384&&t(2,n=Object.entries(r).sort(([T],[A])=>T==="local"?-1:A==="local"?1:T.localeCompare(A)))},[s,v,n,i,a,l,f,d,m,p,g,I,u,c,r,L,k,C]}var xh=class extends G{constructor(e){super(),J(this,e,hR,mR,K,{plugin:12},aR)}},l1=xh;var mu=class extends c1.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new l1({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var O1=require("obsidian");var{Boolean:w1}=Yn;function gR(o){Ce(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function u1(o,e,t){let r=o.slice();return r[20]=e[t],r}function f1(o,e,t){let r=o.slice();return r[23]=e[t],r}function yR(o){return{c:H,m:H,p:H,i:H,o:H,d:H}}function vR(o){let e,t,r=he(_1(o[19].documents)),n=[];for(let i=0;i<r.length;i+=1)n[i]=y1(u1(o,r,i));let s=i=>S(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=me()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);x(i,e,a),t=!0},p(i,a){if(a&8311){r=he(_1(i[19].documents));let l;for(l=0;l<r.length;l+=1){let c=u1(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=y1(c),n[l].c(),b(n[l],1),n[l].m(e.parentNode,e))}for(oe(),l=r.length;l<n.length;l+=1)s(l);ne()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(w1);for(let a=0;a<n.length;a+=1)S(n[a]);t=!1},d(i){i&&w(e),je(n,i)}}}function d1(o){let e,t=b1(o[23].queueState.timestamp)+"",r;return{c(){e=B("\u2022 "),r=B(t)},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s&3&&t!==(t=b1(n[23].queueState.timestamp)+"")&&Y(r,t)},d(n){n&&(w(e),w(r))}}}function p1(o){let e,t=o[23].queueState.error+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&Y(r,t)},d(n){n&&w(e)}}}function m1(o){let e,t,r,n,s,i;t=new Up({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function a(){return o[10](o[23])}return{c(){e=_("button"),U(t.$$.fragment),r=B(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){x(l,e,c),D(t,e,null),y(e,r),n=!0,s||(i=V(e,"click",a),s=!0)},p(l,c){o=l},i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){S(t.$$.fragment,l),n=!1},d(l){l&&w(e),R(t),s=!1,i()}}}function bR(o){var m,p,v;let e,t,r=o[5](o[23]).text+"",n,s,i,a,l,c,u=((m=o[23].queueState)==null?void 0:m.timestamp)&&d1(o),f=((p=o[23].queueState)==null?void 0:p.error)&&p1(o),d=((v=o[23].queueState)==null?void 0:v.status)==="failed"&&m1(o);return{c(){e=_("div"),t=_("span"),n=B(r),s=F(),u&&u.c(),i=F(),f&&f.c(),a=F(),d&&d.c(),l=me(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(g,I){x(g,e,I),y(e,t),y(t,n),y(t,s),u&&u.m(t,null),y(t,i),f&&f.m(t,null),x(g,a,I),d&&d.m(g,I),x(g,l,I),c=!0},p(g,I){var L,k,C;(!c||I&3)&&r!==(r=g[5](g[23]).text+"")&&Y(n,r),(L=g[23].queueState)!=null&&L.timestamp?u?u.p(g,I):(u=d1(g),u.c(),u.m(t,i)):u&&(u.d(1),u=null),(k=g[23].queueState)!=null&&k.error?f?f.p(g,I):(f=p1(g),f.c(),f.m(t,null)):f&&(f.d(1),f=null),((C=g[23].queueState)==null?void 0:C.status)==="failed"?d?(d.p(g,I),I&3&&b(d,1)):(d=m1(g),d.c(),b(d,1),d.m(l.parentNode,l)):d&&(oe(),S(d,1,1,()=>{d=null}),ne())},i(g){c||(b(d),c=!0)},o(g){S(d),c=!1},d(g){g&&(w(e),w(a),w(l)),u&&u.d(),f&&f.d(),d&&d.d(g)}}}function _R(o){let e,t=o[9].default,r=be(t,o,o[13],null),n=r||bR(o);return{c(){n&&n.c()},m(s,i){n&&n.m(s,i),e=!0},p(s,i){r?r.p&&(!e||i&8192)&&we(r,t,s,s[13],e?_e(t,s[13],i,null):xe(s[13]),null):n&&n.p&&(!e||i&3)&&n.p(s,e?i:-1)},i(s){e||(b(n,s),e=!0)},o(s){S(n,s),e=!1},d(s){n&&n.d(s)}}}function wR(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",i,a;var l=o[5](o[23]).icon;function c(u,f){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=Qo(l,c(o))),{c(){e=_("span"),t&&U(t.$$.fragment),r=F(),n=_("span"),i=B(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(u,f){x(u,e,f),t&&D(t,e,null),y(e,r),y(e,n),y(n,i),a=!0},p(u,f){if(f&3&&l!==(l=u[5](u[23]).icon)){if(t){oe();let d=t;S(d.$$.fragment,1,0,()=>{R(d,1)}),ne()}l?(t=Qo(l,c(u,f)),U(t.$$.fragment),b(t.$$.fragment,1),D(t,e,r)):t=null}else if(l){let d={};f&3&&(d.class="svg-icon "+u[5](u[23]).iconClass),t.$set(d)}(!a||f&3)&&s!==(s=u[23].path.split("/").pop()+"")&&Y(i,s)},i(u){a||(t&&b(t.$$.fragment,u),a=!0)},o(u){t&&S(t.$$.fragment,u),a=!1},d(u){u&&w(e),t&&R(t)}}}function h1(o){let e,t;return e=new Ft({props:{$$slots:{name:[wR],default:[_R]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function g1(o){let e,t;return e=new Ft({props:{$$slots:{name:[xR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function xR(o){let e,t,r=v1(o[1](o[20]).remainingCount)+"",n,s,i=o[20].title.toLowerCase()+"",a,l,c,u,f,d,m,p;function v(){return o[11](o[20])}function g(...I){return o[12](o[20],...I)}return{c(){var I;e=_("span"),t=B("...and "),n=B(r),s=B(` more
					`),a=B(i),l=F(),c=_("span"),u=B("(show more)"),d=F(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",f=`Show ${((I=o[2][o[20].title])==null?void 0:I.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(I,L){x(I,e,L),y(e,t),y(e,n),y(e,s),y(e,a),y(e,l),y(e,c),y(c,u),y(e,d),m||(p=[V(c,"click",v),V(c,"keydown",g)],m=!0)},p(I,L){var k;o=I,L&3&&r!==(r=v1(o[1](o[20]).remainingCount)+"")&&Y(n,r),L&1&&i!==(i=o[20].title.toLowerCase()+"")&&Y(a,i),L&1&&f!==(f=`Show ${((k=o[2][o[20].title])==null?void 0:k.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",f)},d(I){I&&w(e),m=!1,ve(p)}}}function y1(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,i;e=new ze({props:{name:o[20].title}});let a=he(o[1](o[20]).visibleDocs),l=[];for(let f=0;f<a.length;f+=1)l[f]=h1(f1(o,a,f));let c=f=>S(l[f],1,1,()=>{l[f]=null}),u=n&&g1(o);return{c(){U(e.$$.fragment),t=F();for(let f=0;f<l.length;f+=1)l[f].c();r=F(),u&&u.c(),s=me()},m(f,d){D(e,f,d),x(f,t,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(f,d);x(f,r,d),u&&u.m(f,d),x(f,s,d),i=!0},p(f,d){let m={};if(d&1&&(m.name=f[20].title),e.$set(m),d&8291){a=he(f[1](f[20]).visibleDocs);let p;for(p=0;p<a.length;p+=1){let v=f1(f,a,p);l[p]?(l[p].p(v,d),b(l[p],1)):(l[p]=h1(v),l[p].c(),b(l[p],1),l[p].m(r.parentNode,r))}for(oe(),p=a.length;p<l.length;p+=1)c(p);ne()}d&3&&(n=f[1](f[20]).remainingCount>0),n?u?(u.p(f,d),d&3&&b(u,1)):(u=g1(f),u.c(),b(u,1),u.m(s.parentNode,s)):u&&(oe(),S(u,1,1,()=>{u=null}),ne())},i(f){if(!i){b(e.$$.fragment,f);for(let d=0;d<a.length;d+=1)b(l[d]);b(u),i=!0}},o(f){S(e.$$.fragment,f),l=l.filter(w1);for(let d=0;d<l.length;d+=1)S(l[d]);S(u),i=!1},d(f){f&&(w(t),w(r),w(s)),R(e,f),je(l,f),u&&u.d(f)}}}function SR(o){let e;return{c(){e=_("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function kR(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:SR,then:vR,catch:yR,value:19,blocks:[,,,]};return en(t=o[0],n),{c(){e=me(),n.block.c()},m(s,i){x(s,e,i),n.block.m(s,n.anchor=i),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[i]){o=s,n.ctx=o,i&1&&t!==(t=o[0])&&en(t,n)||ni(n,o,i)},i(s){r||(b(n.block),r=!0)},o(s){for(let i=0;i<3;i+=1){let a=n.blocks[i];S(a)}r=!1},d(s){s&&w(e),n.block.d(s),n.token=null,n=null}}}function v1(o){return new Intl.NumberFormat().format(o)}function b1(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let i=Math.floor(s/24);return i===1?"yesterday":`${i} days ago`}function _1(o){let e=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="running"}),t=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="failed"}),r=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="pending"}),n=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function IR(o,e,t){let r,n,s,i,a,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:f}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},m=Ie({}),p=Ze(m,A=>E=>{let P=d[E.title]||d.default,M=A[E.title]||P.initialCount,$=E.documents.slice(0,M),W=E.documents.length-M;return{visibleCount:M,visibleDocs:$,remainingCount:W}});le(o,p,A=>t(1,a=A));function v(A){let E=d[A]||d.default;m.update(P=>Object.assign(Object.assign({},P),{[A]:(P[A]||E.initialCount)+E.incrementCount}))}function g(A){return Ae(this,void 0,void 0,function*(){var E;let P=[],M=Array.from(A.docs.values());for(let $ of M){let W=yield $.getOrigin(),O=yield $.getServerSynced(),N={guid:$.guid,path:A.getPath($.path),doc:$,origin:W||"unknown",serverSynced:O},te=Array.from(r).find(ye=>ye.guid===$.guid),Z=Array.from(n).find(ye=>ye.guid===$.guid),Q=s.find(ye=>ye.guid===$.guid);if(te||Z||Q){let ye=te||Z||Q;N.queueState={status:ye.status,type:"type"in ye?ye.type:"sync",error:"error"in ye?ye.error:void 0,timestamp:"timestamp"in ye?ye.timestamp:Date.now()}}else W==="local"&&!O?N.queueState={status:"pending",type:"sync",timestamp:Date.now()}:O?N.queueState={status:"completed",type:"sync",timestamp:Date.now()}:N.queueState={status:"pending",type:"sync",timestamp:Date.now()};P.push(N)}return{folder:A,documents:P,progress:((E=f.getGroupProgress(A))===null||E===void 0?void 0:E.percent)||0}})}function I(A){let{origin:E,serverSynced:P,queueState:M}=A,$=(M==null?void 0:M.status)||"completed",W=(M==null?void 0:M.type)||"sync";return E==="remote"&&!P&&$==="running"&&W==="download"?{text:"Downloading",description:"Initial acquisition",icon:va,iconClass:"mod-primary"}:E==="remote"&&!P&&$==="pending"&&W==="download"?{text:"Queued for Download",description:"Waiting to download",icon:ya,iconClass:""}:E==="remote"&&!P&&$==="failed"&&W==="download"?{text:"Download stuck",description:"Needs retry",icon:es,iconClass:"mod-warning"}:E==="local"&&!P&&$==="running"&&W==="sync"?{text:"Uploading",description:"First-time upload",icon:qp,iconClass:"mod-primary"}:E==="local"&&!P&&$==="pending"&&W==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:ya,iconClass:""}:E==="local"&&!P&&$==="failed"&&W==="sync"?{text:"Upload stuck",description:"Needs retry",icon:es,iconClass:"mod-warning"}:P&&$==="running"&&W==="sync"?{text:"Syncing",description:"Collaborative update",icon:ap,iconClass:"mod-primary"}:P&&$==="pending"&&W==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:ya,iconClass:""}:P&&$==="failed"&&W==="sync"?{text:"Sync stuck",description:"Needs retry",icon:es,iconClass:"mod-warning"}:P&&$==="completed"?{text:"Complete",description:"Fully synchronized",icon:ha,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:ba,iconClass:""}}function L(A){return Ae(this,void 0,void 0,function*(){var E,P;let M={id:A.guid,guid:A.guid,path:A.path,timestamp:((E=A.queueState)===null||E===void 0?void 0:E.timestamp)||Date.now(),type:((P=A.queueState)===null||P===void 0?void 0:P.type)||"sync",status:"failed",sharedFolderGuid:A.doc.sharedFolder.guid};yield f.retryLogItem(M)})}let k=A=>L(A),C=A=>{v(A.title)},T=(A,E)=>E.key==="Enter"&&v(A.title);return o.$$set=A=>{"folder"in A&&t(7,u=A.folder),"backgroundSync"in A&&t(8,f=A.backgroundSync),"$$scope"in A&&t(13,c=A.$$scope)},o.$$.update=()=>{o.$$.dirty&256&&(r=new Set(f.activeSync.items())),o.$$.dirty&256&&(n=new Set(f.activeDownloads.items())),o.$$.dirty&256&&(s=f.getSyncLog()),o.$$.dirty&128&&t(0,i=g(u))},[i,a,d,p,v,I,L,u,f,l,k,C,T,c]}var Sh=class extends G{constructor(e){super(),J(this,e,IR,kR,K,{folder:7,backgroundSync:8},gR)}},kh=Sh;var{Map:CR}=Yn;function LR(o){Ce(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function x1(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function S1(o){let e,t;return e=new ze({props:{name:"Sync Status"}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function k1(o){let e,t;return e=new Ue({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[AR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function I1(o){let e,t,r,n,s,i,a=[TR,MR],l=[];function c(u,f){return u[9]?0:1}return t=c(o,-1),r=l[t]=a[t](o),{c(){e=_("button"),r.c(),h(e,"class","mod-cta")},m(u,f){x(u,e,f),l[t].m(e,null),n=!0,s||(i=V(e,"click",o[16]),s=!0)},p(u,f){let d=t;t=c(u,f),t!==d&&(oe(),S(l[d],1,1,()=>{l[d]=null}),ne(),r=l[t],r||(r=l[t]=a[t](u),r.c()),b(r,1),r.m(e,null))},i(u){n||(b(r),n=!0)},o(u){S(r),n=!1},d(u){u&&w(e),l[t].d(),s=!1,i()}}}function MR(o){let e,t,r;return e=new Ep({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){U(e.$$.fragment),t=B(`
						Pause`)},m(n,s){D(e,n,s),x(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){n&&w(t),R(e,n)}}}function TR(o){let e,t,r;return e=new Dp({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){U(e.$$.fragment),t=B(`
						Resume`)},m(n,s){D(e,n,s),x(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){S(e.$$.fragment,n),r=!1},d(n){n&&w(t),R(e,n)}}}function AR(o){let e,t,r=(o[11]||o[10])&&I1(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&b(r,1)):(r=I1(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),S(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){S(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function FR(o){let e=[],t=new CR,r,n,s=he(o[6]),i=a=>a[25].guid;for(let a=0;a<s.length;a+=1){let l=x1(o,s,a),c=i(l);t.set(c,e[a]=F1(c,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=me()},m(a,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,l);x(a,r,l),n=!0},p(a,l){l&32851&&(s=he(a[6]),oe(),e=mr(e,l,i,1,a,s,t,r.parentNode,tn,F1,r,x1),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)S(e[l]);n=!1},d(a){a&&w(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function ER(o){let e,t,r,n;return e=new ze({props:{$$slots:{name:[NR],default:[UR]},$$scope:{ctx:o}}}),r=new kh({props:{folder:o[5],backgroundSync:o[0]}}),{c(){U(e.$$.fragment),t=F(),U(r.$$.fragment)},m(s,i){D(e,s,i),x(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i&536875040&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&32&&(l.folder=s[5]),i&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),S(r.$$.fragment,s),n=!1},d(s){s&&w(t),R(e,s),R(r,s)}}}function C1(o){let e,t,r,n,s,i=o[26].progress+"",a,l;return{c(){e=_("div"),t=_("div"),r=_("div"),n=F(),s=_("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ae(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){x(c,e,u),y(e,t),y(t,r),y(e,n),y(e,s),y(s,a),y(s,l)},p(c,u){u&80&&ae(r,"width",c[26].progress+"%"),u&80&&i!==(i=c[26].progress+"")&&Y(a,i)},d(c){c&&w(e)}}}function PR(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&C1(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=C1(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function L1(o){let e,t=o[26].running+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].running+"")&&Y(r,t)},d(s){s&&w(e)}}}function M1(o){let e,t=o[26].failed+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].failed+"")&&Y(r,t)},d(s){s&&w(e)}}}function T1(o){let e,t=o[26].pending+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&80&&t!==(t=s[26].pending+"")&&Y(r,t)},d(s){s&&w(e)}}}function DR(o){var C,T,A;let e,t,r,n,s,i=o[25].name+"",a,l,c,u,f,d,m,p,v=((C=o[26])==null?void 0:C.running)>0&&L1(o),g=((T=o[26])==null?void 0:T.failed)>0&&M1(o),I=((A=o[26])==null?void 0:A.pending)>0&&T1(o);function L(){return o[22](o[25])}function k(...E){return o[23](o[25],...E)}return{c(){e=_("div"),t=_("span"),r=B("\u25B6"),s=F(),a=B(i),l=F(),c=_("span"),v&&v.c(),u=F(),g&&g.c(),f=F(),I&&I.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(E,P){x(E,e,P),y(e,t),y(t,r),y(e,s),y(e,a),y(e,l),y(e,c),v&&v.m(c,null),y(c,u),g&&g.m(c,null),y(c,f),I&&I.m(c,null),m||(p=[V(e,"click",L),V(e,"keydown",k)],m=!0)},p(E,P){var M,$,W;o=E,P&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),P&64&&i!==(i=o[25].name+"")&&Y(a,i),((M=o[26])==null?void 0:M.running)>0?v?v.p(o,P):(v=L1(o),v.c(),v.m(c,u)):v&&(v.d(1),v=null),(($=o[26])==null?void 0:$.failed)>0?g?g.p(o,P):(g=M1(o),g.c(),g.m(c,f)):g&&(g.d(1),g=null),((W=o[26])==null?void 0:W.pending)>0?I?I.p(o,P):(I=T1(o),I.c(),I.m(c,null)):I&&(I.d(1),I=null),P&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(E){E&&w(e),v&&v.d(),g&&g.d(),I&&I.d(),m=!1,ve(p)}}}function RR(o){let e,t;return e=new La({props:{folder:o[25],$$slots:{default:[DR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function A1(o){let e,t;return e=new kh({props:{folder:o[25],backgroundSync:o[0]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function F1(o,e){let t,r,n,s,i;r=new ze({props:{$$slots:{name:[RR],default:[PR]},$$scope:{ctx:e}}});let a=e[1][e[25].guid]&&A1(e);return{key:o,first:null,c(){t=me(),U(r.$$.fragment),n=F(),a&&a.c(),s=me(),this.first=t},m(l,c){x(l,t,c),D(r,l,c),x(l,n,c),a&&a.m(l,c),x(l,s,c),i=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?a?(a.p(e,c),c&66&&b(a,1)):(a=A1(e),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(oe(),S(a,1,1,()=>{a=null}),ne())},i(l){i||(b(r.$$.fragment,l),b(a),i=!0)},o(l){S(r.$$.fragment,l),S(a),i=!1},d(l){l&&(w(t),w(n),w(s)),R(r,l),a&&a.d(l)}}}function E1(o){let e,t,r,n,s,i=o[12].progress+"",a,l;return{c(){e=_("div"),t=_("div"),r=_("div"),n=F(),s=_("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ae(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){x(c,e,u),y(e,t),y(t,r),y(e,n),y(e,s),y(s,a),y(s,l)},p(c,u){u&4096&&ae(r,"width",c[12].progress+"%"),u&4096&&i!==(i=c[12].progress+"")&&Y(a,i)},d(c){c&&w(e)}}}function UR(o){let e,t=(o[12].running>0||o[12].failed>0)&&E1(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=E1(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function P1(o){let e,t=o[12].running+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].running+"")&&Y(r,t)},d(s){s&&w(e)}}}function D1(o){let e,t=o[12].failed+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].failed+"")&&Y(r,t)},d(s){s&&w(e)}}}function R1(o){let e,t=o[12].pending+"",r,n;return{c(){e=_("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i&4096&&t!==(t=s[12].pending+"")&&Y(r,t)},d(s){s&&w(e)}}}function OR(o){let e,t=o[5].name+"",r,n,s,i,a,l=o[12].running>0&&P1(o),c=o[12].failed>0&&D1(o),u=o[12].pending>0&&R1(o);return{c(){e=_("div"),r=B(t),n=F(),s=_("span"),l&&l.c(),i=F(),c&&c.c(),a=F(),u&&u.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(f,d){x(f,e,d),y(e,r),y(e,n),y(e,s),l&&l.m(s,null),y(s,i),c&&c.m(s,null),y(s,a),u&&u.m(s,null)},p(f,d){d&32&&t!==(t=f[5].name+"")&&Y(r,t),f[12].running>0?l?l.p(f,d):(l=P1(f),l.c(),l.m(s,i)):l&&(l.d(1),l=null),f[12].failed>0?c?c.p(f,d):(c=D1(f),c.c(),c.m(s,a)):c&&(c.d(1),c=null),f[12].pending>0?u?u.p(f,d):(u=R1(f),u.c(),u.m(s,null)):u&&(u.d(1),u=null)},d(f){f&&w(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function NR(o){let e,t;return e=new La({props:{folder:o[5],$$slots:{default:[OR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function $R(o){let e,t,r,n,s,i,a=!o[5]&&S1(o),l=!o[5]&&k1(o),c=[ER,FR],u=[];function f(d,m){return d[5]&&d[12]?0:1}return n=f(o,-1),s=u[n]=c[n](o),{c(){e=_("div"),a&&a.c(),t=F(),l&&l.c(),r=F(),s.c(),h(e,"class","setting-item-container")},m(d,m){x(d,e,m),a&&a.m(e,null),y(e,t),l&&l.m(e,null),y(e,r),u[n].m(e,null),i=!0},p(d,[m]){d[5]?a&&(oe(),S(a,1,1,()=>{a=null}),ne()):a?m&32&&b(a,1):(a=S1(d),a.c(),b(a,1),a.m(e,t)),d[5]?l&&(oe(),S(l,1,1,()=>{l=null}),ne()):l?(l.p(d,m),m&32&&b(l,1)):(l=k1(d),l.c(),b(l,1),l.m(e,r));let p=n;n=f(d,m),n===p?u[n].p(d,m):(oe(),S(u[p],1,1,()=>{u[p]=null}),ne(),s=u[n],s?s.p(d,m):(s=u[n]=c[n](d),s.c()),b(s,1),s.m(e,null))},i(d){i||(b(a),b(l),b(s),i=!0)},o(d){S(a),S(l),S(s),i=!1},d(d){d&&w(e),a&&a.d(),l&&l.d(),u[n].d()}}}function BR(o,e,t){let r,n,s,i,a,l,c,u,f,d,m,{backgroundSync:p}=e,{sharedFolders:v}=e,{focusedFolderGuid:g}=e,I={},L=0,k=0,C=0,T=0,{activeSync:A,activeDownloads:E}=p;le(o,A,O=>t(21,m=O)),le(o,E,O=>t(20,d=O));function P(O){t(1,I[O]=!I[O],I),t(1,I),t(6,r),t(17,v)}function M(){l?p.resume():p.pause()}let $=O=>P(O.guid),W=(O,N)=>N.key==="Enter"&&P(O.guid);return o.$$set=O=>{"backgroundSync"in O&&t(0,p=O.backgroundSync),"sharedFolders"in O&&t(17,v=O.sharedFolders),"focusedFolderGuid"in O&&t(18,g=O.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072&&t(6,r=v.items().sort((O,N)=>O.name.localeCompare(N.name))),o.$$.dirty&66&&(r.forEach(O=>{O.guid in I||t(1,I[O.guid]=!0,I)}),t(1,I),t(6,r),t(17,v)),o.$$.dirty&393216&&t(5,n=g?v.items().find(O=>O.guid===g):void 0),o.$$.dirty&3145793&&t(4,s=new Map(r.map(O=>{var N,te;return[O.guid,{progress:((N=p.getGroupProgress(O))===null||N===void 0?void 0:N.percent)||0,running:[...m.items(),...d.items()].filter(Z=>Z.sharedFolder.guid===O.guid).length,failed:((te=p.syncGroups.get(O))===null||te===void 0?void 0:te.status)==="failed"?1:0,pending:[...p.pendingSyncs,...p.pendingDownloads].filter(Z=>Z.sharedFolder.guid===O.guid).length,completed:(()=>{let Z=p.syncGroups.get(O);return((Z==null?void 0:Z.completedSyncs)||0)+((Z==null?void 0:Z.completedDownloads)||0)})(),sharedFolder:O}]}))),o.$$.dirty&48&&t(12,i=n?s.get(n.guid):void 0),o.$$.dirty&1&&t(19,a=p.getQueueStatus()),o.$$.dirty&524288&&t(9,l=a.isPaused),o.$$.dirty&524288&&(c=a.syncsActive>0||a.downloadsActive>0),o.$$.dirty&16){let O=0,N=0,te=0,Z=0;for(let Q of s.values())O+=Q.running,N+=Q.failed,te+=Q.pending,Z+=Q.completed;t(2,L=O),t(7,k=N),t(3,C=te),t(8,T=Z)}o.$$.dirty&4&&t(11,u=L>0),o.$$.dirty&8&&t(10,f=C>0)},[p,I,L,C,s,n,r,k,T,l,f,u,i,A,E,P,M,v,g,a,d,m,$,W]}var Ih=class extends G{constructor(e){super(),J(this,e,BR,$R,K,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},LR)}},U1=Ih;var Ta=class extends O1.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new U1({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Vne=require("obsidian");function Ch(o){return o.startsWith("v")?o.slice(1):o}function VR(o,e){return o.map((t,r)=>[t,e[r]])}function HR(o,e){try{let t=Ch(o).split(".").map(parseInt),r=Ch(e).split(".").map(parseInt);for(let[n,s]of VR(t,r))if(n>s)return!0}catch(t){}return!1}var hu=class extends at{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.observableName="UpdateManager";this.githubReleases=new zo("system3-relay/releases"),this.releaseChannels=new zo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await lt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return He().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await lt(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<300*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<300*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>Ch(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await lt(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await lt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return He().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&HR(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var t0=require("obsidian");var X1=require("obsidian");function qR(o){Ce(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function N1(o,e,t){let r=o.slice();return r[66]=e[t],r}function $1(o){let e,t;return e=new Ft({props:{name:"Show all releases",$$slots:{default:[jR]},$$scope:{ctx:o}}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function jR(o){let e,t,r,n,s,i;return{c(){e=_("div"),t=_("input"),r=F(),n=_("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Me(e,"is-enabled",o[6])},m(a,l){x(a,e,l),y(e,t),y(e,r),y(e,n),s||(i=[V(e,"click",o[41]),V(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Me(e,"is-enabled",a[6])},d(a){a&&w(e),s=!1,ve(i)}}}function zR(o){let e,t,r=!o[1]&&B1(o);function n(a,l){if(a[11])return YR;if(a[16])return JR}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=F(),i&&i.c(),t=me()},m(a,l){r&&r.m(a,l),x(a,e,l),i&&i.m(a,l),x(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=B1(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(w(e),w(t)),r&&r.d(a),i&&i.d(a)}}}function WR(o){let e;return{c(){e=_("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function KR(o){let e;return{c(){e=_("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function GR(o){let e;return{c(){e=_("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function B1(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&V1(o),a=o[4]&&H1(o),l=n&&q1(o),c=!o[1]&&j1(o);return{c(){e=_("div"),i&&i.c(),t=F(),a&&a.c(),r=F(),l&&l.c(),s=F(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(u,f){x(u,e,f),i&&i.m(e,null),y(e,t),a&&a.m(e,null),y(e,r),l&&l.m(e,null),y(e,s),c&&c.m(e,null)},p(u,f){u[5]?i?i.p(u,f):(i=V1(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null),u[4]?a?a.p(u,f):(a=H1(u),a.c(),a.m(e,r)):a&&(a.d(1),a=null),f[0]&256&&(n=!u[8].some(u[40])),n?l?l.p(u,f):(l=q1(u),l.c(),l.m(e,s)):l&&(l.d(1),l=null),u[1]?c&&(c.d(1),c=null):c?c.p(u,f):(c=j1(u),c.c(),c.m(e,null))},d(u){u&&w(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function V1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){x(i,e,a),y(e,t),n||(s=[V(e,"click",o[43]),V(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,ve(s)}}}function H1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){x(i,e,a),y(e,t),n||(s=[V(e,"click",o[45]),V(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,ve(s)}}}function q1(o){let e,t,r,n,s;return{c(){e=_("div"),t=_("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){x(i,e,a),y(e,t),n||(s=[V(e,"click",o[47]),V(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,ve(s)}}}function j1(o){let e,t=he(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=z1(N1(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=he(n[8]);let i;for(i=0;i<t.length;i+=1){let a=N1(n,t,i);r[i]?r[i].p(a,s):(r[i]=z1(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),je(r,n)}}}function z1(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function u(){return o[49](o[66])}function f(...d){return o[50](o[66],...d)}return{c(){e=_("div"),t=_("div"),n=B(r),s=F(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(Z1(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,m){x(d,e,m),y(e,t),y(t,n),y(e,s),l||(c=[V(e,"click",u),V(e,"keydown",f)],l=!0)},p(d,m){o=d,m[0]&256&&r!==(r=o[66].tag_name+"")&&Y(n,r),m[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(Z1(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),m[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&w(e),l=!1,ve(c)}}}function JR(o){let e,t,r,n,s,i,a;return{c(){e=_("div"),t=_("div"),r=B(o[16]),n=F(),s=_("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){x(l,e,c),y(e,t),y(t,r),y(e,n),y(e,s),i||(a=V(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&Y(r,l[16])},d(l){l&&w(e),i=!1,a()}}}function YR(o){var O;let e,t,r,n,s,i,a=(O=o[38](o[10]))==null?void 0:O.prerelease,l,c,u,f,d,m,p,v,g,I,L=a&&W1(o),k=o[12][o[10]]==="beta-alias"&&K1(o),C=o[12][o[10]]==="stable-alias"&&G1(o);function T(N,te){if(te[0]&9216&&(d=null),te[0]&1024&&(m=null),d==null&&(d=!!((N[38](N[10])||N[13][N[10]]==="stable-alias"||N[13][N[10]]==="beta-alias")&&!N[28](N[10]))),d)return ZR;if(m==null&&(m=!!N[28](N[10])),m)return QR}let A=T(o,[-1,-1,-1]),E=A&&A(o);function P(N,te){return N[13][N[10]]==="stable-alias"||N[13][N[10]]==="beta-alias"||N[9]==="development"?o3:N[10]?r3:t3}let M=P(o,[-1,-1,-1]),$=M(o),W=o[15]&&J1(o);return{c(){e=_("div"),t=_("div"),r=_("h3"),n=B("Release Details: "),s=B(o[10]),i=F(),L&&L.c(),l=F(),k&&k.c(),c=F(),C&&C.c(),u=F(),f=_("div"),E&&E.c(),p=F(),v=_("div"),g=_("div"),$.c(),I=F(),W&&W.c(),h(r,"class","svelte-12doke6"),h(f,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(v,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(N,te){x(N,e,te),y(e,t),y(t,r),y(r,n),y(r,s),y(r,i),L&&L.m(r,null),y(r,l),k&&k.m(r,null),y(r,c),C&&C.m(r,null),y(t,u),y(t,f),E&&E.m(f,null),y(e,p),y(e,v),y(v,g),$.m(g,null),y(e,I),W&&W.m(e,null)},p(N,te){var Z;te[0]&1024&&Y(s,N[10]),te[0]&1024&&(a=(Z=N[38](N[10]))==null?void 0:Z.prerelease),a?L||(L=W1(N),L.c(),L.m(r,l)):L&&(L.d(1),L=null),N[12][N[10]]==="beta-alias"?k||(k=K1(N),k.c(),k.m(r,c)):k&&(k.d(1),k=null),N[12][N[10]]==="stable-alias"?C||(C=G1(N),C.c(),C.m(r,null)):C&&(C.d(1),C=null),A===(A=T(N,te))&&E?E.p(N,te):(E&&E.d(1),E=A&&A(N),E&&(E.c(),E.m(f,null))),M===(M=P(N,te))&&$?$.p(N,te):($.d(1),$=M(N),$&&($.c(),$.m(g,null))),N[15]?W?W.p(N,te):(W=J1(N),W.c(),W.m(e,null)):W&&(W.d(1),W=null)},d(N){N&&w(e),L&&L.d(),k&&k.d(),C&&C.d(),E&&E.d(),$.d(),W&&W.d()}}}function W1(o){let e;return{c(){e=_("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function K1(o){let e;return{c(){e=_("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function G1(o){let e;return{c(){e=_("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function QR(o){let e;return{c(){e=_("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function ZR(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?e3:XR}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=_("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){x(l,e,c),a.m(e,null),r||(n=V(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&w(e),a.d(),r=!1,n()}}}function XR(o){let e;return{c(){e=B("Install")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function e3(o){let e;return{c(){e=B("Installing...")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function t3(o){let e;return{c(){e=B('"No changelog available"')},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function r3(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:i3,then:s3,catch:n3,value:65};return en(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=me(),r.block.c()},m(s,i){x(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&en(t,r)||ni(r,o,i)},d(s){s&&w(e),r.block.d(s),r.token=null,r=null}}}function o3(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return c3;if(s[13][s[10]]==="beta-alias")return l3;if(s[10]===s[0].version)return a3}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=me()},m(s,i){n&&n.m(s,i),x(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n&&n.d(s)}}}function n3(o){return{c:H,m:H,p:H,d:H}}function s3(o){let e,t=o[65]+"",r;return{c(){e=new kn(!1),r=me(),e.a=r},m(n,s){e.m(t,n,s),x(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(w(r),e.d())}}}function i3(o){let e;return{c(){e=B('"loading..."')},m(t,r){x(t,e,r)},p:H,d(t){t&&w(e)}}}function a3(o){let e;return{c(){e=_("p"),e.textContent="Current development version"},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function l3(o){let e;return{c(){e=_("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function c3(o){let e;return{c(){e=_("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function J1(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),u,f,d,m,p,v=o[11].name+"",g,I,L,k,C,T,A=o[11].author+"",E,P,M,$,W,O,N=o[11].description+"",te,Z,Q,ye,z,q,X=o[11].isDesktopOnly?"Yes":"No",fe,j,ee,re,de,Le,pe=o[11].minAppVersion+"",Ee,Oe=c&&Y1(o);return{c(){e=_("div"),t=_("div"),r=_("span"),r.textContent="Version:",n=F(),s=_("span"),a=B(i),l=F(),Oe&&Oe.c(),u=F(),f=_("div"),d=_("span"),d.textContent="Name:",m=F(),p=_("span"),g=B(v),I=F(),L=_("div"),k=_("span"),k.textContent="Author:",C=F(),T=_("span"),E=B(A),P=F(),M=_("div"),$=_("span"),$.textContent="Description:",W=F(),O=_("span"),te=B(N),Z=F(),Q=_("div"),ye=_("span"),ye.textContent="isDesktopOnly:",z=F(),q=_("span"),fe=B(X),j=F(),ee=_("div"),re=_("span"),re.textContent="minAppVersion:",de=F(),Le=_("span"),Ee=B(pe),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(p,"class","manifest-value svelte-12doke6"),h(f,"class","manifest-field svelte-12doke6"),h(k,"class","manifest-label svelte-12doke6"),h(T,"class","manifest-value svelte-12doke6"),h(L,"class","manifest-field svelte-12doke6"),h($,"class","manifest-label svelte-12doke6"),h(O,"class","manifest-value svelte-12doke6"),h(M,"class","manifest-field svelte-12doke6"),h(ye,"class","manifest-label svelte-12doke6"),h(q,"class","manifest-value svelte-12doke6"),h(Q,"class","manifest-field svelte-12doke6"),h(re,"class","manifest-label svelte-12doke6"),h(Le,"class","manifest-value svelte-12doke6"),h(ee,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(Te,nt){x(Te,e,nt),y(e,t),y(t,r),y(t,n),y(t,s),y(s,a),y(t,l),Oe&&Oe.m(t,null),y(e,u),y(e,f),y(f,d),y(f,m),y(f,p),y(p,g),y(e,I),y(e,L),y(L,k),y(L,C),y(L,T),y(T,E),y(e,P),y(e,M),y(M,$),y(M,W),y(M,O),y(O,te),y(e,Z),y(e,Q),y(Q,ye),y(Q,z),y(Q,q),y(q,fe),y(e,j),y(e,ee),y(ee,re),y(ee,de),y(ee,Le),y(Le,Ee)},p(Te,nt){nt[0]&2048&&i!==(i=Te[11].version+"")&&Y(a,i),nt[0]&3072&&(c=Te[10]!==Te[11].version&&!Te[10].startsWith("v"+Te[11].version)),c?Oe||(Oe=Y1(Te),Oe.c(),Oe.m(t,null)):Oe&&(Oe.d(1),Oe=null),nt[0]&2048&&v!==(v=Te[11].name+"")&&Y(g,v),nt[0]&2048&&A!==(A=Te[11].author+"")&&Y(E,A),nt[0]&2048&&N!==(N=Te[11].description+"")&&Y(te,N),nt[0]&2048&&X!==(X=Te[11].isDesktopOnly?"Yes":"No")&&Y(fe,X),nt[0]&2048&&pe!==(pe=Te[11].minAppVersion+"")&&Y(Ee,pe)},d(Te){Te&&w(e),Oe&&Oe.d()}}}function Y1(o){let e;return{c(){e=_("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function u3(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,u,f=!o[1]&&$1(o);function d(v,g){return v[7]?GR:v[3].length===0?KR:v[8].length===0?WR:zR}let m=d(o,[-1,-1,-1]),p=m(o);return{c(){e=_("div"),r=B(t),n=F(),s=_("div"),i=_("div"),a=F(),l=_("div"),f&&f.c(),c=F(),p.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(v,g){x(v,e,g),y(e,r),x(v,n,g),x(v,s,g),y(s,i),y(s,a),y(s,l),f&&f.m(l,null),y(s,c),p.m(s,null),u=!0},p(v,g){(!u||g[0]&2)&&t!==(t=v[1]?"Relay installer":"Relay releases")&&Y(r,t),v[1]?f&&(oe(),S(f,1,1,()=>{f=null}),ne()):f?(f.p(v,g),g[0]&2&&b(f,1)):(f=$1(v),f.c(),b(f,1),f.m(l,null)),m===(m=d(v,g))&&p?p.p(v,g):(p.d(1),p=m(v),p&&(p.c(),p.m(s,null)))},i(v){u||(b(f),u=!0)},o(v){S(f),u=!1},d(v){v&&(w(e),w(n),w(s)),f&&f.d(),p.d()}}}var Q1="system3-relay";function ls(o){return o.startsWith("v")?o.substring(1):o}function Z1(o){return(o==null?void 0:o.prerelease)===!0}function f3(o,e,t){let r,n,s,i,a,l,c,u,f,d,m,p,v,g,I,L,{plugin:k}=e,{version:C}=e,T=Ie(k.manifest.version),A=Ie(!1),E=Ie(""),P=Ie(""),M=Ie(!1);le(o,M,ce=>t(7,c=ce));let $=Ie(!1);le(o,$,ce=>t(6,l=ce));let W=Ie(null);le(o,W,ce=>t(11,m=ce));let O=Ie("");le(o,O,ce=>t(10,d=ce));let N=Ie(null),te=Ie(null);le(o,te,ce=>t(16,L=ce));let Z=Ie(!1);le(o,Z,ce=>t(15,I=ce));let Q=Ie(null);le(o,Q,ce=>t(5,s=ce));let ye=Ie(null);le(o,ye,ce=>t(4,n=ce));let z=Ie(null);le(o,z,ce=>t(53,a=ce));let q=Ie(null);le(o,q,ce=>t(52,i=ce));let X=Ie(!1),fe=!1,j=Ie(null);le(o,j,ce=>t(14,g=ce));let ee=k.app;function re(ce){let Ne=ls(ce),mt=ls(k.version);return Ne===mt}let de=Ie({});le(o,de,ce=>t(13,v=ce));let Le=Ie({});le(o,Le,ce=>t(12,p=ce));let pe=Ie(k.releaseSettings.get().channel);le(o,pe,ce=>t(9,f=ce)),it(()=>{nt(),Ee(),!C&&!r.some(ce=>{ce.tag_name,k.version})?pe.set(null):pe.set(k.releaseSettings.get().channel),W.set({version:C||k.version,name:k.manifest.name,author:k.manifest.author,description:k.manifest.description,isDesktopOnly:k.manifest.isDesktopOnly,minAppVersion:k.manifest.minAppVersion}),O.set(C||k.version)});function Ee(){return Ae(this,void 0,void 0,function*(){X.set(!0);try{let ce=yield k.updateManager.fetchRepoManifest("manifest.json");ce&&(Q.set(ce),z.set(ce.version));let Ne=yield k.updateManager.fetchRepoManifest("manifest-beta.json");Ne&&(ye.set(Ne),q.set(Ne.version))}catch(ce){k.error("Error fetching main branch manifests:",ce)}finally{X.set(!1)}})}let Oe=Ze(k.updateManager,()=>k.updateManager.releases);le(o,Oe,ce=>t(3,r=ce));let Te=Ze([Oe,$],()=>r&&r.length>0?Dt(l).sort():[]);le(o,Te,ce=>t(8,u=ce)),r.forEach(ce=>Ae(void 0,void 0,void 0,function*(){try{let Ne=yield k.updateManager.fetchReleaseManifest(ce);Ne&&de.update(mt=>Object.assign(Object.assign({},mt),{[ce.tag_name]:Ne.version}))}catch(Ne){}}));function nt(){return Ae(this,void 0,void 0,function*(){M.set(!0);try{yield k.updateManager.getReleases(),Dt(l)}catch(ce){k.error("Error refreshing GitHub releases:",ce)}finally{M.set(!1)}})}function ct(ce){return Ae(this,void 0,void 0,function*(){let Ne=document.createElement("div");return yield X1.MarkdownRenderer.render(k.app,ce,Ne,"",k),Ne.innerHTML})}function Dt(ce){return ce?r:C?r.filter(Ne=>C===ls(Ne.tag_name)):r.filter(Ne=>{let mt=Ne.tag_name;return Ro(Ne)})}function Ro(ce){if(ce.prerelease||ce.draft)return!1;if(ce.latest||ls(ce.tag_name)===a||ls(ce.tag_name)===i)return!0;let Ne=new Date(ce.created_at),mt=new Date;return mt.setMonth(mt.getMonth()-3),Ne>mt}function Cr(ce){return Ae(this,void 0,void 0,function*(){te.set(null),N.set(ce);try{let Ne=qt(ce);if(!Ne){te.set(`Could not find release for ${ce}`);return}let mt=yield k.updateManager.fetchReleaseManifest(Ne);mt?(W.set(mt),O.set(ce),Z.set(!1),de.update(Vr=>Object.assign(Object.assign({},Vr),{[ce]:mt.version}))):te.set(`Could not find manifest for ${ce}`)}catch(Ne){k.error("Error fetching manifest:",Ne),te.set(`Error fetching manifest: ${Ne.message||"Unknown error"}`)}finally{N.set(null)}})}function Lr(ce){let Ne=ce==="stable"?s:n;if(Ne){let mt=Ne.version;pe.set(ce);let Vr=[...r.values()].find(or=>ls(or.tag_name)===ls(mt));Vr?(ce==="stable"?Le.update(or=>Object.assign(Object.assign({},or),{[Vr.tag_name]:"stable-alias"})):Le.update(or=>Object.assign(Object.assign({},or),{[Vr.tag_name]:"beta-alias"})),Cr(Vr.tag_name)):(W.set(Ne),O.set(mt),ce==="stable"?Le.update(or=>Object.assign(Object.assign({},or),{[mt]:"stable-alias"})):Le.update(or=>Object.assign(Object.assign({},or),{[mt]:"beta-alias"})),Z.set(!1))}else te.set(`Could not find ${ce} manifest`)}function io(){W.set(null),O.set(""),te.set(null)}function qt(ce){return[...r.values()].find(Ne=>Ne.tag_name===ce)}function sn(ce){return Ae(this,void 0,void 0,function*(){try{j.set(ce);let Ne=qt(ce);if(!Ne)throw new Error(`Could not find release for ${ce}`);let mt=yield k.updateManager.fetchReleaseManifest(Ne);if(!mt)throw new Error(`Could not find manifest for ${ce}`);t(2,fe=!0),yield ee.plugins.installPlugin(k.repo,ce,mt),yield ee.plugins.disablePlugin(Q1),yield ee.plugins.enablePlugin(Q1)}catch(Ne){console.error(`Error installing version ${ce}:`,Ne),k&&k.error(`Error installing version ${ce}:`,Ne)}finally{k&&(t(2,fe=!1),j.set(null))}})}let cs=ce=>re(ce.tag_name),vr=()=>{$.update(ce=>!ce)},Mr=ce=>{(ce.key==="Enter"||ce.key===" ")&&$.update(Ne=>!Ne)},ao=()=>{k.releaseSettings.update(ce=>({...ce,channel:"stable"})),pe.set("stable"),Lr("stable")},En=ce=>{(ce.key==="Enter"||ce.key===" ")&&(k.releaseSettings.update(Ne=>({...Ne,channel:"stable"})),pe.set("stable"),Lr("stable"))},lo=()=>{k.releaseSettings.update(ce=>({...ce,channel:"beta"})),pe.set("beta"),Lr("beta")},Pn=ce=>{(ce.key==="Enter"||ce.key===" ")&&(k.releaseSettings.update(Ne=>({...Ne,channel:"beta"})),pe.set("beta"),Lr("beta"))},ke=()=>{pe.set(null),W.set({version:k.manifest.version,name:k.manifest.name,author:k.manifest.author,description:k.manifest.description,isDesktopOnly:k.manifest.isDesktopOnly,minAppVersion:k.manifest.minAppVersion}),O.set(k.version),Z.set(!1)},Ge=ce=>{(ce.key==="Enter"||ce.key===" ")&&(pe.set(null),W.set({version:k.manifest.version,name:k.manifest.name,author:k.manifest.author,description:k.manifest.description,isDesktopOnly:k.manifest.isDesktopOnly,minAppVersion:k.manifest.minAppVersion}),O.set(k.version),Z.set(!1))},tt=ce=>{pe.set(null),Cr(ce.tag_name)},Tr=(ce,Ne)=>{(Ne.key==="Enter"||Ne.key===" ")&&(pe.set(null),Cr(ce.tag_name))},an=async()=>{sn(d)};return o.$$set=ce=>{"plugin"in ce&&t(0,k=ce.plugin),"version"in ce&&t(1,C=ce.version)},[k,C,fe,r,n,s,l,c,u,f,d,m,p,v,g,I,L,M,$,W,O,te,Z,Q,ye,z,q,j,re,de,Le,pe,Oe,Te,ct,Cr,Lr,io,qt,sn,cs,vr,Mr,ao,En,lo,Pn,ke,Ge,tt,Tr,an]}var Lh=class extends G{constructor(e){super(),J(this,e,f3,u3,K,{plugin:0,version:1},qR,[-1,-1,-1])}},e0=Lh;var Aa=class extends t0.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new e0({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var d0=require("obsidian");function d3(o){Ce(o,"svelte-1yric5k",".self-host-modal.svelte-1yric5k{padding:0 0 20px 0}.host-list-section.svelte-1yric5k{margin:16px 0}.public-key-section.svelte-1yric5k{margin:16px 0}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.host-list.svelte-1yric5k{display:flex;flex-direction:column;margin-top:8px}.host-card.svelte-1yric5k{display:flex;align-items:center;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.host-card.svelte-1yric5k:hover{background:var(--background-modifier-hover)}.host-card.active.svelte-1yric5k{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.host-info.svelte-1yric5k{display:flex;flex-direction:column;gap:4px;flex:1}.host-url.svelte-1yric5k{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.host-key-indicator.svelte-1yric5k{font-size:0.8em;color:var(--text-faint)}.add-host-card.svelte-1yric5k{border-style:dashed;opacity:0.8}.add-host-card.svelte-1yric5k:hover{opacity:1}.host-url-input.svelte-1yric5k{width:100%;border:none;background:transparent;color:var(--text-muted);font-size:0.85em;font-family:var(--font-monospace);padding:0;outline:none}.host-url-input.svelte-1yric5k:focus{color:var(--text-normal)}.host-url-input.svelte-1yric5k::placeholder{color:var(--text-faint);opacity:0.8}.host-input-invalid.svelte-1yric5k{color:var(--text-error) !important}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}.modal-button-container.svelte-1yric5k{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.loading-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-muted);border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em;text-align:center}.error-message.svelte-1yric5k{background:var(--background-secondary);color:var(--text-error);border:1px solid var(--text-error);border-radius:var(--radius-s);padding:12px;margin:16px 0;font-size:0.9em}")}function r0(o,e,t){let r=o.slice();return r[30]=e[t],r}function o0(o,e,t){let r=o.slice();return r[33]=e[t],r}function n0(o){let e,t=o[0].user.name+"",r,n;return{c(){e=_("option"),r=B(t),n=B(" (Personal)"),e.__value="user",Ye(e,e.__value)},m(s,i){x(s,e,i),y(e,r),y(e,n)},p(s,i){i[0]&1&&t!==(t=s[0].user.name+"")&&Y(r,t)},d(s){s&&w(e)}}}function s0(o){let e,t=o[33].name+"",r,n;return{c(){e=_("option"),r=B(t),e.__value=n=o[33].id,Ye(e,e.__value)},m(s,i){x(s,e,i),y(e,r)},p(s,i){i[0]&8&&t!==(t=s[33].name+"")&&Y(r,t),i[0]&8&&n!==(n=s[33].id)&&(e.__value=n,Ye(e,e.__value))},d(s){s&&w(e)}}}function p3(o){let e,t,r,n,s,i,a=o[0].user&&n0(o),l=he(o[3]),c=[];for(let u=0;u<l.length;u+=1)c[u]=s0(o0(o,l,u));return{c(){e=_("select"),a&&a.c(),t=me();for(let u=0;u<c.length;u+=1)c[u].c();h(e,"class","owner-select"),e.disabled=n=o[8]<=1},m(u,f){x(u,e,f),a&&a.m(e,null),y(e,t);for(let d=0;d<c.length;d+=1)c[d]&&c[d].m(e,null);In(e,o[16]()),s||(i=V(e,"change",o[15]),s=!0)},p(u,f){if(u[0].user?a?a.p(u,f):(a=n0(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),f[0]&8){l=he(u[3]);let d;for(d=0;d<l.length;d+=1){let m=o0(u,l,d);c[d]?c[d].p(m,f):(c[d]=s0(m),c[d].c(),c[d].m(e,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=l.length}f[0]&256&&n!==(n=u[8]<=1)&&(e.disabled=n)},d(u){u&&w(e),a&&a.d(),je(c,u),s=!1,i()}}}function i0(o){let e,t=o[2].submit+"",r;return{c(){e=_("div"),r=B(t),h(e,"class","error-message svelte-1yric5k")},m(n,s){x(n,e,s),y(e,r)},p(n,s){s[0]&4&&t!==(t=n[2].submit+"")&&Y(r,t)},d(n){n&&w(e)}}}function a0(o){let e;return{c(){e=_("div"),e.textContent="Legacy host",h(e,"class","host-key-indicator svelte-1yric5k")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function l0(o,e){let t,r,n,s=e[30].url+"",i,a,l,c,u,f=e[30].keyType==="legacy"&&a0(e);function d(){return e[22](e[30])}function m(...p){return e[23](e[30],...p)}return{key:o,first:null,c(){var p;t=_("div"),r=_("div"),n=_("div"),i=B(s),a=F(),f&&f.c(),l=F(),h(n,"class","host-url svelte-1yric5k"),h(r,"class","host-info svelte-1yric5k"),h(t,"class","host-card svelte-1yric5k"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to select this host"),Me(t,"active",((p=e[10])==null?void 0:p.id)===e[30].id),this.first=t},m(p,v){x(p,t,v),y(t,r),y(r,n),y(n,i),y(r,a),f&&f.m(r,null),y(t,l),c||(u=[V(t,"click",d),V(t,"keydown",m)],c=!0)},p(p,v){var g;e=p,v[0]&2049&&s!==(s=e[30].url+"")&&Y(i,s),e[30].keyType==="legacy"?f||(f=a0(e),f.c(),f.m(r,null)):f&&(f.d(1),f=null),v[0]&3073&&Me(t,"active",((g=e[10])==null?void 0:g.id)===e[30].id)},d(p){p&&w(t),f&&f.d(),c=!1,ve(u)}}}function c0(o){let e,t,r,n,s,i,a,l,c=[y3,g3,h3,m3],u=[];function f(d,m){return d[5]?0:d[6]?1:d[7]?2:3}return i=f(o,[-1,-1]),a=u[i]=c[i](o),{c(){e=_("div"),t=_("div"),t.textContent="Relay Server Configuration",r=F(),n=_("div"),n.textContent="Copy this configuration to your Relay Server's TOML file.",s=F(),a.c(),h(t,"class","setting-item-name"),h(n,"class","setting-item-description"),h(e,"class","public-key-section svelte-1yric5k")},m(d,m){x(d,e,m),y(e,t),y(e,r),y(e,n),y(e,s),u[i].m(e,null),l=!0},p(d,m){let p=i;i=f(d,m),i===p?u[i].p(d,m):(oe(),S(u[p],1,1,()=>{u[p]=null}),ne(),a=u[i],a?a.p(d,m):(a=u[i]=c[i](d),a.c()),b(a,1),a.m(e,null))},i(d){l||(b(a),l=!0)},o(d){S(a),l=!1},d(d){d&&w(e),u[i].d()}}}function m3(o){let e;return{c(){e=_("div"),e.textContent="No configuration available",h(e,"class","error-message svelte-1yric5k")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function h3(o){let e,t;return e=new ou({props:{toml:o[7]}}),{c(){U(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.toml=r[7]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){S(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function g3(o){let e,t;return{c(){e=_("div"),t=B(o[6]),h(e,"class","error-message svelte-1yric5k")},m(r,n){x(r,e,n),y(e,t)},p(r,n){n[0]&64&&Y(t,r[6])},i:H,o:H,d(r){r&&w(e)}}}function y3(o){let e;return{c(){e=_("div"),e.textContent="Loading configuration...",h(e,"class","loading-message svelte-1yric5k")},m(t,r){x(t,e,r)},p:H,i:H,o:H,d(t){t&&w(e)}}}function v3(o){let e;return{c(){e=B("Create Relay Server")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function b3(o){let e;return{c(){e=B("Creating...")},m(t,r){x(t,e,r)},d(t){t&&w(e)}}}function _3(o){let e,t,r,n,s,i,a,l,c,u,f,d,m=[],p=new Map,v,g,I,L,k,C,T,A,E,P,M,$,W;n=new Ue({props:{name:"Owner",description:"Select who will own this self-hosted relay server.",$$slots:{default:[p3]},$$scope:{ctx:o}}});let O=o[2].submit&&i0(o),N=he(o[11].values().filter(o[21])),te=q=>q[30].id;for(let q=0;q<N.length;q+=1){let X=r0(o,N,q),fe=te(X);p.set(fe,m[q]=l0(fe,X))}let Z=!o[10]&&c0(o);function Q(q,X){return q[4]?b3:v3}let ye=Q(o,[-1,-1]),z=ye(o);return{c(){e=_("div"),t=_("div"),t.innerHTML=`<p>Create a new self-hosted Relay Server. Select an existing host or add a
			new one.</p>`,r=F(),U(n.$$.fragment),s=F(),O&&O.c(),i=F(),a=_("div"),l=_("div"),l.textContent="Relay Server URL",c=F(),u=_("div"),u.textContent=`This should be accessible to users within your private network, but not
			exposed to the public internet.`,f=F(),d=_("div");for(let q=0;q<m.length;q+=1)m[q].c();v=F(),g=_("div"),I=_("div"),L=_("input"),C=F(),Z&&Z.c(),T=F(),A=_("div"),E=_("button"),z.c(),h(t,"class","setting-item-description"),ae(t,"margin-bottom","16px"),h(l,"class","setting-item-name"),h(u,"class","setting-item-description"),h(L,"type","url"),h(L,"placeholder","https://relay.my-corp.ts.net"),h(L,"class","host-url-input svelte-1yric5k"),h(L,"title",k=o[2].url),Me(L,"host-input-invalid",o[2].url),h(I,"class","host-info svelte-1yric5k"),h(g,"class","host-card add-host-card svelte-1yric5k"),h(d,"class","host-list svelte-1yric5k"),h(a,"class","host-list-section svelte-1yric5k"),h(E,"class","mod-cta"),E.disabled=P=o[4]||!o[10]&&(!o[1].trim()||!!o[2].url),h(A,"class","modal-button-container svelte-1yric5k"),h(e,"class","self-host-modal svelte-1yric5k")},m(q,X){x(q,e,X),y(e,t),y(e,r),D(n,e,null),y(e,s),O&&O.m(e,null),y(e,i),y(e,a),y(a,l),y(a,c),y(a,u),y(a,f),y(a,d);for(let fe=0;fe<m.length;fe+=1)m[fe]&&m[fe].m(d,null);y(d,v),y(d,g),y(g,I),y(I,L),Ye(L,o[1]),y(e,C),Z&&Z.m(e,null),y(e,T),y(e,A),y(A,E),z.m(E,null),M=!0,$||(W=[V(L,"click",o[24]),V(L,"input",o[25]),V(E,"click",o[14])],$=!0)},p(q,X){let fe={};X[0]&265|X[1]&32&&(fe.$$scope={dirty:X,ctx:q}),n.$set(fe),q[2].submit?O?O.p(q,X):(O=i0(q),O.c(),O.m(e,i)):O&&(O.d(1),O=null),X[0]&11265&&(N=he(q[11].values().filter(q[21])),m=mr(m,X,te,1,q,N,p,d,si,l0,v,r0)),(!M||X[0]&4&&k!==(k=q[2].url))&&h(L,"title",k),X[0]&2&&L.value!==q[1]&&Ye(L,q[1]),(!M||X[0]&4)&&Me(L,"host-input-invalid",q[2].url),q[10]?Z&&(oe(),S(Z,1,1,()=>{Z=null}),ne()):Z?(Z.p(q,X),X[0]&1024&&b(Z,1)):(Z=c0(q),Z.c(),b(Z,1),Z.m(e,T)),ye!==(ye=Q(q,X))&&(z.d(1),z=ye(q),z&&(z.c(),z.m(E,null))),(!M||X[0]&1046&&P!==(P=q[4]||!q[10]&&(!q[1].trim()||!!q[2].url)))&&(E.disabled=P)},i(q){M||(b(n.$$.fragment,q),b(Z),M=!0)},o(q){S(n.$$.fragment,q),S(Z),M=!1},d(q){q&&w(e),R(n),O&&O.d();for(let X=0;X<m.length;X+=1)m[X].d();Z&&Z.d(),z.d(),$=!1,ve(W)}}}function u0(o){if(!o.trim())return"URL is required";try{let e=new URL(o);return["http:","https:"].includes(e.protocol)?void 0:"URL must use http or https protocol"}catch(e){return"Please enter a valid URL"}}function w3(o,e,t){let r,n,s,i,a,l=H,c=()=>(l(),l=At(r,q=>t(11,a=q)),r);o.$$.on_destroy.push(()=>l());let{onConfirm:u}=e,{relayManager:f}=e,d="",m=!1,p={},v=Ie(null);le(o,v,q=>t(10,i=q));let g=null,I=!1,L=!1,k=null,C="",T="",A=null;function E(){t(2,p={});let q=u0(d);return q&&t(2,p.url=q,p),Object.keys(p).length===0}function P(q){v.set(q)}function M(){v.set(null),t(1,d=""),t(2,p={})}function $(){return Ae(this,void 0,void 0,function*(){p.submit&&(delete p.submit,t(2,p),t(1,d),t(18,g));let q=(A==null?void 0:A.type)==="org"?A.org.id:void 0;if(i){t(4,m=!0);try{yield u(void 0,i.id,q)}catch(X){t(2,p.submit=X instanceof Error?X.message:"Failed to create relay: Unknown error",p),t(2,p),t(1,d),t(18,g)}finally{t(4,m=!1)}}else{if(!E()||m)return;t(4,m=!0);try{yield u(d.trim(),void 0,q)}catch(X){t(2,p.submit=X instanceof Error?X.message:"Failed to create relay: Unknown error",p),t(2,p),t(1,d),t(18,g)}finally{t(4,m=!1)}}})}function W(q){q.target.value==="user"&&f.user&&t(20,A={type:"user",user:f.user})}function O(){return A?A.type==="user"?"user":A.org.id:""}function N(){return Ae(this,void 0,void 0,function*(){if(!(f!=null&&f.pb)){t(6,k="Not connected to relay service");return}t(5,L=!0),t(6,k=null);try{let q=f.pb.baseUrl+"/templates/relay.toml",X=yield lt(q,{method:"GET",headers:{Authorization:f.pb.authStore.token?`Bearer ${f.pb.authStore.token}`:""}});t(19,T=yield X.text())}catch(q){t(6,k=q instanceof Error?q.message:"Failed to fetch configuration")}finally{t(5,L=!1)}})}it(()=>{N();let q=f.providers.values().filter(X=>X.selfHosted&&f.relays.some((fe,j)=>fe.providerId===X.id));q.length>0&&v.set(q[0])});let te=q=>q.selfHosted&&f.relays.some((X,fe)=>X.providerId===q.id),Z=q=>P(q),Q=(q,X)=>X.key==="Enter"||X.key===" "?P(q):null,ye=()=>P(null);function z(){d=this.value,t(1,d)}return o.$$set=q=>{"onConfirm"in q&&t(17,u=q.onConfirm),"relayManager"in q&&t(0,f=q.relayManager)},o.$$.update=()=>{o.$$.dirty[0]&1&&c(t(9,r=f.providers)),o.$$.dirty[0]&1048577&&!A&&f.user&&t(20,A={type:"user",user:f.user}),o.$$.dirty[0]&9&&t(8,s=(f.user?1:0)+n.length),o.$$.dirty[0]&262150&&(d.trim()?(I=!0,g&&clearTimeout(g),t(18,g=setTimeout(()=>{let q=u0(d);q?t(2,p.url=q,p):p.url&&(delete p.url,t(2,p),t(1,d),t(18,g))},500))):(p.url&&(delete p.url,t(2,p),t(1,d),t(18,g)),I=!1)),o.$$.dirty[0]&524290&&t(7,C=T?T.replace(/\{url\}/g,d||""):"")},t(3,n=[]),[f,d,p,n,m,L,k,C,s,r,i,a,v,P,$,W,O,u,g,T,A,te,Z,Q,ye,z]}var Mh=class extends G{constructor(e){super(),J(this,e,w3,_3,K,{onConfirm:17,relayManager:0},d3,[-1,-1])}},f0=Mh;var gu=class extends d0.Modal{constructor(t,r,n){super(t);this.relayManager=r;this.onSuccess=n;this.setTitle("Self Host Relay Server")}onOpen(){let{contentEl:t}=this;this.component=new f0({target:t,props:{relayManager:this.relayManager,onConfirm:async(r,n,s)=>{let i=await this.relayManager.createSelfHostedRelay(r,n,s);this.close(),this.onSuccess(i)}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var x3={debugging:!1},S3={release:{channel:"stable"},sharedFolders:[],endpoints:{},...Yi,...x3},yu=class extends h0.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.7.1";this.repo="No-Instructions/Relay"}enableDebugging(t){bl(!0),console.warn("RelayInstances",Nt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){bl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return bl(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return this.loginManager.getEndpointManager().getApiUrl()+t}openEndpointConfigurationModal(){new lu(this.app,this,()=>{this.reload()}).open()}async validateAndApplyEndpoints(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){new ot.Notice("Please configure an enterprise tenant first",4e3);return}let r=new ot.Notice("Validating endpoints...",0);try{let s=await this.loginManager.validateAndApplyEndpoints();r.hide(),s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),new ot.Notice("\u2713 Endpoints validated and applied successfully!",5e3),s.licenseInfo&&this.log("License validation successful:",s.licenseInfo)):(await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Validation failed: ${s.error}`,8e3))}catch(s){r.hide();let i=s instanceof Error?s.message:"Unknown error";await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Validation error: ${i}`,8e3)}}resetToDefaultEndpoints(){this.loginManager.getEndpointManager().clearValidatedEndpoints(),this.endpointSettings.update(()=>({})),new ot.Notice("Reset to default endpoints",3e3)}async validateEndpointsOnStartup(t){var s;let r=this.endpointSettings.get();if(!r.activeTenantId||!((s=r.tenants)!=null&&s.length)){this.log("No active enterprise tenant configured, using defaults");return}let n=r.tenants.find(i=>i.id===r.activeTenantId);if(!n){this.log("Active tenant not found, using defaults");return}this.log("Enterprise tenant configured, validating on startup...",{tenantId:n.id,tenantUrl:n.tenantUrl,tenantName:n.name});try{let i=await t.validateAndSetEndpoints(5e3);i.success?(await this.endpointSettings.update(a=>({...a,_lastValidationError:void 0,_lastValidationAttempt:void 0})),this.log("\u2713 Enterprise tenant validated and applied on startup",{licenseInfo:i.licenseInfo})):(this.error("\u274C Enterprise tenant validation failed on startup",i.error),await this.endpointSettings.update(a=>({...a,_lastValidationError:i.error,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Custom endpoints failed validation: ${i.error}`,8e3))}catch(i){let a=i instanceof Error?i.message:"Unknown error";this.error("Startup endpoint validation error:",a),await this.endpointSettings.update(l=>({...l,_lastValidationError:a,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Endpoint validation error: ${a}`,8e3)}}async onload(){this.appId=this.app.appId;let t=ot.moment.now();Nt.set(this,"plugin"),this.timeProvider=new Hs,this.register(()=>{this.timeProvider.destroy()}),Ky(new du(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new fu,this.debug=Fe("[System 3][Relay]","debug"),this.log=Fe("[System 3][Relay]","log"),this.warn=Fe("[System 3][Relay]","warn"),this.error=Fe("[System 3][Relay]","error"),this.settings=new Xl(this,S3),await this.settings.load(),this.featureSettings=new $r(this.settings,"(enable*)"),this.debugSettings=new $r(this.settings,"(debugging)"),this.folderSettings=new $r(this.settings,"sharedFolders"),this.releaseSettings=new $r(this.settings,"release"),this.loginSettings=new $r(this.settings,"login"),this.endpointSettings=new $r(this.settings,"endpoints"),lr.getInstance().setSettings(this.featureSettings),this.settingsTab=new au(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new hu(this,this.timeProvider,this.releaseSettings),this.register(this.debugSettings.subscribe(a=>{a.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let l=new cu(this.app,()=>{this.reload()});this.openModals.push(l),l.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let l=new pu(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let l=new uu(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let l=new Aa(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let l=new mu(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let l=new Ta(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(l),l.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}));let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.addCommand({id:"open-settings",name:"Open settings",callback:()=>{this.openSettings()}}),this.addCommand({id:"configure-endpoints",name:"Configure enterprise tenant",callback:()=>{this.openEndpointConfigurationModal()}}),He().enableSelfManageHosts&&this.addCommand({id:"register-host",name:"Register self-hosted Relay Server",callback:()=>{let a=new gu(this.app,this.relayManager,l=>{this.openSettings(`/relays?id=${l.id}`)});this.openModals.push(a),a.open()}}),this.register(this.updateManager.subscribe(()=>{let a=this.updateManager.getNewRelease();a?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${a.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(a)}}),this.log(`Update available: v${this.version} \u2192 ${a.tag_name}`)):this.removeCommand("update-plugin")})),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new nc(this.appId);let i=new Vl(this.endpointSettings);await this.validateEndpointsOnStartup(i),this.loginManager=new ql(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings,i),this.relayManager=new Zl(this.loginManager),this.sharedFolders=new cc(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new zl(this.loginManager,this.timeProvider,s,3),this.networkStatus=new ib(this.timeProvider,"https://api.system3.md/health?version=0.7.1"),this.backgroundSync=new sc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new ot.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new Vc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),p0.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(a=>a.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(ai,a=>new Dc(a)),this.registerEvent(this.app.workspace.on("file-menu",(a,l)=>{if(l instanceof ot.TFolder){let c=this.sharedFolders.find(u=>u.path===l.path);if(!c)return;c.relayId?(a.addItem(u=>{u.setTitle("Relay: Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${c.relayId}`)})}),a.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),a.addItem(u=>{u.setTitle(c.connected?"Relay: Disconnect":"Relay: Connect").setIcon("satellite").onClick(()=>{c.connected?(c.shouldConnect=!1,c.disconnect()):(c.shouldConnect=!0,c.connect()),this._liveViews.refresh("folder connection toggle")})})):a.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),c.relayId&&He().enableSyncModal&&a.addItem(u=>{u.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new Ta(this.app,this.backgroundSync,this.sharedFolders,c.guid);this.openModals.push(f),f.open()})}),c.relayId&&c.connected&&a.addItem(u=>{u.setTitle("Relay: Sync").setIcon("folder-sync").onClick(()=>{c.netSync()})})}else if(l instanceof ot.TFile){let c=this.sharedFolders.lookup(l.path),u=c==null?void 0:c.getFile(l);u&&fr(u)&&(a.addItem(f=>{f.setTitle("Relay: Download").setIcon("cloud-download").onClick(async()=>{await u.pull(),new ot.Notice(`Download complete: ${u.name}`)})}),this.debugSettings.get().debugging&&a.addItem(f=>{f.setTitle("Relay: Verify upload").setIcon("search-check").onClick(async()=>{let d=await u.verifyUpload();new ot.Notice(`${u.name} ${d?"on server":"missing from server"}`)})}),a.addItem(f=>{f.setTitle("Relay: Upload").setIcon("cloud-upload").onClick(async()=>{await u.push(!0);let d=await u.verifyUpload();new ot.Notice(`${d?"File uploaded:":"File upload failed:"} ${u.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=ot.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new $r(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:Zs.defaultFlags}),!0),new lc(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let p=d.detail.url;for(let v of t.interceptedUrls)if(typeof v=="string"&&p.startsWith(v)||v instanceof RegExp&&v.test(p))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(d=>{this.debug("Intercepting Webviewer for URL pattern",d.source),this.interceptedUrls.push(d)});let u=this.loginManager.getEndpointManager().getApiUrl(),f=new RegExp(u.replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new jc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Fe("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",a=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Fe("[System 3][Relay][Vault]","log"),n=a=>{},s=a=>n(a);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",a=>{let l=this.sharedFolders.lookup(a.path);l&&(l.placeHold([a]).length>0?l.uploadFile(a):l.whenReady().then(u=>{u.getFile(a)}))})),this.registerEvent(this.app.vault.on("delete",a=>{if(a instanceof ot.TFolder){let c=this.sharedFolders.find(u=>u.path===a.path);if(c){this.sharedFolders.delete(c);return}}let l=this.sharedFolders.lookup(a.path);l&&(r("Delete",a.path),l.whenReady().then(c=>{c.proxy.deleteFile(a.path)}))})),this.registerEvent(this.app.vault.on("rename",(a,l)=>{if(a instanceof ot.TFolder){let d=this.sharedFolders.find(m=>m.path==l);if(d){d.move(a.path),this.sharedFolders.update();return}}let c=this.sharedFolders.lookup(l),u=this.sharedFolders.lookup(a.path),f=c||u;c&&u?(r("Rename",a.path,l),c.renameFile(a,l),u.renameFile(a,l),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):f&&(r("Rename",a.path,l),f.renameFile(a,l),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",a=>{let l=this.sharedFolders.lookup(a.path);if(l){r("Modify",a.path);let c=l.proxy.getFile(a);c&&fr(c)&&c.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",c)},10)}}));let i=this;hr().patch(ot.MarkdownView.prototype,{onUnloadFile(a){return function(l){return i._liveViews.wipe(),a.call(this,l)}}}),hr().patch(this.app.vault,{process(a){return function(l,c,u){try{let f=i.sharedFolders.lookup(l.path);if(f){let d=f.proxy.getFile(l);l instanceof ot.TFile&&d&&oo(d)&&d.process(c)}}catch(f){i.log(f)}return a.call(this,l,c,u)}}}),this.patchWebviewer(),yn(qo.enableNewLinkFormat,()=>{hr().patch(ot.MetadataCache.prototype,{fileToLinktext(a){return function(l,c,u){if(i.sharedFolders.lookup(l.path)){u===void 0&&(u=!0);let d=l.extension==="md"&&u?l.basename:l.name,m=(0,ot.normalizePath)(l.name),p=i.app.metadataCache.uniqueFileLookup.get(m.toLowerCase());if(p&&p.length===1&&p[0]===l)return d;{let v=l.extension==="md"&&u?l.path.slice(0,l.path.length-3):l.path,g=(0,m0.relative)(c,v);return g==="../"+d?"./"+d:g}}return a.call(this,l,c,u)}}})}),this.registerObsidianProtocolHandler("relay/settings/relays",async a=>{let l=a,c=new URLSearchParams({...l}).toString(),u=`/${l.action.split("/").slice(-1)}?${c}`;this.openSettings(u)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async a=>{let l=a,c=new URLSearchParams({...l}).toString(),u=`/${l.action.split("/").slice(-1)}?${c}`;this.openSettings(u)}),this.registerObsidianProtocolHandler("relay/upgrade",async a=>{var u;let c=(u=a.version)==null?void 0:u.trim();this.installVersion(c)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Aa(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,ot.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,u,f,d,m,p,v;wa.destroy(),(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(ai),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(f=this.sharedFolders)==null||f.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(m=this.loginManager)==null||m.destroy(),this.loginManager=null,(p=this.backgroundSync)==null||p.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(v=this.app)==null||v.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,lr.destroy(),this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.endpointSettings.destroy(),this.endpointSettings=null,this.interceptedUrls.length=0,Qr.destroy(),this.notifier=null,tv(),Of()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
lucide-svelte/dist/icons/arrow-right-left.svelte:
lucide-svelte/dist/icons/arrow-right.svelte:
lucide-svelte/dist/icons/arrow-up-down.svelte:
lucide-svelte/dist/icons/check.svelte:
lucide-svelte/dist/icons/chevron-left.svelte:
lucide-svelte/dist/icons/chevron-right.svelte:
lucide-svelte/dist/icons/circle-alert.svelte:
lucide-svelte/dist/icons/circle-check-big.svelte:
lucide-svelte/dist/icons/circle-help.svelte:
lucide-svelte/dist/icons/clock.svelte:
lucide-svelte/dist/icons/download.svelte:
lucide-svelte/dist/icons/folder-lock.svelte:
lucide-svelte/dist/icons/folder-open.svelte:
lucide-svelte/dist/icons/folder.svelte:
lucide-svelte/dist/icons/home.svelte:
lucide-svelte/dist/icons/info.svelte:
lucide-svelte/dist/icons/layers.svelte:
lucide-svelte/dist/icons/lock.svelte:
lucide-svelte/dist/icons/message-square-heart.svelte:
lucide-svelte/dist/icons/pause.svelte:
lucide-svelte/dist/icons/play.svelte:
lucide-svelte/dist/icons/refresh-cw.svelte:
lucide-svelte/dist/icons/satellite.svelte:
lucide-svelte/dist/icons/settings.svelte:
lucide-svelte/dist/icons/square-pen.svelte:
lucide-svelte/dist/icons/triangle-alert.svelte:
lucide-svelte/dist/icons/upload.svelte:
lucide-svelte/dist/icons/x.svelte:
lucide-svelte/dist/icons/index.js:
lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */